(function(ee){typeof define=="function"&&define.amd?define(ee):ee()})(function(){"use strict";var Qm=Object.defineProperty;var ey=(ee,Me,ft)=>Me in ee?Qm(ee,Me,{enumerable:!0,configurable:!0,writable:!0,value:ft}):ee[Me]=ft;var Ae=(ee,Me,ft)=>(ey(ee,typeof Me!="symbol"?Me+"":Me,ft),ft);var ee=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Me(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ft(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var a=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return n[r]}})}),t}var bs={exports:{}};function Bt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var la={exports:{}};const Zc=ft(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var vs;function pe(){return vs||(vs=1,function(n,e){(function(t,r){n.exports=r()})(ee,function(){var t=t||function(r,a){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof ee<"u"&&ee.crypto&&(i=ee.crypto),!i&&typeof Bt=="function")try{i=Zc}catch{}var s=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function _(){}return function(w){var C;return _.prototype=w,C=new _,_.prototype=null,C}}(),c={},u=c.lib={},d=u.Base=function(){return{extend:function(_){var w=o(this);return _&&w.mixIn(_),(!w.hasOwnProperty("init")||this.init===w.init)&&(w.init=function(){w.$super.init.apply(this,arguments)}),w.init.prototype=w,w.$super=this,w},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var w in _)_.hasOwnProperty(w)&&(this[w]=_[w]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),y=u.WordArray=d.extend({init:function(_,w){_=this.words=_||[],w!=a?this.sigBytes=w:this.sigBytes=_.length*4},toString:function(_){return(_||v).stringify(this)},concat:function(_){var w=this.words,C=_.words,D=this.sigBytes,A=_.sigBytes;if(this.clamp(),D%4)for(var k=0;k<A;k++){var b=C[k>>>2]>>>24-k%4*8&255;w[D+k>>>2]|=b<<24-(D+k)%4*8}else for(var I=0;I<A;I+=4)w[D+I>>>2]=C[I>>>2];return this.sigBytes+=A,this},clamp:function(){var _=this.words,w=this.sigBytes;_[w>>>2]&=4294967295<<32-w%4*8,_.length=r.ceil(w/4)},clone:function(){var _=d.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var w=[],C=0;C<_;C+=4)w.push(s());return new y.init(w,_)}}),f=c.enc={},v=f.Hex={stringify:function(_){for(var w=_.words,C=_.sigBytes,D=[],A=0;A<C;A++){var k=w[A>>>2]>>>24-A%4*8&255;D.push((k>>>4).toString(16)),D.push((k&15).toString(16))}return D.join("")},parse:function(_){for(var w=_.length,C=[],D=0;D<w;D+=2)C[D>>>3]|=parseInt(_.substr(D,2),16)<<24-D%8*4;return new y.init(C,w/2)}},p=f.Latin1={stringify:function(_){for(var w=_.words,C=_.sigBytes,D=[],A=0;A<C;A++){var k=w[A>>>2]>>>24-A%4*8&255;D.push(String.fromCharCode(k))}return D.join("")},parse:function(_){for(var w=_.length,C=[],D=0;D<w;D++)C[D>>>2]|=(_.charCodeAt(D)&255)<<24-D%4*8;return new y.init(C,w)}},P=f.Utf8={stringify:function(_){try{return decodeURIComponent(escape(p.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return p.parse(unescape(encodeURIComponent(_)))}},m=u.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new y.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=P.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var w,C=this._data,D=C.words,A=C.sigBytes,k=this.blockSize,b=k*4,I=A/b;_?I=r.ceil(I):I=r.max((I|0)-this._minBufferSize,0);var h=I*k,O=r.min(h*4,A);if(h){for(var R=0;R<h;R+=k)this._doProcessBlock(D,R);w=D.splice(0,h),C.sigBytes-=O}return new y.init(w,O)},clone:function(){var _=d.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0});u.Hasher=m.extend({cfg:d.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var w=this._doFinalize();return w},blockSize:16,_createHelper:function(_){return function(w,C){return new _.init(C).finalize(w)}},_createHmacHelper:function(_){return function(w,C){return new T.HMAC.init(_,C).finalize(w)}}});var T=c.algo={};return c}(Math);return t})}(la)),la.exports}var da={exports:{}},_s;function br(){return _s||(_s=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(r){var a=t,i=a.lib,s=i.Base,o=i.WordArray,c=a.x64={};c.Word=s.extend({init:function(u,d){this.high=u,this.low=d}}),c.WordArray=s.extend({init:function(u,d){u=this.words=u||[],d!=r?this.sigBytes=d:this.sigBytes=u.length*8},toX32:function(){for(var u=this.words,d=u.length,y=[],f=0;f<d;f++){var v=u[f];y.push(v.high),y.push(v.low)}return o.create(y,this.sigBytes)},clone:function(){for(var u=s.clone.call(this),d=u.words=this.words.slice(0),y=d.length,f=0;f<y;f++)d[f]=d[f].clone();return u}})}(),t})}(da)),da.exports}var ha={exports:{}},ws;function Kc(){return ws||(ws=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,a=r.lib,i=a.WordArray,s=i.init,o=i.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var u=c.byteLength,d=[],y=0;y<u;y++)d[y>>>2]|=c[y]<<24-y%4*8;s.call(this,d,u)}else s.apply(this,arguments)};o.prototype=i}}(),t.lib.WordArray})}(ha)),ha.exports}var fa={exports:{}},xs;function Vc(){return xs||(xs=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.enc;s.Utf16=s.Utf16BE={stringify:function(c){for(var u=c.words,d=c.sigBytes,y=[],f=0;f<d;f+=2){var v=u[f>>>2]>>>16-f%4*8&65535;y.push(String.fromCharCode(v))}return y.join("")},parse:function(c){for(var u=c.length,d=[],y=0;y<u;y++)d[y>>>1]|=c.charCodeAt(y)<<16-y%2*16;return i.create(d,u*2)}},s.Utf16LE={stringify:function(c){for(var u=c.words,d=c.sigBytes,y=[],f=0;f<d;f+=2){var v=o(u[f>>>2]>>>16-f%4*8&65535);y.push(String.fromCharCode(v))}return y.join("")},parse:function(c){for(var u=c.length,d=[],y=0;y<u;y++)d[y>>>1]|=o(c.charCodeAt(y)<<16-y%2*16);return i.create(d,u*2)}};function o(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(fa)),fa.exports}var pa={exports:{}},Ps;function It(){return Ps||(Ps=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.enc;s.Base64={stringify:function(c){var u=c.words,d=c.sigBytes,y=this._map;c.clamp();for(var f=[],v=0;v<d;v+=3)for(var p=u[v>>>2]>>>24-v%4*8&255,P=u[v+1>>>2]>>>24-(v+1)%4*8&255,m=u[v+2>>>2]>>>24-(v+2)%4*8&255,T=p<<16|P<<8|m,_=0;_<4&&v+_*.75<d;_++)f.push(y.charAt(T>>>6*(3-_)&63));var w=y.charAt(64);if(w)for(;f.length%4;)f.push(w);return f.join("")},parse:function(c){var u=c.length,d=this._map,y=this._reverseMap;if(!y){y=this._reverseMap=[];for(var f=0;f<d.length;f++)y[d.charCodeAt(f)]=f}var v=d.charAt(64);if(v){var p=c.indexOf(v);p!==-1&&(u=p)}return o(c,u,y)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function o(c,u,d){for(var y=[],f=0,v=0;v<u;v++)if(v%4){var p=d[c.charCodeAt(v-1)]<<v%4*2,P=d[c.charCodeAt(v)]>>>6-v%4*2,m=p|P;y[f>>>2]|=m<<24-f%4*8,f++}return i.create(y,f)}}(),t.enc.Base64})}(pa)),pa.exports}var ma={exports:{}},As;function Fc(){return As||(As=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.enc;s.Base64url={stringify:function(c,u=!0){var d=c.words,y=c.sigBytes,f=u?this._safe_map:this._map;c.clamp();for(var v=[],p=0;p<y;p+=3)for(var P=d[p>>>2]>>>24-p%4*8&255,m=d[p+1>>>2]>>>24-(p+1)%4*8&255,T=d[p+2>>>2]>>>24-(p+2)%4*8&255,_=P<<16|m<<8|T,w=0;w<4&&p+w*.75<y;w++)v.push(f.charAt(_>>>6*(3-w)&63));var C=f.charAt(64);if(C)for(;v.length%4;)v.push(C);return v.join("")},parse:function(c,u=!0){var d=c.length,y=u?this._safe_map:this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var v=0;v<y.length;v++)f[y.charCodeAt(v)]=v}var p=y.charAt(64);if(p){var P=c.indexOf(p);P!==-1&&(d=P)}return o(c,d,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function o(c,u,d){for(var y=[],f=0,v=0;v<u;v++)if(v%4){var p=d[c.charCodeAt(v-1)]<<v%4*2,P=d[c.charCodeAt(v)]>>>6-v%4*2,m=p|P;y[f>>>2]|=m<<24-f%4*8,f++}return i.create(y,f)}}(),t.enc.Base64url})}(ma)),ma.exports}var ya={exports:{}},Is;function Et(){return Is||(Is=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.algo,u=[];(function(){for(var P=0;P<64;P++)u[P]=r.abs(r.sin(P+1))*4294967296|0})();var d=c.MD5=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(P,m){for(var T=0;T<16;T++){var _=m+T,w=P[_];P[_]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var C=this._hash.words,D=P[m+0],A=P[m+1],k=P[m+2],b=P[m+3],I=P[m+4],h=P[m+5],O=P[m+6],R=P[m+7],z=P[m+8],Z=P[m+9],Y=P[m+10],H=P[m+11],te=P[m+12],ne=P[m+13],M=P[m+14],Q=P[m+15],$=C[0],F=C[1],W=C[2],K=C[3];$=y($,F,W,K,D,7,u[0]),K=y(K,$,F,W,A,12,u[1]),W=y(W,K,$,F,k,17,u[2]),F=y(F,W,K,$,b,22,u[3]),$=y($,F,W,K,I,7,u[4]),K=y(K,$,F,W,h,12,u[5]),W=y(W,K,$,F,O,17,u[6]),F=y(F,W,K,$,R,22,u[7]),$=y($,F,W,K,z,7,u[8]),K=y(K,$,F,W,Z,12,u[9]),W=y(W,K,$,F,Y,17,u[10]),F=y(F,W,K,$,H,22,u[11]),$=y($,F,W,K,te,7,u[12]),K=y(K,$,F,W,ne,12,u[13]),W=y(W,K,$,F,M,17,u[14]),F=y(F,W,K,$,Q,22,u[15]),$=f($,F,W,K,A,5,u[16]),K=f(K,$,F,W,O,9,u[17]),W=f(W,K,$,F,H,14,u[18]),F=f(F,W,K,$,D,20,u[19]),$=f($,F,W,K,h,5,u[20]),K=f(K,$,F,W,Y,9,u[21]),W=f(W,K,$,F,Q,14,u[22]),F=f(F,W,K,$,I,20,u[23]),$=f($,F,W,K,Z,5,u[24]),K=f(K,$,F,W,M,9,u[25]),W=f(W,K,$,F,b,14,u[26]),F=f(F,W,K,$,z,20,u[27]),$=f($,F,W,K,ne,5,u[28]),K=f(K,$,F,W,k,9,u[29]),W=f(W,K,$,F,R,14,u[30]),F=f(F,W,K,$,te,20,u[31]),$=v($,F,W,K,h,4,u[32]),K=v(K,$,F,W,z,11,u[33]),W=v(W,K,$,F,H,16,u[34]),F=v(F,W,K,$,M,23,u[35]),$=v($,F,W,K,A,4,u[36]),K=v(K,$,F,W,I,11,u[37]),W=v(W,K,$,F,R,16,u[38]),F=v(F,W,K,$,Y,23,u[39]),$=v($,F,W,K,ne,4,u[40]),K=v(K,$,F,W,D,11,u[41]),W=v(W,K,$,F,b,16,u[42]),F=v(F,W,K,$,O,23,u[43]),$=v($,F,W,K,Z,4,u[44]),K=v(K,$,F,W,te,11,u[45]),W=v(W,K,$,F,Q,16,u[46]),F=v(F,W,K,$,k,23,u[47]),$=p($,F,W,K,D,6,u[48]),K=p(K,$,F,W,R,10,u[49]),W=p(W,K,$,F,M,15,u[50]),F=p(F,W,K,$,h,21,u[51]),$=p($,F,W,K,te,6,u[52]),K=p(K,$,F,W,b,10,u[53]),W=p(W,K,$,F,Y,15,u[54]),F=p(F,W,K,$,A,21,u[55]),$=p($,F,W,K,z,6,u[56]),K=p(K,$,F,W,Q,10,u[57]),W=p(W,K,$,F,O,15,u[58]),F=p(F,W,K,$,ne,21,u[59]),$=p($,F,W,K,I,6,u[60]),K=p(K,$,F,W,H,10,u[61]),W=p(W,K,$,F,k,15,u[62]),F=p(F,W,K,$,Z,21,u[63]),C[0]=C[0]+$|0,C[1]=C[1]+F|0,C[2]=C[2]+W|0,C[3]=C[3]+K|0},_doFinalize:function(){var P=this._data,m=P.words,T=this._nDataBytes*8,_=P.sigBytes*8;m[_>>>5]|=128<<24-_%32;var w=r.floor(T/4294967296),C=T;m[(_+64>>>9<<4)+15]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,m[(_+64>>>9<<4)+14]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,P.sigBytes=(m.length+1)*4,this._process();for(var D=this._hash,A=D.words,k=0;k<4;k++){var b=A[k];A[k]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360}return D},clone:function(){var P=o.clone.call(this);return P._hash=this._hash.clone(),P}});function y(P,m,T,_,w,C,D){var A=P+(m&T|~m&_)+w+D;return(A<<C|A>>>32-C)+m}function f(P,m,T,_,w,C,D){var A=P+(m&_|T&~_)+w+D;return(A<<C|A>>>32-C)+m}function v(P,m,T,_,w,C,D){var A=P+(m^T^_)+w+D;return(A<<C|A>>>32-C)+m}function p(P,m,T,_,w,C,D){var A=P+(T^(m|~_))+w+D;return(A<<C|A>>>32-C)+m}a.MD5=o._createHelper(d),a.HmacMD5=o._createHmacHelper(d)}(Math),t.MD5})}(ya)),ya.exports}var ga={exports:{}},Es;function ba(){return Es||(Es=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=a.Hasher,o=r.algo,c=[],u=o.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,y){for(var f=this._hash.words,v=f[0],p=f[1],P=f[2],m=f[3],T=f[4],_=0;_<80;_++){if(_<16)c[_]=d[y+_]|0;else{var w=c[_-3]^c[_-8]^c[_-14]^c[_-16];c[_]=w<<1|w>>>31}var C=(v<<5|v>>>27)+T+c[_];_<20?C+=(p&P|~p&m)+1518500249:_<40?C+=(p^P^m)+1859775393:_<60?C+=(p&P|p&m|P&m)-1894007588:C+=(p^P^m)-899497514,T=m,m=P,P=p<<30|p>>>2,p=v,v=C}f[0]=f[0]+v|0,f[1]=f[1]+p|0,f[2]=f[2]+P|0,f[3]=f[3]+m|0,f[4]=f[4]+T|0},_doFinalize:function(){var d=this._data,y=d.words,f=this._nDataBytes*8,v=d.sigBytes*8;return y[v>>>5]|=128<<24-v%32,y[(v+64>>>9<<4)+14]=Math.floor(f/4294967296),y[(v+64>>>9<<4)+15]=f,d.sigBytes=y.length*4,this._process(),this._hash},clone:function(){var d=s.clone.call(this);return d._hash=this._hash.clone(),d}});r.SHA1=s._createHelper(u),r.HmacSHA1=s._createHmacHelper(u)}(),t.SHA1})}(ga)),ga.exports}var va={exports:{}},Os;function Cs(){return Os||(Os=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.algo,u=[],d=[];(function(){function v(T){for(var _=r.sqrt(T),w=2;w<=_;w++)if(!(T%w))return!1;return!0}function p(T){return(T-(T|0))*4294967296|0}for(var P=2,m=0;m<64;)v(P)&&(m<8&&(u[m]=p(r.pow(P,1/2))),d[m]=p(r.pow(P,1/3)),m++),P++})();var y=[],f=c.SHA256=o.extend({_doReset:function(){this._hash=new s.init(u.slice(0))},_doProcessBlock:function(v,p){for(var P=this._hash.words,m=P[0],T=P[1],_=P[2],w=P[3],C=P[4],D=P[5],A=P[6],k=P[7],b=0;b<64;b++){if(b<16)y[b]=v[p+b]|0;else{var I=y[b-15],h=(I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3,O=y[b-2],R=(O<<15|O>>>17)^(O<<13|O>>>19)^O>>>10;y[b]=h+y[b-7]+R+y[b-16]}var z=C&D^~C&A,Z=m&T^m&_^T&_,Y=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),H=(C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25),te=k+H+z+d[b]+y[b],ne=Y+Z;k=A,A=D,D=C,C=w+te|0,w=_,_=T,T=m,m=te+ne|0}P[0]=P[0]+m|0,P[1]=P[1]+T|0,P[2]=P[2]+_|0,P[3]=P[3]+w|0,P[4]=P[4]+C|0,P[5]=P[5]+D|0,P[6]=P[6]+A|0,P[7]=P[7]+k|0},_doFinalize:function(){var v=this._data,p=v.words,P=this._nDataBytes*8,m=v.sigBytes*8;return p[m>>>5]|=128<<24-m%32,p[(m+64>>>9<<4)+14]=r.floor(P/4294967296),p[(m+64>>>9<<4)+15]=P,v.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var v=o.clone.call(this);return v._hash=this._hash.clone(),v}});a.SHA256=o._createHelper(f),a.HmacSHA256=o._createHmacHelper(f)}(Math),t.SHA256})}(va)),va.exports}var _a={exports:{}},Ts;function qc(){return Ts||(Ts=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Cs())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.algo,o=s.SHA256,c=s.SHA224=o.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=o._doFinalize.call(this);return u.sigBytes-=4,u}});r.SHA224=o._createHelper(c),r.HmacSHA224=o._createHmacHelper(c)}(),t.SHA224})}(_a)),_a.exports}var wa={exports:{}},ks;function Ss(){return ks||(ks=1,function(n,e){(function(t,r,a){n.exports=r(pe(),br())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.Hasher,s=r.x64,o=s.Word,c=s.WordArray,u=r.algo;function d(){return o.create.apply(o,arguments)}var y=[d(1116352408,3609767458),d(1899447441,602891725),d(3049323471,3964484399),d(3921009573,2173295548),d(961987163,4081628472),d(1508970993,3053834265),d(2453635748,2937671579),d(2870763221,3664609560),d(3624381080,2734883394),d(310598401,1164996542),d(607225278,1323610764),d(1426881987,3590304994),d(1925078388,4068182383),d(2162078206,991336113),d(2614888103,633803317),d(3248222580,3479774868),d(3835390401,2666613458),d(4022224774,944711139),d(264347078,2341262773),d(604807628,2007800933),d(770255983,1495990901),d(1249150122,1856431235),d(1555081692,3175218132),d(1996064986,2198950837),d(2554220882,3999719339),d(2821834349,766784016),d(2952996808,2566594879),d(3210313671,3203337956),d(3336571891,1034457026),d(3584528711,2466948901),d(113926993,3758326383),d(338241895,168717936),d(666307205,1188179964),d(773529912,1546045734),d(1294757372,1522805485),d(1396182291,2643833823),d(1695183700,2343527390),d(1986661051,1014477480),d(2177026350,1206759142),d(2456956037,344077627),d(2730485921,1290863460),d(2820302411,3158454273),d(3259730800,3505952657),d(3345764771,106217008),d(3516065817,3606008344),d(3600352804,1432725776),d(4094571909,1467031594),d(275423344,851169720),d(430227734,3100823752),d(506948616,1363258195),d(659060556,3750685593),d(883997877,3785050280),d(958139571,3318307427),d(1322822218,3812723403),d(1537002063,2003034995),d(1747873779,3602036899),d(1955562222,1575990012),d(2024104815,1125592928),d(2227730452,2716904306),d(2361852424,442776044),d(2428436474,593698344),d(2756734187,3733110249),d(3204031479,2999351573),d(3329325298,3815920427),d(3391569614,3928383900),d(3515267271,566280711),d(3940187606,3454069534),d(4118630271,4000239992),d(116418474,1914138554),d(174292421,2731055270),d(289380356,3203993006),d(460393269,320620315),d(685471733,587496836),d(852142971,1086792851),d(1017036298,365543100),d(1126000580,2618297676),d(1288033470,3409855158),d(1501505948,4234509866),d(1607167915,987167468),d(1816402316,1246189591)],f=[];(function(){for(var p=0;p<80;p++)f[p]=d()})();var v=u.SHA512=i.extend({_doReset:function(){this._hash=new c.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(p,P){for(var m=this._hash.words,T=m[0],_=m[1],w=m[2],C=m[3],D=m[4],A=m[5],k=m[6],b=m[7],I=T.high,h=T.low,O=_.high,R=_.low,z=w.high,Z=w.low,Y=C.high,H=C.low,te=D.high,ne=D.low,M=A.high,Q=A.low,$=k.high,F=k.low,W=b.high,K=b.low,oe=I,le=h,we=O,U=R,x=z,S=Z,B=Y,G=H,V=te,J=ne,se=M,ue=Q,me=$,ye=F,ve=W,ge=K,he=0;he<80;he++){var de,xe,He=f[he];if(he<16)xe=He.high=p[P+he*2]|0,de=He.low=p[P+he*2+1]|0;else{var Jn=f[he-15],ae=Jn.high,At=Jn.low,Qn=(ae>>>1|At<<31)^(ae>>>8|At<<24)^ae>>>7,gr=(At>>>1|ae<<31)^(At>>>8|ae<<24)^(At>>>7|ae<<25),ea=f[he-2],dt=ea.high,ht=ea.low,rs=(dt>>>19|ht<<13)^(dt<<3|ht>>>29)^dt>>>6,ta=(ht>>>19|dt<<13)^(ht<<3|dt>>>29)^(ht>>>6|dt<<26),ra=f[he-7],ns=ra.high,as=ra.low,na=f[he-16],is=na.high,aa=na.low;de=gr+as,xe=Qn+ns+(de>>>0<gr>>>0?1:0),de=de+ta,xe=xe+rs+(de>>>0<ta>>>0?1:0),de=de+aa,xe=xe+is+(de>>>0<aa>>>0?1:0),He.high=xe,He.low=de}var ss=V&se^~V&me,ia=J&ue^~J&ye,os=oe&we^oe&x^we&x,us=le&U^le&S^U&S,cs=(oe>>>28|le<<4)^(oe<<30|le>>>2)^(oe<<25|le>>>7),sa=(le>>>28|oe<<4)^(le<<30|oe>>>2)^(le<<25|oe>>>7),ls=(V>>>14|J<<18)^(V>>>18|J<<14)^(V<<23|J>>>9),ds=(J>>>14|V<<18)^(J>>>18|V<<14)^(J<<23|V>>>9),oa=y[he],hs=oa.high,ua=oa.low,$e=ge+ds,tt=ve+ls+($e>>>0<ge>>>0?1:0),$e=$e+ia,tt=tt+ss+($e>>>0<ia>>>0?1:0),$e=$e+ua,tt=tt+hs+($e>>>0<ua>>>0?1:0),$e=$e+de,tt=tt+xe+($e>>>0<de>>>0?1:0),ca=sa+us,fs=cs+os+(ca>>>0<sa>>>0?1:0);ve=me,ge=ye,me=se,ye=ue,se=V,ue=J,J=G+$e|0,V=B+tt+(J>>>0<G>>>0?1:0)|0,B=x,G=S,x=we,S=U,we=oe,U=le,le=$e+ca|0,oe=tt+fs+(le>>>0<$e>>>0?1:0)|0}h=T.low=h+le,T.high=I+oe+(h>>>0<le>>>0?1:0),R=_.low=R+U,_.high=O+we+(R>>>0<U>>>0?1:0),Z=w.low=Z+S,w.high=z+x+(Z>>>0<S>>>0?1:0),H=C.low=H+G,C.high=Y+B+(H>>>0<G>>>0?1:0),ne=D.low=ne+J,D.high=te+V+(ne>>>0<J>>>0?1:0),Q=A.low=Q+ue,A.high=M+se+(Q>>>0<ue>>>0?1:0),F=k.low=F+ye,k.high=$+me+(F>>>0<ye>>>0?1:0),K=b.low=K+ge,b.high=W+ve+(K>>>0<ge>>>0?1:0)},_doFinalize:function(){var p=this._data,P=p.words,m=this._nDataBytes*8,T=p.sigBytes*8;P[T>>>5]|=128<<24-T%32,P[(T+128>>>10<<5)+30]=Math.floor(m/4294967296),P[(T+128>>>10<<5)+31]=m,p.sigBytes=P.length*4,this._process();var _=this._hash.toX32();return _},clone:function(){var p=i.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=i._createHelper(v),r.HmacSHA512=i._createHmacHelper(v)}(),t.SHA512})}(wa)),wa.exports}var xa={exports:{}},Rs;function Hc(){return Rs||(Rs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),br(),Ss())})(ee,function(t){return function(){var r=t,a=r.x64,i=a.Word,s=a.WordArray,o=r.algo,c=o.SHA512,u=o.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var d=c._doFinalize.call(this);return d.sigBytes-=16,d}});r.SHA384=c._createHelper(u),r.HmacSHA384=c._createHmacHelper(u)}(),t.SHA384})}(xa)),xa.exports}var Pa={exports:{}},js;function Wc(){return js||(js=1,function(n,e){(function(t,r,a){n.exports=r(pe(),br())})(ee,function(t){return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.x64,u=c.Word,d=a.algo,y=[],f=[],v=[];(function(){for(var m=1,T=0,_=0;_<24;_++){y[m+5*T]=(_+1)*(_+2)/2%64;var w=T%5,C=(2*m+3*T)%5;m=w,T=C}for(var m=0;m<5;m++)for(var T=0;T<5;T++)f[m+5*T]=T+(2*m+3*T)%5*5;for(var D=1,A=0;A<24;A++){for(var k=0,b=0,I=0;I<7;I++){if(D&1){var h=(1<<I)-1;h<32?b^=1<<h:k^=1<<h-32}D&128?D=D<<1^113:D<<=1}v[A]=u.create(k,b)}})();var p=[];(function(){for(var m=0;m<25;m++)p[m]=u.create()})();var P=d.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var m=this._state=[],T=0;T<25;T++)m[T]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(m,T){for(var _=this._state,w=this.blockSize/2,C=0;C<w;C++){var D=m[T+2*C],A=m[T+2*C+1];D=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,A=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360;var k=_[C];k.high^=A,k.low^=D}for(var b=0;b<24;b++){for(var I=0;I<5;I++){for(var h=0,O=0,R=0;R<5;R++){var k=_[I+5*R];h^=k.high,O^=k.low}var z=p[I];z.high=h,z.low=O}for(var I=0;I<5;I++)for(var Z=p[(I+4)%5],Y=p[(I+1)%5],H=Y.high,te=Y.low,h=Z.high^(H<<1|te>>>31),O=Z.low^(te<<1|H>>>31),R=0;R<5;R++){var k=_[I+5*R];k.high^=h,k.low^=O}for(var ne=1;ne<25;ne++){var h,O,k=_[ne],M=k.high,Q=k.low,$=y[ne];$<32?(h=M<<$|Q>>>32-$,O=Q<<$|M>>>32-$):(h=Q<<$-32|M>>>64-$,O=M<<$-32|Q>>>64-$);var F=p[f[ne]];F.high=h,F.low=O}var W=p[0],K=_[0];W.high=K.high,W.low=K.low;for(var I=0;I<5;I++)for(var R=0;R<5;R++){var ne=I+5*R,k=_[ne],oe=p[ne],le=p[(I+1)%5+5*R],we=p[(I+2)%5+5*R];k.high=oe.high^~le.high&we.high,k.low=oe.low^~le.low&we.low}var k=_[0],U=v[b];k.high^=U.high,k.low^=U.low}},_doFinalize:function(){var m=this._data,T=m.words;this._nDataBytes*8;var _=m.sigBytes*8,w=this.blockSize*32;T[_>>>5]|=1<<24-_%32,T[(r.ceil((_+1)/w)*w>>>5)-1]|=128,m.sigBytes=T.length*4,this._process();for(var C=this._state,D=this.cfg.outputLength/8,A=D/8,k=[],b=0;b<A;b++){var I=C[b],h=I.high,O=I.low;h=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,O=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,k.push(O),k.push(h)}return new s.init(k,D)},clone:function(){for(var m=o.clone.call(this),T=m._state=this._state.slice(0),_=0;_<25;_++)T[_]=T[_].clone();return m}});a.SHA3=o._createHelper(P),a.HmacSHA3=o._createHmacHelper(P)}(Math),t.SHA3})}(Pa)),Pa.exports}var Aa={exports:{}},Ns;function Yc(){return Ns||(Ns=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){/** @preserve
				(c) 2012 by Cédric Mesnil. All rights reserved.

				Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

				    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
				    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

				THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
				*/return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.algo,u=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),d=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),y=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),v=s.create([0,1518500249,1859775393,2400959708,2840853838]),p=s.create([1352829926,1548603684,1836072691,2053994217,0]),P=c.RIPEMD160=o.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(A,k){for(var b=0;b<16;b++){var I=k+b,h=A[I];A[I]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360}var O=this._hash.words,R=v.words,z=p.words,Z=u.words,Y=d.words,H=y.words,te=f.words,ne,M,Q,$,F,W,K,oe,le,we;W=ne=O[0],K=M=O[1],oe=Q=O[2],le=$=O[3],we=F=O[4];for(var U,b=0;b<80;b+=1)U=ne+A[k+Z[b]]|0,b<16?U+=m(M,Q,$)+R[0]:b<32?U+=T(M,Q,$)+R[1]:b<48?U+=_(M,Q,$)+R[2]:b<64?U+=w(M,Q,$)+R[3]:U+=C(M,Q,$)+R[4],U=U|0,U=D(U,H[b]),U=U+F|0,ne=F,F=$,$=D(Q,10),Q=M,M=U,U=W+A[k+Y[b]]|0,b<16?U+=C(K,oe,le)+z[0]:b<32?U+=w(K,oe,le)+z[1]:b<48?U+=_(K,oe,le)+z[2]:b<64?U+=T(K,oe,le)+z[3]:U+=m(K,oe,le)+z[4],U=U|0,U=D(U,te[b]),U=U+we|0,W=we,we=le,le=D(oe,10),oe=K,K=U;U=O[1]+Q+le|0,O[1]=O[2]+$+we|0,O[2]=O[3]+F+W|0,O[3]=O[4]+ne+K|0,O[4]=O[0]+M+oe|0,O[0]=U},_doFinalize:function(){var A=this._data,k=A.words,b=this._nDataBytes*8,I=A.sigBytes*8;k[I>>>5]|=128<<24-I%32,k[(I+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,A.sigBytes=(k.length+1)*4,this._process();for(var h=this._hash,O=h.words,R=0;R<5;R++){var z=O[R];O[R]=(z<<8|z>>>24)&16711935|(z<<24|z>>>8)&4278255360}return h},clone:function(){var A=o.clone.call(this);return A._hash=this._hash.clone(),A}});function m(A,k,b){return A^k^b}function T(A,k,b){return A&k|~A&b}function _(A,k,b){return(A|~k)^b}function w(A,k,b){return A&b|k&~b}function C(A,k,b){return A^(k|~b)}function D(A,k){return A<<k|A>>>32-k}a.RIPEMD160=o._createHelper(P),a.HmacRIPEMD160=o._createHmacHelper(P)}(),t.RIPEMD160})}(Aa)),Aa.exports}var Ia={exports:{}},Ls;function Ea(){return Ls||(Ls=1,function(n,e){(function(t,r){n.exports=r(pe())})(ee,function(t){(function(){var r=t,a=r.lib,i=a.Base,s=r.enc,o=s.Utf8,c=r.algo;c.HMAC=i.extend({init:function(u,d){u=this._hasher=new u.init,typeof d=="string"&&(d=o.parse(d));var y=u.blockSize,f=y*4;d.sigBytes>f&&(d=u.finalize(d)),d.clamp();for(var v=this._oKey=d.clone(),p=this._iKey=d.clone(),P=v.words,m=p.words,T=0;T<y;T++)P[T]^=1549556828,m[T]^=909522486;v.sigBytes=p.sigBytes=f,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var d=this._hasher,y=d.finalize(u);d.reset();var f=d.finalize(this._oKey.clone().concat(y));return f}})})()})}(Ia)),Ia.exports}var Oa={exports:{}},Ds;function Gc(){return Ds||(Ds=1,function(n,e){(function(t,r,a){n.exports=r(pe(),ba(),Ea())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.Base,s=a.WordArray,o=r.algo,c=o.SHA1,u=o.HMAC,d=o.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:1}),init:function(y){this.cfg=this.cfg.extend(y)},compute:function(y,f){for(var v=this.cfg,p=u.create(v.hasher,y),P=s.create(),m=s.create([1]),T=P.words,_=m.words,w=v.keySize,C=v.iterations;T.length<w;){var D=p.update(f).finalize(m);p.reset();for(var A=D.words,k=A.length,b=D,I=1;I<C;I++){b=p.finalize(b),p.reset();for(var h=b.words,O=0;O<k;O++)A[O]^=h[O]}P.concat(D),_[0]++}return P.sigBytes=w*4,P}});r.PBKDF2=function(y,f,v){return d.create(v).compute(y,f)}}(),t.PBKDF2})}(Oa)),Oa.exports}var Ca={exports:{}},Bs;function pt(){return Bs||(Bs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),ba(),Ea())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.Base,s=a.WordArray,o=r.algo,c=o.MD5,u=o.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,y){for(var f,v=this.cfg,p=v.hasher.create(),P=s.create(),m=P.words,T=v.keySize,_=v.iterations;m.length<T;){f&&p.update(f),f=p.update(d).finalize(y),p.reset();for(var w=1;w<_;w++)f=p.finalize(f),p.reset();P.concat(f)}return P.sigBytes=T*4,P}});r.EvpKDF=function(d,y,f){return u.create(f).compute(d,y)}}(),t.EvpKDF})}(Ca)),Ca.exports}var Ta={exports:{}},$s;function Oe(){return $s||($s=1,function(n,e){(function(t,r,a){n.exports=r(pe(),pt())})(ee,function(t){t.lib.Cipher||function(r){var a=t,i=a.lib,s=i.Base,o=i.WordArray,c=i.BufferedBlockAlgorithm,u=a.enc;u.Utf8;var d=u.Base64,y=a.algo,f=y.EvpKDF,v=i.Cipher=c.extend({cfg:s.extend(),createEncryptor:function(h,O){return this.create(this._ENC_XFORM_MODE,h,O)},createDecryptor:function(h,O){return this.create(this._DEC_XFORM_MODE,h,O)},init:function(h,O,R){this.cfg=this.cfg.extend(R),this._xformMode=h,this._key=O,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(h){return this._append(h),this._process()},finalize:function(h){h&&this._append(h);var O=this._doFinalize();return O},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function h(O){return typeof O=="string"?I:A}return function(O){return{encrypt:function(R,z,Z){return h(z).encrypt(O,R,z,Z)},decrypt:function(R,z,Z){return h(z).decrypt(O,R,z,Z)}}}}()});i.StreamCipher=v.extend({_doFinalize:function(){var h=this._process(!0);return h},blockSize:1});var p=a.mode={},P=i.BlockCipherMode=s.extend({createEncryptor:function(h,O){return this.Encryptor.create(h,O)},createDecryptor:function(h,O){return this.Decryptor.create(h,O)},init:function(h,O){this._cipher=h,this._iv=O}}),m=p.CBC=function(){var h=P.extend();h.Encryptor=h.extend({processBlock:function(R,z){var Z=this._cipher,Y=Z.blockSize;O.call(this,R,z,Y),Z.encryptBlock(R,z),this._prevBlock=R.slice(z,z+Y)}}),h.Decryptor=h.extend({processBlock:function(R,z){var Z=this._cipher,Y=Z.blockSize,H=R.slice(z,z+Y);Z.decryptBlock(R,z),O.call(this,R,z,Y),this._prevBlock=H}});function O(R,z,Z){var Y,H=this._iv;H?(Y=H,this._iv=r):Y=this._prevBlock;for(var te=0;te<Z;te++)R[z+te]^=Y[te]}return h}(),T=a.pad={},_=T.Pkcs7={pad:function(h,O){for(var R=O*4,z=R-h.sigBytes%R,Z=z<<24|z<<16|z<<8|z,Y=[],H=0;H<z;H+=4)Y.push(Z);var te=o.create(Y,z);h.concat(te)},unpad:function(h){var O=h.words[h.sigBytes-1>>>2]&255;h.sigBytes-=O}};i.BlockCipher=v.extend({cfg:v.cfg.extend({mode:m,padding:_}),reset:function(){var h;v.reset.call(this);var O=this.cfg,R=O.iv,z=O.mode;this._xformMode==this._ENC_XFORM_MODE?h=z.createEncryptor:(h=z.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==h?this._mode.init(this,R&&R.words):(this._mode=h.call(z,this,R&&R.words),this._mode.__creator=h)},_doProcessBlock:function(h,O){this._mode.processBlock(h,O)},_doFinalize:function(){var h,O=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(O.pad(this._data,this.blockSize),h=this._process(!0)):(h=this._process(!0),O.unpad(h)),h},blockSize:128/32});var w=i.CipherParams=s.extend({init:function(h){this.mixIn(h)},toString:function(h){return(h||this.formatter).stringify(this)}}),C=a.format={},D=C.OpenSSL={stringify:function(h){var O,R=h.ciphertext,z=h.salt;return z?O=o.create([1398893684,1701076831]).concat(z).concat(R):O=R,O.toString(d)},parse:function(h){var O,R=d.parse(h),z=R.words;return z[0]==1398893684&&z[1]==1701076831&&(O=o.create(z.slice(2,4)),z.splice(0,4),R.sigBytes-=16),w.create({ciphertext:R,salt:O})}},A=i.SerializableCipher=s.extend({cfg:s.extend({format:D}),encrypt:function(h,O,R,z){z=this.cfg.extend(z);var Z=h.createEncryptor(R,z),Y=Z.finalize(O),H=Z.cfg;return w.create({ciphertext:Y,key:R,iv:H.iv,algorithm:h,mode:H.mode,padding:H.padding,blockSize:h.blockSize,formatter:z.format})},decrypt:function(h,O,R,z){z=this.cfg.extend(z),O=this._parse(O,z.format);var Z=h.createDecryptor(R,z).finalize(O.ciphertext);return Z},_parse:function(h,O){return typeof h=="string"?O.parse(h,this):h}}),k=a.kdf={},b=k.OpenSSL={execute:function(h,O,R,z){z||(z=o.random(64/8));var Z=f.create({keySize:O+R}).compute(h,z),Y=o.create(Z.words.slice(O),R*4);return Z.sigBytes=O*4,w.create({key:Z,iv:Y,salt:z})}},I=i.PasswordBasedCipher=A.extend({cfg:A.cfg.extend({kdf:b}),encrypt:function(h,O,R,z){z=this.cfg.extend(z);var Z=z.kdf.execute(R,h.keySize,h.ivSize);z.iv=Z.iv;var Y=A.encrypt.call(this,h,O,Z.key,z);return Y.mixIn(Z),Y},decrypt:function(h,O,R,z){z=this.cfg.extend(z),O=this._parse(O,z.format);var Z=z.kdf.execute(R,h.keySize,h.ivSize,O.salt);z.iv=Z.iv;var Y=A.decrypt.call(this,h,O,Z.key,z);return Y}})}()})}(Ta)),Ta.exports}var ka={exports:{}},zs;function Xc(){return zs||(zs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize;a.call(this,i,s,c,o),this._prevBlock=i.slice(s,s+c)}}),r.Decryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize,u=i.slice(s,s+c);a.call(this,i,s,c,o),this._prevBlock=u}});function a(i,s,o,c){var u,d=this._iv;d?(u=d.slice(0),this._iv=void 0):u=this._prevBlock,c.encryptBlock(u,0);for(var y=0;y<o;y++)i[s+y]^=u[y]}return r}(),t.mode.CFB})}(ka)),ka.exports}var Sa={exports:{}},Ms;function Jc(){return Ms||(Ms=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize,u=this._iv,d=this._counter;u&&(d=this._counter=u.slice(0),this._iv=void 0);var y=d.slice(0);o.encryptBlock(y,0),d[c-1]=d[c-1]+1|0;for(var f=0;f<c;f++)i[s+f]^=y[f]}});return r.Decryptor=a,r}(),t.mode.CTR})}(Sa)),Sa.exports}var Ra={exports:{}},Us;function Qc(){return Us||(Us=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function a(o){if((o>>24&255)===255){var c=o>>16&255,u=o>>8&255,d=o&255;c===255?(c=0,u===255?(u=0,d===255?d=0:++d):++u):++c,o=0,o+=c<<16,o+=u<<8,o+=d}else o+=1<<24;return o}function i(o){return(o[0]=a(o[0]))===0&&(o[1]=a(o[1])),o}var s=r.Encryptor=r.extend({processBlock:function(o,c){var u=this._cipher,d=u.blockSize,y=this._iv,f=this._counter;y&&(f=this._counter=y.slice(0),this._iv=void 0),i(f);var v=f.slice(0);u.encryptBlock(v,0);for(var p=0;p<d;p++)o[c+p]^=v[p]}});return r.Decryptor=s,r}(),t.mode.CTRGladman})}(Ra)),Ra.exports}var ja={exports:{}},Zs;function el(){return Zs||(Zs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize,u=this._iv,d=this._keystream;u&&(d=this._keystream=u.slice(0),this._iv=void 0),o.encryptBlock(d,0);for(var y=0;y<c;y++)i[s+y]^=d[y]}});return r.Decryptor=a,r}(),t.mode.OFB})}(ja)),ja.exports}var Na={exports:{}},Ks;function tl(){return Ks||(Ks=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(a,i){this._cipher.encryptBlock(a,i)}}),r.Decryptor=r.extend({processBlock:function(a,i){this._cipher.decryptBlock(a,i)}}),r}(),t.mode.ECB})}(Na)),Na.exports}var La={exports:{}},Vs;function rl(){return Vs||(Vs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.pad.AnsiX923={pad:function(r,a){var i=r.sigBytes,s=a*4,o=s-i%s,c=i+o-1;r.clamp(),r.words[c>>>2]|=o<<24-c%4*8,r.sigBytes+=o},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},t.pad.Ansix923})}(La)),La.exports}var Da={exports:{}},Fs;function nl(){return Fs||(Fs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.pad.Iso10126={pad:function(r,a){var i=a*4,s=i-r.sigBytes%i;r.concat(t.lib.WordArray.random(s-1)).concat(t.lib.WordArray.create([s<<24],1))},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},t.pad.Iso10126})}(Da)),Da.exports}var Ba={exports:{}},qs;function al(){return qs||(qs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.pad.Iso97971={pad:function(r,a){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,a)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(Ba)),Ba.exports}var $a={exports:{}},Hs;function il(){return Hs||(Hs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.pad.ZeroPadding={pad:function(r,a){var i=a*4;r.clamp(),r.sigBytes+=i-(r.sigBytes%i||i)},unpad:function(r){for(var a=r.words,i=r.sigBytes-1,i=r.sigBytes-1;i>=0;i--)if(a[i>>>2]>>>24-i%4*8&255){r.sigBytes=i+1;break}}},t.pad.ZeroPadding})}($a)),$a.exports}var za={exports:{}},Ws;function sl(){return Ws||(Ws=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(za)),za.exports}var Ma={exports:{}},Ys;function ol(){return Ys||(Ys=1,function(n,e){(function(t,r,a){n.exports=r(pe(),Oe())})(ee,function(t){return function(r){var a=t,i=a.lib,s=i.CipherParams,o=a.enc,c=o.Hex,u=a.format;u.Hex={stringify:function(d){return d.ciphertext.toString(c)},parse:function(d){var y=c.parse(d);return s.create({ciphertext:y})}}}(),t.format.Hex})}(Ma)),Ma.exports}var Ua={exports:{}},Gs;function ul(){return Gs||(Gs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),It(),Et(),pt(),Oe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.BlockCipher,s=r.algo,o=[],c=[],u=[],d=[],y=[],f=[],v=[],p=[],P=[],m=[];(function(){for(var w=[],C=0;C<256;C++)C<128?w[C]=C<<1:w[C]=C<<1^283;for(var D=0,A=0,C=0;C<256;C++){var k=A^A<<1^A<<2^A<<3^A<<4;k=k>>>8^k&255^99,o[D]=k,c[k]=D;var b=w[D],I=w[b],h=w[I],O=w[k]*257^k*16843008;u[D]=O<<24|O>>>8,d[D]=O<<16|O>>>16,y[D]=O<<8|O>>>24,f[D]=O;var O=h*16843009^I*65537^b*257^D*16843008;v[k]=O<<24|O>>>8,p[k]=O<<16|O>>>16,P[k]=O<<8|O>>>24,m[k]=O,D?(D=b^w[w[w[h^b]]],A^=w[w[A]]):D=A=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],_=s.AES=i.extend({_doReset:function(){var w;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var C=this._keyPriorReset=this._key,D=C.words,A=C.sigBytes/4,k=this._nRounds=A+6,b=(k+1)*4,I=this._keySchedule=[],h=0;h<b;h++)h<A?I[h]=D[h]:(w=I[h-1],h%A?A>6&&h%A==4&&(w=o[w>>>24]<<24|o[w>>>16&255]<<16|o[w>>>8&255]<<8|o[w&255]):(w=w<<8|w>>>24,w=o[w>>>24]<<24|o[w>>>16&255]<<16|o[w>>>8&255]<<8|o[w&255],w^=T[h/A|0]<<24),I[h]=I[h-A]^w);for(var O=this._invKeySchedule=[],R=0;R<b;R++){var h=b-R;if(R%4)var w=I[h];else var w=I[h-4];R<4||h<=4?O[R]=w:O[R]=v[o[w>>>24]]^p[o[w>>>16&255]]^P[o[w>>>8&255]]^m[o[w&255]]}}},encryptBlock:function(w,C){this._doCryptBlock(w,C,this._keySchedule,u,d,y,f,o)},decryptBlock:function(w,C){var D=w[C+1];w[C+1]=w[C+3],w[C+3]=D,this._doCryptBlock(w,C,this._invKeySchedule,v,p,P,m,c);var D=w[C+1];w[C+1]=w[C+3],w[C+3]=D},_doCryptBlock:function(w,C,D,A,k,b,I,h){for(var O=this._nRounds,R=w[C]^D[0],z=w[C+1]^D[1],Z=w[C+2]^D[2],Y=w[C+3]^D[3],H=4,te=1;te<O;te++){var ne=A[R>>>24]^k[z>>>16&255]^b[Z>>>8&255]^I[Y&255]^D[H++],M=A[z>>>24]^k[Z>>>16&255]^b[Y>>>8&255]^I[R&255]^D[H++],Q=A[Z>>>24]^k[Y>>>16&255]^b[R>>>8&255]^I[z&255]^D[H++],$=A[Y>>>24]^k[R>>>16&255]^b[z>>>8&255]^I[Z&255]^D[H++];R=ne,z=M,Z=Q,Y=$}var ne=(h[R>>>24]<<24|h[z>>>16&255]<<16|h[Z>>>8&255]<<8|h[Y&255])^D[H++],M=(h[z>>>24]<<24|h[Z>>>16&255]<<16|h[Y>>>8&255]<<8|h[R&255])^D[H++],Q=(h[Z>>>24]<<24|h[Y>>>16&255]<<16|h[R>>>8&255]<<8|h[z&255])^D[H++],$=(h[Y>>>24]<<24|h[R>>>16&255]<<16|h[z>>>8&255]<<8|h[Z&255])^D[H++];w[C]=ne,w[C+1]=M,w[C+2]=Q,w[C+3]=$},keySize:256/32});r.AES=i._createHelper(_)}(),t.AES})}(Ua)),Ua.exports}var Za={exports:{}},Xs;function cl(){return Xs||(Xs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),It(),Et(),pt(),Oe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=a.BlockCipher,o=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],d=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],y=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],v=o.DES=s.extend({_doReset:function(){for(var T=this._key,_=T.words,w=[],C=0;C<56;C++){var D=c[C]-1;w[C]=_[D>>>5]>>>31-D%32&1}for(var A=this._subKeys=[],k=0;k<16;k++){for(var b=A[k]=[],I=d[k],C=0;C<24;C++)b[C/6|0]|=w[(u[C]-1+I)%28]<<31-C%6,b[4+(C/6|0)]|=w[28+(u[C+24]-1+I)%28]<<31-C%6;b[0]=b[0]<<1|b[0]>>>31;for(var C=1;C<7;C++)b[C]=b[C]>>>(C-1)*4+3;b[7]=b[7]<<5|b[7]>>>27}for(var h=this._invSubKeys=[],C=0;C<16;C++)h[C]=A[15-C]},encryptBlock:function(T,_){this._doCryptBlock(T,_,this._subKeys)},decryptBlock:function(T,_){this._doCryptBlock(T,_,this._invSubKeys)},_doCryptBlock:function(T,_,w){this._lBlock=T[_],this._rBlock=T[_+1],p.call(this,4,252645135),p.call(this,16,65535),P.call(this,2,858993459),P.call(this,8,16711935),p.call(this,1,1431655765);for(var C=0;C<16;C++){for(var D=w[C],A=this._lBlock,k=this._rBlock,b=0,I=0;I<8;I++)b|=y[I][((k^D[I])&f[I])>>>0];this._lBlock=k,this._rBlock=A^b}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,p.call(this,1,1431655765),P.call(this,8,16711935),P.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),T[_]=this._lBlock,T[_+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(T,_){var w=(this._lBlock>>>T^this._rBlock)&_;this._rBlock^=w,this._lBlock^=w<<T}function P(T,_){var w=(this._rBlock>>>T^this._lBlock)&_;this._lBlock^=w,this._rBlock^=w<<T}r.DES=s._createHelper(v);var m=o.TripleDES=s.extend({_doReset:function(){var T=this._key,_=T.words;if(_.length!==2&&_.length!==4&&_.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var w=_.slice(0,2),C=_.length<4?_.slice(0,2):_.slice(2,4),D=_.length<6?_.slice(0,2):_.slice(4,6);this._des1=v.createEncryptor(i.create(w)),this._des2=v.createEncryptor(i.create(C)),this._des3=v.createEncryptor(i.create(D))},encryptBlock:function(T,_){this._des1.encryptBlock(T,_),this._des2.decryptBlock(T,_),this._des3.encryptBlock(T,_)},decryptBlock:function(T,_){this._des3.decryptBlock(T,_),this._des2.encryptBlock(T,_),this._des1.decryptBlock(T,_)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=s._createHelper(m)}(),t.TripleDES})}(Za)),Za.exports}var Ka={exports:{}},Js;function ll(){return Js||(Js=1,function(n,e){(function(t,r,a){n.exports=r(pe(),It(),Et(),pt(),Oe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.StreamCipher,s=r.algo,o=s.RC4=i.extend({_doReset:function(){for(var d=this._key,y=d.words,f=d.sigBytes,v=this._S=[],p=0;p<256;p++)v[p]=p;for(var p=0,P=0;p<256;p++){var m=p%f,T=y[m>>>2]>>>24-m%4*8&255;P=(P+v[p]+T)%256;var _=v[p];v[p]=v[P],v[P]=_}this._i=this._j=0},_doProcessBlock:function(d,y){d[y]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var d=this._S,y=this._i,f=this._j,v=0,p=0;p<4;p++){y=(y+1)%256,f=(f+d[y])%256;var P=d[y];d[y]=d[f],d[f]=P,v|=d[(d[y]+d[f])%256]<<24-p*8}return this._i=y,this._j=f,v}r.RC4=i._createHelper(o);var u=s.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var d=this.cfg.drop;d>0;d--)c.call(this)}});r.RC4Drop=i._createHelper(u)}(),t.RC4})}(Ka)),Ka.exports}var Va={exports:{}},Qs;function dl(){return Qs||(Qs=1,function(n,e){(function(t,r,a){n.exports=r(pe(),It(),Et(),pt(),Oe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.StreamCipher,s=r.algo,o=[],c=[],u=[],d=s.Rabbit=i.extend({_doReset:function(){for(var f=this._key.words,v=this.cfg.iv,p=0;p<4;p++)f[p]=(f[p]<<8|f[p]>>>24)&16711935|(f[p]<<24|f[p]>>>8)&4278255360;var P=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],m=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var p=0;p<4;p++)y.call(this);for(var p=0;p<8;p++)m[p]^=P[p+4&7];if(v){var T=v.words,_=T[0],w=T[1],C=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,D=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,A=C>>>16|D&4294901760,k=D<<16|C&65535;m[0]^=C,m[1]^=A,m[2]^=D,m[3]^=k,m[4]^=C,m[5]^=A,m[6]^=D,m[7]^=k;for(var p=0;p<4;p++)y.call(this)}},_doProcessBlock:function(f,v){var p=this._X;y.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var P=0;P<4;P++)o[P]=(o[P]<<8|o[P]>>>24)&16711935|(o[P]<<24|o[P]>>>8)&4278255360,f[v+P]^=o[P]},blockSize:128/32,ivSize:64/32});function y(){for(var f=this._X,v=this._C,p=0;p<8;p++)c[p]=v[p];v[0]=v[0]+1295307597+this._b|0,v[1]=v[1]+3545052371+(v[0]>>>0<c[0]>>>0?1:0)|0,v[2]=v[2]+886263092+(v[1]>>>0<c[1]>>>0?1:0)|0,v[3]=v[3]+1295307597+(v[2]>>>0<c[2]>>>0?1:0)|0,v[4]=v[4]+3545052371+(v[3]>>>0<c[3]>>>0?1:0)|0,v[5]=v[5]+886263092+(v[4]>>>0<c[4]>>>0?1:0)|0,v[6]=v[6]+1295307597+(v[5]>>>0<c[5]>>>0?1:0)|0,v[7]=v[7]+3545052371+(v[6]>>>0<c[6]>>>0?1:0)|0,this._b=v[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var P=f[p]+v[p],m=P&65535,T=P>>>16,_=((m*m>>>17)+m*T>>>15)+T*T,w=((P&4294901760)*P|0)+((P&65535)*P|0);u[p]=_^w}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.Rabbit=i._createHelper(d)}(),t.Rabbit})}(Va)),Va.exports}var Fa={exports:{}},eo;function hl(){return eo||(eo=1,function(n,e){(function(t,r,a){n.exports=r(pe(),It(),Et(),pt(),Oe())})(ee,function(t){return function(){var r=t,a=r.lib,i=a.StreamCipher,s=r.algo,o=[],c=[],u=[],d=s.RabbitLegacy=i.extend({_doReset:function(){var f=this._key.words,v=this.cfg.iv,p=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],P=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var m=0;m<4;m++)y.call(this);for(var m=0;m<8;m++)P[m]^=p[m+4&7];if(v){var T=v.words,_=T[0],w=T[1],C=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,D=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,A=C>>>16|D&4294901760,k=D<<16|C&65535;P[0]^=C,P[1]^=A,P[2]^=D,P[3]^=k,P[4]^=C,P[5]^=A,P[6]^=D,P[7]^=k;for(var m=0;m<4;m++)y.call(this)}},_doProcessBlock:function(f,v){var p=this._X;y.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var P=0;P<4;P++)o[P]=(o[P]<<8|o[P]>>>24)&16711935|(o[P]<<24|o[P]>>>8)&4278255360,f[v+P]^=o[P]},blockSize:128/32,ivSize:64/32});function y(){for(var f=this._X,v=this._C,p=0;p<8;p++)c[p]=v[p];v[0]=v[0]+1295307597+this._b|0,v[1]=v[1]+3545052371+(v[0]>>>0<c[0]>>>0?1:0)|0,v[2]=v[2]+886263092+(v[1]>>>0<c[1]>>>0?1:0)|0,v[3]=v[3]+1295307597+(v[2]>>>0<c[2]>>>0?1:0)|0,v[4]=v[4]+3545052371+(v[3]>>>0<c[3]>>>0?1:0)|0,v[5]=v[5]+886263092+(v[4]>>>0<c[4]>>>0?1:0)|0,v[6]=v[6]+1295307597+(v[5]>>>0<c[5]>>>0?1:0)|0,v[7]=v[7]+3545052371+(v[6]>>>0<c[6]>>>0?1:0)|0,this._b=v[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var P=f[p]+v[p],m=P&65535,T=P>>>16,_=((m*m>>>17)+m*T>>>15)+T*T,w=((P&4294901760)*P|0)+((P&65535)*P|0);u[p]=_^w}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.RabbitLegacy=i._createHelper(d)}(),t.RabbitLegacy})}(Fa)),Fa.exports}(function(n,e){(function(t,r,a){n.exports=r(pe(),br(),Kc(),Vc(),It(),Fc(),Et(),ba(),Cs(),qc(),Ss(),Hc(),Wc(),Yc(),Ea(),Gc(),pt(),Oe(),Xc(),Jc(),Qc(),el(),tl(),rl(),nl(),al(),il(),sl(),ol(),ul(),cl(),ll(),dl(),hl())})(ee,function(t){return t})})(bs);var fl=bs.exports;const pl=Me(fl);class vr{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}var ml=Object.defineProperty,yl=(n,e,t)=>e in n?ml(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,gl=(n,e,t)=>(yl(n,typeof e!="symbol"?e+"":e,t),t),_r={};_r.byteLength=_l,_r.toByteArray=xl,_r.fromByteArray=Il;for(var Xe=[],Ze=[],bl=typeof Uint8Array<"u"?Uint8Array:Array,qa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ot=0,vl=qa.length;Ot<vl;++Ot)Xe[Ot]=qa[Ot],Ze[qa.charCodeAt(Ot)]=Ot;Ze["-".charCodeAt(0)]=62,Ze["_".charCodeAt(0)]=63;function to(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function _l(n){var e=to(n),t=e[0],r=e[1];return(t+r)*3/4-r}function wl(n,e,t){return(e+t)*3/4-t}function xl(n){var e,t=to(n),r=t[0],a=t[1],i=new bl(wl(n,r,a)),s=0,o=a>0?r-4:r,c;for(c=0;c<o;c+=4)e=Ze[n.charCodeAt(c)]<<18|Ze[n.charCodeAt(c+1)]<<12|Ze[n.charCodeAt(c+2)]<<6|Ze[n.charCodeAt(c+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=e&255;return a===2&&(e=Ze[n.charCodeAt(c)]<<2|Ze[n.charCodeAt(c+1)]>>4,i[s++]=e&255),a===1&&(e=Ze[n.charCodeAt(c)]<<10|Ze[n.charCodeAt(c+1)]<<4|Ze[n.charCodeAt(c+2)]>>2,i[s++]=e>>8&255,i[s++]=e&255),i}function Pl(n){return Xe[n>>18&63]+Xe[n>>12&63]+Xe[n>>6&63]+Xe[n&63]}function Al(n,e,t){for(var r,a=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),a.push(Pl(r));return a.join("")}function Il(n){for(var e,t=n.length,r=t%3,a=[],i=16383,s=0,o=t-r;s<o;s+=i)a.push(Al(n,s,s+i>o?o:s+i));return r===1?(e=n[t-1],a.push(Xe[e>>2]+Xe[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],a.push(Xe[e>>10]+Xe[e>>4&63]+Xe[e<<2&63]+"=")),a.join("")}function El(n,e){let t=Array.from({length:n.length},(r,a)=>({start:a,end:a+1}));for(;t.length>1;){let r=null;for(let a=0;a<t.length-1;a++){const i=n.slice(t[a].start,t[a+1].end),s=e.get(i.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,a])}if(r!=null){const a=r[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function Ol(n,e){return n.length===1?[e.get(n.join(","))]:El(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function Cl(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Ha=class{constructor(n,e){Ae(this,"specialTokens");Ae(this,"inverseSpecialTokens");Ae(this,"patStr");Ae(this,"textEncoder",new TextEncoder);Ae(this,"textDecoder",new TextDecoder("utf-8"));Ae(this,"rankMap",new Map);Ae(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,a)=>{const[i,s,...o]=a.split(" "),c=Number.parseInt(s,10);return o.forEach((u,d)=>r[u]=c+d),r},{});for(const[r,a]of Object.entries(t)){const i=_r.toByteArray(r);this.rankMap.set(i.join(","),a),this.textMap.set(a,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[a,i])=>(r[i]=this.textEncoder.encode(a),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),a=Ha.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!s.has(u)):t);if(o.size>0){const u=Ha.specialTokenRegex([...o]),d=n.match(u);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let c=0;for(;;){let u=null,d=c;for(;a.lastIndex=d,u=a.exec(n),!(u==null||s.has(u[0]));)d=u.index+1;const y=(u==null?void 0:u.index)??n.length;for(const v of n.substring(c,y).matchAll(r)){const p=this.textEncoder.encode(v[0]),P=this.rankMap.get(p.join(","));if(P!=null){i.push(P);continue}i.push(...Ol(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];i.push(f),c=u.index+u[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const s=n[i],o=this.textMap.get(s)??this.inverseSpecialTokens[s];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let a=0;for(const i of e)r.set(i,a),a+=i.length;return this.textDecoder.decode(r)}},ro=Ha;gl(ro,"specialTokenRegex",n=>new RegExp(n.map(e=>Cl(e)).join("|"),"g"));function Tl(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var wr={exports:{}},no={};function Ke(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var kl=Ke;Ke.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},Ke.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},Ke.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0},Ke.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},Ke.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)},Ke.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)},Ke.prototype.start=Ke.prototype.try,Ke.prototype.errors=function(){return this._errors},Ke.prototype.attempts=function(){return this._attempts},Ke.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var a=this._errors[r],i=a.message,s=(n[i]||0)+1;n[i]=s,s>=t&&(e=a,t=s)}return e},function(n){var e=kl;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)r[a]=t[a];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],s=0;s<r.retries;s++)i.push(this.createTimeout(s,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(s,r)),i.sort(function(o,c){return o-c}),i},n.createTimeout=function(t,r){var a=r.randomize?Math.random()+1:1,i=Math.round(a*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,a){if(r instanceof Array&&(a=r,r=null),!a){a=[];for(var i in t)typeof t[i]=="function"&&a.push(i)}for(var s=0;s<a.length;s++){var o=a[s],c=t[o];t[o]=(function(d){var y=n.operation(r),f=Array.prototype.slice.call(arguments,1),v=f.pop();f.push(function(p){y.retry(p)||(p&&(arguments[0]=y.mainError()),v.apply(this,arguments))}),y.attempt(function(){d.apply(t,f)})}).bind(t,c),t[o].options=r}}}(no);var Sl=no;const Rl=Sl,jl=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class ao extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Nl=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},Ll=n=>jl.includes(n),io=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const a=Rl.operation(e);a.attempt(async i=>{try{t(await n(i))}catch(s){if(!(s instanceof Error)){r(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof ao)a.stop(),r(s.originalError);else if(s instanceof TypeError&&!Ll(s.message))a.stop(),r(s);else{Nl(s,i,e);try{await e.onFailedAttempt(s)}catch(o){r(o);return}a.retry(s)||r(a.mainError())}}})});wr.exports=io,wr.exports.default=io,wr.exports.AbortError=ao;var Dl=wr.exports;const xr=Me(Dl);var so={},oo={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function a(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function i(c,u,d,y,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new a(d,y||c,f),p=t?t+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],v]:c._events[p].push(v):(c._events[p]=v,c._eventsCount++),c}function s(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],d,y;if(this._eventsCount===0)return u;for(y in d=this._events)e.call(d,y)&&u.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},o.prototype.listeners=function(u){var d=t?t+u:u,y=this._events[d];if(!y)return[];if(y.fn)return[y.fn];for(var f=0,v=y.length,p=new Array(v);f<v;f++)p[f]=y[f].fn;return p},o.prototype.listenerCount=function(u){var d=t?t+u:u,y=this._events[d];return y?y.fn?1:y.length:0},o.prototype.emit=function(u,d,y,f,v,p){var P=t?t+u:u;if(!this._events[P])return!1;var m=this._events[P],T=arguments.length,_,w;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),T){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,y),!0;case 4:return m.fn.call(m.context,d,y,f),!0;case 5:return m.fn.call(m.context,d,y,f,v),!0;case 6:return m.fn.call(m.context,d,y,f,v,p),!0}for(w=1,_=new Array(T-1);w<T;w++)_[w-1]=arguments[w];m.fn.apply(m.context,_)}else{var C=m.length,D;for(w=0;w<C;w++)switch(m[w].once&&this.removeListener(u,m[w].fn,void 0,!0),T){case 1:m[w].fn.call(m[w].context);break;case 2:m[w].fn.call(m[w].context,d);break;case 3:m[w].fn.call(m[w].context,d,y);break;case 4:m[w].fn.call(m[w].context,d,y,f);break;default:if(!_)for(D=1,_=new Array(T-1);D<T;D++)_[D-1]=arguments[D];m[w].fn.apply(m[w].context,_)}}return!0},o.prototype.on=function(u,d,y){return i(this,u,d,y,!1)},o.prototype.once=function(u,d,y){return i(this,u,d,y,!0)},o.prototype.removeListener=function(u,d,y,f){var v=t?t+u:u;if(!this._events[v])return this;if(!d)return s(this,v),this;var p=this._events[v];if(p.fn)p.fn===d&&(!f||p.once)&&(!y||p.context===y)&&s(this,v);else{for(var P=0,m=[],T=p.length;P<T;P++)(p[P].fn!==d||f&&!p[P].once||y&&p[P].context!==y)&&m.push(p[P]);m.length?this._events[v]=m.length===1?m[0]:m:s(this,v)}return this},o.prototype.removeAllListeners=function(u){var d;return u?(d=t?t+u:u,this._events[d]&&s(this,d)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(oo);var Bl=oo.exports,Pr={exports:{}},$l=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const zl=$l;class uo extends Error{constructor(e){super(e),this.name="TimeoutError"}}const co=(n,e,t)=>new Promise((r,a)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(c){a(c)}return}const s=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new uo(s);typeof n.cancel=="function"&&n.cancel(),a(o)},e);zl(n.then(r,a),()=>{clearTimeout(i)})});Pr.exports=co,Pr.exports.default=co,Pr.exports.TimeoutError=uo;var Ml=Pr.exports,Wa={},Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});function Ul(n,e,t){let r=0,a=n.length;for(;a>0;){const i=a/2|0;let s=r+i;t(n[s],e)<=0?(r=++s,a-=i+1):a=i}return r}Ya.default=Ul,Object.defineProperty(Wa,"__esModule",{value:!0});const Zl=Ya;class Kl{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const a=Zl.default(this._queue,r,(i,s)=>s.priority-i.priority);this._queue.splice(a,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Wa.default=Kl,Object.defineProperty(so,"__esModule",{value:!0});const Vl=Bl,lo=Ml,Fl=Wa,Ar=()=>{},ql=new lo.TimeoutError;class Hl extends Vl{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ar,this._resolveIdle=Ar,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Fl.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(a=e.interval)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ar,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Ar,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const s=this._timeout===void 0&&t.timeout===void 0?e():lo.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&a(ql)});r(await s)}catch(s){a(s)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var rt=so.default=Hl;const Wl=[400,401,402,403,404,405,406,407,408,409],Yl=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.name==="TimeoutError"||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&Wl.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const a=new Error(n==null?void 0:n.message);throw a.name="InsufficientQuotaError",a}};let Ir=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Yl;const t="default"in rt?rt.default:rt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>xr(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const Er={},Gl=new Ir({});async function Xl(n,e){return n in Er||(Er[n]=Gl.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete Er[n],t})),new ro(await Er[n],e==null?void 0:e.extendedSpecialTokens)}async function ho(n,e){return Xl(Tl(n),e)}let Or;const Jl=new Uint8Array(16);function Ql(){if(!Or&&(Or=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Or))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Or(Jl)}const Ce=[];for(let n=0;n<256;++n)Ce.push((n+256).toString(16).slice(1));function e0(n,e=0){return Ce[n[e+0]]+Ce[n[e+1]]+Ce[n[e+2]]+Ce[n[e+3]]+"-"+Ce[n[e+4]]+Ce[n[e+5]]+"-"+Ce[n[e+6]]+Ce[n[e+7]]+"-"+Ce[n[e+8]]+Ce[n[e+9]]+"-"+Ce[n[e+10]]+Ce[n[e+11]]+Ce[n[e+12]]+Ce[n[e+13]]+Ce[n[e+14]]+Ce[n[e+15]]}const fo={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function nt(n,e,t){if(fo.randomUUID&&!e&&!n)return fo.randomUUID();n=n||{};const r=n.random||(n.rng||Ql)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=r[a];return e}return e0(r)}var t0=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const r0=Me(t0);var po={exports:{}};const n0=/[\p{Lu}]/u,a0=/[\p{Ll}]/u,mo=/^[\p{Lu}](?![\p{Lu}])/gu,yo=/([\p{Alpha}\p{N}_]|$)/u,go=/[_.\- ]+/,i0=new RegExp("^"+go.source),bo=new RegExp(go.source+yo.source,"gu"),vo=new RegExp("\\d+"+yo.source,"gu"),s0=(n,e,t)=>{let r=!1,a=!1,i=!1;for(let s=0;s<n.length;s++){const o=n[s];r&&n0.test(o)?(n=n.slice(0,s)+"-"+n.slice(s),r=!1,i=a,a=!0,s++):a&&i&&a0.test(o)?(n=n.slice(0,s-1)+"-"+n.slice(s-1),i=a,a=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=a,a=t(o)===o&&e(o)!==o)}return n},o0=(n,e)=>(mo.lastIndex=0,n.replace(mo,t=>e(t))),u0=(n,e)=>(bo.lastIndex=0,vo.lastIndex=0,n.replace(bo,(t,r)=>e(r)).replace(vo,t=>e(t))),_o=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=s0(n,t,r)),n=n.replace(i0,""),e.preserveConsecutiveUppercase?n=o0(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),u0(n,r))};po.exports=_o,po.exports.default=_o;function c0(n,e){return(e==null?void 0:e[n])||r0(n)}function l0(n,e,t){const r={};for(const a in n)Object.hasOwn(n,a)&&(r[e(a,t)]=n[a]);return r}function wo(n){return Array.isArray(n)?[...n]:{...n}}function d0(n,e){const t=wo(n);for(const[r,a]of Object.entries(e)){const[i,...s]=r.split(".").reverse();let o=t;for(const c of s.reverse()){if(o[c]===void 0)break;o[c]=wo(o[c]),o=o[c]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[a]})}return t}function xo(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class at{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,xo(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof at||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((a,i)=>(a[i]=i in this?this[i]:this.lc_kwargs[i],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let i=this,s=r;const[o,...c]=a.split(".").reverse();for(const u of c.reverse()){if(!(u in i)||i[u]===void 0)return;(!(u in s)||s[u]===void 0)&&(typeof i[u]=="object"&&i[u]!=null?s[u]={}:Array.isArray(i[u])&&(s[u]=[])),i=i[u],s=s[u]}o in i&&i[o]!==void 0&&(s[o]=s[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:l0(Object.keys(t).length?d0(r,t):r,c0,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}class h0{}class $t extends h0{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,xo(this.constructor)]}constructor(e){var t;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?((t=process.env)==null?void 0:t.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return at.prototype.toJSON.call(this)}toJSONNotImplemented(){return at.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends $t{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:nt()}),Object.assign(this,e)}}return new t}}var Ga={exports:{}};Ga.exports,function(n){const t=(i=0)=>s=>`\x1B[${38+i};5;${s}m`,r=(i=0)=>(s,o,c)=>`\x1B[${38+i};2;${s};${o};${c}m`;function a(){const i=new Map,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};s.color.gray=s.color.blackBright,s.bgColor.bgGray=s.bgColor.bgBlackBright,s.color.grey=s.color.blackBright,s.bgColor.bgGrey=s.bgColor.bgBlackBright;for(const[o,c]of Object.entries(s)){for(const[u,d]of Object.entries(c))s[u]={open:`\x1B[${d[0]}m`,close:`\x1B[${d[1]}m`},c[u]=s[u],i.set(d[0],d[1]);Object.defineProperty(s,o,{value:c,enumerable:!1})}return Object.defineProperty(s,"codes",{value:i,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi256=t(),s.color.ansi16m=r(),s.bgColor.ansi256=t(10),s.bgColor.ansi16m=r(10),Object.defineProperties(s,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(y=>y+y).join(""));const d=Number.parseInt(u,16);return[d>>16&255,d>>8&255,d&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1}}),s}Object.defineProperty(n,"exports",{enumerable:!0,get:a})}(Ga);var f0=Ga.exports;const Po=Me(f0);function Xa(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class Ja extends $t{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,i,s,o){var f;const c=this._getExecutionOrder(a),u=Date.now(),d=o?{...i,metadata:o}:i,y={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:s||[]};this._startTrace(y),await((f=this.onLLMStart)==null?void 0:f.call(this,y))}async handleChatModelStart(e,t,r,a,i,s,o){var f;const c=this._getExecutionOrder(a),u=Date.now(),d=o?{...i,metadata:o}:i,y={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:s||[]};this._startTrace(y),await((f=this.onLLMStart)==null?void 0:f.call(this,y))}async handleLLMEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onLLMEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleLLMError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onLLMError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleChainStart(e,t,r,a,i,s,o){var y;const c=this._getExecutionOrder(a),u=Date.now(),d={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};this._startTrace(d),await((y=this.onChainStart)==null?void 0:y.call(this,d))}async handleChainEnd(e,t,r,a,i){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");s.end_time=Date.now(),s.outputs=Xa(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=Xa(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s)}async handleChainError(e,t,r,a,i){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");s.end_time=Date.now(),s.error=e.message,s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=Xa(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s)}async handleToolStart(e,t,r,a,i,s){var d;const o=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};this._startTrace(u),await((d=this.onToolStart)==null?void 0:d.call(this,u))}async handleToolEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleToolError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var a;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,r)))}async handleRetrieverStart(e,t,r,a,i,s){var d;const o=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};this._startTrace(u),await((d=this.onRetrieverStart)==null?void 0:d.call(this,u))}async handleRetrieverEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleRetrieverError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleText(e,t){var a;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,r)))}async handleLLMNewToken(e,t,r,a,i,s){var c;const o=this.runMap.get(r);!o||(o==null?void 0:o.run_type)!=="llm"||(o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o)))}}function Le(n,e){return`${n.open}${e}${n.close}`}function Ye(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function ot(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:ze}=Po;class Ao extends Ja{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const a=this.runMap.get(r.parent_run_id);if(a)t.push(a),r=a;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((a,i,s)=>{const o=`${a.execution_order}:${a.run_type}:${a.name}`;return i===s.length-1?Le(Po.bold,o):o}).join(" > ");return Le(ze.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ye(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.cyan,"[chain/end]")} [${t}] [${ot(e)}] Exiting Chain run with output: ${Ye(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.red,"[chain/error]")} [${t}] [${ot(e)}] Chain run errored with error: ${Ye(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Le(ze.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ye(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.cyan,"[llm/end]")} [${t}] [${ot(e)}] Exiting LLM run with output: ${Ye(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.red,"[llm/error]")} [${t}] [${ot(e)}] LLM run errored with error: ${Ye(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Le(ze.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,a;const t=this.getBreadcrumbs(e);console.log(`${Le(ze.cyan,"[tool/end]")} [${t}] [${ot(e)}] Exiting Tool run with output: "${(a=(r=e.outputs)==null?void 0:r.output)==null?void 0:a.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.red,"[tool/error]")} [${t}] [${ot(e)}] Tool run errored with error: ${Ye(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ye(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.cyan,"[retriever/end]")} [${t}] [${ot(e)}] Exiting Retriever run with output: ${Ye(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Le(ze.red,"[retriever/error]")} [${t}] [${ot(e)}] Retriever run errored with error: ${Ye(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Le(ze.blue,"[agent/action]")} [${r}] Agent selected action: ${Ye(t.actions[t.actions.length-1],"[action]")}`)}}const p0=[400,401,403,404,405,406,407,408,409];class m0{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in rt?rt.default:rt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>xr(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var i;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const a=(i=r==null?void 0:r.response)==null?void 0:i.status;if(a&&p0.includes(+a))throw r},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}function Io(n){return typeof(n==null?void 0:n._getType)=="function"}function Eo(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}const y0=()=>typeof window<"u"&&typeof window.document<"u",g0=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",b0=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Oo=()=>typeof Deno<"u",v0=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Oo(),_0=()=>{let n;return y0()?n="browser":v0()?n="node":g0()?n="webworker":b0()?n="jsdom":Oo()?n="deno":n="other",n};let Qa;async function w0(){if(Qa===void 0){const n=_0(),e=x0();Qa={library:"langsmith",runtime:n,...e}}return Qa}function Ct(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}let ei;function x0(){if(ei!==void 0)return ei;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Ct(t);r!==void 0&&(e[t]=r)}return ei=e,e}const Co=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},zt=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};async function P0(n){const e=[];for await(const t of n)e.push(t);return e}function ti(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function To(n){return Ct("LANGCHAIN_HIDE_INPUTS")==="true"?{}:n}function ko(n){return Ct("LANGCHAIN_HIDE_OUTPUTS")==="true"?{}:n}class ri{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});const t=ri.getDefaultClientConfig();this.apiUrl=ti(e.apiUrl??t.apiUrl)??"",this.apiKey=ti(e.apiKey??t.apiKey),this.webUrl=ti(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new m0(e.callerOptions??{})}static getDefaultClientConfig(){const e=Ct("LANGCHAIN_API_KEY");return{apiUrl:Ct("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984"),apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){if(!Co(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:Co(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _get(e,t){const r=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i.json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);const o=await s.json();if(o.length===0||(yield o,o.length<a))break;r+=o.length}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},a=await w0(),i=e.project_name;delete e.project_name;const s={session_name:i,...e,extra:{...e.extra,runtime:{...a,...r.runtime}}};s.inputs=To(s.inputs),s.outputs&&(s.outputs=ko(s.outputs));const o=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});await zt(o,"create run")}async updateRun(e,t){t.inputs&&(t.inputs=To(t.inputs)),t.outputs&&(t.outputs=ko(t.outputs));const r={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await zt(a,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let a;t.session_id?a=t.session_id:r!=null&&r.projectName?a=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?a=r==null?void 0:r.projectId:a=(await this.readProject({projectName:Ct("LANGCHAIN_PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await P0(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort((i,s)=>((i==null?void 0:i.dotted_order)??"").localeCompare((s==null?void 0:s.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),a[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(a[i].child_runs=r[i]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:a,startTime:i,executionOrder:s,runType:o,error:c,id:u,limit:d,offset:y,query:f,filter:v}){const p=new URLSearchParams;let P=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");P=(await this.readProject({projectName:t})).id}if(P&&p.append("session",P),r&&p.append("parent_run",r),a&&p.append("reference_example",a),i&&p.append("start_time",i.toISOString()),s&&p.append("execution_order",s.toString()),o&&p.append("run_type",o),c!==void 0&&p.append("error",c.toString()),u!==void 0)for(const m of u)p.append("id",m);d!==void 0&&p.append("limit",d.toString()),y!==void 0&&p.append("offset",y.toString()),f!==void 0&&p.append("query",f),v!==void 0&&p.append("filter",v);for await(const m of this._getPaginated("/runs",p))yield*m}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||nt()},i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await zt(t,"unshare run")}async readRunSharedLink(e){const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async createProject({projectName:e,projectExtra:t,upsert:r,referenceDatasetId:a}){const i=r?"?upsert=true":"",s=`${this.apiUrl}/sessions${i}`,o={name:e};t!==void 0&&(o.extra=t),a!==void 0&&(o.reference_dataset_id=a);const c=await this.caller.call(fetch,s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)}),u=await c.json();if(!c.ok)throw new Error(`Failed to create session ${e}: ${c.status} ${c.statusText}`);return u}async readProject({projectId:e,projectName:t}){let r="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this._get(r,a);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:s}={}){const o=new URLSearchParams;if(e!==void 0)for(const c of e)o.append("id",c);if(t!==void 0&&o.append("name",t),r!==void 0&&o.append("name_contains",r),a!==void 0)o.append("reference_dataset",a);else if(i!==void 0){const c=await this.readDataset({datasetName:i});o.append("reference_dataset",c.id)}s!==void 0&&o.append("reference_free",s.toString());for await(const c of this._getPaginated("/sessions",o))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e;const a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await zt(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:s,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(f=>{u.append("input_keys",f)}),a.forEach(f=>{u.append("output_keys",f)}),i&&u.append("description",i),s&&u.append("data_type",s),o&&u.append("name",o);const d=await this.caller.call(fetch,c,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms)});if(!d.ok){const f=await d.json();throw f.detail&&f.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${d.status} ${d.statusText}`)}return await d.json()}async createDataset(e,{description:t,dataType:r}={}){const a={name:e,description:t};r&&(a.data_type=r);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok){const o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,a);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i}={}){const s="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)o.append("id",c);a!==void 0&&o.append("name",a),i!==void 0&&o.append("name_contains",i);for await(const c of this._getPaginated(s,o))yield*c}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)r+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:i,exampleId:s}){let o=r;if(o===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:a})).id);const u={dataset_id:o,inputs:e,outputs:t,created_at:(i||new Date).toISOString(),id:s},d=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!d.ok)throw new Error(`Failed to create example: ${d.status} ${d.statusText}`);return await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const a=e.map(s=>Io(s)?Eo(s):s),i=Io(t)?Eo(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)a=e;else if(t!==void 0)a=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const i=new URLSearchParams({dataset:a});if(r!==void 0)for(const s of r)i.append("id",s);for await(const s of this._getPaginated("/examples",i))yield*s}async deleteExample(e){const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a}={loadChildRuns:!1}){let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);let s;i.reference_example_id!==null&&i.reference_example_id!==void 0&&(s=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,s);let c=r??{};return o.evaluatorInfo&&(c={...c,...o.evaluatorInfo}),await this.createFeedback(i.id,o.key,{score:o.score,value:o.value,comment:o.comment,correction:o.correction,sourceInfo:c,feedbackSourceType:"model"})}async createFeedback(e,t,{score:r,value:a,correction:i,comment:s,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:d}){const y={type:c??"api",metadata:o??{}};u!==void 0&&(y==null?void 0:y.metadata)!==void 0&&!y.metadata.__run&&(y.metadata.__run={run_id:u});const f={id:d??nt(),run_id:e,key:t,score:r,value:a,correction:i,comment:s,feedback_source:y},v=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)});return await zt(v,"create feedback"),f}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){const s={};return t!=null&&(s.score=t),r!=null&&(s.value=r),a!=null&&(s.correction=a),i!=null&&(s.comment=i),(await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)})).json()}async readFeedback(e){const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const i of t)a.append("key",i);if(r)for(const i of r)a.append("source",i);for await(const i of this._getPaginated("/feedback",a))yield*i}}const A0=()=>typeof window<"u"&&typeof window.document<"u",I0=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",E0=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),So=()=>typeof Deno<"u",O0=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!So(),C0=()=>{let n;return A0()?n="browser":O0()?n="node":I0()?n="webworker":E0()?n="jsdom":So()?n="deno":n="other",n};let ni;async function T0(){return ni===void 0&&(ni={library:"langchain-js",runtime:C0()}),ni}function ce(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}class k0 extends Ja{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:a}=e;this.projectName=r??ce("LANGCHAIN_PROJECT")??ce("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new ri({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await T0()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}class S0{}const Ro=(n,e)=>{if(e!==void 0)return n[e];const t=Object.keys(n);if(t.length===1)return n[t[0]]},R0=(n,e)=>{const t=Ro(n,e);if(!t){const r=Object.keys(n);throw new Error(`input values have ${r.length} keys, you must specify an input key or pass only 1 key as input`)}return t},j0=(n,e)=>{const t=Ro(n,e);if(!t){const r=Object.keys(n);throw new Error(`output values have ${r.length} keys, you must specify an output key or pass only 1 key as output`)}return t};function Cr(n,e="Human",t="AI"){const r=[];for(const a of n){let i;if(a._getType()==="human")i=e;else if(a._getType()==="ai")i=t;else if(a._getType()==="system")i="System";else if(a._getType()==="function")i="Function";else if(a._getType()==="generic")i=a.role;else throw new Error(`Got unsupported message type: ${a}`);const s=a.name?`${a.name}, `:"";r.push(`${i}: ${s}${a.content}`)}return r.join(`
`)}class N0 extends Ja{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:ce("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=ce("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var i;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let a;if(e.run_type==="llm"){const s=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(c=>Cr(c));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:s,response:e.outputs}}else if(e.run_type==="chain"){const s=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:s.filter(c=>c.type==="llm"),child_chain_runs:s.filter(c=>c.type==="chain"),child_tool_runs:s.filter(c=>c.type==="tool")}}else if(e.run_type==="tool"){const s=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(i=e.outputs)==null?void 0:i.output,action:JSON.stringify(r),child_llm_runs:s.filter(c=>c.type==="llm"),child_chain_runs:s.filter(c=>c.type==="chain"),child_tool_runs:s.filter(c=>c.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return a}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const a=await t.json();return a.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=a,this.session=r,r)}}async function L0(n){const e=new N0;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function D0(){return new k0}let ai;function B0(){const n="default"in rt?rt.default:rt;return new n({autoStart:!0,concurrency:1})}async function Te(n,e){e===!0?await n():(typeof ai>"u"&&(ai=B0()),ai.add(n))}function jo(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class $0{setHandler(e){return this.setHandlers([e])}}class Tr{constructor(e,t,r,a,i,s,o,c){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:c})}async handleText(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleText: ${a}`)}},t.awaitHandlers)))}}class z0 extends Tr{getChild(e){const t=new Se(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${a}`)}},t.awaitHandlers)))}}class No extends Tr{async handleLLMNewToken(e,t,r,a,i,s){await Promise.all(this.handlers.map(o=>Te(async()=>{var c;if(!o.ignoreLLM)try{await((c=o.handleLLMNewToken)==null?void 0:c.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${a}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${a}`)}},t.awaitHandlers)))}}class M0 extends Tr{getChild(e){const t=new Se(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(s=>Te(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(c){console.error(`Error in handler ${s.constructor.name}, handleChainError: ${c}`)}},s.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(s=>Te(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(c){console.error(`Error in handler ${s.constructor.name}, handleChainEnd: ${c}`)}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${a}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${a}`)}},t.awaitHandlers)))}}class U0 extends Tr{getChild(e){const t=new Se(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${a}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Te(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${a}`)}},t.awaitHandlers)))}}class Se extends $0{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,a=void 0,i=void 0){return Promise.all(t.map(async s=>{const o=nt();return await Promise.all(this.handlers.map(c=>Te(async()=>{var u;if(!c.ignoreLLM)try{await((u=c.handleLLMStart)==null?void 0:u.call(c,e,[s],o,this._parentRunId,i,this.tags,this.metadata))}catch(d){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${d}`)}},c.awaitHandlers))),new No(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,a=void 0,i=void 0){return Promise.all(t.map(async s=>{const o=nt();return await Promise.all(this.handlers.map(c=>Te(async()=>{var u,d;if(!c.ignoreLLM)try{if(c.handleChatModelStart)await((u=c.handleChatModelStart)==null?void 0:u.call(c,e,[s],o,this._parentRunId,i,this.tags,this.metadata));else if(c.handleLLMStart){const y=Cr(s);await((d=c.handleLLMStart)==null?void 0:d.call(c,e,[y],o,this._parentRunId,i,this.tags,this.metadata))}}catch(y){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${y}`)}},c.awaitHandlers))),new No(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=nt(),a=void 0){return await Promise.all(this.handlers.map(i=>Te(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainStart)==null?void 0:s.call(i,e,t,r,this._parentRunId,this.tags,this.metadata,a))}catch(o){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${o}`)}},i.awaitHandlers))),new M0(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=nt()){return await Promise.all(this.handlers.map(a=>Te(async()=>{var i;if(!a.ignoreAgent)try{await((i=a.handleToolStart)==null?void 0:i.call(a,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(s){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${s}`)}},a.awaitHandlers))),new U0(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=nt(),a=void 0){return await Promise.all(this.handlers.map(i=>Te(async()=>{var s;if(!i.ignoreRetriever)try{await((s=i.handleRetrieverStart)==null?void 0:s.call(i,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(o){console.error(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${o}`)}},i.awaitHandlers))),new z0(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Se(this._parentRunId);for(const a of this.handlers){const i=this.inheritableHandlers.includes(a);r.addHandler(a,i)}for(const a of this.tags){const i=this.inheritableTags.includes(a);r.addTags([a],i)}for(const a of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},i)}for(const a of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends $t{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:nt()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,i,s,o){let c;(e||t)&&(Array.isArray(e)||!e?(c=new Se,c.setHandlers((e==null?void 0:e.map(Lo))??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(Lo):t==null?void 0:t.handlers,!1));const u=ce("LANGCHAIN_VERBOSE")||(o==null?void 0:o.verbose),d=ce("LANGCHAIN_TRACING_V2")==="true",y=d||(ce("LANGCHAIN_TRACING")??!1);if(u||y){if(c||(c=new Se),u&&!c.handlers.some(f=>f.name===Ao.prototype.name)){const f=new Ao;c.addHandler(f,!0)}if(y&&!c.handlers.some(f=>f.name==="langchain_tracer"))if(d)c.addHandler(await D0(),!0);else{const f=ce("LANGCHAIN_PROJECT")&&ce("LANGCHAIN_SESSION");c.addHandler(await L0(f),!0)}}return(r||a)&&c&&(c.addTags(r??[]),c.addTags(a??[],!1)),(i||s)&&c&&(c.addMetadata(i??{}),c.addMetadata(s??{},!1)),c}}function Lo(n){return"name"in n?n:$t.fromMethods(n)}class kr extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();const e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new kr({start(r){return a();function a(){return t.read().then(({done:i,value:s})=>{if(i){r.close();return}return r.enqueue(s),a()})}}})}static fromAsyncGenerator(e){return new kr({async pull(t){const{value:r,done:a}=await e.next();a?t.close():r&&t.enqueue(r)}})}}async function mt(n){return Se.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function Re(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class Ie extends at{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new Sr({bound:this,kwargs:e,config:{}})}map(){return new ii({bound:this})}withRetry(e){return new Z0({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Sr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new F0({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),i=new Ir({maxConcurrency:r==null?void 0:r.maxConcurrency,onFailedAttempt:o=>{throw o}}),s=e.map((o,c)=>i.call(async()=>{try{return await this.invoke(o,a[c])}catch(u){if(r!=null&&r.returnExceptions)return u;throw u}}));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return kr.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){const a=await mt(r),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),Re(t,"input"),void 0,r==null?void 0:r.runType));let s;try{s=await e.bind(this)(t,r,i)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(Re(s,"output"))),s}async _batchWithConfig(e,t,r,a){const i=this._getOptionsList(r??{},t.length),s=await Promise.all(i.map(mt)),o=await Promise.all(s.map((u,d)=>u==null?void 0:u.handleChainStart(this.toJSON(),Re(t[d],"input"))));let c;try{c=await e(t,i,o,a)}catch(u){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Re(c,"output")))),c}async*_transformStreamWithConfig(e,t,r){let a,i=!0,s,o=!0;const c=await mt(r);let u;const d=this.toJSON();async function*y(){for await(const v of e){if(u||(u=await(c==null?void 0:c.handleChainStart(d,{input:""},void 0,r==null?void 0:r.runType))),i)if(a===void 0)a=v;else try{a=a.concat(v)}catch{a=void 0,i=!1}yield v}}const f=y();try{const v=t(f,u,r);for await(const p of v)if(yield p,o)if(s===void 0)s=p;else try{s=s.concat(p)}catch{s=void 0,o=!1}}catch(v){throw await(u==null?void 0:u.handleChainError(v,void 0,void 0,void 0,{inputs:Re(a,"input")})),v}await(u==null?void 0:u.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:Re(a,"input")}))}_patchConfig(e={},t=void 0){return{...e,callbacks:t}}pipe(e){return new Tt({first:this,last:yt(e)})}async*transform(e,t){let r;for await(const a of e)r?r=r.concat(a):r=a;yield*this._streamIterator(r,t)}static isRunnable(e){return e.lc_runnable}}class Sr extends Ie{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config}_mergeConfig(e){const t={...this.config};if(e)for(const r of Object.keys(e))r==="metadata"?t[r]={...t[r],...e[r]}:r==="tags"?t[r]=(t[r]??[]).concat(e[r]??[]):t[r]=e[r]??t[r];return t}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){const a=Array.isArray(t)?t.map(i=>this._mergeConfig({...i,...this.kwargs})):this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,this._mergeConfig({...t,...this.kwargs}))}async*transform(e,t){yield*this.bound.transform(e,this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&Ie.isRunnable(e.bound)}}class ii extends Ie{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new ii({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r==null?void 0:r.getChild()))}}class Z0 extends Sr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r==null?void 0:r.getChild(a))}async _invoke(e,t,r){return xr(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){const i={};try{await xr(async s=>{const o=e.map((f,v)=>v).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),c=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(s,t==null?void 0:t[f],r==null?void 0:r[f])),d=await super.batch(c,u,{...a,returnExceptions:!0});let y;for(let f=0;f<d.length;f+=1){const v=d[f],p=o[f];v instanceof Error&&y===void 0&&(y=v),i[p.toString()]=v}if(y)throw y;return d},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((a==null?void 0:a.returnExceptions)!==!0)throw s}return Object.keys(i).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>i[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Tt extends Ie{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await mt(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Re(e,"input")));let i=e,s;try{const o=[this.first,...this.middle];for(let c=0;c<o.length;c+=1)i=await o[c].invoke(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${c+1}`)));s=await this.last.invoke(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${this.steps.length}`)))}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(Re(s,"output"))),s}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(mt)),s=await Promise.all(i.map((u,d)=>u==null?void 0:u.handleChainStart(this.toJSON(),Re(e[d],"input"))));let o=e,c;try{const u=[this.first,...this.middle];for(let d=0;d<u.length;d+=1)o=await u[d].batch(o,s.map((f,v)=>this._patchConfig(a[v],f==null?void 0:f.getChild(`seq:step:${d+1}`))),r);c=await this.last.batch(o,s.map(d=>this._patchConfig(a[this.steps.length-1],d==null?void 0:d.getChild(`seq:step:${this.steps.length}`))),r)}catch(u){throw await Promise.all(s.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(s.map((u,d)=>u==null?void 0:u.handleChainEnd(Re(c[d],"output")))),c}async*_streamIterator(e,t){const r=await mt(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Re(e,"input")));let i=e;const s=[this.first,...this.middle,this.last],o=Math.min(s.length-1,s.length-[...s].reverse().findIndex(d=>{var v;const y=d.transform===Ie.prototype.transform,f=Sr.isRunnableBinding(d)&&((v=d.bound)==null?void 0:v.transform)===Ie.prototype.transform;return y||f})-1);try{const d=s.slice(0,o);for(let y=0;y<d.length;y+=1)i=await d[y].invoke(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${y+1}`)))}catch(d){throw await(a==null?void 0:a.handleChainError(d)),d}let c=!0,u;try{let d=await s[o]._streamIterator(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${o+1}`)));const y=s.slice(o+1);for(let f=0;f<y.length;f+=1)d=await y[f].transform(d,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${o+f+2}`)));for await(const f of d)if(yield f,c)if(u===void 0)u=f;else try{u=u.concat(f)}catch{u=void 0,c=!1}}catch(d){throw await(a==null?void 0:a.handleChainError(d)),d}await(a==null?void 0:a.handleChainEnd(Re(u,"output")))}pipe(e){return Tt.isRunnableSequence(e)?new Tt({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}):new Tt({first:this.first,middle:[...this.middle,this.last],last:yt(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Ie.isRunnable(e)}static from([e,...t]){return new Tt({first:yt(e),middle:t.slice(0,-1).map(yt),last:yt(t[t.length-1])})}}class K0 extends Ie{static lc_name(){return"RunnableMap"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=yt(r)}async invoke(e,t){const r=await mt(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),{input:e})),i={};try{for(const[s,o]of Object.entries(this.steps)){const c=await o.invoke(e,this._patchConfig(t,a==null?void 0:a.getChild()));i[s]=c}}catch(s){throw await(a==null?void 0:a.handleChainError(s)),s}return await(a==null?void 0:a.handleChainEnd(i)),i}}class V0 extends Ie{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async _invoke(e,t,r){let a=await this.func(e);return a&&Ie.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r==null?void 0:r.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class F0 extends Ie{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await Se.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Re(e,"input")));let i;for(const s of this.runnables())try{const o=await s.invoke(e,this._patchConfig(t,a==null?void 0:a.getChild()));return await(a==null?void 0:a.handleChainEnd(Re(o,"output"))),o}catch(o){i===void 0&&(i=o)}throw i===void 0?new Error("No error stored at end of fallback."):(await(a==null?void 0:a.handleChainError(i)),i)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(c=>Se.configure(c==null?void 0:c.callbacks,void 0,c==null?void 0:c.tags,void 0,c==null?void 0:c.metadata))),s=await Promise.all(i.map((c,u)=>c==null?void 0:c.handleChainStart(this.toJSON(),Re(e[u],"input"))));let o;for(const c of this.runnables())try{const u=await c.batch(e,s.map((d,y)=>this._patchConfig(a[y],d==null?void 0:d.getChild())),r);return await Promise.all(s.map((d,y)=>d==null?void 0:d.handleChainEnd(Re(u[y],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function yt(n){if(typeof n=="function")return new V0({func:n});if(Ie.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=yt(r);return new K0({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class q0 extends Ie{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}invoke(e,t){return this.transformDocuments(e)}}class H0 extends q0{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const a=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${a})`))}else r=e.split(t);else r=e.split("");return r.filter(a=>a!=="")}async createDocuments(e,t=[],r={}){const a=t.length>0?t:new Array(e.length).fill({}),{chunkHeader:i="",chunkOverlapHeader:s="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,c=new Array;for(let u=0;u<e.length;u+=1){const d=e[u];let y=1,f=null;for(const v of await this.splitText(d)){let p=i,P=0;if(f){const w=d.indexOf(v),C=d.indexOf(f)+await this.lengthFunction(f);P=(d.slice(C,w).match(/\n/g)||[]).length,o&&(p+=s)}y+=P;const m=(v.match(/\n/g)||[]).length,T=a[u].loc&&typeof a[u].loc=="object"?{...a[u].loc}:{};T.lines={from:y,to:y+m};const _={...a[u],loc:T};p+=v,c.push(new vr({pageContent:p,metadata:_})),y+=m,f=v}}return c}async splitDocuments(e,t={}){const r=e.filter(s=>s.pageContent!==void 0),a=r.map(s=>s.pageContent),i=r.map(s=>s.metadata);return this.createDocuments(a,i,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}async mergeSplits(e,t){const r=[],a=[];let i=0;for(const o of e){const c=await this.lengthFunction(o);if(i+c+(a.length>0?t.length:0)>this.chunkSize&&(i>this.chunkSize&&console.warn(`Created a chunk of size ${i}, +
which is longer than the specified ${this.chunkSize}`),a.length>0)){const u=this.joinDocs(a,t);for(u!==null&&r.push(u);i>this.chunkOverlap||i+c>this.chunkSize&&i>0;)i-=await this.lengthFunction(a[0]),a.shift()}a.push(o),i+=c}const s=this.joinDocs(a,t);return s!==null&&r.push(s),r}}class Rr extends H0{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let a=t[t.length-1],i;for(let u=0;u<t.length;u+=1){const d=t[u];if(d===""){a=d;break}if(e.includes(d)){a=d,i=t.slice(u+1);break}}const s=this.splitOnSeparator(e,a);let o=[];const c=this.keepSeparator?"":a;for(const u of s)if(await this.lengthFunction(u)<this.chunkSize)o.push(u);else{if(o.length){const d=await this.mergeSplits(o,c);r.push(...d),o=[]}if(!i)r.push(u);else{const d=await this._splitText(u,i);r.push(...d)}}if(o.length){const u=await this.mergeSplits(o,c);r.push(...u)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new Rr({...t,separators:Rr.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}const kt="4.11.0";class Ve extends Error{}let Fe=class ms extends Ve{constructor(e,t,r,a){super(`${e} ${ms.makeMessage(t,r)}`),this.status=e,this.headers=a;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t){return e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):t||"status code (no body)"}static generate(e,t,r,a){if(!e)return new jr({cause:fi(t)});const i=t==null?void 0:t.error;return e===400?new Do(e,i,r,a):e===401?new Bo(e,i,r,a):e===403?new $o(e,i,r,a):e===404?new zo(e,i,r,a):e===409?new Mo(e,i,r,a):e===422?new Uo(e,i,r,a):e===429?new Zo(e,i,r,a):e>=500?new Ko(e,i,r,a):new ms(e,i,r,a)}},si=class extends Fe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},jr=class extends Fe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},oi=class extends jr{constructor({message:e}={}){super({message:e??"Request timed out."})}},Do=class extends Fe{constructor(){super(...arguments),this.status=400}},Bo=class extends Fe{constructor(){super(...arguments),this.status=401}},$o=class extends Fe{constructor(){super(...arguments),this.status=403}},zo=class extends Fe{constructor(){super(...arguments),this.status=404}},Mo=class extends Fe{constructor(){super(...arguments),this.status=409}},Uo=class extends Fe{constructor(){super(...arguments),this.status=422}},Zo=class extends Fe{constructor(){super(...arguments),this.status=429}},Ko=class extends Fe{},W0=class{constructor(e,t){this.response=e,this.controller=t,this.decoder=new Y0}async*iterMessages(){if(!this.response.body)throw this.controller.abort(),new Ve("Attempted to iterate over a response with no body");const e=new ui,t=X0(this.response.body);for await(const r of t)for(const a of e.decode(r)){const i=this.decoder.decode(a);i&&(yield i)}for(const r of e.flush()){const a=this.decoder.decode(r);a&&(yield a)}}async*[Symbol.asyncIterator](){let e=!1;try{for await(const t of this.iterMessages())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(t.event===null)try{yield JSON.parse(t.data)}catch(r){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),r}}e=!0}catch(t){if(t instanceof Error&&t.name==="AbortError")return;throw t}finally{e||this.controller.abort()}}},Y0=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=G0(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}},ui=class ys{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ys.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(ys.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Ve(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!==null&&t!==void 0||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Ve(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Ve("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};ui.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]),ui.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function G0(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function X0(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let Vo=!1,Mt,Fo,qo,ci,Ho,Wo,Yo,Go;function J0(n,e={auto:!1}){if(Vo)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Mt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Mt}'\``);Vo=e.auto,Mt=n.kind,Fo=n.fetch,n.Request,n.Response,n.Headers,qo=n.FormData,n.Blob,ci=n.File,Ho=n.getMultipartRequestOptions,Wo=n.getDefaultAgent,Yo=n.fileFromPath,Go=n.isFsReadStream}let Q0=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function ed({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,a,i;try{t=fetch,r=Request,a=Response,i=Headers}catch(s){throw new Error(`this environment is missing the following Web Fetch API type: ${s.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:a,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},getMultipartRequestOptions:async(s,o)=>({...o,body:new Q0(s)}),getDefaultAgent:s=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:s=>!1}}Mt||J0(ed(),{auto:!0});const Xo=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",td=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Jo(n),Jo=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",rd=n=>td(n)||Xo(n)||Go(n);async function Qo(n,e,t={}){var r,a,i;if(n=await n,Xo(n)){const o=await n.blob();return e||(e=(r=new URL(n.url).pathname.split(/[\\/]/).pop())!==null&&r!==void 0?r:"unknown_file"),new ci([o],e,t)}const s=await nd(n);if(e||(e=(a=id(n))!==null&&a!==void 0?a:"unknown_file"),!t.type){const o=(i=s[0])===null||i===void 0?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new ci(s,e,t)}async function nd(n){var e;let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(Jo(n))t.push(await n.arrayBuffer());else if(sd(n))for await(const r of n)t.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(e=n==null?void 0:n.constructor)===null||e===void 0?void 0:e.name}; props: ${ad(n)}`);return t}function ad(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function id(n){var e;return li(n.name)||li(n.filename)||((e=li(n.path))===null||e===void 0?void 0:e.split(/[\\/]/).pop())}const li=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},sd=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",eu=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Ut=async n=>{const e=await od(n.body);return Ho(e,n)},od=async n=>{const e=new qo;return await Promise.all(Object.entries(n||{}).map(([t,r])=>di(e,t,r))),e},di=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(rd(t)){const r=await Qo(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>di(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>di(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ud=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},cd=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Nr;const ld=2;async function tu(n){const{response:e}=n;if(n.options.stream)return new W0(e,n.controller);const t=e.headers.get("content-type");if(t!=null&&t.includes("application/json")){const a=await e.json();return Dr("response",e.status,e.url,e.headers,a),a}const r=await e.text();return Dr("response",e.status,e.url,e.headers,r),r}let ru=class Uc extends Promise{constructor(e,t=tu){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Uc(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},dd=class{constructor({baseURL:e,maxRetries:t,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=hi("maxRetries",t??ld),this.timeout=hi("timeout",r),this.httpAgent=a,this.fetch=i??Fo}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...gd(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${xd()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(a=>({method:e,path:t,...a})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var t,r,a,i,s,o;const{method:c,path:u,query:d,headers:y={}}=e,f=eu(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,v=this.calculateContentLength(f),p=this.buildURL(u,d);"timeout"in e&&hi("timeout",e.timeout);const P=(t=e.timeout)!==null&&t!==void 0?t:this.timeout,m=(a=(r=e.httpAgent)!==null&&r!==void 0?r:this.httpAgent)!==null&&a!==void 0?a:Wo(p),T=P+1e3;typeof((i=m==null?void 0:m.options)===null||i===void 0?void 0:i.timeout)=="number"&&T>((s=m.options.timeout)!==null&&s!==void 0?s:0)&&(m.options.timeout=T),this.idempotencyHeader&&c!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),y[this.idempotencyHeader]=e.idempotencyKey);const _={...v&&{"Content-Length":v},...this.defaultHeaders(e),...y};eu(e.body)&&Mt!=="node"&&delete _["Content-Type"],Object.keys(_).forEach(C=>_[C]===null&&delete _[C]);const w={method:c,...f&&{body:f},headers:_,...m&&{agent:m},signal:(o=e.signal)!==null&&o!==void 0?o:null};return this.validateHeaders(_,y),{req:w,url:p,timeout:P}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return Fe.generate(e,t,r,a)}request(e,t=null){return new ru(this.makeRequest(e,t))}async makeRequest(e,t){var r,a,i;const s=await e;t==null&&(t=(r=s.maxRetries)!==null&&r!==void 0?r:this.maxRetries);const{req:o,url:c,timeout:u}=this.buildRequest(s);if(await this.prepareRequest(o,{url:c,options:s}),Dr("request",c,s,o.headers),!((a=s.signal)===null||a===void 0)&&a.aborted)throw new si;const d=new AbortController,y=await this.fetchWithTimeout(c,o,u,d).catch(fi);if(y instanceof Error){if(!((i=s.signal)===null||i===void 0)&&i.aborted)throw new si;if(t)return this.retryRequest(s,t);throw y.name==="AbortError"?new oi:new jr({cause:y})}const f=fd(y.headers);if(!y.ok){if(t&&this.shouldRetry(y))return this.retryRequest(s,t,f);const v=await y.text().catch(T=>fi(T).message),p=bd(v),P=p?void 0:v;throw Dr("response",y.status,c,f,P),this.makeStatusError(y.status,p,P,f)}return{response:y,options:s,controller:d}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new hd(this,r,e)}buildURL(e,t){const r=_d(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return cu(a)||(t={...a,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Ve(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){const{signal:i,...s}=t||{};i&&i.addEventListener("abort",()=>a.abort());const o=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:a.signal,...s}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var a;t-=1;let i;const s=r==null?void 0:r["retry-after"];if(s){const o=parseInt(s);Number.isNaN(o)?i=Date.parse(s)-Date.now():i=o*1e3}if(!i||!Number.isInteger(i)||i<=0||i>60*1e3){const o=(a=e.maxRetries)!==null&&a!==void 0?a:this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,o)}return await ou(i),this.makeRequest(e,t)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,s=Math.min(.5*Math.pow(i-1,2),2),o=Math.random()-.5;return(s+o)*1e3}getUserAgent(){return`${this.constructor.name}/JS ${kt}`}},nu=class{constructor(e,t,r,a){Nr.set(this,void 0),ud(this,Nr,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,i]of r)e.url.searchParams.set(a,i);t.query=void 0,t.path=e.url.toString()}return await cd(this,Nr,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Nr=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},hd=class extends ru{constructor(e,t,r){super(t,async a=>new r(e,a.response,await tu(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const fd=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),pd={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0},au=n=>typeof n=="object"&&n!==null&&!cu(n)&&Object.keys(n).every(e=>wd(pd,e)),md=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kt,"X-Stainless-OS":su(Deno.build.os),"X-Stainless-Arch":iu(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kt,"X-Stainless-OS":su(process.platform),"X-Stainless-Arch":iu(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=yd();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function yd(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${a}.${i}.${s}`}}}return null}const iu=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",su=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Lr;const gd=()=>Lr??(Lr=md()),bd=n=>{try{return JSON.parse(n)}catch{return}},vd=new RegExp("^(?:[a-z]+:)?//","i"),_d=n=>vd.test(n),ou=n=>new Promise(e=>setTimeout(e,n)),hi=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Ve(`${n} must be an integer`);if(e<0)throw new Ve(`${n} must be a positive integer`);return e},fi=n=>n instanceof Error?n:new Error(n),uu=n=>{var e,t,r,a;if(typeof process<"u")return(t=(e=process.env)===null||e===void 0?void 0:e[n])!==null&&t!==void 0?t:void 0;if(typeof Deno<"u")return(a=(r=Deno.env)===null||r===void 0?void 0:r.get)===null||a===void 0?void 0:a.call(r,n)};function cu(n){if(!n)return!0;for(const e in n)return!1;return!0}function wd(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Dr(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const xd=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Pd=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";let Br=class extends nu{constructor(e,t,r,a){super(e,t,r,a),this.object=r.object,this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}},pi=class extends nu{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e,t;if(!(!((e=this.data)===null||e===void 0)&&e.length))return null;const r=(t=this.data[this.data.length-1])===null||t===void 0?void 0:t.id;return r?{params:{after:r}}:null}},De=class{constructor(e){this.client=e,this.get=e.get.bind(e),this.post=e.post.bind(e),this.patch=e.patch.bind(e),this.put=e.put.bind(e),this.delete=e.delete.bind(e),this.getAPIList=e.getAPIList.bind(e)}},$r=class extends De{create(e,t){return this.post("/audio/transcriptions",Ut({body:e,...t}))}};$r||($r={});let zr=class extends De{create(e,t){return this.post("/audio/translations",Ut({body:e,...t}))}};zr||(zr={});let Mr=class extends De{constructor(){super(...arguments),this.transcriptions=new $r(this.client),this.translations=new zr(this.client)}};(function(n){n.Transcriptions=$r,n.Translations=zr})(Mr||(Mr={}));let Ur=class extends De{create(e,t){var r;return this.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}};Ur||(Ur={});let Zr=class extends De{constructor(){super(...arguments),this.completions=new Ur(this.client)}};(function(n){n.Completions=Ur})(Zr||(Zr={}));let Kr=class extends De{create(e,t){var r;return this.post("/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}};Kr||(Kr={});let Vr=class extends De{create(e,t){return this.post("/embeddings",{body:e,...t})}};Vr||(Vr={});let Fr=class extends De{create(e,t){return this.post("/edits",{body:e,...t})}};Fr||(Fr={});let qr=class extends De{create(e,t){return this.post("/files",Ut({body:e,...t}))}retrieve(e,t){return this.get(`/files/${e}`,t)}list(e){return this.getAPIList("/files",lu,e)}del(e,t){return this.delete(`/files/${e}`,t)}retrieveContent(e,t){return this.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const a=new Set(["processed","error","deleted"]),i=Date.now();let s=await this.retrieve(e);for(;!s.status||!a.has(s.status);)if(await ou(t),s=await this.retrieve(e),Date.now()-i>r)throw new oi({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}},lu=class extends Br{};qr||(qr={});let Hr=class extends De{create(e,t){return this.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this.get(`/fine-tunes/${e}`,t)}list(e){return this.getAPIList("/fine-tunes",du,e)}cancel(e,t){return this.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){var a;return this.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:(a=t==null?void 0:t.stream)!==null&&a!==void 0?a:!1})}},du=class extends Br{};Hr||(Hr={});let Wr=class extends De{create(e,t){return this.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return au(e)?this.list({},e):this.getAPIList("/fine_tuning/jobs",hu,{query:e,...t})}cancel(e,t){return this.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return au(t)?this.listEvents(e,{},t):this.getAPIList(`/fine_tuning/jobs/${e}/events`,fu,{query:t,...r})}},hu=class extends pi{},fu=class extends pi{};Wr||(Wr={});let Yr=class extends De{constructor(){super(...arguments),this.jobs=new Wr(this.client)}};(function(n){n.Jobs=Wr,n.FineTuningJobsPage=hu,n.FineTuningJobEventsPage=fu})(Yr||(Yr={}));let Gr=class extends De{createVariation(e,t){return this.post("/images/variations",Ut({body:e,...t}))}edit(e,t){return this.post("/images/edits",Ut({body:e,...t}))}generate(e,t){return this.post("/images/generations",{body:e,...t})}};Gr||(Gr={});let Xr=class extends De{retrieve(e,t){return this.get(`/models/${e}`,t)}list(e){return this.getAPIList("/models",pu,e)}del(e,t){return this.delete(`/models/${e}`,t)}},pu=class extends Br{};Xr||(Xr={});let Jr=class extends De{create(e,t){return this.post("/moderations",{body:e,...t})}};Jr||(Jr={});var mu;let Ee=class extends dd{constructor(e){var t,r,a,{apiKey:i=uu("OPENAI_API_KEY"),organization:s=(t=uu("OPENAI_ORG_ID"))!==null&&t!==void 0?t:null,...o}=e===void 0?{}:e;if(i===void 0)throw new Ve("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'my apiKey' }).");const c={apiKey:i,organization:s,...o,baseURL:(r=o.baseURL)!==null&&r!==void 0?r:"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&Pd())throw new Ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:(a=c.timeout)!==null&&a!==void 0?a:6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new Kr(this),this.chat=new Zr(this),this.edits=new Fr(this),this.embeddings=new Vr(this),this.files=new qr(this),this.images=new Gr(this),this.audio=new Mr(this),this.moderations=new Jr(this),this.models=new Xr(this),this.fineTuning=new Yr(this),this.fineTunes=new Hr(this),this._options=c,this.apiKey=i,this.organization=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};mu=Ee,Ee.OpenAI=mu,Ee.OpenAIError=Ve,Ee.APIError=Fe,Ee.APIConnectionError=jr,Ee.APIConnectionTimeoutError=oi,Ee.APIUserAbortError=si,Ee.NotFoundError=zo,Ee.ConflictError=Mo,Ee.RateLimitError=Zo,Ee.BadRequestError=Do,Ee.AuthenticationError=Bo,Ee.InternalServerError=Ko,Ee.PermissionDeniedError=$o,Ee.UnprocessableEntityError=Uo,function(n){n.toFile=Qo,n.fileFromPath=Yo,n.Page=Br,n.CursorPage=pi,n.Completions=Kr,n.Chat=Zr,n.Edits=Fr,n.Embeddings=Vr,n.Files=qr,n.FileObjectsPage=lu,n.Images=Gr,n.Audio=Mr,n.Moderations=Jr,n.Models=Xr,n.ModelsPage=pu,n.FineTuning=Yr,n.FineTunes=Hr,n.FineTunesPage=du}(Ee||(Ee={}));const Ad=Ee,it={sanitizeUrl:n=>{let e;try{e=new URL(n.trim())}catch{return null}return e.href.length>2048||!e.hostname?null:(e.pathname.length===1?e.pathname="/":e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),e.href)},md5:n=>pl.MD5(n).toString(),currTs:()=>Date.now()/1e3,extractHtmlContent:n=>{let e=n;return e=e.replace(/\n+/g,`
`).replace(/\s+/g," ").trim(),e},text2docs:async(n,e)=>{const r=await new Rr({chunkSize:500,chunkOverlap:20}).createDocuments([n]);return e&&r.forEach(a=>{a.metadata=e}),r},testOpenAIKey:async n=>{try{return await new Ad({apiKey:n,dangerouslyAllowBrowser:!0}).chat.completions.create({messages:[{role:"user",content:"test"}],model:"gpt-3.5-turbo",max_tokens:1,n:1}),!0}catch{return!1}}},St="4.4.0";class Id{constructor(e,t){this.response=e,this.controller=t,this.decoder=new Ed}async*iterMessages(){if(!this.response.body)throw this.controller.abort(),new Error("Attempted to iterate over a response with no body");const e=new Rt,t=Cd(this.response.body);for await(const r of t)for(const a of e.decode(r)){const i=this.decoder.decode(a);i&&(yield i)}for(const r of e.flush()){const a=this.decoder.decode(r);a&&(yield a)}}async*[Symbol.asyncIterator](){let e=!1;try{for await(const t of this.iterMessages())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(t.event===null)try{yield JSON.parse(t.data)}catch(r){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),r}}e=!0}catch(t){if(t instanceof Error&&t.name==="AbortError")return;throw t}finally{e||this.controller.abort()}}}class Ed{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=Od(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}}class Rt{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Rt.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(Rt.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Error(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!==null&&t!==void 0||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Error(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Error("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Rt.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]),Rt.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Od(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Cd(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let Ue=class gs extends Error{constructor(e,t,r,a){super(gs.makeMessage(t,r)),this.status=e,this.headers=a;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t){return e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):t||"Unknown error occurred"}static generate(e,t,r,a){if(!e)return new Zt({cause:Eu(t)});const i=t==null?void 0:t.error;return e===400?new yi(e,i,r,a):e===401?new gi(e,i,r,a):e===403?new bi(e,i,r,a):e===404?new vi(e,i,r,a):e===409?new _i(e,i,r,a):e===422?new wi(e,i,r,a):e===429?new xi(e,i,r,a):e>=500?new Pi(e,i,r,a):new gs(e,i,r,a)}},Qr=class extends Ue{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Zt=class extends Ue{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},mi=class extends Zt{constructor(){super({message:"Request timed out."})}},yi=class extends Ue{constructor(){super(...arguments),this.status=400}},gi=class extends Ue{constructor(){super(...arguments),this.status=401}},bi=class extends Ue{constructor(){super(...arguments),this.status=403}},vi=class extends Ue{constructor(){super(...arguments),this.status=404}},_i=class extends Ue{constructor(){super(...arguments),this.status=409}},wi=class extends Ue{constructor(){super(...arguments),this.status=422}},xi=class extends Ue{constructor(){super(...arguments),this.status=429}},Pi=class extends Ue{};const Td=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:Zt,APIConnectionTimeoutError:mi,APIError:Ue,APIUserAbortError:Qr,AuthenticationError:gi,BadRequestError:yi,ConflictError:_i,InternalServerError:Pi,NotFoundError:vi,PermissionDeniedError:bi,RateLimitError:xi,UnprocessableEntityError:wi},Symbol.toStringTag,{value:"Module"})),kd=n=>{},Sd=fetch.bind(void 0),Rd=!1,jd=FormData,yu=typeof File<"u"?File:class extends Blob{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'File' is not defined")}};async function Nd(n,e){return{...e,body:new Kd(n)}}async function Ld(){throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")}function Dd(n){return!1}const gu=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Bd=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&bu(n),bu=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",$d=n=>Bd(n)||gu(n)||Dd();async function vu(n,e,t={}){var r,a,i;if(n=await n,gu(n)){const o=await n.blob();return e||(e=(r=new URL(n.url).pathname.split(/[\\/]/).pop())!==null&&r!==void 0?r:"unknown_file"),new yu([o],e,t)}const s=await zd(n);if(e||(e=(a=Ud(n))!==null&&a!==void 0?a:"unknown_file"),!t.type){const o=(i=s[0])===null||i===void 0?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new yu(s,e,t)}async function zd(n){var e;let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(bu(n))t.push(await n.arrayBuffer());else if(Zd(n))for await(const r of n)t.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(e=n==null?void 0:n.constructor)===null||e===void 0?void 0:e.name}; props: ${Md(n)}`);return t}function Md(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Ud(n){var e;return Ai(n.name)||Ai(n.filename)||((e=Ai(n.path))===null||e===void 0?void 0:e.split(/[\\/]/).pop())}const Ai=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Zd=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";class Kd{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const _u=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Kt=async n=>{const e=await Vd(n.body);return Nd(e,n)},Vd=async n=>{const e=new jd;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Ii(e,t,r))),e},Ii=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if($d(t)){const r=await vu(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Ii(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>Ii(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Fd=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},qd=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},en;const Hd=2;async function wu(n){const{response:e}=n;if(n.options.stream)return new Id(e,n.controller);const t=e.headers.get("content-type");if(t!=null&&t.includes("application/json")){const a=await e.json();return nn("response",e.status,e.url,e.headers,a),a}const r=await e.text();return nn("response",e.status,e.url,e.headers,r),r}class tn extends Promise{constructor(e,t=wu){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new tn(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Wd{constructor({baseURL:e,maxRetries:t,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=Ei("maxRetries",t??Hd),this.timeout=Ei("timeout",r),this.httpAgent=a,this.fetch=i??Sd}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...eh(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${sh()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(a=>({method:e,path:t,...a})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var t,r,a,i,s,o;const{method:c,path:u,query:d,headers:y={}}=e,f=_u(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,v=this.calculateContentLength(f),p=this.buildURL(u,d);"timeout"in e&&Ei("timeout",e.timeout);const P=(t=e.timeout)!==null&&t!==void 0?t:this.timeout,m=(a=(r=e.httpAgent)!==null&&r!==void 0?r:this.httpAgent)!==null&&a!==void 0?a:kd(),T=P+1e3;typeof((i=m==null?void 0:m.options)===null||i===void 0?void 0:i.timeout)=="number"&&T>((s=m.options.timeout)!==null&&s!==void 0?s:0)&&(m.options.timeout=T),this.idempotencyHeader&&c!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),y[this.idempotencyHeader]=e.idempotencyKey);const _={...v&&{"Content-Length":v},...this.defaultHeaders(e),...y};_u(e.body)&&!Rd&&delete _["Content-Type"],Object.keys(_).forEach(C=>_[C]===null&&delete _[C]);const w={method:c,...f&&{body:f},headers:_,...m&&{agent:m},signal:(o=e.signal)!==null&&o!==void 0?o:null};return this.validateHeaders(_,y),{req:w,url:p,timeout:P}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return Ue.generate(e,t,r,a)}request(e,t=null){return new tn(this.makeRequest(e,t))}async makeRequest(e,t){var r,a,i;const s=await e;t==null&&(t=(r=s.maxRetries)!==null&&r!==void 0?r:this.maxRetries);const{req:o,url:c,timeout:u}=this.buildRequest(s);if(await this.prepareRequest(o,{url:c,options:s}),nn("request",c,s,o.headers),!((a=s.signal)===null||a===void 0)&&a.aborted)throw new Qr;const d=new AbortController,y=await this.fetchWithTimeout(c,o,u,d).catch(Eu);if(y instanceof Error){if(!((i=s.signal)===null||i===void 0)&&i.aborted)throw new Qr;if(t)return this.retryRequest(s,t);throw y.name==="AbortError"?new mi:new Zt({cause:y})}const f=Gd(y.headers);if(!y.ok){if(t&&this.shouldRetry(y))return this.retryRequest(s,t,f);const v=await y.text().catch(()=>"Unknown"),p=th(v),P=p?void 0:v;throw nn("response",y.status,c,f,P),this.makeStatusError(y.status,p,P,f)}return{response:y,options:s,controller:d}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Yd(this,r,e)}buildURL(e,t){const r=nh(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Cu(a)||(t={...a,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Error(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){const{signal:i,...s}=t||{};i&&i.addEventListener("abort",()=>a.abort());const o=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch(e,{signal:a.signal,...s}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var a;t-=1;const i=parseInt((r==null?void 0:r["retry-after"])||""),s=(a=e.maxRetries)!==null&&a!==void 0?a:this.maxRetries,o=this.calculateRetryTimeoutSeconds(t,i,s)*1e3;return await ah(o),this.makeRequest(e,t)}calculateRetryTimeoutSeconds(e,t,r){if(Number.isInteger(t)&&t<=60)return t;const s=r-e,o=Math.min(.5*Math.pow(s-1,2),2),c=Math.random()-.5;return o+c}getUserAgent(){return`${this.constructor.name}/JS ${St}`}}class xu{constructor(e,t,r,a){en.set(this,void 0),Fd(this,en,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Error("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,i]of r)e.url.searchParams.set(a,i);t.query=void 0,t.path=e.url.toString()}return await qd(this,en,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(en=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Yd extends tn{constructor(e,t,r){super(t,async a=>new r(e,a.response,await wu(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Gd=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Xd={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0},Pu=n=>typeof n=="object"&&n!==null&&!Cu(n)&&Object.keys(n).every(e=>ih(Xd,e)),Jd=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":St,"X-Stainless-OS":Iu(Deno.build.os),"X-Stainless-Arch":Au(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":St,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":St,"X-Stainless-OS":Iu(process.platform),"X-Stainless-Arch":Au(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Qd();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":St,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":St,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Qd(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${a}.${i}.${s}`}}}return null}const Au=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Iu=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let rn;const eh=()=>rn??(rn=Jd()),th=n=>{try{return JSON.parse(n)}catch{return}},rh=new RegExp("^(?:[a-z]+:)?//","i"),nh=n=>rh.test(n),ah=n=>new Promise(e=>setTimeout(e,n)),Ei=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Error(`${n} must be an integer`);if(e<0)throw new Error(`${n} must be a positive integer`);return e},Eu=n=>n instanceof Error?n:new Error(n),Ou=n=>{var e,t,r,a;if(typeof process<"u")return(t=(e=process.env)===null||e===void 0?void 0:e[n])!==null&&t!==void 0?t:void 0;if(typeof Deno<"u")return(a=(r=Deno.env)===null||r===void 0?void 0:r.get)===null||a===void 0?void 0:a.call(r,n)};function Cu(n){if(!n)return!0;for(const e in n)return!1;return!0}function ih(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function nn(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const sh=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),oh=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";class an extends xu{constructor(e,t,r,a){super(e,t,r,a),this.object=r.object,this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}}class Oi extends xu{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e,t;if(!(!((e=this.data)===null||e===void 0)&&e.length))return null;const r=(t=this.data[this.data.length-1])===null||t===void 0?void 0:t.id;return r?{params:{after:r}}:null}}class Be{constructor(e){this.client=e,this.get=e.get.bind(e),this.post=e.post.bind(e),this.patch=e.patch.bind(e),this.put=e.put.bind(e),this.delete=e.delete.bind(e),this.getAPIList=e.getAPIList.bind(e)}}class sn extends Be{create(e,t){return this.post("/audio/transcriptions",Kt({body:e,...t}))}}sn||(sn={});class on extends Be{create(e,t){return this.post("/audio/translations",Kt({body:e,...t}))}}on||(on={});class un extends Be{constructor(){super(...arguments),this.transcriptions=new sn(this.client),this.translations=new on(this.client)}}(function(n){n.Transcriptions=sn,n.Translations=on})(un||(un={}));let cn=class extends Be{create(e,t){var r;return this.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}};cn||(cn={});class ln extends Be{constructor(){super(...arguments),this.completions=new cn(this.client)}}(function(n){n.Completions=cn})(ln||(ln={}));class dn extends Be{create(e,t){var r;return this.post("/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}}dn||(dn={});let hn=class extends Be{create(e,t){return this.post("/embeddings",{body:e,...t})}};hn||(hn={});class fn extends Be{create(e,t){return this.post("/edits",{body:e,...t})}}fn||(fn={});class pn extends Be{create(e,t){return this.post("/files",Kt({body:e,...t}))}retrieve(e,t){return this.get(`/files/${e}`,t)}list(e){return this.getAPIList("/files",Tu,e)}del(e,t){return this.delete(`/files/${e}`,t)}retrieveContent(e,t){return this.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}}class Tu extends an{}pn||(pn={});class mn extends Be{create(e,t){return this.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this.get(`/fine-tunes/${e}`,t)}list(e){return this.getAPIList("/fine-tunes",ku,e)}cancel(e,t){return this.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){var a;return this.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:(a=t==null?void 0:t.stream)!==null&&a!==void 0?a:!1})}}class ku extends an{}mn||(mn={});class yn extends Be{create(e,t){return this.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Pu(e)?this.list({},e):this.getAPIList("/fine_tuning/jobs",Su,{query:e,...t})}cancel(e,t){return this.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Pu(t)?this.listEvents(e,{},t):this.getAPIList(`/fine_tuning/jobs/${e}/events`,Ru,{query:t,...r})}}class Su extends Oi{}class Ru extends Oi{}yn||(yn={});class gn extends Be{constructor(){super(...arguments),this.jobs=new yn(this.client)}}(function(n){n.Jobs=yn,n.FineTuningJobsPage=Su,n.FineTuningJobEventsPage=Ru})(gn||(gn={}));class bn extends Be{createVariation(e,t){return this.post("/images/variations",Kt({body:e,...t}))}edit(e,t){return this.post("/images/edits",Kt({body:e,...t}))}generate(e,t){return this.post("/images/generations",{body:e,...t})}}bn||(bn={});class vn extends Be{retrieve(e,t){return this.get(`/models/${e}`,t)}list(e){return this.getAPIList("/models",ju,e)}del(e,t){return this.delete(`/models/${e}`,t)}}class ju extends an{}vn||(vn={});class _n extends Be{create(e,t){return this.post("/moderations",{body:e,...t})}}_n||(_n={});var Nu;let Pe=class extends Wd{constructor(e){var t,r,{apiKey:a=Ou("OPENAI_API_KEY"),organization:i=(t=Ou("OPENAI_ORG_ID"))!==null&&t!==void 0?t:null,...s}=e===void 0?{}:e;if(a===void 0)throw new Error("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'my apiKey' }).");const o={apiKey:a,organization:i,baseURL:"https://api.openai.com/v1",...s};if(!o.dangerouslyAllowBrowser&&oh())throw new Error(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:(r=o.timeout)!==null&&r!==void 0?r:6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new dn(this),this.chat=new ln(this),this.edits=new fn(this),this.embeddings=new hn(this),this.files=new pn(this),this.images=new bn(this),this.audio=new un(this),this.moderations=new _n(this),this.models=new vn(this),this.fineTuning=new gn(this),this.fineTunes=new mn(this),this._options=o,this.apiKey=a,this.organization=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Nu=Pe,Pe.OpenAI=Nu,Pe.APIError=Ue,Pe.APIConnectionError=Zt,Pe.APIConnectionTimeoutError=mi,Pe.APIUserAbortError=Qr,Pe.NotFoundError=vi,Pe.ConflictError=_i,Pe.RateLimitError=xi,Pe.BadRequestError=yi,Pe.AuthenticationError=gi,Pe.InternalServerError=Pi,Pe.PermissionDeniedError=bi,Pe.UnprocessableEntityError=wi;const{APIError:ly,APIConnectionError:dy,APIConnectionTimeoutError:uh,APIUserAbortError:ch,NotFoundError:hy,ConflictError:fy,RateLimitError:py,BadRequestError:my,AuthenticationError:yy,InternalServerError:gy,PermissionDeniedError:by,UnprocessableEntityError:vy}=Td;(function(n){n.toFile=vu,n.fileFromPath=Ld,n.Page=an,n.CursorPage=Oi,n.Completions=dn,n.Chat=ln,n.Edits=fn,n.Embeddings=hn,n.Files=pn,n.FileObjectsPage=Tu,n.Images=bn,n.Audio=un,n.Moderations=_n,n.Models=vn,n.ModelsPage=ju,n.FineTuning=gn,n.FineTunes=mn,n.FineTunesPage=ku})(Pe||(Pe={}));const Ci=(n,e)=>n.reduce((t,r,a)=>{const i=Math.floor(a/e),s=t[i]||[];return t[i]=s.concat([r]),t},[]);class lh{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Ir(e??{})}}function wn(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:i}=n;if(r&&a&&e)return`${a}/${e}`;if(r){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function xn(n){let e;return n.constructor.name===uh.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===ch.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}class dh extends lh{constructor(e,t){var u,d;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a=(r==null?void 0:r.openAIApiKey)??ce("OPENAI_API_KEY");const i=(r==null?void 0:r.azureOpenAIApiKey)??ce("AZURE_OPENAI_API_KEY");if(!i&&!a)throw new Error("OpenAI or Azure OpenAI API key not found");const s=(r==null?void 0:r.azureOpenAIApiInstanceName)??ce("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(ce("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||ce("AZURE_OPENAI_API_DEPLOYMENT_NAME")),c=(r==null?void 0:r.azureOpenAIApiVersion)??ce("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??ce("AZURE_OPENAI_BASE_PATH"),this.modelName=(r==null?void 0:r.modelName)??this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(i?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.azureOpenAIApiVersion=c,this.azureOpenAIApiKey=i,this.azureOpenAIApiInstanceName=s,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");a=a??""}this.clientConfig={apiKey:a,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(u=t==null?void 0:t.baseOptions)==null?void 0:u.headers,defaultQuery:(d=t==null?void 0:t.baseOptions)==null?void 0:d.params,...t}}async embedDocuments(e){const t=Ci(this.stripNewLines?e.map(s=>s.replace(/\n/g," ")):e,this.batchSize),r=t.map(s=>this.embeddingWithRetry({model:this.modelName,input:s})),a=await Promise.all(r),i=[];for(let s=0;s<a.length;s+=1){const o=t[s],{data:c}=a[s];for(let u=0;u<o.length;u+=1)i.push(c[u].embedding)}return i}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=wn(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Pe(i)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw xn(r)}})}}function hh(n,e){let t=0,r=0,a=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i],r+=n[i]*n[i],a+=e[i]*e[i];return t/(Math.sqrt(r)*Math.sqrt(a))}class fh extends Ie{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,t)}async getRelevantDocuments(e,t){const r=jo(t),a=await Se.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i=await(a==null?void 0:a.handleRetrieverStart(this.toJSON(),e));try{const s=await this._getRelevantDocuments(e,i);return await(i==null?void 0:i.handleRetrieverEnd(s)),s}catch(s){throw await(i==null?void 0:i.handleRetrieverError(s)),s}}}class Ti extends fh{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain","retrievers","base"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class ph extends at{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(s=>s[0])}async similaritySearchWithScore(e,t=4,r=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,a,i,s){if(typeof e=="number")return new Ti({vectorStore:this,k:e,filter:t,tags:[...a??[],this._vectorstoreType()],metadata:i,verbose:s,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Ti({...o,searchKwargs:e.searchKwargs}):new Ti({...o})}}}class ki extends ph{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??hh}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((a,i)=>({content:t[i].pageContent,embedding:a,metadata:t[i].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){const a=c=>{if(!r)return!0;const u=new vr({metadata:c.metadata,pageContent:c.content});return r(u)},i=this.memoryVectors.filter(a);return i.map((c,u)=>({similarity:this.similarity(e,c.embedding),index:u})).sort((c,u)=>c.similarity>u.similarity?-1:0).slice(0,t).map(c=>[new vr({metadata:i[c.index].metadata,pageContent:i[c.index].content}),c.similarity])}static async fromTexts(e,t,r,a){const i=[];for(let s=0;s<e.length;s+=1){const o=Array.isArray(t)?t[s]:t,c=new vr({pageContent:e[s],metadata:o});i.push(c)}return ki.fromDocuments(i,r,a)}static async fromDocuments(e,t,r){const a=new this(t,r);return await a.addDocuments(e),a}static async fromExistingIndex(e,t){return new this(e,t)}}class Lu{constructor(){Ae(this,"data");Ae(this,"QUOTA_BYTES",100);this.data={}}async get(e){const t=this.data[e],r={};return t&&(r[e]=t),r}async set(e){console.log("set ",e),console.log("old data",this.data),this.data={...this.data,...e},console.log("new data ",this.data)}async getBytesInUse(e){return 100}}class mh{constructor(){Ae(this,"local");Ae(this,"sync");this.local=new Lu,this.sync=new Lu}}const Vt=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n,yh=n=>{switch(Vt(n)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},gh=async({prompt:n,modelName:e})=>{let t;try{t=(await ho(Vt(e))).encode(n).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(n.length/4)}return yh(e)-t},Si="__run";class jt{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new jt({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class ut extends at{get text(){return this.content}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class Ft extends ut{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[a,i]of Object.entries(t))if(r[a]===void 0)r[a]=i;else{if(typeof r[a]!=typeof i)throw new Error(`additional_kwargs[${a}] already exists in the message chunk, but with a different type.`);if(typeof r[a]=="string")r[a]=r[a]+i;else if(!Array.isArray(r[a])&&typeof r[a]=="object")r[a]=this._mergeAdditionalKwargs(r[a],i);else throw new Error(`additional_kwargs[${a}] already exists in this message chunk.`)}return r}}class st extends ut{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Pn extends Ft{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Pn({content:this.content+e.content,additional_kwargs:Pn._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class gt extends ut{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class An extends Ft{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new An({content:this.content+e.content,additional_kwargs:An._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class Ri extends ut{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class In extends Ft{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new In({content:this.content+e.content,additional_kwargs:In._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class En extends Ft{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new En({content:this.content+e.content,additional_kwargs:En._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class On extends ut{static lc_name(){return"ChatMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}function Du(n){return typeof n._getType=="function"}function Cn(n){if(typeof n=="string")return new st(n);if(Du(n))return n;const[e,t]=n;if(e==="human"||e==="user")return new st({content:t});if(e==="ai"||e==="assistant")return new gt({content:t});if(e==="system")return new Ri({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class Tn extends Ft{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Tn({content:this.content+e.content,additional_kwargs:Tn._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}class ji extends jt{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new ji({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}class Bu extends at{}class bh extends at{addUserMessage(e){return this.addMessage(new st(e))}addAIChatMessage(e){return this.addMessage(new gt(e))}}class vh{}var $u={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(r,a,i){function s(u,d){if(!a[u]){if(!r[u]){var y=typeof Bt=="function"&&Bt;if(!d&&y)return y(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}d=a[u]={exports:{}},r[u][0].call(d.exports,function(f){var v=r[u][1][f];return s(v||f)},d,d.exports,t,r,a,i)}return a[u].exports}for(var o=typeof Bt=="function"&&Bt,c=0;c<i.length;c++)s(i[c]);return s}({1:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){var p=t("crypto");function P(A,k){k=_(A,k);var b;return(b=k.algorithm!=="passthrough"?p.createHash(k.algorithm):new D).write===void 0&&(b.write=b.update,b.end=b.update),C(k,b).dispatch(A),b.update||b.end(""),b.digest?b.digest(k.encoding==="buffer"?void 0:k.encoding):(A=b.read(),k.encoding!=="buffer"?A.toString(k.encoding):A)}(a=r.exports=P).sha1=function(A){return P(A)},a.keys=function(A){return P(A,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(A){return P(A,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(A){return P(A,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var m=p.getHashes?p.getHashes().slice():["sha1","md5"],T=(m.push("passthrough"),["buffer","hex","binary","base64"]);function _(A,k){var b={};if(b.algorithm=(k=k||{}).algorithm||"sha1",b.encoding=k.encoding||"hex",b.excludeValues=!!k.excludeValues,b.algorithm=b.algorithm.toLowerCase(),b.encoding=b.encoding.toLowerCase(),b.ignoreUnknown=k.ignoreUnknown===!0,b.respectType=k.respectType!==!1,b.respectFunctionNames=k.respectFunctionNames!==!1,b.respectFunctionProperties=k.respectFunctionProperties!==!1,b.unorderedArrays=k.unorderedArrays===!0,b.unorderedSets=k.unorderedSets!==!1,b.unorderedObjects=k.unorderedObjects!==!1,b.replacer=k.replacer||void 0,b.excludeKeys=k.excludeKeys||void 0,A===void 0)throw new Error("Object argument required.");for(var I=0;I<m.length;++I)m[I].toLowerCase()===b.algorithm.toLowerCase()&&(b.algorithm=m[I]);if(m.indexOf(b.algorithm)===-1)throw new Error('Algorithm "'+b.algorithm+'"  not supported. supported values: '+m.join(", "));if(T.indexOf(b.encoding)===-1&&b.algorithm!=="passthrough")throw new Error('Encoding "'+b.encoding+'"  not supported. supported values: '+T.join(", "));return b}function w(A){if(typeof A=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(A))!=null}function C(A,k,b){b=b||[];function I(h){return k.update?k.update(h,"utf8"):k.write(h,"utf8")}return{dispatch:function(h){return this["_"+((h=A.replacer?A.replacer(h):h)===null?"null":typeof h)](h)},_object:function(h){var O,R=Object.prototype.toString.call(h),z=/\[object (.*)\]/i.exec(R);if(z=(z=z?z[1]:"unknown:["+R+"]").toLowerCase(),0<=(R=b.indexOf(h)))return this.dispatch("[CIRCULAR:"+R+"]");if(b.push(h),o!==void 0&&o.isBuffer&&o.isBuffer(h))return I("buffer:"),I(h);if(z==="object"||z==="function"||z==="asyncfunction")return R=Object.keys(h),A.unorderedObjects&&(R=R.sort()),A.respectType===!1||w(h)||R.splice(0,0,"prototype","__proto__","constructor"),A.excludeKeys&&(R=R.filter(function(Z){return!A.excludeKeys(Z)})),I("object:"+R.length+":"),O=this,R.forEach(function(Z){O.dispatch(Z),I(":"),A.excludeValues||O.dispatch(h[Z]),I(",")});if(!this["_"+z]){if(A.ignoreUnknown)return I("["+z+"]");throw new Error('Unknown object type "'+z+'"')}this["_"+z](h)},_array:function(h,Z){Z=Z!==void 0?Z:A.unorderedArrays!==!1;var R=this;if(I("array:"+h.length+":"),!Z||h.length<=1)return h.forEach(function(Y){return R.dispatch(Y)});var z=[],Z=h.map(function(Y){var H=new D,te=b.slice();return C(A,H,te).dispatch(Y),z=z.concat(te.slice(b.length)),H.read().toString()});return b=b.concat(z),Z.sort(),this._array(Z,!1)},_date:function(h){return I("date:"+h.toJSON())},_symbol:function(h){return I("symbol:"+h.toString())},_error:function(h){return I("error:"+h.toString())},_boolean:function(h){return I("bool:"+h.toString())},_string:function(h){I("string:"+h.length+":"),I(h.toString())},_function:function(h){I("fn:"),w(h)?this.dispatch("[native]"):this.dispatch(h.toString()),A.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(h.name)),A.respectFunctionProperties&&this._object(h)},_number:function(h){return I("number:"+h.toString())},_xml:function(h){return I("xml:"+h.toString())},_null:function(){return I("Null")},_undefined:function(){return I("Undefined")},_regexp:function(h){return I("regex:"+h.toString())},_uint8array:function(h){return I("uint8array:"),this.dispatch(Array.prototype.slice.call(h))},_uint8clampedarray:function(h){return I("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(h))},_int8array:function(h){return I("int8array:"),this.dispatch(Array.prototype.slice.call(h))},_uint16array:function(h){return I("uint16array:"),this.dispatch(Array.prototype.slice.call(h))},_int16array:function(h){return I("int16array:"),this.dispatch(Array.prototype.slice.call(h))},_uint32array:function(h){return I("uint32array:"),this.dispatch(Array.prototype.slice.call(h))},_int32array:function(h){return I("int32array:"),this.dispatch(Array.prototype.slice.call(h))},_float32array:function(h){return I("float32array:"),this.dispatch(Array.prototype.slice.call(h))},_float64array:function(h){return I("float64array:"),this.dispatch(Array.prototype.slice.call(h))},_arraybuffer:function(h){return I("arraybuffer:"),this.dispatch(new Uint8Array(h))},_url:function(h){return I("url:"+h.toString())},_map:function(h){return I("map:"),h=Array.from(h),this._array(h,A.unorderedSets!==!1)},_set:function(h){return I("set:"),h=Array.from(h),this._array(h,A.unorderedSets!==!1)},_file:function(h){return I("file:"),this.dispatch([h.name,h.size,h.type,h.lastModfied])},_blob:function(){if(A.ignoreUnknown)return I("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return I("domwindow")},_bigint:function(h){return I("bigint:"+h.toString())},_process:function(){return I("process")},_timer:function(){return I("timer")},_pipe:function(){return I("pipe")},_tcp:function(){return I("tcp")},_udp:function(){return I("udp")},_tty:function(){return I("tty")},_statwatcher:function(){return I("statwatcher")},_securecontext:function(){return I("securecontext")},_connection:function(){return I("connection")},_zlib:function(){return I("zlib")},_context:function(){return I("context")},_nodescript:function(){return I("nodescript")},_httpparser:function(){return I("httpparser")},_dataview:function(){return I("dataview")},_signal:function(){return I("signal")},_fsevent:function(){return I("fsevent")},_tlswrap:function(){return I("tlswrap")}}}function D(){return{buf:"",write:function(A){this.buf+=A},end:function(A){this.buf+=A},read:function(){return this.buf}}}a.writeToStream=function(A,k,b){return b===void 0&&(b=k,k={}),C(k=_(A,k),b).dispatch(A)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){(function(p){var P=typeof Uint8Array<"u"?Uint8Array:Array,m="+".charCodeAt(0),T="/".charCodeAt(0),_="0".charCodeAt(0),w="a".charCodeAt(0),C="A".charCodeAt(0),D="-".charCodeAt(0),A="_".charCodeAt(0);function k(b){return b=b.charCodeAt(0),b===m||b===D?62:b===T||b===A?63:b<_?-1:b<_+10?b-_+26+26:b<C+26?b-C:b<w+26?b-w+26:void 0}p.toByteArray=function(b){var I,h;if(0<b.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var O=b.length,O=b.charAt(O-2)==="="?2:b.charAt(O-1)==="="?1:0,R=new P(3*b.length/4-O),z=0<O?b.length-4:b.length,Z=0;function Y(H){R[Z++]=H}for(I=0;I<z;I+=4,0)Y((16711680&(h=k(b.charAt(I))<<18|k(b.charAt(I+1))<<12|k(b.charAt(I+2))<<6|k(b.charAt(I+3))))>>16),Y((65280&h)>>8),Y(255&h);return O==2?Y(255&(h=k(b.charAt(I))<<2|k(b.charAt(I+1))>>4)):O==1&&(Y((h=k(b.charAt(I))<<10|k(b.charAt(I+1))<<4|k(b.charAt(I+2))>>2)>>8&255),Y(255&h)),R},p.fromByteArray=function(b){var I,h,O,R,z=b.length%3,Z="";function Y(H){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(H)}for(I=0,O=b.length-z;I<O;I+=3)h=(b[I]<<16)+(b[I+1]<<8)+b[I+2],Z+=Y((R=h)>>18&63)+Y(R>>12&63)+Y(R>>6&63)+Y(63&R);switch(z){case 1:Z=(Z+=Y((h=b[b.length-1])>>2))+Y(h<<4&63)+"==";break;case 2:Z=(Z=(Z+=Y((h=(b[b.length-2]<<8)+b[b.length-1])>>10))+Y(h>>4&63))+Y(h<<2&63)+"="}return Z}})(a===void 0?this.base64js={}:a)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,r,a){(function(i,s,m,c,u,d,y,f,v){var p=t("base64-js"),P=t("ieee754");function m(x,S,B){if(!(this instanceof m))return new m(x,S,B);var G,V,J,se,ue=typeof x;if(S==="base64"&&ue=="string")for(x=(se=x).trim?se.trim():se.replace(/^\s+|\s+$/g,"");x.length%4!=0;)x+="=";if(ue=="number")G=ne(x);else if(ue=="string")G=m.byteLength(x,S);else{if(ue!="object")throw new Error("First argument needs to be a number, array or string.");G=ne(x.length)}if(m._useTypedArrays?V=m._augment(new Uint8Array(G)):((V=this).length=G,V._isBuffer=!0),m._useTypedArrays&&typeof x.byteLength=="number")V._set(x);else if(M(se=x)||m.isBuffer(se)||se&&typeof se=="object"&&typeof se.length=="number")for(J=0;J<G;J++)m.isBuffer(x)?V[J]=x.readUInt8(J):V[J]=x[J];else if(ue=="string")V.write(x,0,S);else if(ue=="number"&&!m._useTypedArrays&&!B)for(J=0;J<G;J++)V[J]=0;return V}function T(x,S,B,G){return m._charsWritten=W(function(V){for(var J=[],se=0;se<V.length;se++)J.push(255&V.charCodeAt(se));return J}(S),x,B,G)}function _(x,S,B,G){return m._charsWritten=W(function(V){for(var J,se,ue=[],me=0;me<V.length;me++)se=V.charCodeAt(me),J=se>>8,se=se%256,ue.push(se),ue.push(J);return ue}(S),x,B,G)}function w(x,S,B){var G="";B=Math.min(x.length,B);for(var V=S;V<B;V++)G+=String.fromCharCode(x[V]);return G}function C(x,S,B,J){J||(U(typeof B=="boolean","missing or invalid endian"),U(S!=null,"missing offset"),U(S+1<x.length,"Trying to read beyond buffer length"));var V,J=x.length;if(!(J<=S))return B?(V=x[S],S+1<J&&(V|=x[S+1]<<8)):(V=x[S]<<8,S+1<J&&(V|=x[S+1])),V}function D(x,S,B,J){J||(U(typeof B=="boolean","missing or invalid endian"),U(S!=null,"missing offset"),U(S+3<x.length,"Trying to read beyond buffer length"));var V,J=x.length;if(!(J<=S))return B?(S+2<J&&(V=x[S+2]<<16),S+1<J&&(V|=x[S+1]<<8),V|=x[S],S+3<J&&(V+=x[S+3]<<24>>>0)):(S+1<J&&(V=x[S+1]<<16),S+2<J&&(V|=x[S+2]<<8),S+3<J&&(V|=x[S+3]),V+=x[S]<<24>>>0),V}function A(x,S,B,G){if(G||(U(typeof B=="boolean","missing or invalid endian"),U(S!=null,"missing offset"),U(S+1<x.length,"Trying to read beyond buffer length")),!(x.length<=S))return G=C(x,S,B,!0),32768&G?-1*(65535-G+1):G}function k(x,S,B,G){if(G||(U(typeof B=="boolean","missing or invalid endian"),U(S!=null,"missing offset"),U(S+3<x.length,"Trying to read beyond buffer length")),!(x.length<=S))return G=D(x,S,B,!0),2147483648&G?-1*(4294967295-G+1):G}function b(x,S,B,G){return G||(U(typeof B=="boolean","missing or invalid endian"),U(S+3<x.length,"Trying to read beyond buffer length")),P.read(x,S,B,23,4)}function I(x,S,B,G){return G||(U(typeof B=="boolean","missing or invalid endian"),U(S+7<x.length,"Trying to read beyond buffer length")),P.read(x,S,B,52,8)}function h(x,S,B,G,V){if(V||(U(S!=null,"missing value"),U(typeof G=="boolean","missing or invalid endian"),U(B!=null,"missing offset"),U(B+1<x.length,"trying to write beyond buffer length"),oe(S,65535)),V=x.length,!(V<=B))for(var J=0,se=Math.min(V-B,2);J<se;J++)x[B+J]=(S&255<<8*(G?J:1-J))>>>8*(G?J:1-J)}function O(x,S,B,G,V){if(V||(U(S!=null,"missing value"),U(typeof G=="boolean","missing or invalid endian"),U(B!=null,"missing offset"),U(B+3<x.length,"trying to write beyond buffer length"),oe(S,4294967295)),V=x.length,!(V<=B))for(var J=0,se=Math.min(V-B,4);J<se;J++)x[B+J]=S>>>8*(G?J:3-J)&255}function R(x,S,B,G,V){V||(U(S!=null,"missing value"),U(typeof G=="boolean","missing or invalid endian"),U(B!=null,"missing offset"),U(B+1<x.length,"Trying to write beyond buffer length"),le(S,32767,-32768)),x.length<=B||h(x,0<=S?S:65535+S+1,B,G,V)}function z(x,S,B,G,V){V||(U(S!=null,"missing value"),U(typeof G=="boolean","missing or invalid endian"),U(B!=null,"missing offset"),U(B+3<x.length,"Trying to write beyond buffer length"),le(S,2147483647,-2147483648)),x.length<=B||O(x,0<=S?S:4294967295+S+1,B,G,V)}function Z(x,S,B,G,V){V||(U(S!=null,"missing value"),U(typeof G=="boolean","missing or invalid endian"),U(B!=null,"missing offset"),U(B+3<x.length,"Trying to write beyond buffer length"),we(S,34028234663852886e22,-34028234663852886e22)),x.length<=B||P.write(x,S,B,G,23,4)}function Y(x,S,B,G,V){V||(U(S!=null,"missing value"),U(typeof G=="boolean","missing or invalid endian"),U(B!=null,"missing offset"),U(B+7<x.length,"Trying to write beyond buffer length"),we(S,17976931348623157e292,-17976931348623157e292)),x.length<=B||P.write(x,S,B,G,52,8)}a.Buffer=m,a.SlowBuffer=m,a.INSPECT_MAX_BYTES=50,m.poolSize=8192,m._useTypedArrays=function(){try{var x=new ArrayBuffer(0),S=new Uint8Array(x);return S.foo=function(){return 42},S.foo()===42&&typeof S.subarray=="function"}catch{return!1}}(),m.isEncoding=function(x){switch(String(x).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},m.isBuffer=function(x){return!(x==null||!x._isBuffer)},m.byteLength=function(x,S){var B;switch(x+="",S||"utf8"){case"hex":B=x.length/2;break;case"utf8":case"utf-8":B=$(x).length;break;case"ascii":case"binary":case"raw":B=x.length;break;case"base64":B=F(x).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=2*x.length;break;default:throw new Error("Unknown encoding")}return B},m.concat=function(x,S){if(U(M(x),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),x.length===0)return new m(0);if(x.length===1)return x[0];if(typeof S!="number")for(V=S=0;V<x.length;V++)S+=x[V].length;for(var B=new m(S),G=0,V=0;V<x.length;V++){var J=x[V];J.copy(B,G),G+=J.length}return B},m.prototype.write=function(x,S,B,G){isFinite(S)?isFinite(B)||(G=B,B=void 0):(me=G,G=S,S=B,B=me),S=Number(S)||0;var V,J,se,ue,me=this.length-S;switch((!B||me<(B=Number(B)))&&(B=me),G=String(G||"utf8").toLowerCase()){case"hex":V=function(ye,ve,ge,he){ge=Number(ge)||0;var de=ye.length-ge;(!he||de<(he=Number(he)))&&(he=de),U((de=ve.length)%2==0,"Invalid hex string"),de/2<he&&(he=de/2);for(var xe=0;xe<he;xe++){var He=parseInt(ve.substr(2*xe,2),16);U(!isNaN(He),"Invalid hex string"),ye[ge+xe]=He}return m._charsWritten=2*xe,xe}(this,x,S,B);break;case"utf8":case"utf-8":J=this,se=S,ue=B,V=m._charsWritten=W($(x),J,se,ue);break;case"ascii":case"binary":V=T(this,x,S,B);break;case"base64":J=this,se=S,ue=B,V=m._charsWritten=W(F(x),J,se,ue);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":V=_(this,x,S,B);break;default:throw new Error("Unknown encoding")}return V},m.prototype.toString=function(x,S,B){var G,V,J,se,ue=this;if(x=String(x||"utf8").toLowerCase(),S=Number(S)||0,(B=B!==void 0?Number(B):ue.length)===S)return"";switch(x){case"hex":G=function(me,ye,ve){var ge=me.length;(!ye||ye<0)&&(ye=0),(!ve||ve<0||ge<ve)&&(ve=ge);for(var he="",de=ye;de<ve;de++)he+=Q(me[de]);return he}(ue,S,B);break;case"utf8":case"utf-8":G=function(me,ye,ve){var ge="",he="";ve=Math.min(me.length,ve);for(var de=ye;de<ve;de++)me[de]<=127?(ge+=K(he)+String.fromCharCode(me[de]),he=""):he+="%"+me[de].toString(16);return ge+K(he)}(ue,S,B);break;case"ascii":case"binary":G=w(ue,S,B);break;case"base64":V=ue,se=B,G=(J=S)===0&&se===V.length?p.fromByteArray(V):p.fromByteArray(V.slice(J,se));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":G=function(me,ye,ve){for(var ge=me.slice(ye,ve),he="",de=0;de<ge.length;de+=2)he+=String.fromCharCode(ge[de]+256*ge[de+1]);return he}(ue,S,B);break;default:throw new Error("Unknown encoding")}return G},m.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},m.prototype.copy=function(x,S,B,G){if(S=S||0,(G=G||G===0?G:this.length)!==(B=B||0)&&x.length!==0&&this.length!==0){U(B<=G,"sourceEnd < sourceStart"),U(0<=S&&S<x.length,"targetStart out of bounds"),U(0<=B&&B<this.length,"sourceStart out of bounds"),U(0<=G&&G<=this.length,"sourceEnd out of bounds"),G>this.length&&(G=this.length);var V=(G=x.length-S<G-B?x.length-S+B:G)-B;if(V<100||!m._useTypedArrays)for(var J=0;J<V;J++)x[J+S]=this[J+B];else x._set(this.subarray(B,B+V),S)}},m.prototype.slice=function(x,S){var B=this.length;if(x=te(x,B,0),S=te(S,B,B),m._useTypedArrays)return m._augment(this.subarray(x,S));for(var G=S-x,V=new m(G,void 0,!0),J=0;J<G;J++)V[J]=this[J+x];return V},m.prototype.get=function(x){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(x)},m.prototype.set=function(x,S){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(x,S)},m.prototype.readUInt8=function(x,S){if(S||(U(x!=null,"missing offset"),U(x<this.length,"Trying to read beyond buffer length")),!(x>=this.length))return this[x]},m.prototype.readUInt16LE=function(x,S){return C(this,x,!0,S)},m.prototype.readUInt16BE=function(x,S){return C(this,x,!1,S)},m.prototype.readUInt32LE=function(x,S){return D(this,x,!0,S)},m.prototype.readUInt32BE=function(x,S){return D(this,x,!1,S)},m.prototype.readInt8=function(x,S){if(S||(U(x!=null,"missing offset"),U(x<this.length,"Trying to read beyond buffer length")),!(x>=this.length))return 128&this[x]?-1*(255-this[x]+1):this[x]},m.prototype.readInt16LE=function(x,S){return A(this,x,!0,S)},m.prototype.readInt16BE=function(x,S){return A(this,x,!1,S)},m.prototype.readInt32LE=function(x,S){return k(this,x,!0,S)},m.prototype.readInt32BE=function(x,S){return k(this,x,!1,S)},m.prototype.readFloatLE=function(x,S){return b(this,x,!0,S)},m.prototype.readFloatBE=function(x,S){return b(this,x,!1,S)},m.prototype.readDoubleLE=function(x,S){return I(this,x,!0,S)},m.prototype.readDoubleBE=function(x,S){return I(this,x,!1,S)},m.prototype.writeUInt8=function(x,S,B){B||(U(x!=null,"missing value"),U(S!=null,"missing offset"),U(S<this.length,"trying to write beyond buffer length"),oe(x,255)),S>=this.length||(this[S]=x)},m.prototype.writeUInt16LE=function(x,S,B){h(this,x,S,!0,B)},m.prototype.writeUInt16BE=function(x,S,B){h(this,x,S,!1,B)},m.prototype.writeUInt32LE=function(x,S,B){O(this,x,S,!0,B)},m.prototype.writeUInt32BE=function(x,S,B){O(this,x,S,!1,B)},m.prototype.writeInt8=function(x,S,B){B||(U(x!=null,"missing value"),U(S!=null,"missing offset"),U(S<this.length,"Trying to write beyond buffer length"),le(x,127,-128)),S>=this.length||(0<=x?this.writeUInt8(x,S,B):this.writeUInt8(255+x+1,S,B))},m.prototype.writeInt16LE=function(x,S,B){R(this,x,S,!0,B)},m.prototype.writeInt16BE=function(x,S,B){R(this,x,S,!1,B)},m.prototype.writeInt32LE=function(x,S,B){z(this,x,S,!0,B)},m.prototype.writeInt32BE=function(x,S,B){z(this,x,S,!1,B)},m.prototype.writeFloatLE=function(x,S,B){Z(this,x,S,!0,B)},m.prototype.writeFloatBE=function(x,S,B){Z(this,x,S,!1,B)},m.prototype.writeDoubleLE=function(x,S,B){Y(this,x,S,!0,B)},m.prototype.writeDoubleBE=function(x,S,B){Y(this,x,S,!1,B)},m.prototype.fill=function(x,S,B){if(S=S||0,B=B||this.length,U(typeof(x=typeof(x=x||0)=="string"?x.charCodeAt(0):x)=="number"&&!isNaN(x),"value is not a number"),U(S<=B,"end < start"),B!==S&&this.length!==0){U(0<=S&&S<this.length,"start out of bounds"),U(0<=B&&B<=this.length,"end out of bounds");for(var G=S;G<B;G++)this[G]=x}},m.prototype.inspect=function(){for(var x=[],S=this.length,B=0;B<S;B++)if(x[B]=Q(this[B]),B===a.INSPECT_MAX_BYTES){x[B+1]="...";break}return"<Buffer "+x.join(" ")+">"},m.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(m._useTypedArrays)return new m(this).buffer;for(var x=new Uint8Array(this.length),S=0,B=x.length;S<B;S+=1)x[S]=this[S];return x.buffer};var H=m.prototype;function te(x,S,B){return typeof x!="number"?B:S<=(x=~~x)?S:0<=x||0<=(x+=S)?x:0}function ne(x){return(x=~~Math.ceil(+x))<0?0:x}function M(x){return(Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"})(x)}function Q(x){return x<16?"0"+x.toString(16):x.toString(16)}function $(x){for(var S=[],B=0;B<x.length;B++){var G=x.charCodeAt(B);if(G<=127)S.push(x.charCodeAt(B));else for(var V=B,J=(55296<=G&&G<=57343&&B++,encodeURIComponent(x.slice(V,B+1)).substr(1).split("%")),se=0;se<J.length;se++)S.push(parseInt(J[se],16))}return S}function F(x){return p.toByteArray(x)}function W(x,S,B,G){for(var V=0;V<G&&!(V+B>=S.length||V>=x.length);V++)S[V+B]=x[V];return V}function K(x){try{return decodeURIComponent(x)}catch{return String.fromCharCode(65533)}}function oe(x,S){U(typeof x=="number","cannot write a non-number as a number"),U(0<=x,"specified a negative value for writing an unsigned value"),U(x<=S,"value is larger than maximum value for type"),U(Math.floor(x)===x,"value has a fractional component")}function le(x,S,B){U(typeof x=="number","cannot write a non-number as a number"),U(x<=S,"value larger than maximum allowed value"),U(B<=x,"value smaller than minimum allowed value"),U(Math.floor(x)===x,"value has a fractional component")}function we(x,S,B){U(typeof x=="number","cannot write a non-number as a number"),U(x<=S,"value larger than maximum allowed value"),U(B<=x,"value smaller than minimum allowed value")}function U(x,S){if(!x)throw new Error(S||"Failed assertion")}m._augment=function(x){return x._isBuffer=!0,x._get=x.get,x._set=x.set,x.get=H.get,x.set=H.set,x.write=H.write,x.toString=H.toString,x.toLocaleString=H.toString,x.toJSON=H.toJSON,x.copy=H.copy,x.slice=H.slice,x.readUInt8=H.readUInt8,x.readUInt16LE=H.readUInt16LE,x.readUInt16BE=H.readUInt16BE,x.readUInt32LE=H.readUInt32LE,x.readUInt32BE=H.readUInt32BE,x.readInt8=H.readInt8,x.readInt16LE=H.readInt16LE,x.readInt16BE=H.readInt16BE,x.readInt32LE=H.readInt32LE,x.readInt32BE=H.readInt32BE,x.readFloatLE=H.readFloatLE,x.readFloatBE=H.readFloatBE,x.readDoubleLE=H.readDoubleLE,x.readDoubleBE=H.readDoubleBE,x.writeUInt8=H.writeUInt8,x.writeUInt16LE=H.writeUInt16LE,x.writeUInt16BE=H.writeUInt16BE,x.writeUInt32LE=H.writeUInt32LE,x.writeUInt32BE=H.writeUInt32BE,x.writeInt8=H.writeInt8,x.writeInt16LE=H.writeInt16LE,x.writeInt16BE=H.writeInt16BE,x.writeInt32LE=H.writeInt32LE,x.writeInt32BE=H.writeInt32BE,x.writeFloatLE=H.writeFloatLE,x.writeFloatBE=H.writeFloatBE,x.writeDoubleLE=H.writeDoubleLE,x.writeDoubleBE=H.writeDoubleBE,x.fill=H.fill,x.inspect=H.inspect,x.toArrayBuffer=H.toArrayBuffer,x}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,r,a){(function(i,s,p,c,u,d,y,f,v){var p=t("buffer").Buffer,P=4,m=new p(P);m.fill(0),r.exports={hash:function(T,_,w,C){for(var D=_(function(h,O){h.length%P!=0&&(R=h.length+(P-h.length%P),h=p.concat([h,m],R));for(var R,z=[],Z=O?h.readInt32BE:h.readInt32LE,Y=0;Y<h.length;Y+=P)z.push(Z.call(h,Y));return z}(T=p.isBuffer(T)?T:new p(T),C),8*T.length),_=C,A=new p(w),k=_?A.writeInt32BE:A.writeInt32LE,b=0;b<D.length;b++)k.call(A,D[b],4*b,!0);return A}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,r,a){(function(i,s,p,c,u,d,y,f,v){var p=t("buffer").Buffer,P=t("./sha"),m=t("./sha256"),T=t("./rng"),_={sha1:P,sha256:m,md5:t("./md5")},w=64,C=new p(w);function D(h,O){var R=_[h=h||"sha1"],z=[];return R||A("algorithm:",h,"is not yet supported"),{update:function(Z){return p.isBuffer(Z)||(Z=new p(Z)),z.push(Z),Z.length,this},digest:function(Z){var Y=p.concat(z),Y=O?function(H,te,ne){p.isBuffer(te)||(te=new p(te)),p.isBuffer(ne)||(ne=new p(ne)),te.length>w?te=H(te):te.length<w&&(te=p.concat([te,C],w));for(var M=new p(w),Q=new p(w),$=0;$<w;$++)M[$]=54^te[$],Q[$]=92^te[$];return ne=H(p.concat([M,ne])),H(p.concat([Q,ne]))}(R,O,Y):R(Y);return z=null,Z?Y.toString(Z):Y}}}function A(){var h=[].slice.call(arguments).join(" ");throw new Error([h,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}C.fill(0),a.createHash=function(h){return D(h)},a.createHmac=D,a.randomBytes=function(h,O){if(!O||!O.call)return new p(T(h));try{O.call(this,void 0,new p(T(h)))}catch(R){O(R)}};var k,b=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],I=function(h){a[h]=function(){A("sorry,",h,"is not implemented yet")}};for(k in b)I(b[k])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){var p=t("./helpers");function P(A,k){A[k>>5]|=128<<k%32,A[14+(k+64>>>9<<4)]=k;for(var b=1732584193,I=-271733879,h=-1732584194,O=271733878,R=0;R<A.length;R+=16){var z=b,Z=I,Y=h,H=O,b=T(b,I,h,O,A[R+0],7,-680876936),O=T(O,b,I,h,A[R+1],12,-389564586),h=T(h,O,b,I,A[R+2],17,606105819),I=T(I,h,O,b,A[R+3],22,-1044525330);b=T(b,I,h,O,A[R+4],7,-176418897),O=T(O,b,I,h,A[R+5],12,1200080426),h=T(h,O,b,I,A[R+6],17,-1473231341),I=T(I,h,O,b,A[R+7],22,-45705983),b=T(b,I,h,O,A[R+8],7,1770035416),O=T(O,b,I,h,A[R+9],12,-1958414417),h=T(h,O,b,I,A[R+10],17,-42063),I=T(I,h,O,b,A[R+11],22,-1990404162),b=T(b,I,h,O,A[R+12],7,1804603682),O=T(O,b,I,h,A[R+13],12,-40341101),h=T(h,O,b,I,A[R+14],17,-1502002290),b=_(b,I=T(I,h,O,b,A[R+15],22,1236535329),h,O,A[R+1],5,-165796510),O=_(O,b,I,h,A[R+6],9,-1069501632),h=_(h,O,b,I,A[R+11],14,643717713),I=_(I,h,O,b,A[R+0],20,-373897302),b=_(b,I,h,O,A[R+5],5,-701558691),O=_(O,b,I,h,A[R+10],9,38016083),h=_(h,O,b,I,A[R+15],14,-660478335),I=_(I,h,O,b,A[R+4],20,-405537848),b=_(b,I,h,O,A[R+9],5,568446438),O=_(O,b,I,h,A[R+14],9,-1019803690),h=_(h,O,b,I,A[R+3],14,-187363961),I=_(I,h,O,b,A[R+8],20,1163531501),b=_(b,I,h,O,A[R+13],5,-1444681467),O=_(O,b,I,h,A[R+2],9,-51403784),h=_(h,O,b,I,A[R+7],14,1735328473),b=w(b,I=_(I,h,O,b,A[R+12],20,-1926607734),h,O,A[R+5],4,-378558),O=w(O,b,I,h,A[R+8],11,-2022574463),h=w(h,O,b,I,A[R+11],16,1839030562),I=w(I,h,O,b,A[R+14],23,-35309556),b=w(b,I,h,O,A[R+1],4,-1530992060),O=w(O,b,I,h,A[R+4],11,1272893353),h=w(h,O,b,I,A[R+7],16,-155497632),I=w(I,h,O,b,A[R+10],23,-1094730640),b=w(b,I,h,O,A[R+13],4,681279174),O=w(O,b,I,h,A[R+0],11,-358537222),h=w(h,O,b,I,A[R+3],16,-722521979),I=w(I,h,O,b,A[R+6],23,76029189),b=w(b,I,h,O,A[R+9],4,-640364487),O=w(O,b,I,h,A[R+12],11,-421815835),h=w(h,O,b,I,A[R+15],16,530742520),b=C(b,I=w(I,h,O,b,A[R+2],23,-995338651),h,O,A[R+0],6,-198630844),O=C(O,b,I,h,A[R+7],10,1126891415),h=C(h,O,b,I,A[R+14],15,-1416354905),I=C(I,h,O,b,A[R+5],21,-57434055),b=C(b,I,h,O,A[R+12],6,1700485571),O=C(O,b,I,h,A[R+3],10,-1894986606),h=C(h,O,b,I,A[R+10],15,-1051523),I=C(I,h,O,b,A[R+1],21,-2054922799),b=C(b,I,h,O,A[R+8],6,1873313359),O=C(O,b,I,h,A[R+15],10,-30611744),h=C(h,O,b,I,A[R+6],15,-1560198380),I=C(I,h,O,b,A[R+13],21,1309151649),b=C(b,I,h,O,A[R+4],6,-145523070),O=C(O,b,I,h,A[R+11],10,-1120210379),h=C(h,O,b,I,A[R+2],15,718787259),I=C(I,h,O,b,A[R+9],21,-343485551),b=D(b,z),I=D(I,Z),h=D(h,Y),O=D(O,H)}return Array(b,I,h,O)}function m(A,k,b,I,h,O){return D((k=D(D(k,A),D(I,O)))<<h|k>>>32-h,b)}function T(A,k,b,I,h,O,R){return m(k&b|~k&I,A,k,h,O,R)}function _(A,k,b,I,h,O,R){return m(k&I|b&~I,A,k,h,O,R)}function w(A,k,b,I,h,O,R){return m(k^b^I,A,k,h,O,R)}function C(A,k,b,I,h,O,R){return m(b^(k|~I),A,k,h,O,R)}function D(A,k){var b=(65535&A)+(65535&k);return(A>>16)+(k>>16)+(b>>16)<<16|65535&b}r.exports=function(A){return p.hash(A,P,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){r.exports=function(p){for(var P,m=new Array(p),T=0;T<p;T++)!(3&T)&&(P=4294967296*Math.random()),m[T]=P>>>((3&T)<<3)&255;return m}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){var p=t("./helpers");function P(_,w){_[w>>5]|=128<<24-w%32,_[15+(w+64>>9<<4)]=w;for(var C,D,A,k=Array(80),b=1732584193,I=-271733879,h=-1732584194,O=271733878,R=-1009589776,z=0;z<_.length;z+=16){for(var Z=b,Y=I,H=h,te=O,ne=R,M=0;M<80;M++){k[M]=M<16?_[z+M]:T(k[M-3]^k[M-8]^k[M-14]^k[M-16],1);var Q=m(m(T(b,5),(Q=I,D=h,A=O,(C=M)<20?Q&D|~Q&A:!(C<40)&&C<60?Q&D|Q&A|D&A:Q^D^A)),m(m(R,k[M]),(C=M)<20?1518500249:C<40?1859775393:C<60?-1894007588:-899497514)),R=O,O=h,h=T(I,30),I=b,b=Q}b=m(b,Z),I=m(I,Y),h=m(h,H),O=m(O,te),R=m(R,ne)}return Array(b,I,h,O,R)}function m(_,w){var C=(65535&_)+(65535&w);return(_>>16)+(w>>16)+(C>>16)<<16|65535&C}function T(_,w){return _<<w|_>>>32-w}r.exports=function(_){return p.hash(_,P,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){function p(w,C){var D=(65535&w)+(65535&C);return(w>>16)+(C>>16)+(D>>16)<<16|65535&D}function P(w,C){var D,A=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),k=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),b=new Array(64);w[C>>5]|=128<<24-C%32,w[15+(C+64>>9<<4)]=C;for(var I,h,O=0;O<w.length;O+=16){for(var R=k[0],z=k[1],Z=k[2],Y=k[3],H=k[4],te=k[5],ne=k[6],M=k[7],Q=0;Q<64;Q++)b[Q]=Q<16?w[Q+O]:p(p(p((h=b[Q-2],T(h,17)^T(h,19)^_(h,10)),b[Q-7]),(h=b[Q-15],T(h,7)^T(h,18)^_(h,3))),b[Q-16]),D=p(p(p(p(M,T(h=H,6)^T(h,11)^T(h,25)),H&te^~H&ne),A[Q]),b[Q]),I=p(T(I=R,2)^T(I,13)^T(I,22),R&z^R&Z^z&Z),M=ne,ne=te,te=H,H=p(Y,D),Y=Z,Z=z,z=R,R=p(D,I);k[0]=p(R,k[0]),k[1]=p(z,k[1]),k[2]=p(Z,k[2]),k[3]=p(Y,k[3]),k[4]=p(H,k[4]),k[5]=p(te,k[5]),k[6]=p(ne,k[6]),k[7]=p(M,k[7])}return k}var m=t("./helpers"),T=function(w,C){return w>>>C|w<<32-C},_=function(w,C){return w>>>C};r.exports=function(w){return m.hash(w,P,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){a.read=function(p,P,m,T,O){var w,C,D=8*O-T-1,A=(1<<D)-1,k=A>>1,b=-7,I=m?O-1:0,h=m?-1:1,O=p[P+I];for(I+=h,w=O&(1<<-b)-1,O>>=-b,b+=D;0<b;w=256*w+p[P+I],I+=h,b-=8);for(C=w&(1<<-b)-1,w>>=-b,b+=T;0<b;C=256*C+p[P+I],I+=h,b-=8);if(w===0)w=1-k;else{if(w===A)return C?NaN:1/0*(O?-1:1);C+=Math.pow(2,T),w-=k}return(O?-1:1)*C*Math.pow(2,w-T)},a.write=function(p,P,m,T,_,R){var C,D,A=8*R-_-1,k=(1<<A)-1,b=k>>1,I=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=T?0:R-1,O=T?1:-1,R=P<0||P===0&&1/P<0?1:0;for(P=Math.abs(P),isNaN(P)||P===1/0?(D=isNaN(P)?1:0,C=k):(C=Math.floor(Math.log(P)/Math.LN2),P*(T=Math.pow(2,-C))<1&&(C--,T*=2),2<=(P+=1<=C+b?I/T:I*Math.pow(2,1-b))*T&&(C++,T/=2),k<=C+b?(D=0,C=k):1<=C+b?(D=(P*T-1)*Math.pow(2,_),C+=b):(D=P*Math.pow(2,b-1)*Math.pow(2,_),C=0));8<=_;p[m+h]=255&D,h+=O,D/=256,_-=8);for(C=C<<_|D,A+=_;0<A;p[m+h]=255&C,h+=O,C/=256,A-=8);p[m+h-O]|=128*R}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,r,a){(function(i,s,o,c,u,d,y,f,v){var p,P,m;function T(){}(i=r.exports={}).nextTick=(P=typeof window<"u"&&window.setImmediate,m=typeof window<"u"&&window.postMessage&&window.addEventListener,P?function(_){return window.setImmediate(_)}:m?(p=[],window.addEventListener("message",function(_){var w=_.source;w!==window&&w!==null||_.data!=="process-tick"||(_.stopPropagation(),0<p.length&&p.shift()())},!0),function(_){p.push(_),window.postMessage("process-tick","*")}):function(_){setTimeout(_,0)}),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=T,i.addListener=T,i.once=T,i.off=T,i.removeListener=T,i.removeAllListeners=T,i.emit=T,i.binding=function(_){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(_){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})($u);var _h=$u.exports;const wh=Me(_h),zu=(...n)=>wh(n.join("_")),xh=new Map;class Ni extends vh{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(zu(e,t))??null)}async update(e,t,r){this.cache.set(zu(e,t),r)}static global(){return new Ni(xh)}}class Mu extends Bu{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new st(this.value)]}}class Li extends Ie{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,s]of Object.entries(t))typeof s=="string"?r[i]=s:r[i]=await s();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(()=>Vu);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(()=>Vu);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>uf);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Uu extends Li{async formatPromptValue(e){const t=await this.format(e);return new Mu(t)}}const Zu=n=>{const e=n.split(""),t=[],r=(i,s)=>{for(let o=s;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){const i=r("}",a);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,i).join("")}),a=i+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{const i=r("{}",a),s=(i<0?e.slice(a):e.slice(a,i)).join("");t.push({type:"literal",text:s}),a=i<0?e.length:i}}return t},Di={"f-string":(n,e)=>Zu(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`Missing value for input ${r.name}`)}return t+r.text},""),jinja2:(n,e)=>""},Ph={"f-string":Zu,jinja2:n=>[]},Bi=(n,e,t)=>Di[e](n,t),Ah=(n,e)=>Ph[e](n),Ku=(n,e,t)=>{if(!(e in Di)){const r=Object.keys(Di);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((a,i)=>(a[i]="foo",a),{});Bi(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class be extends Uu{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Ku(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Bi(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a=`

`,i=""){const s=[i,...e,t].join(a);return new be({inputVariables:r,template:s})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){if(t==="jinja2")throw new Error("jinja2 templates are not currently supported.");const a=new Set;return Ah(e,t).forEach(i=>{i.type==="variable"&&a.add(i.name)}),new be({inputVariables:[...a],templateFormat:t,template:e,...r})}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new be(a)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new be({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const Vu=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:be},Symbol.toStringTag,{value:"Module"}));class Ih extends Ie{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class Fu extends Bu{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class kn extends Ih{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class Eh extends Li{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new Fu(t)}}class Oh extends kn{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new On(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this(be.fromTemplate(e),t)}}class bt extends kn{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new st(await this.prompt.format(e))}static fromTemplate(e){return new this(be.fromTemplate(e))}}class qu extends kn{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new gt(await this.prompt.format(e))}static fromTemplate(e){return new this(be.fromTemplate(e))}}class qt extends kn{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new Ri(await this.prompt.format(e))}static fromTemplate(e){return new this(be.fromTemplate(e))}}function Ch(n){return typeof n.formatMessages=="function"}function Th(n){if(Ch(n)||Du(n))return n;const e=Cn(n);if(e._getType()==="human")return bt.fromTemplate(e.content);if(e._getType()==="ai")return qu.fromTemplate(e.content);if(e._getType()==="system")return qt.fromTemplate(e.content);if(On.isInstance(e))return Oh.fromTemplate(e.content,e.role);throw new Error(`Could not coerce message prompt template from input. Received message type: "${e._getType()}".`)}class Je extends Eh{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof ut))for(const c of o.inputVariables)t.add(c);const r=this.inputVariables,a=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),i=new Set([...a].filter(o=>!t.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);const s=new Set([...t].filter(o=>!a.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const a of this.promptMessages)if(a instanceof ut)r.push(a);else{const i=a.inputVariables.reduce((o,c)=>{if(!(c in t))throw new Error(`Missing value for input variable \`${c.toString()}\``);return o[c]=t[c],o},{}),s=await a.formatMessages(i);r=r.concat(s)}return r}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new Je(a)}static fromMessages(e){const t=e.reduce((i,s)=>i.concat(s instanceof Je?s.promptMessages:[Th(s)]),[]),r=e.reduce((i,s)=>s instanceof Je?Object.assign(i,s.partialVariables):i,Object.create(null)),a=new Set;for(const i of t)if(!(i instanceof ut))for(const s of i.inputVariables)s in r||a.add(s);return new Je({inputVariables:[...a],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}const kh=()=>!1;class Hu extends Ie{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??kh(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class $i extends Hu{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Ir(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await ho("modelName"in this?Vt(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return typeof e=="string"?new Mu(e):Array.isArray(e)?new Fu(e.map(Cn)):e}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:r,...a}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await Promise.resolve().then(()=>Dm)).ChatOpenAI}[t];if(i===void 0)throw new Error(`Cannot load LLM with type ${t}`);return new i(a)}}class Nt extends $i{constructor({cache:e,concurrency:t,...r}){super(t?{maxConcurrency:t,...r}:r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e=="object"?this.cache=e:e?this.cache=Ni.global():this.cache=void 0}async invoke(e,t){const r=Nt._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async*_streamIterator(e,t){if(this._streamResponseChunks===Nt.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=Nt._convertInputToPromptValue(e),[a,i]=this._separateRunnableConfigFromCallOptions(t),s=await Se.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this==null?void 0:this.invocationParams(i)},c=await(s==null?void 0:s.handleLLMStart(this.toJSON(),[r.toString()],void 0,void 0,o));let u=new jt({text:""});try{for await(const d of this._streamResponseChunks(e.toString(),i,c==null?void 0:c[0]))u?u=u.concat(d):u=d,typeof d.text=="string"&&(yield d.text)}catch(d){throw await Promise.all((c??[]).map(y=>y==null?void 0:y.handleLLMError(d))),d}await Promise.all((c??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(e,t,r){const a=e.map(i=>i.toString());return this.generate(a,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const a=e.generations[r];if(r===0)t.push({generations:[a],llmOutput:e.llmOutput});else{const i=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[a],llmOutput:i})}}return t}async _generateUncached(e,t,r){const a=await Se.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this==null?void 0:this.invocationParams(t)},s=await(a==null?void 0:a.handleLLMStart(this.toJSON(),e,void 0,void 0,i));let o;try{o=await this._generate(e,t,s==null?void 0:s[0])}catch(d){throw await Promise.all((s??[]).map(y=>y==null?void 0:y.handleLLMError(d))),d}const c=this._flattenLLMResult(o);await Promise.all((s??[]).map((d,y)=>d==null?void 0:d.handleLLMEnd(c[y])));const u=(s==null?void 0:s.map(d=>d.runId))||void 0;return Object.defineProperty(o,Si,{value:u?{runIds:u}:void 0,configurable:!0}),o}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let a;Array.isArray(t)?a={stop:t}:a=t;const[i,s]=this._separateRunnableConfigFromCallOptions(a);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(e,s,i);const{cache:o}=this,c=this.serialize();c.stop=s.stop??c.stop;const u=`${Object.entries(c).sort()}`,d=[],y=await Promise.all(e.map(async(v,p)=>{const P=await o.lookup(v,u);return P||d.push(p),P}));let f={};if(d.length>0){const v=await this._generateUncached(d.map(p=>e[p]),s,i);await Promise.all(v.generations.map(async(p,P)=>{const m=d[P];return y[m]=p,o.update(e[m],u,p)})),f=v.llmOutput??{}}return{generations:y,llmOutput:f}}async call(e,t,r){const{generations:a}=await this.generate([e],t,r);return a[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const a=Cr(e),i=await this.call(a,t,r);return new gt(i)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}static async deserialize(e){const{_type:t,_model:r,...a}=e;if(r&&r!=="base_llm")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await Promise.resolve().then(()=>Rh)).OpenAI}[t];if(i===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new i(a)}}class Sh extends Nt{async _generate(e,t,r){return{generations:await Promise.all(e.map((i,s)=>this._call(i,{...t,promptIndex:s},r).then(o=>[{text:o}])))}}}class Wu extends Sh{static lc_name(){return"OpenAIChat"}get callKeys(){return[...super.callKeys,"options","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,i,s,o,c,u,d;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"prefixMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ce("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ce("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ce("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(ce("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||ce("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ce("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ce("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??ce("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.prefixMessages=(e==null?void 0:e.prefixMessages)??this.prefixMessages,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.maxTokens=e==null?void 0:e.maxTokens,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.n>1)throw new Error("Cannot use n > 1 in OpenAIChat LLM. Use ChatOpenAI Chat Model instead.");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((a=e==null?void 0:e.configuration)==null?void 0:a.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=t==null?void 0:t.baseOptions)==null?void 0:i.headers)??((o=(s=e==null?void 0:e.configuration)==null?void 0:s.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((d=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:d.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,logit_bias:this.logitBias,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}formatMessages(e){const t={role:"user",content:e};return this.prefixMessages?[...this.prefixMessages,t]:[t]}async*_streamResponseChunks(e,t,r){var s;const a={...this.invocationParams(t),messages:this.formatMessages(e),stream:!0},i=await this.completionWithRetry(a,t);for await(const o of i){const c=o==null?void 0:o.choices[0];if(!c)continue;const{delta:u}=c,d=new jt({text:u.content??""});yield d;const y={prompt:t.promptIndex??0,completion:c.index??0};r==null||r.handleLLMNewToken(d.text??"",y)}if((s=t.signal)!=null&&s.aborted)throw new Error("AbortError")}async _call(e,t,r){var i,s;const a=this.invocationParams(t);if(a.stream){const o=await this._streamResponseChunks(e,t,r);let c;for await(const u of o)c===void 0?c=u:c=c.concat(u);return(c==null?void 0:c.text)??""}else{const o=await this.completionWithRetry({...a,stream:!1,messages:this.formatMessages(e)},{signal:t.signal,...t.options});return((s=(i=o==null?void 0:o.choices[0])==null?void 0:i.message)==null?void 0:s.content)??""}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw xn(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=wn(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Pe(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}class Yu extends Nt{static lc_name(){return"OpenAI"}get callKeys(){return[...super.callKeys,"options"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,i,s,o,c,u,d,y,f,v;if(((r=e==null?void 0:e.modelName)!=null&&r.startsWith("gpt-3.5-turbo")||(a=e==null?void 0:e.modelName)!=null&&a.startsWith("gpt-4"))&&!((i=e==null?void 0:e.modelName)!=null&&i.includes("-instruct")))return new Wu(e,t);if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:256}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"bestOf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-davinci-003"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ce("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ce("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ce("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(ce("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||ce("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ce("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ce("AZURE_OPENAI_BASE_PATH"),this.organization=((s=e==null?void 0:e.configuration)==null?void 0:s.organization)??ce("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.batchSize=(e==null?void 0:e.batchSize)??this.batchSize,this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.maxTokens=(e==null?void 0:e.maxTokens)??this.maxTokens,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.bestOf=(e==null?void 0:e.bestOf)??this.bestOf,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.streaming&&this.bestOf&&this.bestOf>1)throw new Error("Cannot stream results when bestOf > 1");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((o=e==null?void 0:e.configuration)==null?void 0:o.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((c=t==null?void 0:t.baseOptions)==null?void 0:c.headers)??((d=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:d.headers),defaultQuery:((y=t==null?void 0:t.baseOptions)==null?void 0:y.params)??((v=(f=e==null?void 0:e.configuration)==null?void 0:f.baseOptions)==null?void 0:v.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,max_tokens:this.maxTokens,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,best_of:this.bestOf,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const a=Ci(e,this.batchSize),i=[],s={},o=this.invocationParams(t);if(o.max_tokens===-1){if(e.length!==1)throw new Error("max_tokens set to -1 not supported for multiple inputs");o.max_tokens=await gh({prompt:e[0],modelName:this.modelName})}for(let u=0;u<a.length;u+=1){const d=o.stream?await(async()=>{var T;const p=[];let P;const m=await this.completionWithRetry({...o,stream:!0,prompt:a[u]},t);for await(const _ of m){P||(P={id:_.id,object:_.object,created:_.created,model:_.model});for(const w of _.choices){if(!p[w.index])p[w.index]=w;else{const C=p[w.index];C.text+=w.text,C.finish_reason=w.finish_reason,C.logprobs=w.logprobs}r==null||r.handleLLMNewToken(w.text,{prompt:Math.floor(w.index/this.n),completion:w.index%this.n})}}if((T=t.signal)!=null&&T.aborted)throw new Error("AbortError");return{...P,choices:p}})():await this.completionWithRetry({...o,stream:!1,prompt:a[u]},{signal:t.signal,...t.options});i.push(...d.choices);const{completion_tokens:y,prompt_tokens:f,total_tokens:v}=d.usage?d.usage:{completion_tokens:void 0,prompt_tokens:void 0,total_tokens:void 0};y&&(s.completionTokens=(s.completionTokens??0)+y),f&&(s.promptTokens=(s.promptTokens??0)+f),v&&(s.totalTokens=(s.totalTokens??0)+v)}return{generations:Ci(i,this.n).map(u=>u.map(d=>({text:d.text??"",generationInfo:{finishReason:d.finish_reason,logprobs:d.logprobs}}))),llmOutput:{tokenUsage:s}}}async*_streamResponseChunks(e,t,r){var s;const a={...this.invocationParams(t),prompt:e,stream:!0},i=await this.completionWithRetry(a,t);for await(const o of i){const c=o==null?void 0:o.choices[0];if(!c)continue;const u=new jt({text:c.text,generationInfo:{finishReason:c.finish_reason}});yield u,r==null||r.handleLLMNewToken(u.text??"")}if((s=t.signal)!=null&&s.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.completions.create(e,r)}catch(a){throw xn(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=wn(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Pe(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}const Rh=Object.freeze(Object.defineProperty({__proto__:null,OpenAI:Yu,OpenAIChat:Wu},Symbol.toStringTag,{value:"Module"}));class qe extends Hu{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:a,callbackManager:i,...s}=e;super({...s,callbacks:i??s.callbacks}),this.memory=a}else super({verbose:t,callbacks:r}),this.memory=e}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter(c=>{var u;return!((u=this.memory)!=null&&u.memoryKeys.includes(c))});if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const i=r.length?{[r[0]]:e}:{},s=await this.call(i,t),o=Object.keys(s);if(o.length===1)return s[o[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),this.memory!=null){const r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[a,i]of Object.entries(r))t[a]=i}return t}async call(e,t,r){const a=await this._formatValues(e),i=jo(t),s=await Se.configure(i.callbacks,this.callbacks,i.tags||r,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(s==null?void 0:s.handleChainStart(this.toJSON(),a));let c;try{c=await(e.signal?Promise.race([this._call(a,o),new Promise((u,d)=>{var y;(y=e.signal)==null||y.addEventListener("abort",()=>{d(new Error("AbortError"))})})]):this._call(a,o))}catch(u){throw await(o==null?void 0:o.handleChainError(u)),u}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),c),await(o==null?void 0:o.handleChainEnd(c)),Object.defineProperty(c,Si,{value:o?{runId:o==null?void 0:o.runId}:void 0,configurable:!0}),c}async apply(e,t){return Promise.all(e.map(async(r,a)=>this.call(r,t==null?void 0:t[a])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:r}=await Promise.resolve().then(()=>Dh);return r.deserialize(e)}case"sequential_chain":{const{SequentialChain:r}=await Promise.resolve().then(()=>ec);return r.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:r}=await Promise.resolve().then(()=>ec);return r.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:r}=await Promise.resolve().then(()=>Zi);return r.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:r}=await Promise.resolve().then(()=>Zi);return r.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:r}=await Promise.resolve().then(()=>Zi);return r.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:r}=await Promise.resolve().then(()=>Af);return r.deserialize(e,t)}case"api_chain":{const{APIChain:r}=await Promise.resolve().then(()=>Mh);return r.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class jh extends Ie{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async r=>this.parseResult([{text:r}]),e,{...t,runType:"parser"}):this._callWithConfig(async r=>this.parseResult([{message:r,text:r.content}]),e,{...t,runType:"parser"})}}class Nh extends jh{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Lh extends Nh{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class _e extends qe{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new Lh,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){let a;return this.outputParser?a=await this.outputParser.parseResultWithPrompt(e,t,r==null?void 0:r.getChild()):a=e[0].text,a}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},a={...this.llmKwargs};for(const o of this.llm.callKeys)o in e&&(a[o]=e[o],delete r[o]);const i=await this.prompt.formatPromptValue(r),{generations:s}=await this.llm.generatePrompt([i],a,t==null?void 0:t.getChild());return{[this.outputKey]:await this._getFinalOutput(s[0],i,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new _e({llm:await $i.deserialize(t),prompt:await Li.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}const Dh=Object.freeze(Object.defineProperty({__proto__:null,LLMChain:_e},Symbol.toStringTag,{value:"Module"})),Gu=`You are given the below API Documentation:
{api_docs}
Using this documentation, generate the full API url to call for answering the user question.
You should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.

Question:{question}
API url:`,Bh=new be({inputVariables:["api_docs","question"],template:Gu}),$h=`${Gu} {api_url}

Here is the response from the API:

{api_response}

Summarize this response to answer the original question.

Summary:`,zh=new be({inputVariables:["api_docs","question","api_url","api_response"],template:$h});class zi extends qe{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,t){const r=e[this.inputKey],a=await this.apiRequestChain.predict({question:r,api_docs:this.apiDocs},t==null?void 0:t.getChild("request")),s=await(await fetch(a,{headers:this.headers})).text(),o=await this.apiAnswerChain.predict({question:r,api_docs:this.apiDocs,api_url:a,api_response:s},t==null?void 0:t.getChild("response"));return{[this.outputKey]:o}}_chainType(){return"api_chain"}static async deserialize(e){const{api_request_chain:t,api_answer_chain:r,api_docs:a}=e;if(!t)throw new Error("LLMChain must have api_request_chain");if(!r)throw new Error("LLMChain must have api_answer_chain");if(!a)throw new Error("LLMChain must have api_docs");return new zi({apiAnswerChain:await _e.deserialize(r),apiRequestChain:await _e.deserialize(t),apiDocs:a})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,t,r={}){const{apiUrlPrompt:a=Bh,apiResponsePrompt:i=zh}=r,s=new _e({prompt:a,llm:e}),o=new _e({prompt:i,llm:e});return new this({apiAnswerChain:o,apiRequestChain:s,apiDocs:t,...r})}}const Mh=Object.freeze(Object.defineProperty({__proto__:null,APIChain:zi},Symbol.toStringTag,{value:"Module"}));class Xu extends bh{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}class Uh extends S0{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=(e==null?void 0:e.chatHistory)??new Xu,this.returnMessages=(e==null?void 0:e.returnMessages)??this.returnMessages,this.inputKey=(e==null?void 0:e.inputKey)??this.inputKey,this.outputKey=(e==null?void 0:e.outputKey)??this.outputKey}async saveContext(e,t){await this.chatHistory.addUserMessage(R0(e,this.inputKey)),await this.chatHistory.addAIChatMessage(j0(t,this.outputKey))}async clear(){await this.chatHistory.clear()}}class Ju extends Uh{constructor(e){super({chatHistory:e==null?void 0:e.chatHistory,returnMessages:(e==null?void 0:e.returnMessages)??!1,inputKey:e==null?void 0:e.inputKey,outputKey:e==null?void 0:e.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const t=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:t}:{[this.memoryKey]:Cr(t,this.humanPrefix,this.aiPrefix)}}}function Qu(n,e){const t=new Set;for(const r of e)n.has(r)&&t.add(r);return t}function Zh(n,e){const t=new Set(n);for(const r of e)t.add(r);return t}function Sn(n,e){const t=new Set(n);for(const r of e)t.delete(r);return t}function Ht(n){return Array.from(n).map(e=>`"${e}"`).join(", ")}class Mi extends qe{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){var s;if(this.chains.length===0)throw new Error("Sequential chain must have at least one chain.");const e=((s=this.memory)==null?void 0:s.memoryKeys)??[],t=new Set(this.inputKeys),r=new Set(e),a=Qu(t,r);if(a.size>0)throw new Error(`The following keys: ${Ht(a)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const i=Zh(t,r);for(const o of this.chains){let c=Sn(new Set(o.inputKeys),i);if(o.memory&&(c=Sn(c,new Set(o.memory.memoryKeys))),c.size>0)throw new Error(`Missing variables for chain "${o._chainType()}": ${Ht(c)}. Only got the following variables: ${Ht(i)}.`);const u=new Set(o.outputKeys),d=Qu(i,u);if(d.size>0)throw new Error(`The following output variables for chain "${o._chainType()}" are overlapping: ${Ht(d)}. This can lead to unexpected behaviour.`);for(const y of u)i.add(y)}if(this.outputVariables.length===0)if(this.returnAll){const o=Sn(i,t);this.outputVariables=Array.from(o)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const o=Sn(new Set(this.outputVariables),new Set(i));if(o.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${Ht(o)}.`)}}async _call(e,t){let r={};const a=e;let i=0;for(const o of this.chains){i+=1,r=await o.call(a,t==null?void 0:t.getChild(`step_${i}`));for(const c of Object.keys(r))a[c]=r[c]}const s={};for(const o of this.outputVariables)s[o]=a[o];return s}_chainType(){return"sequential_chain"}static async deserialize(e){const t=[],r=e.input_variables,a=e.output_variables,i=e.chains;for(const s of i){const o=await qe.deserialize(s);t.push(o)}return new Mi({chains:t,inputVariables:r,outputVariables:a})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class Ui extends qe{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(e.inputKeys.filter(t=>{var r;return!((r=e.memory)!=null&&r.memoryKeys.includes(t))}).length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(e.outputKeys.length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],a=0;for(const i of this.chains)a+=1,r=(await i.call({[i.inputKeys[0]]:r,signal:e.signal},t==null?void 0:t.getChild(`step_${a}`)))[i.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await(t==null?void 0:t.handleText(r));return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const t=[],r=e.chains;for(const a of r){const i=await qe.deserialize(a);t.push(i)}return new Ui({chains:t})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}const ec=Object.freeze(Object.defineProperty({__proto__:null,SequentialChain:Mi,SimpleSequentialChain:Ui},Symbol.toStringTag,{value:"Module"}));class ct extends qe{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,i=t.map(({pageContent:s})=>s).join(`

`);return{...r,[this.documentVariableName]:i}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t==null?void 0:t.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new ct({llmChain:await _e.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class Wt extends qe{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...a}=e;let i=r,s=[];for(let u=0;u<this.maxIterations;u+=1){const d=i.map(p=>({[this.documentVariableName]:p.pageContent,...a}));if(u!==0||!this.ensureMapStep){const p=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:i,...a}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(p)<this.maxTokens)break}const f=await this.llmChain.apply(d,t?Array.from({length:d.length},(p,P)=>t.getChild(`map_${P+1}`)):void 0),{outputKey:v}=this.llmChain;this.returnIntermediateSteps&&(s=s.concat(f.map(p=>p[v]))),i=f.map(p=>({pageContent:p[v],metadata:{}}))}const o={[this.combineDocumentChain.inputKey]:i,...a},c=await this.combineDocumentChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnIntermediateSteps?{...c,intermediateSteps:s}:c}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new Wt({llmChain:await _e.deserialize(e.llm_chain),combineDocumentChain:await ct.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class Yt extends qe{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new be({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},a={};return this.documentPrompt.inputVariables.forEach(o=>{a[o]=r[o]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...a})},...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},a={};this.documentPrompt.inputVariables.forEach(o=>{a[o]=r[o]});const i={[this.documentVariableName]:await this.documentPrompt.format({...a})};return{[this.initialResponseName]:t,...i}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...a}=e,i=r,s=await this._constructInitialInputs(i[0],a);let o=await this.llmChain.predict({...s},t==null?void 0:t.getChild("answer"));for(let c=1;c<i.length;c+=1){const d={...await this._constructRefineInputs(i[c],o),...a};o=await this.refineLLMChain.predict({...d},t==null?void 0:t.getChild("refine"))}return{[this.outputKey]:o}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new Yt({llmChain:await _e.deserialize(t),refineLLMChain:await _e.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const Zi=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain:Wt,RefineDocumentsChain:Yt,StuffDocumentsChain:ct},Symbol.toStringTag,{value:"Module"}));class Kh{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class Gt extends Kh{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function Xt(n){return n._modelType()==="base_chat_model"}const Vh=new be({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),Fh=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,qh=[qt.fromTemplate(Fh),bt.fromTemplate("{question}")],Hh=Je.fromMessages(qh),Wh=new Gt(Vh,[[Xt,Hh]]),Yh=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
{context}
Question: {question}
Relevant text, if any:`,Gh=be.fromTemplate(Yh),Xh=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
----------------
{context}`,Jh=[qt.fromTemplate(Xh),bt.fromTemplate("{question}")],Qh=Je.fromMessages(Jh),ef=new Gt(Gh,[[Xt,Qh]]),tf=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.

QUESTION: Which state/country's law governs the interpretation of the contract?
=========
Content: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.

Content: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.

11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.

11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.

11.9 No Third-Party Beneficiaries.

Content: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,
=========
FINAL ANSWER: This Agreement is governed by English law.

QUESTION: What did the president say about Michael Jackson?
=========
Content: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  

Last year COVID-19 kept us apart. This year we are finally together again. 

Tonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. 

With a duty to one another to the American people to the Constitution. 

And with an unwavering resolve that freedom will always triumph over tyranny. 

Six days ago, Russia’s Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. 

He thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. 

He met the Ukrainian people. 

From President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. 

Groups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.

Content: And we won’t stop. 

We have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. 

Let’s use this moment to reset. Let’s stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  

Let’s stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  

We can’t change how divided we’ve been. But we can change how we move forward—on COVID-19 and other issues we must face together. 

I recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. 

They were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. 

Officer Mora was 27 years old. 

Officer Rivera was 22. 

Both Dominican Americans who’d grown up on the same streets they later chose to patrol as police officers. 

I spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.

Content: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  

To all Americans, I will be honest with you, as I’ve always promised. A Russian dictator, invading a foreign country, has costs around the world. 

And I’m taking robust action to make sure the pain of our sanctions  is targeted at Russia’s economy. And I will use every tool at our disposal to protect American businesses and consumers. 

Tonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  

America will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  

These steps will help blunt gas prices here at home. And I know the news about what’s happening can seem alarming. 

But I want you to know that we are going to be okay.

Content: More support for patients and families. 

To get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. 

It’s based on DARPA—the Defense Department project that led to the Internet, GPS, and so much more.  

ARPA-H will have a singular purpose—to drive breakthroughs in cancer, Alzheimer’s, diabetes, and more. 

A unity agenda for the nation. 

We can do this. 

My fellow Americans—tonight , we have gathered in a sacred space—the citadel of our democracy. 

In this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. 

We have fought for freedom, expanded liberty, defeated totalitarianism and terror. 

And built the strongest, freest, and most prosperous nation the world has ever known. 

Now is the hour. 

Our moment of responsibility. 

Our test of resolve and conscience, of history itself. 

It is in this moment that our character is formed. Our purpose is found. Our future is forged. 

Well I know this nation.
=========
FINAL ANSWER: The president did not mention Michael Jackson.

QUESTION: {question}
=========
{summaries}
=========
FINAL ANSWER:`,rf=be.fromTemplate(tf),nf=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.
----------------
{summaries}`,af=[qt.fromTemplate(nf),bt.fromTemplate("{question}")],sf=Je.fromMessages(af),of=new Gt(rf,[[Xt,sf]]);class Rn extends Uu{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Ku(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new Rn(a)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(s=>this.examplePrompt.format(s))),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return Bi(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await be.deserialize(t);let a;if(Array.isArray(e.examples))a=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new Rn({inputVariables:e.input_variables,examplePrompt:r,examples:a,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}const uf=Object.freeze(Object.defineProperty({__proto__:null,FewShotPromptTemplate:Rn},Symbol.toStringTag,{value:"Module"})),cf=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,lf=new be({inputVariables:["question","existing_answer","context"],template:cf}),df=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,hf=[bt.fromTemplate("{question}"),qu.fromTemplate("{existing_answer}"),bt.fromTemplate(df)],ff=Je.fromMessages(hf),pf=new Gt(lf,[[Xt,ff]]),mf=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer the question: {question}`,yf=new be({inputVariables:["context","question"],template:mf}),gf=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer any questions`,bf=[qt.fromTemplate(gf),bt.fromTemplate("{question}")],vf=Je.fromMessages(bf),_f=new Gt(yf,[[Xt,vf]]),wf=(n,e={type:"stuff"})=>{const{type:t}=e;if(t==="stuff")return tc(n,e);if(t==="map_reduce")return xf(n,e);if(t==="refine")return Pf(n,e);throw new Error(`Invalid _type: ${t}`)};function tc(n,e={}){const{prompt:t=Wh.getPrompt(n),verbose:r}=e,a=new _e({prompt:t,llm:n,verbose:r});return new ct({llmChain:a,verbose:r})}function xf(n,e={}){const{combineMapPrompt:t=ef.getPrompt(n),combinePrompt:r=of.getPrompt(n),verbose:a,combineLLM:i,returnIntermediateSteps:s}=e,o=new _e({prompt:t,llm:n,verbose:a}),c=new _e({prompt:r,llm:i??n,verbose:a}),u=new ct({llmChain:c,documentVariableName:"summaries",verbose:a});return new Wt({llmChain:o,combineDocumentChain:u,returnIntermediateSteps:s,verbose:a})}function Pf(n,e={}){const{questionPrompt:t=_f.getPrompt(n),refinePrompt:r=pf.getPrompt(n),refineLLM:a,verbose:i}=e,s=new _e({prompt:t,llm:n,verbose:i}),o=new _e({prompt:r,llm:a??n,verbose:i});return new Yt({llmChain:s,refineLLMChain:o,verbose:i})}class Ki extends qe{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const r=e[this.inputKey],a=await this.vectorstore.similaritySearch(r,this.k,e.filter,t==null?void 0:t.getChild("vectorstore")),i={question:r,input_documents:a},s=await this.combineDocumentsChain.call(i,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...s,sourceDocuments:a}:s}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:r}=t;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new Ki({combineDocumentsChain:await qe.deserialize(e.combine_documents_chain),k:e.k,vectorstore:r})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,r){const a=tc(e);return new this({vectorstore:t,combineDocumentsChain:a,...r})}}const Af=Object.freeze(Object.defineProperty({__proto__:null,VectorDBQAChain:Ki},Symbol.toStringTag,{value:"Module"})),If=`Write a concise summary of the following:


"{text}"


CONCISE SUMMARY:`,jn=new be({template:If,inputVariables:["text"]}),Ef=`Your job is to produce a final summary
We have provided an existing summary up to a certain point: "{existing_answer}"
We have the opportunity to refine the existing summary
(only if needed) with some more context below.
------------
"{text}"
------------

Given the new context, refine the original summary
If the context isn't useful, return the original summary.

REFINED SUMMARY:`,Of=new be({template:Ef,inputVariables:["existing_answer","text"]}),Cf=(n,e={type:"map_reduce"})=>{const{verbose:t}=e;if(e.type==="stuff"){const{prompt:r=jn}=e,a=new _e({prompt:r,llm:n,verbose:t});return new ct({llmChain:a,documentVariableName:"text",verbose:t})}if(e.type==="map_reduce"){const{combineMapPrompt:r=jn,combinePrompt:a=jn,combineLLM:i,returnIntermediateSteps:s}=e,o=new _e({prompt:r,llm:n,verbose:t}),c=new _e({prompt:a,llm:i??n,verbose:t}),u=new ct({llmChain:c,documentVariableName:"text",verbose:t});return new Wt({llmChain:o,combineDocumentChain:u,documentVariableName:"text",returnIntermediateSteps:s,verbose:t})}if(e.type==="refine"){const{refinePrompt:r=Of,refineLLM:a,questionPrompt:i=jn}=e,s=new _e({prompt:i,llm:n,verbose:t}),o=new _e({prompt:r,llm:a??n,verbose:t});return new Yt({llmChain:s,refineLLMChain:o,documentVariableName:"text",verbose:t})}throw new Error(`Invalid _type: ${e.type}`)},Tf=`Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.

Chat History:
{chat_history}
Follow Up Input: {question}
Standalone question:`;class Vi extends qe{static lc_name(){return"ConversationalRetrievalQAChain"}get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}static getChatHistoryString(e){let t;return Array.isArray(e)?(Array.isArray(e[0])&&typeof e[0][0]=="string"?(console.warn(`Passing chat history as an array of strings is deprecated.
Please see https://js.langchain.com/docs/modules/chains/popular/chat_vector_db#externally-managed-memory for more information.`),t=e.flat().map((r,a)=>a%2===0?new st(r):new gt(r))):t=e,t.map(r=>r._getType()==="human"?`Human: ${r.content}`:r._getType()==="ai"?`Assistant: ${r.content}`:`${r.content}`).join(`
`)):e}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found.`);const r=e[this.inputKey],a=Vi.getChatHistoryString(e[this.chatHistoryKey]);let i=r;if(a.length>0){const u=await this.questionGeneratorChain.call({question:r,chat_history:a},t==null?void 0:t.getChild("question_generator")),d=Object.keys(u);if(d.length===1)i=u[d[0]];else throw new Error("Return from llm chain has multiple values, only single values supported.")}const s=await this.retriever.getRelevantDocuments(i,t==null?void 0:t.getChild("retriever")),o={question:i,input_documents:s,chat_history:a},c=await this.combineDocumentsChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...c,sourceDocuments:s}:c}_chainType(){return"conversational_retrieval_chain"}static async deserialize(e,t){throw new Error("Not implemented.")}serialize(){throw new Error("Not implemented.")}static fromLLM(e,t,r={}){const{questionGeneratorTemplate:a,qaTemplate:i,qaChainOptions:s={type:"stuff",prompt:i?be.fromTemplate(i):void 0},questionGeneratorChainOptions:o,verbose:c,...u}=r,d=wf(e,s),y=be.fromTemplate((o==null?void 0:o.template)??a??Tf),f=new _e({prompt:y,llm:(o==null?void 0:o.llm)??e,verbose:c});return new this({retriever:t,combineDocumentsChain:d,questionGeneratorChain:f,verbose:c,...u})}}var rc={},Nn={},Jt={},Ln={},Fi={},Qe={},Dn={},Qt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getParsedType=n.ZodParsedType=n.objectUtil=n.util=void 0;var e;(function(r){r.assertEqual=o=>o;function a(o){}r.assertIs=a;function i(o){throw new Error}r.assertNever=i,r.arrayToEnum=o=>{const c={};for(const u of o)c[u]=u;return c},r.getValidEnumValues=o=>{const c=r.objectKeys(o).filter(d=>typeof o[o[d]]!="number"),u={};for(const d of c)u[d]=o[d];return r.objectValues(u)},r.objectValues=o=>r.objectKeys(o).map(function(c){return o[c]}),r.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const c=[];for(const u in o)Object.prototype.hasOwnProperty.call(o,u)&&c.push(u);return c},r.find=(o,c)=>{for(const u of o)if(c(u))return u},r.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&isFinite(o)&&Math.floor(o)===o;function s(o,c=" | "){return o.map(u=>typeof u=="string"?`'${u}'`:u).join(c)}r.joinValues=s,r.jsonStringifyReplacer=(o,c)=>typeof c=="bigint"?c.toString():c})(e=n.util||(n.util={})),function(r){r.mergeShapes=(a,i)=>({...a,...i})}(n.objectUtil||(n.objectUtil={})),n.ZodParsedType=e.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);const t=r=>{switch(typeof r){case"undefined":return n.ZodParsedType.undefined;case"string":return n.ZodParsedType.string;case"number":return isNaN(r)?n.ZodParsedType.nan:n.ZodParsedType.number;case"boolean":return n.ZodParsedType.boolean;case"function":return n.ZodParsedType.function;case"bigint":return n.ZodParsedType.bigint;case"symbol":return n.ZodParsedType.symbol;case"object":return Array.isArray(r)?n.ZodParsedType.array:r===null?n.ZodParsedType.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?n.ZodParsedType.promise:typeof Map<"u"&&r instanceof Map?n.ZodParsedType.map:typeof Set<"u"&&r instanceof Set?n.ZodParsedType.set:typeof Date<"u"&&r instanceof Date?n.ZodParsedType.date:n.ZodParsedType.object;default:return n.ZodParsedType.unknown}};n.getParsedType=t})(Qt);var et={};Object.defineProperty(et,"__esModule",{value:!0}),et.ZodError=et.quotelessJson=et.ZodIssueCode=void 0;const nc=Qt;et.ZodIssueCode=nc.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);const kf=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");et.quotelessJson=kf;class qi extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},a=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)r._errors.push(t(s));else{let o=r,c=0;for(;c<s.path.length;){const u=s.path[c];c===s.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(s))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return a(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,nc.util.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}et.ZodError=qi,qi.create=n=>new qi(n),Object.defineProperty(Dn,"__esModule",{value:!0});const vt=Qt,je=et,Sf=(n,e)=>{let t;switch(n.code){case je.ZodIssueCode.invalid_type:n.received===vt.ZodParsedType.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case je.ZodIssueCode.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,vt.util.jsonStringifyReplacer)}`;break;case je.ZodIssueCode.unrecognized_keys:t=`Unrecognized key(s) in object: ${vt.util.joinValues(n.keys,", ")}`;break;case je.ZodIssueCode.invalid_union:t="Invalid input";break;case je.ZodIssueCode.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${vt.util.joinValues(n.options)}`;break;case je.ZodIssueCode.invalid_enum_value:t=`Invalid enum value. Expected ${vt.util.joinValues(n.options)}, received '${n.received}'`;break;case je.ZodIssueCode.invalid_arguments:t="Invalid function arguments";break;case je.ZodIssueCode.invalid_return_type:t="Invalid function return type";break;case je.ZodIssueCode.invalid_date:t="Invalid date";break;case je.ZodIssueCode.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:vt.util.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case je.ZodIssueCode.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case je.ZodIssueCode.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case je.ZodIssueCode.custom:t="Invalid input";break;case je.ZodIssueCode.invalid_intersection_types:t="Intersection results could not be merged";break;case je.ZodIssueCode.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case je.ZodIssueCode.not_finite:t="Number must be finite";break;default:t=e.defaultError,vt.util.assertNever(n)}return{message:t}};Dn.default=Sf;var Rf=ee&&ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.getErrorMap=Qe.setErrorMap=Qe.defaultErrorMap=void 0;const ac=Rf(Dn);Qe.defaultErrorMap=ac.default;let ic=ac.default;function jf(n){ic=n}Qe.setErrorMap=jf;function Nf(){return ic}Qe.getErrorMap=Nf;var Hi={};(function(n){var e=ee&&ee.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(n,"__esModule",{value:!0}),n.isAsync=n.isValid=n.isDirty=n.isAborted=n.OK=n.DIRTY=n.INVALID=n.ParseStatus=n.addIssueToContext=n.EMPTY_PATH=n.makeIssue=void 0;const t=Qe,r=e(Dn),a=v=>{const{data:p,path:P,errorMaps:m,issueData:T}=v,_=[...P,...T.path||[]],w={...T,path:_};let C="";const D=m.filter(A=>!!A).slice().reverse();for(const A of D)C=A(w,{data:p,defaultError:C}).message;return{...T,path:_,message:T.message||C}};n.makeIssue=a,n.EMPTY_PATH=[];function i(v,p){const P=(0,n.makeIssue)({issueData:p,data:v.data,path:v.path,errorMaps:[v.common.contextualErrorMap,v.schemaErrorMap,(0,t.getErrorMap)(),r.default].filter(m=>!!m)});v.common.issues.push(P)}n.addIssueToContext=i;class s{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(p,P){const m=[];for(const T of P){if(T.status==="aborted")return n.INVALID;T.status==="dirty"&&p.dirty(),m.push(T.value)}return{status:p.value,value:m}}static async mergeObjectAsync(p,P){const m=[];for(const T of P)m.push({key:await T.key,value:await T.value});return s.mergeObjectSync(p,m)}static mergeObjectSync(p,P){const m={};for(const T of P){const{key:_,value:w}=T;if(_.status==="aborted"||w.status==="aborted")return n.INVALID;_.status==="dirty"&&p.dirty(),w.status==="dirty"&&p.dirty(),_.value!=="__proto__"&&(typeof w.value<"u"||T.alwaysSet)&&(m[_.value]=w.value)}return{status:p.value,value:m}}}n.ParseStatus=s,n.INVALID=Object.freeze({status:"aborted"});const o=v=>({status:"dirty",value:v});n.DIRTY=o;const c=v=>({status:"valid",value:v});n.OK=c;const u=v=>v.status==="aborted";n.isAborted=u;const d=v=>v.status==="dirty";n.isDirty=d;const y=v=>v.status==="valid";n.isValid=y;const f=v=>typeof Promise<"u"&&v instanceof Promise;n.isAsync=f})(Hi);var sc={};Object.defineProperty(sc,"__esModule",{value:!0});var oc={},uc={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.errorUtil=void 0,function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message}(n.errorUtil||(n.errorUtil={}))})(uc),function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.date=n.boolean=n.bigint=n.array=n.any=n.coerce=n.ZodFirstPartyTypeKind=n.late=n.ZodSchema=n.Schema=n.custom=n.ZodReadonly=n.ZodPipeline=n.ZodBranded=n.BRAND=n.ZodNaN=n.ZodCatch=n.ZodDefault=n.ZodNullable=n.ZodOptional=n.ZodTransformer=n.ZodEffects=n.ZodPromise=n.ZodNativeEnum=n.ZodEnum=n.ZodLiteral=n.ZodLazy=n.ZodFunction=n.ZodSet=n.ZodMap=n.ZodRecord=n.ZodTuple=n.ZodIntersection=n.ZodDiscriminatedUnion=n.ZodUnion=n.ZodObject=n.ZodArray=n.ZodVoid=n.ZodNever=n.ZodUnknown=n.ZodAny=n.ZodNull=n.ZodUndefined=n.ZodSymbol=n.ZodDate=n.ZodBoolean=n.ZodBigInt=n.ZodNumber=n.ZodString=n.ZodType=void 0,n.NEVER=n.void=n.unknown=n.union=n.undefined=n.tuple=n.transformer=n.symbol=n.string=n.strictObject=n.set=n.record=n.promise=n.preprocess=n.pipeline=n.ostring=n.optional=n.onumber=n.oboolean=n.object=n.number=n.nullable=n.null=n.never=n.nativeEnum=n.nan=n.map=n.literal=n.lazy=n.intersection=n.instanceof=n.function=n.enum=n.effect=n.discriminatedUnion=void 0;const e=Qe,t=uc,r=Hi,a=Qt,i=et;class s{constructor(l,g,E,L){this._cachedPath=[],this.parent=l,this.data=g,this._path=E,this._key=L}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const o=(j,l)=>{if((0,r.isValid)(l))return{success:!0,data:l.value};if(!j.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const g=new i.ZodError(j.common.issues);return this._error=g,this._error}}};function c(j){if(!j)return{};const{errorMap:l,invalid_type_error:g,required_error:E,description:L}=j;if(l&&(g||E))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return l?{errorMap:l,description:L}:{errorMap:(X,q)=>X.code!=="invalid_type"?{message:q.defaultError}:typeof q.data>"u"?{message:E??q.defaultError}:{message:g??q.defaultError},description:L}}class u{constructor(l){this.spa=this.safeParseAsync,this._def=l,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(l){return(0,a.getParsedType)(l.data)}_getOrReturnCtx(l,g){return g||{common:l.parent.common,data:l.data,parsedType:(0,a.getParsedType)(l.data),schemaErrorMap:this._def.errorMap,path:l.path,parent:l.parent}}_processInputParams(l){return{status:new r.ParseStatus,ctx:{common:l.parent.common,data:l.data,parsedType:(0,a.getParsedType)(l.data),schemaErrorMap:this._def.errorMap,path:l.path,parent:l.parent}}}_parseSync(l){const g=this._parse(l);if((0,r.isAsync)(g))throw new Error("Synchronous parse encountered promise.");return g}_parseAsync(l){const g=this._parse(l);return Promise.resolve(g)}parse(l,g){const E=this.safeParse(l,g);if(E.success)return E.data;throw E.error}safeParse(l,g){var E;const L={common:{issues:[],async:(E=g==null?void 0:g.async)!==null&&E!==void 0?E:!1,contextualErrorMap:g==null?void 0:g.errorMap},path:(g==null?void 0:g.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:l,parsedType:(0,a.getParsedType)(l)},N=this._parseSync({data:l,path:L.path,parent:L});return o(L,N)}async parseAsync(l,g){const E=await this.safeParseAsync(l,g);if(E.success)return E.data;throw E.error}async safeParseAsync(l,g){const E={common:{issues:[],contextualErrorMap:g==null?void 0:g.errorMap,async:!0},path:(g==null?void 0:g.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:l,parsedType:(0,a.getParsedType)(l)},L=this._parse({data:l,path:E.path,parent:E}),N=await((0,r.isAsync)(L)?L:Promise.resolve(L));return o(E,N)}refine(l,g){const E=L=>typeof g=="string"||typeof g>"u"?{message:g}:typeof g=="function"?g(L):g;return this._refinement((L,N)=>{const X=l(L),q=()=>N.addIssue({code:i.ZodIssueCode.custom,...E(L)});return typeof Promise<"u"&&X instanceof Promise?X.then(ie=>ie?!0:(q(),!1)):X?!0:(q(),!1)})}refinement(l,g){return this._refinement((E,L)=>l(E)?!0:(L.addIssue(typeof g=="function"?g(E,L):g),!1))}_refinement(l){return new ue({schema:this,typeName:ae.ZodEffects,effect:{type:"refinement",refinement:l}})}superRefine(l){return this._refinement(l)}optional(){return me.create(this,this._def)}nullable(){return ye.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return te.create(this,this._def)}promise(){return se.create(this,this._def)}or(l){return Q.create([this,l],this._def)}and(l){return K.create(this,l,this._def)}transform(l){return new ue({...c(this._def),schema:this,typeName:ae.ZodEffects,effect:{type:"transform",transform:l}})}default(l){const g=typeof l=="function"?l:()=>l;return new ve({...c(this._def),innerType:this,defaultValue:g,typeName:ae.ZodDefault})}brand(){return new de({typeName:ae.ZodBranded,type:this,...c(this._def)})}catch(l){const g=typeof l=="function"?l:()=>l;return new ge({...c(this._def),innerType:this,catchValue:g,typeName:ae.ZodCatch})}describe(l){const g=this.constructor;return new g({...this._def,description:l})}pipe(l){return xe.create(this,l)}readonly(){return He.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}n.ZodType=u,n.Schema=u,n.ZodSchema=u;const d=/^c[^\s-]{8,}$/i,y=/^[a-z][a-z0-9]*$/,f=/[0-9A-HJKMNP-TV-Z]{26}/,v=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,p=/^([A-Z0-9_+-]+\.?)*[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,P=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,m=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,T=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,_=j=>j.precision?j.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${j.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${j.precision}}Z$`):j.precision===0?j.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):j.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function w(j,l){return!!((l==="v4"||!l)&&m.test(j)||(l==="v6"||!l)&&T.test(j))}class C extends u{constructor(){super(...arguments),this._regex=(l,g,E)=>this.refinement(L=>l.test(L),{validation:g,code:i.ZodIssueCode.invalid_string,...t.errorUtil.errToObj(E)}),this.nonempty=l=>this.min(1,t.errorUtil.errToObj(l)),this.trim=()=>new C({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new C({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new C({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(l){if(this._def.coerce&&(l.data=String(l.data)),this._getType(l)!==a.ZodParsedType.string){const N=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(N,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.string,received:N.parsedType}),r.INVALID}const E=new r.ParseStatus;let L;for(const N of this._def.checks)if(N.kind==="min")l.data.length<N.value&&(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.too_small,minimum:N.value,type:"string",inclusive:!0,exact:!1,message:N.message}),E.dirty());else if(N.kind==="max")l.data.length>N.value&&(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.too_big,maximum:N.value,type:"string",inclusive:!0,exact:!1,message:N.message}),E.dirty());else if(N.kind==="length"){const X=l.data.length>N.value,q=l.data.length<N.value;(X||q)&&(L=this._getOrReturnCtx(l,L),X?(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.too_big,maximum:N.value,type:"string",inclusive:!0,exact:!0,message:N.message}):q&&(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.too_small,minimum:N.value,type:"string",inclusive:!0,exact:!0,message:N.message}),E.dirty())}else if(N.kind==="email")p.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"email",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty());else if(N.kind==="emoji")P.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"emoji",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty());else if(N.kind==="uuid")v.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"uuid",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty());else if(N.kind==="cuid")d.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"cuid",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty());else if(N.kind==="cuid2")y.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"cuid2",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty());else if(N.kind==="ulid")f.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"ulid",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty());else if(N.kind==="url")try{new URL(l.data)}catch{L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"url",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty()}else N.kind==="regex"?(N.regex.lastIndex=0,N.regex.test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"regex",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty())):N.kind==="trim"?l.data=l.data.trim():N.kind==="includes"?l.data.includes(N.value,N.position)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.invalid_string,validation:{includes:N.value,position:N.position},message:N.message}),E.dirty()):N.kind==="toLowerCase"?l.data=l.data.toLowerCase():N.kind==="toUpperCase"?l.data=l.data.toUpperCase():N.kind==="startsWith"?l.data.startsWith(N.value)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.invalid_string,validation:{startsWith:N.value},message:N.message}),E.dirty()):N.kind==="endsWith"?l.data.endsWith(N.value)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.invalid_string,validation:{endsWith:N.value},message:N.message}),E.dirty()):N.kind==="datetime"?_(N).test(l.data)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.invalid_string,validation:"datetime",message:N.message}),E.dirty()):N.kind==="ip"?w(l.data,N.version)||(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{validation:"ip",code:i.ZodIssueCode.invalid_string,message:N.message}),E.dirty()):a.util.assertNever(N);return{status:E.value,value:l.data}}_addCheck(l){return new C({...this._def,checks:[...this._def.checks,l]})}email(l){return this._addCheck({kind:"email",...t.errorUtil.errToObj(l)})}url(l){return this._addCheck({kind:"url",...t.errorUtil.errToObj(l)})}emoji(l){return this._addCheck({kind:"emoji",...t.errorUtil.errToObj(l)})}uuid(l){return this._addCheck({kind:"uuid",...t.errorUtil.errToObj(l)})}cuid(l){return this._addCheck({kind:"cuid",...t.errorUtil.errToObj(l)})}cuid2(l){return this._addCheck({kind:"cuid2",...t.errorUtil.errToObj(l)})}ulid(l){return this._addCheck({kind:"ulid",...t.errorUtil.errToObj(l)})}ip(l){return this._addCheck({kind:"ip",...t.errorUtil.errToObj(l)})}datetime(l){var g;return typeof l=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:l}):this._addCheck({kind:"datetime",precision:typeof(l==null?void 0:l.precision)>"u"?null:l==null?void 0:l.precision,offset:(g=l==null?void 0:l.offset)!==null&&g!==void 0?g:!1,...t.errorUtil.errToObj(l==null?void 0:l.message)})}regex(l,g){return this._addCheck({kind:"regex",regex:l,...t.errorUtil.errToObj(g)})}includes(l,g){return this._addCheck({kind:"includes",value:l,position:g==null?void 0:g.position,...t.errorUtil.errToObj(g==null?void 0:g.message)})}startsWith(l,g){return this._addCheck({kind:"startsWith",value:l,...t.errorUtil.errToObj(g)})}endsWith(l,g){return this._addCheck({kind:"endsWith",value:l,...t.errorUtil.errToObj(g)})}min(l,g){return this._addCheck({kind:"min",value:l,...t.errorUtil.errToObj(g)})}max(l,g){return this._addCheck({kind:"max",value:l,...t.errorUtil.errToObj(g)})}length(l,g){return this._addCheck({kind:"length",value:l,...t.errorUtil.errToObj(g)})}get isDatetime(){return!!this._def.checks.find(l=>l.kind==="datetime")}get isEmail(){return!!this._def.checks.find(l=>l.kind==="email")}get isURL(){return!!this._def.checks.find(l=>l.kind==="url")}get isEmoji(){return!!this._def.checks.find(l=>l.kind==="emoji")}get isUUID(){return!!this._def.checks.find(l=>l.kind==="uuid")}get isCUID(){return!!this._def.checks.find(l=>l.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(l=>l.kind==="cuid2")}get isULID(){return!!this._def.checks.find(l=>l.kind==="ulid")}get isIP(){return!!this._def.checks.find(l=>l.kind==="ip")}get minLength(){let l=null;for(const g of this._def.checks)g.kind==="min"&&(l===null||g.value>l)&&(l=g.value);return l}get maxLength(){let l=null;for(const g of this._def.checks)g.kind==="max"&&(l===null||g.value<l)&&(l=g.value);return l}}n.ZodString=C,C.create=j=>{var l;return new C({checks:[],typeName:ae.ZodString,coerce:(l=j==null?void 0:j.coerce)!==null&&l!==void 0?l:!1,...c(j)})};function D(j,l){const g=(j.toString().split(".")[1]||"").length,E=(l.toString().split(".")[1]||"").length,L=g>E?g:E,N=parseInt(j.toFixed(L).replace(".","")),X=parseInt(l.toFixed(L).replace(".",""));return N%X/Math.pow(10,L)}class A extends u{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(l){if(this._def.coerce&&(l.data=Number(l.data)),this._getType(l)!==a.ZodParsedType.number){const N=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(N,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.number,received:N.parsedType}),r.INVALID}let E;const L=new r.ParseStatus;for(const N of this._def.checks)N.kind==="int"?a.util.isInteger(l.data)||(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:N.message}),L.dirty()):N.kind==="min"?(N.inclusive?l.data<N.value:l.data<=N.value)&&(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_small,minimum:N.value,type:"number",inclusive:N.inclusive,exact:!1,message:N.message}),L.dirty()):N.kind==="max"?(N.inclusive?l.data>N.value:l.data>=N.value)&&(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_big,maximum:N.value,type:"number",inclusive:N.inclusive,exact:!1,message:N.message}),L.dirty()):N.kind==="multipleOf"?D(l.data,N.value)!==0&&(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.not_multiple_of,multipleOf:N.value,message:N.message}),L.dirty()):N.kind==="finite"?Number.isFinite(l.data)||(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.not_finite,message:N.message}),L.dirty()):a.util.assertNever(N);return{status:L.value,value:l.data}}gte(l,g){return this.setLimit("min",l,!0,t.errorUtil.toString(g))}gt(l,g){return this.setLimit("min",l,!1,t.errorUtil.toString(g))}lte(l,g){return this.setLimit("max",l,!0,t.errorUtil.toString(g))}lt(l,g){return this.setLimit("max",l,!1,t.errorUtil.toString(g))}setLimit(l,g,E,L){return new A({...this._def,checks:[...this._def.checks,{kind:l,value:g,inclusive:E,message:t.errorUtil.toString(L)}]})}_addCheck(l){return new A({...this._def,checks:[...this._def.checks,l]})}int(l){return this._addCheck({kind:"int",message:t.errorUtil.toString(l)})}positive(l){return this._addCheck({kind:"min",value:0,inclusive:!1,message:t.errorUtil.toString(l)})}negative(l){return this._addCheck({kind:"max",value:0,inclusive:!1,message:t.errorUtil.toString(l)})}nonpositive(l){return this._addCheck({kind:"max",value:0,inclusive:!0,message:t.errorUtil.toString(l)})}nonnegative(l){return this._addCheck({kind:"min",value:0,inclusive:!0,message:t.errorUtil.toString(l)})}multipleOf(l,g){return this._addCheck({kind:"multipleOf",value:l,message:t.errorUtil.toString(g)})}finite(l){return this._addCheck({kind:"finite",message:t.errorUtil.toString(l)})}safe(l){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:t.errorUtil.toString(l)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:t.errorUtil.toString(l)})}get minValue(){let l=null;for(const g of this._def.checks)g.kind==="min"&&(l===null||g.value>l)&&(l=g.value);return l}get maxValue(){let l=null;for(const g of this._def.checks)g.kind==="max"&&(l===null||g.value<l)&&(l=g.value);return l}get isInt(){return!!this._def.checks.find(l=>l.kind==="int"||l.kind==="multipleOf"&&a.util.isInteger(l.value))}get isFinite(){let l=null,g=null;for(const E of this._def.checks){if(E.kind==="finite"||E.kind==="int"||E.kind==="multipleOf")return!0;E.kind==="min"?(g===null||E.value>g)&&(g=E.value):E.kind==="max"&&(l===null||E.value<l)&&(l=E.value)}return Number.isFinite(g)&&Number.isFinite(l)}}n.ZodNumber=A,A.create=j=>new A({checks:[],typeName:ae.ZodNumber,coerce:(j==null?void 0:j.coerce)||!1,...c(j)});class k extends u{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(l){if(this._def.coerce&&(l.data=BigInt(l.data)),this._getType(l)!==a.ZodParsedType.bigint){const N=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(N,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.bigint,received:N.parsedType}),r.INVALID}let E;const L=new r.ParseStatus;for(const N of this._def.checks)N.kind==="min"?(N.inclusive?l.data<N.value:l.data<=N.value)&&(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_small,type:"bigint",minimum:N.value,inclusive:N.inclusive,message:N.message}),L.dirty()):N.kind==="max"?(N.inclusive?l.data>N.value:l.data>=N.value)&&(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_big,type:"bigint",maximum:N.value,inclusive:N.inclusive,message:N.message}),L.dirty()):N.kind==="multipleOf"?l.data%N.value!==BigInt(0)&&(E=this._getOrReturnCtx(l,E),(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.not_multiple_of,multipleOf:N.value,message:N.message}),L.dirty()):a.util.assertNever(N);return{status:L.value,value:l.data}}gte(l,g){return this.setLimit("min",l,!0,t.errorUtil.toString(g))}gt(l,g){return this.setLimit("min",l,!1,t.errorUtil.toString(g))}lte(l,g){return this.setLimit("max",l,!0,t.errorUtil.toString(g))}lt(l,g){return this.setLimit("max",l,!1,t.errorUtil.toString(g))}setLimit(l,g,E,L){return new k({...this._def,checks:[...this._def.checks,{kind:l,value:g,inclusive:E,message:t.errorUtil.toString(L)}]})}_addCheck(l){return new k({...this._def,checks:[...this._def.checks,l]})}positive(l){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:t.errorUtil.toString(l)})}negative(l){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:t.errorUtil.toString(l)})}nonpositive(l){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:t.errorUtil.toString(l)})}nonnegative(l){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:t.errorUtil.toString(l)})}multipleOf(l,g){return this._addCheck({kind:"multipleOf",value:l,message:t.errorUtil.toString(g)})}get minValue(){let l=null;for(const g of this._def.checks)g.kind==="min"&&(l===null||g.value>l)&&(l=g.value);return l}get maxValue(){let l=null;for(const g of this._def.checks)g.kind==="max"&&(l===null||g.value<l)&&(l=g.value);return l}}n.ZodBigInt=k,k.create=j=>{var l;return new k({checks:[],typeName:ae.ZodBigInt,coerce:(l=j==null?void 0:j.coerce)!==null&&l!==void 0?l:!1,...c(j)})};class b extends u{_parse(l){if(this._def.coerce&&(l.data=!!l.data),this._getType(l)!==a.ZodParsedType.boolean){const E=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.boolean,received:E.parsedType}),r.INVALID}return(0,r.OK)(l.data)}}n.ZodBoolean=b,b.create=j=>new b({typeName:ae.ZodBoolean,coerce:(j==null?void 0:j.coerce)||!1,...c(j)});class I extends u{_parse(l){if(this._def.coerce&&(l.data=new Date(l.data)),this._getType(l)!==a.ZodParsedType.date){const N=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(N,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.date,received:N.parsedType}),r.INVALID}if(isNaN(l.data.getTime())){const N=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(N,{code:i.ZodIssueCode.invalid_date}),r.INVALID}const E=new r.ParseStatus;let L;for(const N of this._def.checks)N.kind==="min"?l.data.getTime()<N.value&&(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.too_small,message:N.message,inclusive:!0,exact:!1,minimum:N.value,type:"date"}),E.dirty()):N.kind==="max"?l.data.getTime()>N.value&&(L=this._getOrReturnCtx(l,L),(0,r.addIssueToContext)(L,{code:i.ZodIssueCode.too_big,message:N.message,inclusive:!0,exact:!1,maximum:N.value,type:"date"}),E.dirty()):a.util.assertNever(N);return{status:E.value,value:new Date(l.data.getTime())}}_addCheck(l){return new I({...this._def,checks:[...this._def.checks,l]})}min(l,g){return this._addCheck({kind:"min",value:l.getTime(),message:t.errorUtil.toString(g)})}max(l,g){return this._addCheck({kind:"max",value:l.getTime(),message:t.errorUtil.toString(g)})}get minDate(){let l=null;for(const g of this._def.checks)g.kind==="min"&&(l===null||g.value>l)&&(l=g.value);return l!=null?new Date(l):null}get maxDate(){let l=null;for(const g of this._def.checks)g.kind==="max"&&(l===null||g.value<l)&&(l=g.value);return l!=null?new Date(l):null}}n.ZodDate=I,I.create=j=>new I({checks:[],coerce:(j==null?void 0:j.coerce)||!1,typeName:ae.ZodDate,...c(j)});class h extends u{_parse(l){if(this._getType(l)!==a.ZodParsedType.symbol){const E=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.symbol,received:E.parsedType}),r.INVALID}return(0,r.OK)(l.data)}}n.ZodSymbol=h,h.create=j=>new h({typeName:ae.ZodSymbol,...c(j)});class O extends u{_parse(l){if(this._getType(l)!==a.ZodParsedType.undefined){const E=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.undefined,received:E.parsedType}),r.INVALID}return(0,r.OK)(l.data)}}n.ZodUndefined=O,O.create=j=>new O({typeName:ae.ZodUndefined,...c(j)});class R extends u{_parse(l){if(this._getType(l)!==a.ZodParsedType.null){const E=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.null,received:E.parsedType}),r.INVALID}return(0,r.OK)(l.data)}}n.ZodNull=R,R.create=j=>new R({typeName:ae.ZodNull,...c(j)});class z extends u{constructor(){super(...arguments),this._any=!0}_parse(l){return(0,r.OK)(l.data)}}n.ZodAny=z,z.create=j=>new z({typeName:ae.ZodAny,...c(j)});class Z extends u{constructor(){super(...arguments),this._unknown=!0}_parse(l){return(0,r.OK)(l.data)}}n.ZodUnknown=Z,Z.create=j=>new Z({typeName:ae.ZodUnknown,...c(j)});class Y extends u{_parse(l){const g=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.never,received:g.parsedType}),r.INVALID}}n.ZodNever=Y,Y.create=j=>new Y({typeName:ae.ZodNever,...c(j)});class H extends u{_parse(l){if(this._getType(l)!==a.ZodParsedType.undefined){const E=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.void,received:E.parsedType}),r.INVALID}return(0,r.OK)(l.data)}}n.ZodVoid=H,H.create=j=>new H({typeName:ae.ZodVoid,...c(j)});class te extends u{_parse(l){const{ctx:g,status:E}=this._processInputParams(l),L=this._def;if(g.parsedType!==a.ZodParsedType.array)return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.array,received:g.parsedType}),r.INVALID;if(L.exactLength!==null){const X=g.data.length>L.exactLength.value,q=g.data.length<L.exactLength.value;(X||q)&&((0,r.addIssueToContext)(g,{code:X?i.ZodIssueCode.too_big:i.ZodIssueCode.too_small,minimum:q?L.exactLength.value:void 0,maximum:X?L.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:L.exactLength.message}),E.dirty())}if(L.minLength!==null&&g.data.length<L.minLength.value&&((0,r.addIssueToContext)(g,{code:i.ZodIssueCode.too_small,minimum:L.minLength.value,type:"array",inclusive:!0,exact:!1,message:L.minLength.message}),E.dirty()),L.maxLength!==null&&g.data.length>L.maxLength.value&&((0,r.addIssueToContext)(g,{code:i.ZodIssueCode.too_big,maximum:L.maxLength.value,type:"array",inclusive:!0,exact:!1,message:L.maxLength.message}),E.dirty()),g.common.async)return Promise.all([...g.data].map((X,q)=>L.type._parseAsync(new s(g,X,g.path,q)))).then(X=>r.ParseStatus.mergeArray(E,X));const N=[...g.data].map((X,q)=>L.type._parseSync(new s(g,X,g.path,q)));return r.ParseStatus.mergeArray(E,N)}get element(){return this._def.type}min(l,g){return new te({...this._def,minLength:{value:l,message:t.errorUtil.toString(g)}})}max(l,g){return new te({...this._def,maxLength:{value:l,message:t.errorUtil.toString(g)}})}length(l,g){return new te({...this._def,exactLength:{value:l,message:t.errorUtil.toString(g)}})}nonempty(l){return this.min(1,l)}}n.ZodArray=te,te.create=(j,l)=>new te({type:j,minLength:null,maxLength:null,exactLength:null,typeName:ae.ZodArray,...c(l)});function ne(j){if(j instanceof M){const l={};for(const g in j.shape){const E=j.shape[g];l[g]=me.create(ne(E))}return new M({...j._def,shape:()=>l})}else return j instanceof te?new te({...j._def,type:ne(j.element)}):j instanceof me?me.create(ne(j.unwrap())):j instanceof ye?ye.create(ne(j.unwrap())):j instanceof oe?oe.create(j.items.map(l=>ne(l))):j}class M extends u{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const l=this._def.shape(),g=a.util.objectKeys(l);return this._cached={shape:l,keys:g}}_parse(l){if(this._getType(l)!==a.ZodParsedType.object){const re=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(re,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.object,received:re.parsedType}),r.INVALID}const{status:E,ctx:L}=this._processInputParams(l),{shape:N,keys:X}=this._getCached(),q=[];if(!(this._def.catchall instanceof Y&&this._def.unknownKeys==="strip"))for(const re in L.data)X.includes(re)||q.push(re);const ie=[];for(const re of X){const fe=N[re],We=L.data[re];ie.push({key:{status:"valid",value:re},value:fe._parse(new s(L,We,L.path,re)),alwaysSet:re in L.data})}if(this._def.catchall instanceof Y){const re=this._def.unknownKeys;if(re==="passthrough")for(const fe of q)ie.push({key:{status:"valid",value:fe},value:{status:"valid",value:L.data[fe]}});else if(re==="strict")q.length>0&&((0,r.addIssueToContext)(L,{code:i.ZodIssueCode.unrecognized_keys,keys:q}),E.dirty());else if(re!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const re=this._def.catchall;for(const fe of q){const We=L.data[fe];ie.push({key:{status:"valid",value:fe},value:re._parse(new s(L,We,L.path,fe)),alwaysSet:fe in L.data})}}return L.common.async?Promise.resolve().then(async()=>{const re=[];for(const fe of ie){const We=await fe.key;re.push({key:We,value:await fe.value,alwaysSet:fe.alwaysSet})}return re}).then(re=>r.ParseStatus.mergeObjectSync(E,re)):r.ParseStatus.mergeObjectSync(E,ie)}get shape(){return this._def.shape()}strict(l){return t.errorUtil.errToObj,new M({...this._def,unknownKeys:"strict",...l!==void 0?{errorMap:(g,E)=>{var L,N,X,q;const ie=(X=(N=(L=this._def).errorMap)===null||N===void 0?void 0:N.call(L,g,E).message)!==null&&X!==void 0?X:E.defaultError;return g.code==="unrecognized_keys"?{message:(q=t.errorUtil.errToObj(l).message)!==null&&q!==void 0?q:ie}:{message:ie}}}:{}})}strip(){return new M({...this._def,unknownKeys:"strip"})}passthrough(){return new M({...this._def,unknownKeys:"passthrough"})}extend(l){return new M({...this._def,shape:()=>({...this._def.shape(),...l})})}merge(l){return new M({unknownKeys:l._def.unknownKeys,catchall:l._def.catchall,shape:()=>({...this._def.shape(),...l._def.shape()}),typeName:ae.ZodObject})}setKey(l,g){return this.augment({[l]:g})}catchall(l){return new M({...this._def,catchall:l})}pick(l){const g={};return a.util.objectKeys(l).forEach(E=>{l[E]&&this.shape[E]&&(g[E]=this.shape[E])}),new M({...this._def,shape:()=>g})}omit(l){const g={};return a.util.objectKeys(this.shape).forEach(E=>{l[E]||(g[E]=this.shape[E])}),new M({...this._def,shape:()=>g})}deepPartial(){return ne(this)}partial(l){const g={};return a.util.objectKeys(this.shape).forEach(E=>{const L=this.shape[E];l&&!l[E]?g[E]=L:g[E]=L.optional()}),new M({...this._def,shape:()=>g})}required(l){const g={};return a.util.objectKeys(this.shape).forEach(E=>{if(l&&!l[E])g[E]=this.shape[E];else{let N=this.shape[E];for(;N instanceof me;)N=N._def.innerType;g[E]=N}}),new M({...this._def,shape:()=>g})}keyof(){return G(a.util.objectKeys(this.shape))}}n.ZodObject=M,M.create=(j,l)=>new M({shape:()=>j,unknownKeys:"strip",catchall:Y.create(),typeName:ae.ZodObject,...c(l)}),M.strictCreate=(j,l)=>new M({shape:()=>j,unknownKeys:"strict",catchall:Y.create(),typeName:ae.ZodObject,...c(l)}),M.lazycreate=(j,l)=>new M({shape:j,unknownKeys:"strip",catchall:Y.create(),typeName:ae.ZodObject,...c(l)});class Q extends u{_parse(l){const{ctx:g}=this._processInputParams(l),E=this._def.options;function L(N){for(const q of N)if(q.result.status==="valid")return q.result;for(const q of N)if(q.result.status==="dirty")return g.common.issues.push(...q.ctx.common.issues),q.result;const X=N.map(q=>new i.ZodError(q.ctx.common.issues));return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_union,unionErrors:X}),r.INVALID}if(g.common.async)return Promise.all(E.map(async N=>{const X={...g,common:{...g.common,issues:[]},parent:null};return{result:await N._parseAsync({data:g.data,path:g.path,parent:X}),ctx:X}})).then(L);{let N;const X=[];for(const ie of E){const re={...g,common:{...g.common,issues:[]},parent:null},fe=ie._parseSync({data:g.data,path:g.path,parent:re});if(fe.status==="valid")return fe;fe.status==="dirty"&&!N&&(N={result:fe,ctx:re}),re.common.issues.length&&X.push(re.common.issues)}if(N)return g.common.issues.push(...N.ctx.common.issues),N.result;const q=X.map(ie=>new i.ZodError(ie));return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_union,unionErrors:q}),r.INVALID}}get options(){return this._def.options}}n.ZodUnion=Q,Q.create=(j,l)=>new Q({options:j,typeName:ae.ZodUnion,...c(l)});const $=j=>j instanceof S?$(j.schema):j instanceof ue?$(j.innerType()):j instanceof B?[j.value]:j instanceof V?j.options:j instanceof J?Object.keys(j.enum):j instanceof ve?$(j._def.innerType):j instanceof O?[void 0]:j instanceof R?[null]:null;class F extends u{_parse(l){const{ctx:g}=this._processInputParams(l);if(g.parsedType!==a.ZodParsedType.object)return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.object,received:g.parsedType}),r.INVALID;const E=this.discriminator,L=g.data[E],N=this.optionsMap.get(L);return N?g.common.async?N._parseAsync({data:g.data,path:g.path,parent:g}):N._parseSync({data:g.data,path:g.path,parent:g}):((0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[E]}),r.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(l,g,E){const L=new Map;for(const N of g){const X=$(N.shape[l]);if(!X)throw new Error(`A discriminator value for key \`${l}\` could not be extracted from all schema options`);for(const q of X){if(L.has(q))throw new Error(`Discriminator property ${String(l)} has duplicate value ${String(q)}`);L.set(q,N)}}return new F({typeName:ae.ZodDiscriminatedUnion,discriminator:l,options:g,optionsMap:L,...c(E)})}}n.ZodDiscriminatedUnion=F;function W(j,l){const g=(0,a.getParsedType)(j),E=(0,a.getParsedType)(l);if(j===l)return{valid:!0,data:j};if(g===a.ZodParsedType.object&&E===a.ZodParsedType.object){const L=a.util.objectKeys(l),N=a.util.objectKeys(j).filter(q=>L.indexOf(q)!==-1),X={...j,...l};for(const q of N){const ie=W(j[q],l[q]);if(!ie.valid)return{valid:!1};X[q]=ie.data}return{valid:!0,data:X}}else if(g===a.ZodParsedType.array&&E===a.ZodParsedType.array){if(j.length!==l.length)return{valid:!1};const L=[];for(let N=0;N<j.length;N++){const X=j[N],q=l[N],ie=W(X,q);if(!ie.valid)return{valid:!1};L.push(ie.data)}return{valid:!0,data:L}}else return g===a.ZodParsedType.date&&E===a.ZodParsedType.date&&+j==+l?{valid:!0,data:j}:{valid:!1}}class K extends u{_parse(l){const{status:g,ctx:E}=this._processInputParams(l),L=(N,X)=>{if((0,r.isAborted)(N)||(0,r.isAborted)(X))return r.INVALID;const q=W(N.value,X.value);return q.valid?(((0,r.isDirty)(N)||(0,r.isDirty)(X))&&g.dirty(),{status:g.value,value:q.data}):((0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_intersection_types}),r.INVALID)};return E.common.async?Promise.all([this._def.left._parseAsync({data:E.data,path:E.path,parent:E}),this._def.right._parseAsync({data:E.data,path:E.path,parent:E})]).then(([N,X])=>L(N,X)):L(this._def.left._parseSync({data:E.data,path:E.path,parent:E}),this._def.right._parseSync({data:E.data,path:E.path,parent:E}))}}n.ZodIntersection=K,K.create=(j,l,g)=>new K({left:j,right:l,typeName:ae.ZodIntersection,...c(g)});class oe extends u{_parse(l){const{status:g,ctx:E}=this._processInputParams(l);if(E.parsedType!==a.ZodParsedType.array)return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.array,received:E.parsedType}),r.INVALID;if(E.data.length<this._def.items.length)return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.INVALID;!this._def.rest&&E.data.length>this._def.items.length&&((0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g.dirty());const N=[...E.data].map((X,q)=>{const ie=this._def.items[q]||this._def.rest;return ie?ie._parse(new s(E,X,E.path,q)):null}).filter(X=>!!X);return E.common.async?Promise.all(N).then(X=>r.ParseStatus.mergeArray(g,X)):r.ParseStatus.mergeArray(g,N)}get items(){return this._def.items}rest(l){return new oe({...this._def,rest:l})}}n.ZodTuple=oe,oe.create=(j,l)=>{if(!Array.isArray(j))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new oe({items:j,typeName:ae.ZodTuple,rest:null,...c(l)})};class le extends u{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(l){const{status:g,ctx:E}=this._processInputParams(l);if(E.parsedType!==a.ZodParsedType.object)return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.object,received:E.parsedType}),r.INVALID;const L=[],N=this._def.keyType,X=this._def.valueType;for(const q in E.data)L.push({key:N._parse(new s(E,q,E.path,q)),value:X._parse(new s(E,E.data[q],E.path,q))});return E.common.async?r.ParseStatus.mergeObjectAsync(g,L):r.ParseStatus.mergeObjectSync(g,L)}get element(){return this._def.valueType}static create(l,g,E){return g instanceof u?new le({keyType:l,valueType:g,typeName:ae.ZodRecord,...c(E)}):new le({keyType:C.create(),valueType:l,typeName:ae.ZodRecord,...c(g)})}}n.ZodRecord=le;class we extends u{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(l){const{status:g,ctx:E}=this._processInputParams(l);if(E.parsedType!==a.ZodParsedType.map)return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.map,received:E.parsedType}),r.INVALID;const L=this._def.keyType,N=this._def.valueType,X=[...E.data.entries()].map(([q,ie],re)=>({key:L._parse(new s(E,q,E.path,[re,"key"])),value:N._parse(new s(E,ie,E.path,[re,"value"]))}));if(E.common.async){const q=new Map;return Promise.resolve().then(async()=>{for(const ie of X){const re=await ie.key,fe=await ie.value;if(re.status==="aborted"||fe.status==="aborted")return r.INVALID;(re.status==="dirty"||fe.status==="dirty")&&g.dirty(),q.set(re.value,fe.value)}return{status:g.value,value:q}})}else{const q=new Map;for(const ie of X){const re=ie.key,fe=ie.value;if(re.status==="aborted"||fe.status==="aborted")return r.INVALID;(re.status==="dirty"||fe.status==="dirty")&&g.dirty(),q.set(re.value,fe.value)}return{status:g.value,value:q}}}}n.ZodMap=we,we.create=(j,l,g)=>new we({valueType:l,keyType:j,typeName:ae.ZodMap,...c(g)});class U extends u{_parse(l){const{status:g,ctx:E}=this._processInputParams(l);if(E.parsedType!==a.ZodParsedType.set)return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.set,received:E.parsedType}),r.INVALID;const L=this._def;L.minSize!==null&&E.data.size<L.minSize.value&&((0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_small,minimum:L.minSize.value,type:"set",inclusive:!0,exact:!1,message:L.minSize.message}),g.dirty()),L.maxSize!==null&&E.data.size>L.maxSize.value&&((0,r.addIssueToContext)(E,{code:i.ZodIssueCode.too_big,maximum:L.maxSize.value,type:"set",inclusive:!0,exact:!1,message:L.maxSize.message}),g.dirty());const N=this._def.valueType;function X(ie){const re=new Set;for(const fe of ie){if(fe.status==="aborted")return r.INVALID;fe.status==="dirty"&&g.dirty(),re.add(fe.value)}return{status:g.value,value:re}}const q=[...E.data.values()].map((ie,re)=>N._parse(new s(E,ie,E.path,re)));return E.common.async?Promise.all(q).then(ie=>X(ie)):X(q)}min(l,g){return new U({...this._def,minSize:{value:l,message:t.errorUtil.toString(g)}})}max(l,g){return new U({...this._def,maxSize:{value:l,message:t.errorUtil.toString(g)}})}size(l,g){return this.min(l,g).max(l,g)}nonempty(l){return this.min(1,l)}}n.ZodSet=U,U.create=(j,l)=>new U({valueType:j,minSize:null,maxSize:null,typeName:ae.ZodSet,...c(l)});class x extends u{constructor(){super(...arguments),this.validate=this.implement}_parse(l){const{ctx:g}=this._processInputParams(l);if(g.parsedType!==a.ZodParsedType.function)return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.function,received:g.parsedType}),r.INVALID;function E(q,ie){return(0,r.makeIssue)({data:q,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,(0,e.getErrorMap)(),e.defaultErrorMap].filter(re=>!!re),issueData:{code:i.ZodIssueCode.invalid_arguments,argumentsError:ie}})}function L(q,ie){return(0,r.makeIssue)({data:q,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,(0,e.getErrorMap)(),e.defaultErrorMap].filter(re=>!!re),issueData:{code:i.ZodIssueCode.invalid_return_type,returnTypeError:ie}})}const N={errorMap:g.common.contextualErrorMap},X=g.data;if(this._def.returns instanceof se){const q=this;return(0,r.OK)(async function(...ie){const re=new i.ZodError([]),fe=await q._def.args.parseAsync(ie,N).catch(ps=>{throw re.addIssue(E(ie,ps)),re}),We=await Reflect.apply(X,this,fe);return await q._def.returns._def.type.parseAsync(We,N).catch(ps=>{throw re.addIssue(L(We,ps)),re})})}else{const q=this;return(0,r.OK)(function(...ie){const re=q._def.args.safeParse(ie,N);if(!re.success)throw new i.ZodError([E(ie,re.error)]);const fe=Reflect.apply(X,this,re.data),We=q._def.returns.safeParse(fe,N);if(!We.success)throw new i.ZodError([L(fe,We.error)]);return We.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...l){return new x({...this._def,args:oe.create(l).rest(Z.create())})}returns(l){return new x({...this._def,returns:l})}implement(l){return this.parse(l)}strictImplement(l){return this.parse(l)}static create(l,g,E){return new x({args:l||oe.create([]).rest(Z.create()),returns:g||Z.create(),typeName:ae.ZodFunction,...c(E)})}}n.ZodFunction=x;class S extends u{get schema(){return this._def.getter()}_parse(l){const{ctx:g}=this._processInputParams(l);return this._def.getter()._parse({data:g.data,path:g.path,parent:g})}}n.ZodLazy=S,S.create=(j,l)=>new S({getter:j,typeName:ae.ZodLazy,...c(l)});class B extends u{_parse(l){if(l.data!==this._def.value){const g=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(g,{received:g.data,code:i.ZodIssueCode.invalid_literal,expected:this._def.value}),r.INVALID}return{status:"valid",value:l.data}}get value(){return this._def.value}}n.ZodLiteral=B,B.create=(j,l)=>new B({value:j,typeName:ae.ZodLiteral,...c(l)});function G(j,l){return new V({values:j,typeName:ae.ZodEnum,...c(l)})}class V extends u{_parse(l){if(typeof l.data!="string"){const g=this._getOrReturnCtx(l),E=this._def.values;return(0,r.addIssueToContext)(g,{expected:a.util.joinValues(E),received:g.parsedType,code:i.ZodIssueCode.invalid_type}),r.INVALID}if(this._def.values.indexOf(l.data)===-1){const g=this._getOrReturnCtx(l),E=this._def.values;return(0,r.addIssueToContext)(g,{received:g.data,code:i.ZodIssueCode.invalid_enum_value,options:E}),r.INVALID}return(0,r.OK)(l.data)}get options(){return this._def.values}get enum(){const l={};for(const g of this._def.values)l[g]=g;return l}get Values(){const l={};for(const g of this._def.values)l[g]=g;return l}get Enum(){const l={};for(const g of this._def.values)l[g]=g;return l}extract(l){return V.create(l)}exclude(l){return V.create(this.options.filter(g=>!l.includes(g)))}}n.ZodEnum=V,V.create=G;class J extends u{_parse(l){const g=a.util.getValidEnumValues(this._def.values),E=this._getOrReturnCtx(l);if(E.parsedType!==a.ZodParsedType.string&&E.parsedType!==a.ZodParsedType.number){const L=a.util.objectValues(g);return(0,r.addIssueToContext)(E,{expected:a.util.joinValues(L),received:E.parsedType,code:i.ZodIssueCode.invalid_type}),r.INVALID}if(g.indexOf(l.data)===-1){const L=a.util.objectValues(g);return(0,r.addIssueToContext)(E,{received:E.data,code:i.ZodIssueCode.invalid_enum_value,options:L}),r.INVALID}return(0,r.OK)(l.data)}get enum(){return this._def.values}}n.ZodNativeEnum=J,J.create=(j,l)=>new J({values:j,typeName:ae.ZodNativeEnum,...c(l)});class se extends u{unwrap(){return this._def.type}_parse(l){const{ctx:g}=this._processInputParams(l);if(g.parsedType!==a.ZodParsedType.promise&&g.common.async===!1)return(0,r.addIssueToContext)(g,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.promise,received:g.parsedType}),r.INVALID;const E=g.parsedType===a.ZodParsedType.promise?g.data:Promise.resolve(g.data);return(0,r.OK)(E.then(L=>this._def.type.parseAsync(L,{path:g.path,errorMap:g.common.contextualErrorMap})))}}n.ZodPromise=se,se.create=(j,l)=>new se({type:j,typeName:ae.ZodPromise,...c(l)});class ue extends u{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ae.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(l){const{status:g,ctx:E}=this._processInputParams(l),L=this._def.effect||null,N={addIssue:X=>{(0,r.addIssueToContext)(E,X),X.fatal?g.abort():g.dirty()},get path(){return E.path}};if(N.addIssue=N.addIssue.bind(N),L.type==="preprocess"){const X=L.transform(E.data,N);return E.common.issues.length?{status:"dirty",value:E.data}:E.common.async?Promise.resolve(X).then(q=>this._def.schema._parseAsync({data:q,path:E.path,parent:E})):this._def.schema._parseSync({data:X,path:E.path,parent:E})}if(L.type==="refinement"){const X=q=>{const ie=L.refinement(q,N);if(E.common.async)return Promise.resolve(ie);if(ie instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return q};if(E.common.async===!1){const q=this._def.schema._parseSync({data:E.data,path:E.path,parent:E});return q.status==="aborted"?r.INVALID:(q.status==="dirty"&&g.dirty(),X(q.value),{status:g.value,value:q.value})}else return this._def.schema._parseAsync({data:E.data,path:E.path,parent:E}).then(q=>q.status==="aborted"?r.INVALID:(q.status==="dirty"&&g.dirty(),X(q.value).then(()=>({status:g.value,value:q.value}))))}if(L.type==="transform")if(E.common.async===!1){const X=this._def.schema._parseSync({data:E.data,path:E.path,parent:E});if(!(0,r.isValid)(X))return X;const q=L.transform(X.value,N);if(q instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:g.value,value:q}}else return this._def.schema._parseAsync({data:E.data,path:E.path,parent:E}).then(X=>(0,r.isValid)(X)?Promise.resolve(L.transform(X.value,N)).then(q=>({status:g.value,value:q})):X);a.util.assertNever(L)}}n.ZodEffects=ue,n.ZodTransformer=ue,ue.create=(j,l,g)=>new ue({schema:j,typeName:ae.ZodEffects,effect:l,...c(g)}),ue.createWithPreprocess=(j,l,g)=>new ue({schema:l,effect:{type:"preprocess",transform:j},typeName:ae.ZodEffects,...c(g)});class me extends u{_parse(l){return this._getType(l)===a.ZodParsedType.undefined?(0,r.OK)(void 0):this._def.innerType._parse(l)}unwrap(){return this._def.innerType}}n.ZodOptional=me,me.create=(j,l)=>new me({innerType:j,typeName:ae.ZodOptional,...c(l)});class ye extends u{_parse(l){return this._getType(l)===a.ZodParsedType.null?(0,r.OK)(null):this._def.innerType._parse(l)}unwrap(){return this._def.innerType}}n.ZodNullable=ye,ye.create=(j,l)=>new ye({innerType:j,typeName:ae.ZodNullable,...c(l)});class ve extends u{_parse(l){const{ctx:g}=this._processInputParams(l);let E=g.data;return g.parsedType===a.ZodParsedType.undefined&&(E=this._def.defaultValue()),this._def.innerType._parse({data:E,path:g.path,parent:g})}removeDefault(){return this._def.innerType}}n.ZodDefault=ve,ve.create=(j,l)=>new ve({innerType:j,typeName:ae.ZodDefault,defaultValue:typeof l.default=="function"?l.default:()=>l.default,...c(l)});class ge extends u{_parse(l){const{ctx:g}=this._processInputParams(l),E={...g,common:{...g.common,issues:[]}},L=this._def.innerType._parse({data:E.data,path:E.path,parent:{...E}});return(0,r.isAsync)(L)?L.then(N=>({status:"valid",value:N.status==="valid"?N.value:this._def.catchValue({get error(){return new i.ZodError(E.common.issues)},input:E.data})})):{status:"valid",value:L.status==="valid"?L.value:this._def.catchValue({get error(){return new i.ZodError(E.common.issues)},input:E.data})}}removeCatch(){return this._def.innerType}}n.ZodCatch=ge,ge.create=(j,l)=>new ge({innerType:j,typeName:ae.ZodCatch,catchValue:typeof l.catch=="function"?l.catch:()=>l.catch,...c(l)});class he extends u{_parse(l){if(this._getType(l)!==a.ZodParsedType.nan){const E=this._getOrReturnCtx(l);return(0,r.addIssueToContext)(E,{code:i.ZodIssueCode.invalid_type,expected:a.ZodParsedType.nan,received:E.parsedType}),r.INVALID}return{status:"valid",value:l.data}}}n.ZodNaN=he,he.create=j=>new he({typeName:ae.ZodNaN,...c(j)}),n.BRAND=Symbol("zod_brand");class de extends u{_parse(l){const{ctx:g}=this._processInputParams(l),E=g.data;return this._def.type._parse({data:E,path:g.path,parent:g})}unwrap(){return this._def.type}}n.ZodBranded=de;class xe extends u{_parse(l){const{status:g,ctx:E}=this._processInputParams(l);if(E.common.async)return(async()=>{const N=await this._def.in._parseAsync({data:E.data,path:E.path,parent:E});return N.status==="aborted"?r.INVALID:N.status==="dirty"?(g.dirty(),(0,r.DIRTY)(N.value)):this._def.out._parseAsync({data:N.value,path:E.path,parent:E})})();{const L=this._def.in._parseSync({data:E.data,path:E.path,parent:E});return L.status==="aborted"?r.INVALID:L.status==="dirty"?(g.dirty(),{status:"dirty",value:L.value}):this._def.out._parseSync({data:L.value,path:E.path,parent:E})}}static create(l,g){return new xe({in:l,out:g,typeName:ae.ZodPipeline})}}n.ZodPipeline=xe;class He extends u{_parse(l){const g=this._def.innerType._parse(l);return(0,r.isValid)(g)&&(g.value=Object.freeze(g.value)),g}}n.ZodReadonly=He,He.create=(j,l)=>new He({innerType:j,typeName:ae.ZodReadonly,...c(l)});const Jn=(j,l={},g)=>j?z.create().superRefine((E,L)=>{var N,X;if(!j(E)){const q=typeof l=="function"?l(E):typeof l=="string"?{message:l}:l,ie=(X=(N=q.fatal)!==null&&N!==void 0?N:g)!==null&&X!==void 0?X:!0,re=typeof q=="string"?{message:q}:q;L.addIssue({code:"custom",...re,fatal:ie})}}):z.create();n.custom=Jn,n.late={object:M.lazycreate};var ae;(function(j){j.ZodString="ZodString",j.ZodNumber="ZodNumber",j.ZodNaN="ZodNaN",j.ZodBigInt="ZodBigInt",j.ZodBoolean="ZodBoolean",j.ZodDate="ZodDate",j.ZodSymbol="ZodSymbol",j.ZodUndefined="ZodUndefined",j.ZodNull="ZodNull",j.ZodAny="ZodAny",j.ZodUnknown="ZodUnknown",j.ZodNever="ZodNever",j.ZodVoid="ZodVoid",j.ZodArray="ZodArray",j.ZodObject="ZodObject",j.ZodUnion="ZodUnion",j.ZodDiscriminatedUnion="ZodDiscriminatedUnion",j.ZodIntersection="ZodIntersection",j.ZodTuple="ZodTuple",j.ZodRecord="ZodRecord",j.ZodMap="ZodMap",j.ZodSet="ZodSet",j.ZodFunction="ZodFunction",j.ZodLazy="ZodLazy",j.ZodLiteral="ZodLiteral",j.ZodEnum="ZodEnum",j.ZodEffects="ZodEffects",j.ZodNativeEnum="ZodNativeEnum",j.ZodOptional="ZodOptional",j.ZodNullable="ZodNullable",j.ZodDefault="ZodDefault",j.ZodCatch="ZodCatch",j.ZodPromise="ZodPromise",j.ZodBranded="ZodBranded",j.ZodPipeline="ZodPipeline",j.ZodReadonly="ZodReadonly"})(ae=n.ZodFirstPartyTypeKind||(n.ZodFirstPartyTypeKind={}));const At=(j,l={message:`Input not instance of ${j.name}`})=>(0,n.custom)(g=>g instanceof j,l);n.instanceof=At;const Qn=C.create;n.string=Qn;const gr=A.create;n.number=gr;const ea=he.create;n.nan=ea;const dt=k.create;n.bigint=dt;const ht=b.create;n.boolean=ht;const rs=I.create;n.date=rs;const ta=h.create;n.symbol=ta;const ra=O.create;n.undefined=ra;const ns=R.create;n.null=ns;const as=z.create;n.any=as;const na=Z.create;n.unknown=na;const is=Y.create;n.never=is;const aa=H.create;n.void=aa;const ss=te.create;n.array=ss;const ia=M.create;n.object=ia;const os=M.strictCreate;n.strictObject=os;const us=Q.create;n.union=us;const cs=F.create;n.discriminatedUnion=cs;const sa=K.create;n.intersection=sa;const ls=oe.create;n.tuple=ls;const ds=le.create;n.record=ds;const oa=we.create;n.map=oa;const hs=U.create;n.set=hs;const ua=x.create;n.function=ua;const $e=S.create;n.lazy=$e;const tt=B.create;n.literal=tt;const ca=V.create;n.enum=ca;const fs=J.create;n.nativeEnum=fs;const Fm=se.create;n.promise=Fm;const Mc=ue.create;n.effect=Mc,n.transformer=Mc;const qm=me.create;n.optional=qm;const Hm=ye.create;n.nullable=Hm;const Wm=ue.createWithPreprocess;n.preprocess=Wm;const Ym=xe.create;n.pipeline=Ym;const Gm=()=>Qn().optional();n.ostring=Gm;const Xm=()=>gr().optional();n.onumber=Xm;const Jm=()=>ht().optional();n.oboolean=Jm,n.coerce={string:j=>C.create({...j,coerce:!0}),number:j=>A.create({...j,coerce:!0}),boolean:j=>b.create({...j,coerce:!0}),bigint:j=>k.create({...j,coerce:!0}),date:j=>I.create({...j,coerce:!0})},n.NEVER=r.INVALID}(oc),function(n){var e=ee&&ee.__createBinding||(Object.create?function(r,a,i,s){s===void 0&&(s=i),Object.defineProperty(r,s,{enumerable:!0,get:function(){return a[i]}})}:function(r,a,i,s){s===void 0&&(s=i),r[s]=a[i]}),t=ee&&ee.__exportStar||function(r,a){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(a,i)&&e(a,r,i)};Object.defineProperty(n,"__esModule",{value:!0}),t(Qe,n),t(Hi,n),t(sc,n),t(Qt,n),t(oc,n),t(et,n)}(Fi),function(n){var e=ee&&ee.__createBinding||(Object.create?function(s,o,c,u){u===void 0&&(u=c),Object.defineProperty(s,u,{enumerable:!0,get:function(){return o[c]}})}:function(s,o,c,u){u===void 0&&(u=c),s[u]=o[c]}),t=ee&&ee.__setModuleDefault||(Object.create?function(s,o){Object.defineProperty(s,"default",{enumerable:!0,value:o})}:function(s,o){s.default=o}),r=ee&&ee.__importStar||function(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var c in s)c!=="default"&&Object.prototype.hasOwnProperty.call(s,c)&&e(o,s,c);return t(o,s),o},a=ee&&ee.__exportStar||function(s,o){for(var c in s)c!=="default"&&!Object.prototype.hasOwnProperty.call(o,c)&&e(o,s,c)};Object.defineProperty(n,"__esModule",{value:!0}),n.z=void 0;const i=r(Fi);n.z=i,a(Fi,n),n.default=i}(Ln);var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.parseAnyDef=void 0;function Lf(){return{}}Bn.parseAnyDef=Lf;var er={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.setResponseValueAndErrors=Ge.addErrorMessage=void 0;function cc(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage=Object.assign(Object.assign({},n.errorMessage),{[e]:t}))}Ge.addErrorMessage=cc;function Df(n,e,t,r,a){n[e]=t,cc(n,e,r,a)}Ge.setResponseValueAndErrors=Df;var lc;function Bf(){if(lc)return er;lc=1,Object.defineProperty(er,"__esModule",{value:!0}),er.parseArrayDef=void 0;const n=Ln,e=Ge,t=ke();function r(a,i){var s,o;const c={type:"array"};return((o=(s=a.type)===null||s===void 0?void 0:s._def)===null||o===void 0?void 0:o.typeName)!==n.ZodFirstPartyTypeKind.ZodAny&&(c.items=(0,t.parseDef)(a.type._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"items"]}))),a.minLength&&(0,e.setResponseValueAndErrors)(c,"minItems",a.minLength.value,a.minLength.message,i),a.maxLength&&(0,e.setResponseValueAndErrors)(c,"maxItems",a.maxLength.value,a.maxLength.message,i),a.exactLength&&((0,e.setResponseValueAndErrors)(c,"minItems",a.exactLength.value,a.exactLength.message,i),(0,e.setResponseValueAndErrors)(c,"maxItems",a.exactLength.value,a.exactLength.message,i)),c}return er.parseArrayDef=r,er}var $n={};Object.defineProperty($n,"__esModule",{value:!0}),$n.parseBigintDef=void 0;const _t=Ge;function $f(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?(0,_t.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e):(0,_t.setResponseValueAndErrors)(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),(0,_t.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,_t.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e):(0,_t.setResponseValueAndErrors)(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),(0,_t.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e));break;case"multipleOf":(0,_t.setResponseValueAndErrors)(t,"multipleOf",r.value,r.message,e);break}return t}$n.parseBigintDef=$f;var zn={};Object.defineProperty(zn,"__esModule",{value:!0}),zn.parseBooleanDef=void 0;function zf(){return{type:"boolean"}}zn.parseBooleanDef=zf;var tr={},dc;function Mf(){if(dc)return tr;dc=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.parseBrandedDef=void 0;const n=ke();function e(t,r){return(0,n.parseDef)(t.type._def,r)}return tr.parseBrandedDef=e,tr}var rr={},hc;function Uf(){if(hc)return rr;hc=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.parseCatchDef=void 0;const n=ke(),e=(t,r)=>(0,n.parseDef)(t.innerType._def,r);return rr.parseCatchDef=e,rr}var Mn={};Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.parseDateDef=void 0;const fc=Ge;function Zf(n,e){return e.dateStrategy=="integer"?Kf(n,e):{type:"string",format:"date-time"}}Mn.parseDateDef=Zf;const Kf=(n,e)=>{const t={type:"integer",format:"unix-time"};for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"&&(0,fc.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e);break;case"max":e.target==="jsonSchema7"&&(0,fc.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e);break}return t};var nr={},pc;function Vf(){if(pc)return nr;pc=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.parseDefaultDef=void 0;const n=ke();function e(t,r){return Object.assign(Object.assign({},(0,n.parseDef)(t.innerType._def,r)),{default:t.defaultValue()})}return nr.parseDefaultDef=e,nr}var ar={},mc;function Ff(){if(mc)return ar;mc=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.parseEffectsDef=void 0;const n=ke();function e(t,r){return r.effectStrategy==="input"?(0,n.parseDef)(t.schema._def,r):{}}return ar.parseEffectsDef=e,ar}var Un={};Object.defineProperty(Un,"__esModule",{value:!0}),Un.parseEnumDef=void 0;function qf(n){return{type:"string",enum:n.values}}Un.parseEnumDef=qf;var ir={},yc;function Hf(){if(yc)return ir;yc=1;var n=ee&&ee.__rest||function(a,i){var s={};for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.indexOf(o)<0&&(s[o]=a[o]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(a);c<o.length;c++)i.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(a,o[c])&&(s[o[c]]=a[o[c]]);return s};Object.defineProperty(ir,"__esModule",{value:!0}),ir.parseIntersectionDef=void 0;const e=ke(),t=a=>"type"in a&&a.type==="string"?!1:"allOf"in a;function r(a,i){const s=[(0,e.parseDef)(a.left._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"allOf","0"]})),(0,e.parseDef)(a.right._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"allOf","1"]}))].filter(u=>!!u);let o=i.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const c=[];return s.forEach(u=>{if(t(u))c.push(...u.allOf),u.unevaluatedProperties===void 0&&(o=void 0);else{let d=u;"additionalProperties"in u&&u.additionalProperties===!1?d=n(u,["additionalProperties"]):o=void 0,c.push(d)}}),c.length?Object.assign({allOf:c},o):void 0}return ir.parseIntersectionDef=r,ir}var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.parseLiteralDef=void 0;function Wf(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}Zn.parseLiteralDef=Wf;var sr={},gc;function Yf(){if(gc)return sr;gc=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.parseMapDef=void 0;const n=ke();function e(t,r){const a=(0,n.parseDef)(t.keyType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","0"]}))||{},i=(0,n.parseDef)(t.valueType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[a,i],minItems:2,maxItems:2}}}return sr.parseMapDef=e,sr}var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.parseNativeEnumDef=void 0;function Gf(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),a=Array.from(new Set(r.map(i=>typeof i)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}Kn.parseNativeEnumDef=Gf;var Vn={};Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.parseNeverDef=void 0;function Xf(){return{not:{}}}Vn.parseNeverDef=Xf;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.parseNullDef=void 0;function Jf(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}Fn.parseNullDef=Jf;var or={},Wi={},bc;function vc(){return bc||(bc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseUnionDef=n.primitiveMappings=void 0;const e=ke();n.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function t(a,i){if(i.target==="openApi3")return r(a,i);const s=a.options instanceof Map?Array.from(a.options.values()):a.options;if(s.every(o=>o._def.typeName in n.primitiveMappings&&(!o._def.checks||!o._def.checks.length))){const o=s.reduce((c,u)=>{const d=n.primitiveMappings[u._def.typeName];return d&&!c.includes(d)?[...c,d]:c},[]);return{type:o.length>1?o:o[0]}}else if(s.every(o=>o._def.typeName==="ZodLiteral"&&!o.description)){const o=s.reduce((c,u)=>{const d=typeof u._def.value;switch(d){case"string":case"number":case"boolean":return[...c,d];case"bigint":return[...c,"integer"];case"object":if(u._def.value===null)return[...c,"null"];case"symbol":case"undefined":case"function":default:return c}},[]);if(o.length===s.length){const c=o.filter((u,d,y)=>y.indexOf(u)===d);return{type:c.length>1?c:c[0],enum:s.reduce((u,d)=>u.includes(d._def.value)?u:[...u,d._def.value],[])}}}else if(s.every(o=>o._def.typeName==="ZodEnum"))return{type:"string",enum:s.reduce((o,c)=>[...o,...c._def.values.filter(u=>!o.includes(u))],[])};return r(a,i)}n.parseUnionDef=t;const r=(a,i)=>{const s=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((o,c)=>(0,e.parseDef)(o._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"anyOf",`${c}`]}))).filter(o=>!!o&&(!i.strictUnions||typeof o=="object"&&Object.keys(o).length>0));return s.length?{anyOf:s}:void 0}}(Wi)),Wi}var _c;function Qf(){if(_c)return or;_c=1,Object.defineProperty(or,"__esModule",{value:!0}),or.parseNullableDef=void 0;const n=ke(),e=vc();function t(r,a){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return a.target==="openApi3"?{type:e.primitiveMappings[r.innerType._def.typeName],nullable:!0}:{type:[e.primitiveMappings[r.innerType._def.typeName],"null"]};if(a.target==="openApi3"){const s=(0,n.parseDef)(r.innerType._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath]}));return s&&Object.assign(Object.assign({},s),{nullable:!0})}const i=(0,n.parseDef)(r.innerType._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"anyOf","0"]}));return i&&{anyOf:[i,{type:"null"}]}}return or.parseNullableDef=t,or}var qn={};Object.defineProperty(qn,"__esModule",{value:!0}),qn.parseNumberDef=void 0;const lt=Ge;function ep(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",(0,lt.addErrorMessage)(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?(0,lt.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e):(0,lt.setResponseValueAndErrors)(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),(0,lt.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,lt.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e):(0,lt.setResponseValueAndErrors)(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),(0,lt.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e));break;case"multipleOf":(0,lt.setResponseValueAndErrors)(t,"multipleOf",r.value,r.message,e);break}return t}qn.parseNumberDef=ep;var wt={},wc;function tp(){if(wc)return wt;wc=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.parseObjectDef=wt.parseObjectDefX=void 0;const n=ke();function e(r,a){var i,s;Object.keys(r.shape()).reduce((c,u)=>{let d=r.shape()[u];const y=d.isOptional();y||(d=Object.assign({},d._def.innerSchema));const f=(0,n.parseDef)(d._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"properties",u],propertyPath:[...a.currentPath,"properties",u]}));return f!==void 0&&(c.properties[u]=f,y||(c.required||(c.required=[]),c.required.push(u))),c},{type:"object",properties:{},additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(i=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"additionalProperties"]})))!==null&&i!==void 0?i:!0});const o=Object.assign(Object.assign({type:"object"},Object.entries(r.shape()).reduce((c,[u,d])=>{if(d===void 0||d._def===void 0)return c;const y=(0,n.parseDef)(d._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"properties",u],propertyPath:[...a.currentPath,"properties",u]}));return y===void 0?c:{properties:Object.assign(Object.assign({},c.properties),{[u]:y}),required:d.isOptional()?c.required:[...c.required,u]}},{properties:{},required:[]})),{additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(s=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"additionalProperties"]})))!==null&&s!==void 0?s:!0});return o.required.length||delete o.required,o}wt.parseObjectDefX=e;function t(r,a){var i;const s=Object.assign(Object.assign({type:"object"},Object.entries(r.shape()).reduce((o,[c,u])=>{if(u===void 0||u._def===void 0)return o;const d=(0,n.parseDef)(u._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"properties",c],propertyPath:[...a.currentPath,"properties",c]}));return d===void 0?o:{properties:Object.assign(Object.assign({},o.properties),{[c]:d}),required:u.isOptional()?o.required:[...o.required,c]}},{properties:{},required:[]})),{additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(i=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"additionalProperties"]})))!==null&&i!==void 0?i:!0});return s.required.length||delete s.required,s}return wt.parseObjectDef=t,wt}var ur={},xc;function rp(){if(xc)return ur;xc=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.parseOptionalDef=void 0;const n=ke(),e=(t,r)=>{var a;if(r.currentPath.toString()===((a=r.propertyPath)===null||a===void 0?void 0:a.toString()))return(0,n.parseDef)(t.innerType._def,r);const i=(0,n.parseDef)(t.innerType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"anyOf","1"]}));return i?{anyOf:[{not:{}},i]}:{}};return ur.parseOptionalDef=e,ur}var cr={},Pc;function np(){if(Pc)return cr;Pc=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.parsePipelineDef=void 0;const n=ke(),e=(t,r)=>{if(r.pipeStrategy==="input")return(0,n.parseDef)(t.in._def,r);const a=(0,n.parseDef)(t.in._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf","0"]})),i=(0,n.parseDef)(t.out._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf",a?"1":"0"]}));return{allOf:[a,i].filter(s=>s!==void 0)}};return cr.parsePipelineDef=e,cr}var lr={},Ac;function ap(){if(Ac)return lr;Ac=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.parsePromiseDef=void 0;const n=ke();function e(t,r){return(0,n.parseDef)(t.type._def,r)}return lr.parsePromiseDef=e,lr}var dr={},Yi={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseStringDef=n.emojiPattern=n.ulidPattern=n.cuid2Pattern=n.cuidPattern=n.emailPattern=void 0;const e=Ge;n.emailPattern='^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$',n.cuidPattern="^c[^\\s-]{8,}$",n.cuid2Pattern="^[a-z][a-z0-9]*$",n.ulidPattern="/[0-9A-HJKMNP-TV-Z]{26}/",n.emojiPattern="/^(p{Extended_Pictographic}|p{Emoji_Component})+$/u";function t(s,o){const c={type:"string"};if(s.checks)for(const u of s.checks)switch(u.kind){case"min":(0,e.setResponseValueAndErrors)(c,"minLength",typeof c.minLength=="number"?Math.max(c.minLength,u.value):u.value,u.message,o);break;case"max":(0,e.setResponseValueAndErrors)(c,"maxLength",typeof c.maxLength=="number"?Math.min(c.maxLength,u.value):u.value,u.message,o);break;case"email":switch(o.emailStrategy){case"format:email":a(c,"email",u.message,o);break;case"format:idn-email":a(c,"idn-email",u.message,o);break;case"pattern:zod":i(c,n.emailPattern,u.message,o);break}break;case"url":a(c,"uri",u.message,o);break;case"uuid":a(c,"uuid",u.message,o);break;case"regex":i(c,u.regex.source,u.message,o);break;case"cuid":i(c,n.cuidPattern,u.message,o);break;case"cuid2":i(c,n.cuid2Pattern,u.message,o);break;case"startsWith":i(c,"^"+r(u.value),u.message,o);break;case"endsWith":i(c,r(u.value)+"$",u.message,o);break;case"datetime":a(c,"date-time",u.message,o);break;case"length":(0,e.setResponseValueAndErrors)(c,"minLength",typeof c.minLength=="number"?Math.max(c.minLength,u.value):u.value,u.message,o),(0,e.setResponseValueAndErrors)(c,"maxLength",typeof c.maxLength=="number"?Math.min(c.maxLength,u.value):u.value,u.message,o);break;case"includes":{i(c,r(u.value),u.message,o);break}case"ip":{u.version!=="v6"&&a(c,"ipv4",u.message,o),u.version!=="v4"&&a(c,"ipv6",u.message,o);break}case"emoji":i(c,n.emojiPattern,u.message,o);break;case"ulid":{i(c,n.ulidPattern,u.message,o);break}}return c}n.parseStringDef=t;const r=s=>Array.from(s).map(o=>/[a-zA-Z0-9]/.test(o)?o:`\\${o}`).join(""),a=(s,o,c,u)=>{var d;s.format||!((d=s.anyOf)===null||d===void 0)&&d.some(y=>y.format)?(s.anyOf||(s.anyOf=[]),s.format&&(s.anyOf.push(Object.assign({format:s.format},s.errorMessage&&u.errorMessages&&{errorMessage:{format:s.errorMessage.format}})),delete s.format,s.errorMessage&&(delete s.errorMessage.format,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.anyOf.push(Object.assign({format:o},c&&u.errorMessages&&{errorMessage:{format:c}}))):(0,e.setResponseValueAndErrors)(s,"format",o,c,u)},i=(s,o,c,u)=>{var d;s.pattern||!((d=s.allOf)===null||d===void 0)&&d.some(y=>y.pattern)?(s.allOf||(s.allOf=[]),s.pattern&&(s.allOf.push(Object.assign({pattern:s.pattern},s.errorMessage&&u.errorMessages&&{errorMessage:{pattern:s.errorMessage.pattern}})),delete s.pattern,s.errorMessage&&(delete s.errorMessage.pattern,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.allOf.push(Object.assign({pattern:o},c&&u.errorMessages&&{errorMessage:{pattern:c}}))):(0,e.setResponseValueAndErrors)(s,"pattern",o,c,u)}})(Yi);var Ic;function ip(){if(Ic)return dr;Ic=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.parseRecordDef=void 0;const n=Ln,e=ke(),t=Yi;function r(a,i){var s,o,c,u,d;if(i.target==="openApi3"&&((s=a.keyType)===null||s===void 0?void 0:s._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((f,v)=>{var p;return Object.assign(Object.assign({},f),{[v]:(p=(0,e.parseDef)(a.valueType._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"properties",v]})))!==null&&p!==void 0?p:{}})},{}),additionalProperties:!1};const y={type:"object",additionalProperties:(o=(0,e.parseDef)(a.valueType._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"additionalProperties"]})))!==null&&o!==void 0?o:{}};if(i.target==="openApi3")return y;if(((c=a.keyType)===null||c===void 0?void 0:c._def.typeName)===n.ZodFirstPartyTypeKind.ZodString&&(!((u=a.keyType._def.checks)===null||u===void 0)&&u.length)){const f=Object.entries((0,t.parseStringDef)(a.keyType._def,i)).reduce((v,[p,P])=>p==="type"?v:Object.assign(Object.assign({},v),{[p]:P}),{});return Object.assign(Object.assign({},y),{propertyNames:f})}else if(((d=a.keyType)===null||d===void 0?void 0:d._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return Object.assign(Object.assign({},y),{propertyNames:{enum:a.keyType._def.values}});return y}return dr.parseRecordDef=r,dr}var hr={},Ec;function sp(){if(Ec)return hr;Ec=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.parseSetDef=void 0;const n=Ge,e=ke();function t(r,a){const s={type:"array",uniqueItems:!0,items:(0,e.parseDef)(r.valueType._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"items"]}))};return r.minSize&&(0,n.setResponseValueAndErrors)(s,"minItems",r.minSize.value,r.minSize.message,a),r.maxSize&&(0,n.setResponseValueAndErrors)(s,"maxItems",r.maxSize.value,r.maxSize.message,a),s}return hr.parseSetDef=t,hr}var fr={},Oc;function op(){if(Oc)return fr;Oc=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.parseTupleDef=void 0;const n=ke();function e(t,r){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,i)=>(0,n.parseDef)(a._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${i}`]}))).reduce((a,i)=>i===void 0?a:[...a,i],[]),additionalItems:(0,n.parseDef)(t.rest._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"additionalItems"]}))}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,i)=>(0,n.parseDef)(a._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${i}`]}))).reduce((a,i)=>i===void 0?a:[...a,i],[])}}return fr.parseTupleDef=e,fr}var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.parseUndefinedDef=void 0;function up(){return{not:{}}}Hn.parseUndefinedDef=up;var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.parseUnknownDef=void 0;function cp(){return{}}Wn.parseUnknownDef=cp;var Cc;function ke(){if(Cc)return Jt;Cc=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.parseDef=void 0;const n=Ln,e=Bn,t=Bf(),r=$n,a=zn,i=Mf(),s=Uf(),o=Mn,c=Vf(),u=Ff(),d=Un,y=Hf(),f=Zn,v=Yf(),p=Kn,P=Vn,m=Fn,T=Qf(),_=qn,w=tp(),C=rp(),D=np(),A=ap(),k=ip(),b=sp(),I=Yi,h=op(),O=Hn,R=vc(),z=Wn;function Z(M,Q,$=!1){const F=Q.seen.get(M);if(F&&!$){const oe=Y(F,Q);if(oe!==void 0)return oe}const W={def:M,path:Q.currentPath,jsonSchema:void 0};Q.seen.set(M,W);const K=te(M,M.typeName,Q);return K&&ne(M,Q,K),W.jsonSchema=K,K}Jt.parseDef=Z;const Y=(M,Q)=>{switch(Q.$refStrategy){case"root":return{$ref:M.path.length===0?"":M.path.length===1?`${M.path[0]}/`:M.path.join("/")};case"relative":return{$ref:H(Q.currentPath,M.path)};case"none":return M.path.length<Q.currentPath.length&&M.path.every(($,F)=>Q.currentPath[F]===$)?(console.warn(`Recursive reference detected at ${Q.currentPath.join("/")}! Defaulting to any`),{}):void 0;case"seen":return M.path.length<Q.currentPath.length&&M.path.every(($,F)=>Q.currentPath[F]===$)?(console.warn(`Recursive reference detected at ${Q.currentPath.join("/")}! Defaulting to any`),{}):M.jsonSchema}},H=(M,Q)=>{let $=0;for(;$<M.length&&$<Q.length&&M[$]===Q[$];$++);return[(M.length-$).toString(),...Q.slice($)].join("/")},te=(M,Q,$)=>{switch(Q){case n.ZodFirstPartyTypeKind.ZodString:return(0,I.parseStringDef)(M,$);case n.ZodFirstPartyTypeKind.ZodNumber:return(0,_.parseNumberDef)(M,$);case n.ZodFirstPartyTypeKind.ZodObject:return(0,w.parseObjectDef)(M,$);case n.ZodFirstPartyTypeKind.ZodBigInt:return(0,r.parseBigintDef)(M,$);case n.ZodFirstPartyTypeKind.ZodBoolean:return(0,a.parseBooleanDef)();case n.ZodFirstPartyTypeKind.ZodDate:return(0,o.parseDateDef)(M,$);case n.ZodFirstPartyTypeKind.ZodUndefined:return(0,O.parseUndefinedDef)();case n.ZodFirstPartyTypeKind.ZodNull:return(0,m.parseNullDef)($);case n.ZodFirstPartyTypeKind.ZodArray:return(0,t.parseArrayDef)(M,$);case n.ZodFirstPartyTypeKind.ZodUnion:case n.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,R.parseUnionDef)(M,$);case n.ZodFirstPartyTypeKind.ZodIntersection:return(0,y.parseIntersectionDef)(M,$);case n.ZodFirstPartyTypeKind.ZodTuple:return(0,h.parseTupleDef)(M,$);case n.ZodFirstPartyTypeKind.ZodRecord:return(0,k.parseRecordDef)(M,$);case n.ZodFirstPartyTypeKind.ZodLiteral:return(0,f.parseLiteralDef)(M,$);case n.ZodFirstPartyTypeKind.ZodEnum:return(0,d.parseEnumDef)(M);case n.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,p.parseNativeEnumDef)(M);case n.ZodFirstPartyTypeKind.ZodNullable:return(0,T.parseNullableDef)(M,$);case n.ZodFirstPartyTypeKind.ZodOptional:return(0,C.parseOptionalDef)(M,$);case n.ZodFirstPartyTypeKind.ZodMap:return(0,v.parseMapDef)(M,$);case n.ZodFirstPartyTypeKind.ZodSet:return(0,b.parseSetDef)(M,$);case n.ZodFirstPartyTypeKind.ZodLazy:return Z(M.getter()._def,$);case n.ZodFirstPartyTypeKind.ZodPromise:return(0,A.parsePromiseDef)(M,$);case n.ZodFirstPartyTypeKind.ZodNaN:case n.ZodFirstPartyTypeKind.ZodNever:return(0,P.parseNeverDef)();case n.ZodFirstPartyTypeKind.ZodEffects:return(0,u.parseEffectsDef)(M,$);case n.ZodFirstPartyTypeKind.ZodAny:return(0,e.parseAnyDef)();case n.ZodFirstPartyTypeKind.ZodUnknown:return(0,z.parseUnknownDef)();case n.ZodFirstPartyTypeKind.ZodDefault:return(0,c.parseDefaultDef)(M,$);case n.ZodFirstPartyTypeKind.ZodBranded:return(0,i.parseBrandedDef)(M,$);case n.ZodFirstPartyTypeKind.ZodCatch:return(0,s.parseCatchDef)(M,$);case n.ZodFirstPartyTypeKind.ZodPipeline:return(0,D.parsePipelineDef)(M,$);case n.ZodFirstPartyTypeKind.ZodFunction:case n.ZodFirstPartyTypeKind.ZodVoid:case n.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(F=>{})()}},ne=(M,Q,$)=>(M.description&&($.description=M.description,Q.markdownDescription&&($.markdownDescription=M.description)),$);return Jt}var Yn={},Tc={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultOptions=n.defaultOptions=void 0,n.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,emailStrategy:"format:email"};const e=t=>typeof t=="string"?Object.assign(Object.assign({},n.defaultOptions),{name:t}):Object.assign(Object.assign({},n.defaultOptions),t);n.getDefaultOptions=e})(Tc),Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.getRefs=void 0;const lp=Tc,dp=n=>{const e=(0,lp.getDefaultOptions)(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return Object.assign(Object.assign({},e),{currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))})};Yn.getRefs=dp,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.zodToJsonSchema=void 0;const kc=ke(),hp=Yn,fp=(n,e)=>{var t;const r=(0,hp.getRefs)(e),a=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,d])=>{var y;return Object.assign(Object.assign({},c),{[u]:(y=(0,kc.parseDef)(d._def,Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,u]}),!0))!==null&&y!==void 0?y:{}})},{}):void 0,i=typeof e=="string"?e:e==null?void 0:e.name,s=(t=(0,kc.parseDef)(n._def,i===void 0?r:Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,i]}),!1))!==null&&t!==void 0?t:{},o=i===void 0?a?Object.assign(Object.assign({},s),{[r.definitionPath]:a}):s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:Object.assign(Object.assign({},a),{[i]:s})};return r.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};Nn.zodToJsonSchema=fp,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.zodToJsonSchema=void 0;const e=Nn;Object.defineProperty(n,"zodToJsonSchema",{enumerable:!0,get:function(){return e.zodToJsonSchema}}),n.default=e.zodToJsonSchema}(rc);/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function Sc(n){return typeof n>"u"||n===null}function pp(n){return typeof n=="object"&&n!==null}function mp(n){return Array.isArray(n)?n:Sc(n)?[]:[n]}function yp(n,e){var t,r,a,i;if(e)for(i=Object.keys(e),t=0,r=i.length;t<r;t+=1)a=i[t],n[a]=e[a];return n}function gp(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}function bp(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var vp=Sc,_p=pp,wp=mp,xp=gp,Pp=bp,Ap=yp,Gi={isNothing:vp,isObject:_p,toArray:wp,repeat:xp,isNegativeZero:Pp,extend:Ap};function Rc(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}function pr(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=Rc(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}pr.prototype=Object.create(Error.prototype),pr.prototype.constructor=pr,pr.prototype.toString=function(e){return this.name+": "+Rc(this,e)};var xt=pr,Ip=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Ep=["scalar","sequence","mapping"];function Op(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}function Cp(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(Ip.indexOf(t)===-1)throw new xt('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=Op(e.styleAliases||null),Ep.indexOf(this.kind)===-1)throw new xt('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var Ne=Cp;function jc(n,e){var t=[];return n[e].forEach(function(r){var a=t.length;t.forEach(function(i,s){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(a=s)}),t[a]=r}),t}function Tp(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(a){a.multi?(n.multi[a.kind].push(a),n.multi.fallback.push(a)):n[a.kind][a.tag]=n.fallback[a.tag]=a}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}function Xi(n){return this.extend(n)}Xi.prototype.extend=function(e){var t=[],r=[];if(e instanceof Ne)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new xt("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(i){if(!(i instanceof Ne))throw new xt("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new xt("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new xt("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof Ne))throw new xt("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var a=Object.create(Xi.prototype);return a.implicit=(this.implicit||[]).concat(t),a.explicit=(this.explicit||[]).concat(r),a.compiledImplicit=jc(a,"implicit"),a.compiledExplicit=jc(a,"explicit"),a.compiledTypeMap=Tp(a.compiledImplicit,a.compiledExplicit),a};var kp=Xi,Sp=new Ne("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),Rp=new Ne("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),jp=new Ne("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),Np=new kp({explicit:[Sp,Rp,jp]});function Lp(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function Dp(){return null}function Bp(n){return n===null}var $p=new Ne("tag:yaml.org,2002:null",{kind:"scalar",resolve:Lp,construct:Dp,predicate:Bp,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function zp(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function Mp(n){return n==="true"||n==="True"||n==="TRUE"}function Up(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var Zp=new Ne("tag:yaml.org,2002:bool",{kind:"scalar",resolve:zp,construct:Mp,predicate:Up,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function Kp(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function Vp(n){return 48<=n&&n<=55}function Fp(n){return 48<=n&&n<=57}function qp(n){if(n===null)return!1;var e=n.length,t=0,r=!1,a;if(!e)return!1;if(a=n[t],(a==="-"||a==="+")&&(a=n[++t]),a==="0"){if(t+1===e)return!0;if(a=n[++t],a==="b"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(a!=="0"&&a!=="1")return!1;r=!0}return r&&a!=="_"}if(a==="x"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(!Kp(n.charCodeAt(t)))return!1;r=!0}return r&&a!=="_"}if(a==="o"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(!Vp(n.charCodeAt(t)))return!1;r=!0}return r&&a!=="_"}}if(a==="_")return!1;for(;t<e;t++)if(a=n[t],a!=="_"){if(!Fp(n.charCodeAt(t)))return!1;r=!0}return!(!r||a==="_")}function Hp(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function Wp(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!Gi.isNegativeZero(n)}var Yp=new Ne("tag:yaml.org,2002:int",{kind:"scalar",resolve:qp,construct:Hp,predicate:Wp,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Gp=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Xp(n){return!(n===null||!Gp.test(n)||n[n.length-1]==="_")}function Jp(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var Qp=/^[-+]?[0-9]+e/;function em(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Gi.isNegativeZero(n))return"-0.0";return t=n.toString(10),Qp.test(t)?t.replace("e",".e"):t}function tm(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||Gi.isNegativeZero(n))}var rm=new Ne("tag:yaml.org,2002:float",{kind:"scalar",resolve:Xp,construct:Jp,predicate:tm,represent:em,defaultStyle:"lowercase"}),nm=Np.extend({implicit:[$p,Zp,Yp,rm]}),am=nm,Nc=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Lc=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function im(n){return n===null?!1:Nc.exec(n)!==null||Lc.exec(n)!==null}function sm(n){var e,t,r,a,i,s,o,c=0,u=null,d,y,f;if(e=Nc.exec(n),e===null&&(e=Lc.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,a=+e[3],!e[4])return new Date(Date.UTC(t,r,a));if(i=+e[4],s=+e[5],o=+e[6],e[7]){for(c=e[7].slice(0,3);c.length<3;)c+="0";c=+c}return e[9]&&(d=+e[10],y=+(e[11]||0),u=(d*60+y)*6e4,e[9]==="-"&&(u=-u)),f=new Date(Date.UTC(t,r,a,i,s,o,c)),u&&f.setTime(f.getTime()-u),f}function om(n){return n.toISOString()}var um=new Ne("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:im,construct:sm,instanceOf:Date,represent:om});function cm(n){return n==="<<"||n===null}var lm=new Ne("tag:yaml.org,2002:merge",{kind:"scalar",resolve:cm}),Ji=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function dm(n){if(n===null)return!1;var e,t,r=0,a=n.length,i=Ji;for(t=0;t<a;t++)if(e=i.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function hm(n){var e,t,r=n.replace(/[\r\n=]/g,""),a=r.length,i=Ji,s=0,o=[];for(e=0;e<a;e++)e%4===0&&e&&(o.push(s>>16&255),o.push(s>>8&255),o.push(s&255)),s=s<<6|i.indexOf(r.charAt(e));return t=a%4*6,t===0?(o.push(s>>16&255),o.push(s>>8&255),o.push(s&255)):t===18?(o.push(s>>10&255),o.push(s>>2&255)):t===12&&o.push(s>>4&255),new Uint8Array(o)}function fm(n){var e="",t=0,r,a,i=n.length,s=Ji;for(r=0;r<i;r++)r%3===0&&r&&(e+=s[t>>18&63],e+=s[t>>12&63],e+=s[t>>6&63],e+=s[t&63]),t=(t<<8)+n[r];return a=i%3,a===0?(e+=s[t>>18&63],e+=s[t>>12&63],e+=s[t>>6&63],e+=s[t&63]):a===2?(e+=s[t>>10&63],e+=s[t>>4&63],e+=s[t<<2&63],e+=s[64]):a===1&&(e+=s[t>>2&63],e+=s[t<<4&63],e+=s[64],e+=s[64]),e}function pm(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var mm=new Ne("tag:yaml.org,2002:binary",{kind:"scalar",resolve:dm,construct:hm,predicate:pm,represent:fm}),ym=Object.prototype.hasOwnProperty,gm=Object.prototype.toString;function bm(n){if(n===null)return!0;var e=[],t,r,a,i,s,o=n;for(t=0,r=o.length;t<r;t+=1){if(a=o[t],s=!1,gm.call(a)!=="[object Object]")return!1;for(i in a)if(ym.call(a,i))if(!s)s=!0;else return!1;if(!s)return!1;if(e.indexOf(i)===-1)e.push(i);else return!1}return!0}function vm(n){return n!==null?n:[]}var _m=new Ne("tag:yaml.org,2002:omap",{kind:"sequence",resolve:bm,construct:vm}),wm=Object.prototype.toString;function xm(n){if(n===null)return!0;var e,t,r,a,i,s=n;for(i=new Array(s.length),e=0,t=s.length;e<t;e+=1){if(r=s[e],wm.call(r)!=="[object Object]"||(a=Object.keys(r),a.length!==1))return!1;i[e]=[a[0],r[a[0]]]}return!0}function Pm(n){if(n===null)return[];var e,t,r,a,i,s=n;for(i=new Array(s.length),e=0,t=s.length;e<t;e+=1)r=s[e],a=Object.keys(r),i[e]=[a[0],r[a[0]]];return i}var Am=new Ne("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:xm,construct:Pm}),Im=Object.prototype.hasOwnProperty;function Em(n){if(n===null)return!0;var e,t=n;for(e in t)if(Im.call(t,e)&&t[e]!==null)return!1;return!0}function Om(n){return n!==null?n:{}}var Cm=new Ne("tag:yaml.org,2002:set",{kind:"mapping",resolve:Em,construct:Om});am.extend({implicit:[um,lm],explicit:[mm,_m,Am,Cm]});function Dc(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"":n===95?" ":n===76?"\u2028":n===80?"\u2029":""}for(var Tm=new Array(256),km=new Array(256),Lt=0;Lt<256;Lt++)Tm[Lt]=Dc(Lt)?1:0,km[Lt]=Dc(Lt);function Sm(n){return{name:n.name,description:n.description,parameters:rc.zodToJsonSchema(n.schema)}}class mr extends $i{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=mr._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===mr.prototype._streamResponseChunks)yield this.invoke(e,t);else{const a=mr._convertInputToPromptValue(e).toChatMessages(),[i,s]=this._separateRunnableConfigFromCallOptions(t),o=await Se.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s)},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[a],void 0,void 0,c));let d;try{for await(const y of this._streamResponseChunks(a,s,u==null?void 0:u[0]))yield y.message,d?d=d.concat(y):d=y}catch(y){throw await Promise.all((u??[]).map(f=>f==null?void 0:f.handleLLMError(y))),y}await Promise.all((u??[]).map(y=>y==null?void 0:y.handleLLMEnd({generations:[[d]]})))}}async generate(e,t,r){var P;let a;Array.isArray(t)?a={stop:t}:a=t;const i=e.map(m=>m.map(Cn)),[s,o]=this._separateRunnableConfigFromCallOptions(a),c=await Se.configure(s.callbacks??r,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(a)},d=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),i,void 0,void 0,u)),y=await Promise.allSettled(i.map((m,T)=>this._generate(m,{...o,promptIndex:T},d==null?void 0:d[T]))),f=[],v=[];await Promise.all(y.map(async(m,T)=>{var _,w;if(m.status==="fulfilled"){const C=m.value;return f[T]=C.generations,v[T]=C.llmOutput,(_=d==null?void 0:d[T])==null?void 0:_.handleLLMEnd({generations:[C.generations],llmOutput:C.llmOutput})}else return await((w=d==null?void 0:d[T])==null?void 0:w.handleLLMError(m.reason)),Promise.reject(m.reason)}));const p={generations:f,llmOutput:v.length?(P=this._combineLLMOutput)==null?void 0:P.call(this,...v):void 0};return Object.defineProperty(p,Si,{value:d?{runIds:d==null?void 0:d.map(m=>m.runId)}:void 0,configurable:!0}),p}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const a=e.map(i=>i.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(Cn)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const a=new st(e);return(await this.call([a],t,r)).content}}function Rm(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&console.warn(`Unknown message role: ${n.role}`),n.role}function Qi(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":{if(!On.isInstance(n))throw new Error("Invalid generic chat message");return Rm(n)}default:throw new Error(`Unknown message type: ${e}`)}}function jm(n){switch(n.role){case"user":return new st(n.content||"");case"assistant":return new gt(n.content||"",{function_call:n.function_call});case"system":return new Ri(n.content||"");default:return new On(n.content||"",n.role??"unknown")}}function Nm(n,e){const t=n.role??e,r=n.content??"";let a;return n.function_call?a={function_call:n.function_call}:a={},t==="user"?new Pn({content:r}):t==="assistant"?new An({content:r,additional_kwargs:a}):t==="system"?new In({content:r}):t==="function"?new En({content:r,additional_kwargs:a,name:n.name}):new Tn({content:r,role:t})}class Lm extends mr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,i,s,o,c,u,d;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ce("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ce("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ce("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??ce("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ce("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ce("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??ce("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((a=e==null?void 0:e.configuration)==null?void 0:a.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=t==null?void 0:t.baseOptions)==null?void 0:i.headers)??((o=(s=e==null?void 0:e.configuration)==null?void 0:s.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((d=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:d.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,functions:(e==null?void 0:e.functions)??(e!=null&&e.tools?e==null?void 0:e.tools.map(Sm):void 0),function_call:e==null?void 0:e.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c;const a=e.map(u=>({role:Qi(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call})),i={...this.invocationParams(t),messages:a,stream:!0};let s;const o=await this.completionWithRetry(i,t);for await(const u of o){const d=u==null?void 0:u.choices[0];if(!d)continue;const{delta:y}=d,f=Nm(y,s);s=y.role??s;const v={prompt:t.promptIndex??0,completion:d.index??0},p=new ji({message:f,text:f.content,generationInfo:v});yield p,r==null||r.handleLLMNewToken(p.text??"",v,void 0,void 0,void 0,{chunk:p})}if((c=t.signal)!=null&&c.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,c;const a={},i=this.invocationParams(t),s=e.map(u=>({role:Qi(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call}));if(i.stream){const u=await this._streamResponseChunks(e,t,r),d={};for await(const f of u){const v=((o=f.generationInfo)==null?void 0:o.completion)??0;d[v]===void 0?d[v]=f:d[v]=d[v].concat(f)}return{generations:Object.entries(d).sort(([f],[v])=>parseInt(f,10)-parseInt(v,10)).map(([f,v])=>v)}}else{const u=await this.completionWithRetry({...i,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:d,prompt_tokens:y,total_tokens:f}=(u==null?void 0:u.usage)??{};d&&(a.completionTokens=(a.completionTokens??0)+d),y&&(a.promptTokens=(a.promptTokens??0)+y),f&&(a.totalTokens=(a.totalTokens??0)+f);const v=[];for(const p of(u==null?void 0:u.choices)??[]){const m={text:((c=p.message)==null?void 0:c.content)??"",message:jm(p.message??{role:"assistant"})};p.finish_reason&&(m.generationInfo={finish_reason:p.finish_reason}),v.push(m)}return{generations:v,llmOutput:{tokenUsage:a}}}}async getNumTokensFromMessages(e){let t=0,r=0,a=0;Vt(this.modelName)==="gpt-3.5-turbo"?(r=4,a=-1):Vt(this.modelName).startsWith("gpt-4")&&(r=3,a=1);const i=await Promise.all(e.map(async s=>{const o=await this.getNumTokens(s.content),c=await this.getNumTokens(Qi(s)),u=s.name!==void 0?a+await this.getNumTokens(s.name):0,d=o+r+c+u;return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw xn(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=wn(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Pe(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}const Dm=Object.freeze(Object.defineProperty({__proto__:null,ChatOpenAI:Lm},Symbol.toStringTag,{value:"Module"})),Bm=`Write a concise summary of the following content from a webpage:


"{text}"


CONCISE SUMMARY:`,$m=new be({template:Bm,inputVariables:["text"]}),Gn=n=>`embed-${n}`,Xn=n=>`chatlog-${n||""}`,Dt="pageInfo",Bc="chat_history";let es;es=chrome.storage;const $c=async()=>{const n=await es.local.get("key");return n?n.key:null},zm=async n=>{await es.local.set({key:n})};class ts{constructor(e){Ae(this,"storage");Ae(this,"key");Ae(this,"openai");Ae(this,"vectorStore");Ae(this,"chain");Ae(this,"sumChain");Ae(this,"memory");Ae(this,"targetLinkHash",null);let t;e?t=chrome.storage:t=new mh,this.storage=t}async init(e){this.key!==e&&(this.key=e,await this.initOpenAI())}async info(){return{quota:this.storage.local.QUOTA_BYTES,size:await this.storage.local.getBytesInUse()}}async search(e,t,r){var a;return await((a=this.vectorStore)==null?void 0:a.similaritySearchWithScore(e,t,r))}async query(e){var a;const t=await((a=this.chain)==null?void 0:a.call({question:e}));return(t==null?void 0:t.text)||""}async initOpenAI(e){let t=e?it.md5(e):null;const r=new dh({openAIApiKey:this.key}),a=new Yu({openAIApiKey:this.key});this.vectorStore=new ki(r);let i=this.vectorStore.asRetriever();t?(this.targetLinkHash=t,i=this.vectorStore.asRetriever({filter:o=>o.metadata.linkHash===t})):this.targetLinkHash=null,this.memory=await this.loadChatHistory(),await this.loadMemoryVectorStore();const s=Vi.fromLLM(a,i,{memory:this.memory});this.chain=s,this.sumChain=Cf(a,{type:"map_reduce",combinePrompt:$m})}async getChatLogByKey(e){let t=[];const r=await this.storage.local.get(e);return r&&r[e]&&(t=r[e]),t}async getChatLog(e){const t=Xn(e?it.md5(e):null);return await this.getChatLogByKey(t)}async addChatLog(e,t){const r=await this.getChatLog(t);r.push(e);const a=Xn(t?it.md5(t):null);await this.storage.local.set({[a]:r})}async getPageList(e){let t={};const a=(await this.storage.local.get(Dt))[Dt]||{};let i=[];if(e){const s=it.md5(e),o=a[s];o&&i.push(o)}else i=Object.values(a);for(let s=0;s<i.length;s++){const o=i[s],c=Gn(o.linkHash),u=await this.storage.local.getBytesInUse(c);t[o.linkHash]={...o,size:u}}return t}async summary(e){var r;const t=await((r=this.sumChain)==null?void 0:r.call({input_documents:e}));return(t==null?void 0:t.text)||""}async addPage(e,t,r){const a=it.md5(e),i={link:e,linkHash:a,title:t},s=await it.text2docs(r),o=await this.content2Vectors(i,s);o.length>0&&this.addVectorData(o);const c=await this.summary(s.slice(0,2)),u={link:e,linkHash:a,title:t,summary:c,ts:it.currTs()},y=(await this.storage.local.get(Dt))[Dt]||{};y[a]=u,await this.storage.local.set({[Dt]:y});const f=Gn(a);return await this.storage.local.set({[f]:o}),c}async delPage(e){if(!e)return;const t=it.md5(e),r=await this.getPageList();delete r[t],await this.storage.local.set({[Dt]:r}),await this.storage.local.remove(Gn(t)),await this.storage.local.remove(Xn(t))}async text2Vector(e){return this.vectorStore?this.vectorStore.embeddings.embedQuery(e):void 0}async content2Vectors(e,t){const r=[];for(let a=0;a<t.length;a++){const i=t[a],s=await this.text2Vector(i.pageContent);if(s){const o={embedding:s,content:i.pageContent,metadata:e};r.push(o)}}return r}async addVectorData(e){const t=this.vectorStore;t&&t.addVectors(e.map(r=>r.embedding),e.map(r=>({pageContent:r.content,metadata:r.metadata})))}async loadMemoryVectorStore(){if(!this.vectorStore)return;const t=await this.getPageList(),r=Object.values(t);for(let a=0;a<r.length;a++){const s=r[a].linkHash;if(!s||this.targetLinkHash&&this.targetLinkHash!==s)continue;const o=Gn(s),c=await this.storage.local.get(o);if(!c[o])continue;const u=c[o];this.addVectorData(u)}}async loadChatHistory(){let e=new Ju({memoryKey:Bc});const t=Xn(this.targetLinkHash),a=(await this.getChatLogByKey(t)).map(i=>i.isBot?new gt(i.msg):new st(i.msg));return e=new Ju({memoryKey:Bc,chatHistory:new Xu(a)}),e}}let yr,Pt;const zc=async n=>{yr=new ts(!0),await yr.init(n),await yr.initOpenAI(),Pt=new ts(!1),await Pt.init(n)},Mm=async()=>{const n=Pt.key;n&&(Pt=new ts(!1),await Pt.init(n))},Um=async n=>{let e=n.temp?Pt:yr;if(!e){const t=await $c();t&&(zc(t),e=n.temp?Pt:yr)}return e},Zm=(n,e,t)=>{console.log(`[${n}]`);for(let r in e)console.log(`  ->${r}: ${e[r]}`);for(let r in t)console.log(`  <-${r}: ${t[r]}`)},Km=async n=>{let e={ok:!1};if(n.type==="setKey")await it.testOpenAIKey(n.key)&&(await zc(n.key),await zm(n.key),e.ok=!0);else{const t=await Um(n);if(t)switch(n.type){case"chat":t?(e.ok=!0,e.msg=await t.query(n.query)):e.error="asst not ready";break;case"getChatLog":const r=await t.getChatLog(n.link);e.ok=!0,e.data=r;break;case"addChatLog":await t.addChatLog(n.log,n.link),e.ok=!0;break;case"getKey":const a=await $c();e.ok=!!a,e.data=a;break;case"handshake":e.ok=!!t;break;case"addPage":n.temp&&await Mm();const i=await t.addPage(n.link,n.title,n.content);e.ok=!0,e.summary=i;break;case"delPage":await t.delPage(n.link),e.ok=!0;break;case"setScope":await t.initOpenAI(n.scope),e.ok=!0;break;case"getPageList":const s=await t.getPageList(n.link);e.ok=!0,e.data=s;break;case"log":console.log("[LOG] ",n),e.ok=!0;break;case"info":const o=await t.info();e.ok=!0,e.data=o;break}else e.error="asst not ready"}return e},Vm=async(n,e,t)=>{let r={ok:!1};try{r=await Km(n)}catch(a){r.error=a.toString()}Zm(n.type,n,r),t(r)};(async()=>{chrome.runtime.onMessage.addListener((n,e,t)=>(Vm(n,e,t),!0))})()});
