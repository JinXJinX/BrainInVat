(function(Q){typeof define=="function"&&define.amd?define(Q):Q()})(function(){"use strict";var _b=Object.defineProperty;var vb=(Q,Qe,Vt)=>Qe in Q?_b(Q,Qe,{enumerable:!0,configurable:!0,writable:!0,value:Vt}):Q[Qe]=Vt;var ke=(Q,Qe,Vt)=>(vb(Q,typeof Qe!="symbol"?Qe+"":Qe,Vt),Vt);var Q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Vt(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var a=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return n[r]}})}),t}var Uo={exports:{}};function Fr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var es={exports:{}};const sh=Vt(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Ko;function oe(){return Ko||(Ko=1,function(n,e){(function(t,r){n.exports=r()})(Q,function(){var t=t||function(r,a){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof Q<"u"&&Q.crypto&&(s=Q.crypto),!s&&typeof Fr=="function")try{s=sh}catch{}var i=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function g(){}return function(y){var _;return g.prototype=y,_=new g,g.prototype=null,_}}(),c={},u=c.lib={},l=u.Base=function(){return{extend:function(g){var y=o(this);return g&&y.mixIn(g),(!y.hasOwnProperty("init")||this.init===y.init)&&(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var g=this.extend();return g.init.apply(g,arguments),g},init:function(){},mixIn:function(g){for(var y in g)g.hasOwnProperty(y)&&(this[y]=g[y]);g.hasOwnProperty("toString")&&(this.toString=g.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=u.WordArray=l.extend({init:function(g,y){g=this.words=g||[],y!=a?this.sigBytes=y:this.sigBytes=g.length*4},toString:function(g){return(g||x).stringify(this)},concat:function(g){var y=this.words,_=g.words,O=this.sigBytes,v=g.sigBytes;if(this.clamp(),O%4)for(var P=0;P<v;P++){var b=_[P>>>2]>>>24-P%4*8&255;y[O+P>>>2]|=b<<24-(O+P)%4*8}else for(var C=0;C<v;C+=4)y[O+C>>>2]=_[C>>>2];return this.sigBytes+=v,this},clamp:function(){var g=this.words,y=this.sigBytes;g[y>>>2]&=4294967295<<32-y%4*8,g.length=r.ceil(y/4)},clone:function(){var g=l.clone.call(this);return g.words=this.words.slice(0),g},random:function(g){for(var y=[],_=0;_<g;_+=4)y.push(i());return new f.init(y,g)}}),h=c.enc={},x=h.Hex={stringify:function(g){for(var y=g.words,_=g.sigBytes,O=[],v=0;v<_;v++){var P=y[v>>>2]>>>24-v%4*8&255;O.push((P>>>4).toString(16)),O.push((P&15).toString(16))}return O.join("")},parse:function(g){for(var y=g.length,_=[],O=0;O<y;O+=2)_[O>>>3]|=parseInt(g.substr(O,2),16)<<24-O%8*4;return new f.init(_,y/2)}},m=h.Latin1={stringify:function(g){for(var y=g.words,_=g.sigBytes,O=[],v=0;v<_;v++){var P=y[v>>>2]>>>24-v%4*8&255;O.push(String.fromCharCode(P))}return O.join("")},parse:function(g){for(var y=g.length,_=[],O=0;O<y;O++)_[O>>>2]|=(g.charCodeAt(O)&255)<<24-O%4*8;return new f.init(_,y)}},w=h.Utf8={stringify:function(g){try{return decodeURIComponent(escape(m.stringify(g)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(g){return m.parse(unescape(encodeURIComponent(g)))}},d=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(g){typeof g=="string"&&(g=w.parse(g)),this._data.concat(g),this._nDataBytes+=g.sigBytes},_process:function(g){var y,_=this._data,O=_.words,v=_.sigBytes,P=this.blockSize,b=P*4,C=v/b;g?C=r.ceil(C):C=r.max((C|0)-this._minBufferSize,0);var p=C*P,A=r.min(p*4,v);if(p){for(var S=0;S<p;S+=P)this._doProcessBlock(O,S);y=O.splice(0,p),_.sigBytes-=A}return new f.init(y,A)},clone:function(){var g=l.clone.call(this);return g._data=this._data.clone(),g},_minBufferSize:0});u.Hasher=d.extend({cfg:l.extend(),init:function(g){this.cfg=this.cfg.extend(g),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(g){return this._append(g),this._process(),this},finalize:function(g){g&&this._append(g);var y=this._doFinalize();return y},blockSize:16,_createHelper:function(g){return function(y,_){return new g.init(_).finalize(y)}},_createHmacHelper:function(g){return function(y,_){return new k.HMAC.init(g,_).finalize(y)}}});var k=c.algo={};return c}(Math);return t})}(es)),es.exports}var ts={exports:{}},Ho;function An(){return Ho||(Ho=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(r){var a=t,s=a.lib,i=s.Base,o=s.WordArray,c=a.x64={};c.Word=i.extend({init:function(u,l){this.high=u,this.low=l}}),c.WordArray=i.extend({init:function(u,l){u=this.words=u||[],l!=r?this.sigBytes=l:this.sigBytes=u.length*8},toX32:function(){for(var u=this.words,l=u.length,f=[],h=0;h<l;h++){var x=u[h];f.push(x.high),f.push(x.low)}return o.create(f,this.sigBytes)},clone:function(){for(var u=i.clone.call(this),l=u.words=this.words.slice(0),f=l.length,h=0;h<f;h++)l[h]=l[h].clone();return u}})}(),t})}(ts)),ts.exports}var rs={exports:{}},Vo;function ih(){return Vo||(Vo=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,a=r.lib,s=a.WordArray,i=s.init,o=s.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var u=c.byteLength,l=[],f=0;f<u;f++)l[f>>>2]|=c[f]<<24-f%4*8;i.call(this,l,u)}else i.apply(this,arguments)};o.prototype=s}}(),t.lib.WordArray})}(rs)),rs.exports}var ns={exports:{}},qo;function oh(){return qo||(qo=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.WordArray,i=r.enc;i.Utf16=i.Utf16BE={stringify:function(c){for(var u=c.words,l=c.sigBytes,f=[],h=0;h<l;h+=2){var x=u[h>>>2]>>>16-h%4*8&65535;f.push(String.fromCharCode(x))}return f.join("")},parse:function(c){for(var u=c.length,l=[],f=0;f<u;f++)l[f>>>1]|=c.charCodeAt(f)<<16-f%2*16;return s.create(l,u*2)}},i.Utf16LE={stringify:function(c){for(var u=c.words,l=c.sigBytes,f=[],h=0;h<l;h+=2){var x=o(u[h>>>2]>>>16-h%4*8&65535);f.push(String.fromCharCode(x))}return f.join("")},parse:function(c){for(var u=c.length,l=[],f=0;f<u;f++)l[f>>>1]|=o(c.charCodeAt(f)<<16-f%2*16);return s.create(l,u*2)}};function o(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(ns)),ns.exports}var as={exports:{}},Wo;function qt(){return Wo||(Wo=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.WordArray,i=r.enc;i.Base64={stringify:function(c){var u=c.words,l=c.sigBytes,f=this._map;c.clamp();for(var h=[],x=0;x<l;x+=3)for(var m=u[x>>>2]>>>24-x%4*8&255,w=u[x+1>>>2]>>>24-(x+1)%4*8&255,d=u[x+2>>>2]>>>24-(x+2)%4*8&255,k=m<<16|w<<8|d,g=0;g<4&&x+g*.75<l;g++)h.push(f.charAt(k>>>6*(3-g)&63));var y=f.charAt(64);if(y)for(;h.length%4;)h.push(y);return h.join("")},parse:function(c){var u=c.length,l=this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var h=0;h<l.length;h++)f[l.charCodeAt(h)]=h}var x=l.charAt(64);if(x){var m=c.indexOf(x);m!==-1&&(u=m)}return o(c,u,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function o(c,u,l){for(var f=[],h=0,x=0;x<u;x++)if(x%4){var m=l[c.charCodeAt(x-1)]<<x%4*2,w=l[c.charCodeAt(x)]>>>6-x%4*2,d=m|w;f[h>>>2]|=d<<24-h%4*8,h++}return s.create(f,h)}}(),t.enc.Base64})}(as)),as.exports}var ss={exports:{}},Zo;function uh(){return Zo||(Zo=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.WordArray,i=r.enc;i.Base64url={stringify:function(c,u){u===void 0&&(u=!0);var l=c.words,f=c.sigBytes,h=u?this._safe_map:this._map;c.clamp();for(var x=[],m=0;m<f;m+=3)for(var w=l[m>>>2]>>>24-m%4*8&255,d=l[m+1>>>2]>>>24-(m+1)%4*8&255,k=l[m+2>>>2]>>>24-(m+2)%4*8&255,g=w<<16|d<<8|k,y=0;y<4&&m+y*.75<f;y++)x.push(h.charAt(g>>>6*(3-y)&63));var _=h.charAt(64);if(_)for(;x.length%4;)x.push(_);return x.join("")},parse:function(c,u){u===void 0&&(u=!0);var l=c.length,f=u?this._safe_map:this._map,h=this._reverseMap;if(!h){h=this._reverseMap=[];for(var x=0;x<f.length;x++)h[f.charCodeAt(x)]=x}var m=f.charAt(64);if(m){var w=c.indexOf(m);w!==-1&&(l=w)}return o(c,l,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function o(c,u,l){for(var f=[],h=0,x=0;x<u;x++)if(x%4){var m=l[c.charCodeAt(x-1)]<<x%4*2,w=l[c.charCodeAt(x)]>>>6-x%4*2,d=m|w;f[h>>>2]|=d<<24-h%4*8,h++}return s.create(f,h)}}(),t.enc.Base64url})}(ss)),ss.exports}var is={exports:{}},Go;function Wt(){return Go||(Go=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(r){var a=t,s=a.lib,i=s.WordArray,o=s.Hasher,c=a.algo,u=[];(function(){for(var w=0;w<64;w++)u[w]=r.abs(r.sin(w+1))*4294967296|0})();var l=c.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(w,d){for(var k=0;k<16;k++){var g=d+k,y=w[g];w[g]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var _=this._hash.words,O=w[d+0],v=w[d+1],P=w[d+2],b=w[d+3],C=w[d+4],p=w[d+5],A=w[d+6],S=w[d+7],T=w[d+8],F=w[d+9],K=w[d+10],$=w[d+11],X=w[d+12],te=w[d+13],J=w[d+14],Y=w[d+15],R=_[0],L=_[1],z=_[2],j=_[3];R=f(R,L,z,j,O,7,u[0]),j=f(j,R,L,z,v,12,u[1]),z=f(z,j,R,L,P,17,u[2]),L=f(L,z,j,R,b,22,u[3]),R=f(R,L,z,j,C,7,u[4]),j=f(j,R,L,z,p,12,u[5]),z=f(z,j,R,L,A,17,u[6]),L=f(L,z,j,R,S,22,u[7]),R=f(R,L,z,j,T,7,u[8]),j=f(j,R,L,z,F,12,u[9]),z=f(z,j,R,L,K,17,u[10]),L=f(L,z,j,R,$,22,u[11]),R=f(R,L,z,j,X,7,u[12]),j=f(j,R,L,z,te,12,u[13]),z=f(z,j,R,L,J,17,u[14]),L=f(L,z,j,R,Y,22,u[15]),R=h(R,L,z,j,v,5,u[16]),j=h(j,R,L,z,A,9,u[17]),z=h(z,j,R,L,$,14,u[18]),L=h(L,z,j,R,O,20,u[19]),R=h(R,L,z,j,p,5,u[20]),j=h(j,R,L,z,K,9,u[21]),z=h(z,j,R,L,Y,14,u[22]),L=h(L,z,j,R,C,20,u[23]),R=h(R,L,z,j,F,5,u[24]),j=h(j,R,L,z,J,9,u[25]),z=h(z,j,R,L,b,14,u[26]),L=h(L,z,j,R,T,20,u[27]),R=h(R,L,z,j,te,5,u[28]),j=h(j,R,L,z,P,9,u[29]),z=h(z,j,R,L,S,14,u[30]),L=h(L,z,j,R,X,20,u[31]),R=x(R,L,z,j,p,4,u[32]),j=x(j,R,L,z,T,11,u[33]),z=x(z,j,R,L,$,16,u[34]),L=x(L,z,j,R,J,23,u[35]),R=x(R,L,z,j,v,4,u[36]),j=x(j,R,L,z,C,11,u[37]),z=x(z,j,R,L,S,16,u[38]),L=x(L,z,j,R,K,23,u[39]),R=x(R,L,z,j,te,4,u[40]),j=x(j,R,L,z,O,11,u[41]),z=x(z,j,R,L,b,16,u[42]),L=x(L,z,j,R,A,23,u[43]),R=x(R,L,z,j,F,4,u[44]),j=x(j,R,L,z,X,11,u[45]),z=x(z,j,R,L,Y,16,u[46]),L=x(L,z,j,R,P,23,u[47]),R=m(R,L,z,j,O,6,u[48]),j=m(j,R,L,z,S,10,u[49]),z=m(z,j,R,L,J,15,u[50]),L=m(L,z,j,R,p,21,u[51]),R=m(R,L,z,j,X,6,u[52]),j=m(j,R,L,z,b,10,u[53]),z=m(z,j,R,L,K,15,u[54]),L=m(L,z,j,R,v,21,u[55]),R=m(R,L,z,j,T,6,u[56]),j=m(j,R,L,z,Y,10,u[57]),z=m(z,j,R,L,A,15,u[58]),L=m(L,z,j,R,te,21,u[59]),R=m(R,L,z,j,C,6,u[60]),j=m(j,R,L,z,$,10,u[61]),z=m(z,j,R,L,P,15,u[62]),L=m(L,z,j,R,F,21,u[63]),_[0]=_[0]+R|0,_[1]=_[1]+L|0,_[2]=_[2]+z|0,_[3]=_[3]+j|0},_doFinalize:function(){var w=this._data,d=w.words,k=this._nDataBytes*8,g=w.sigBytes*8;d[g>>>5]|=128<<24-g%32;var y=r.floor(k/4294967296),_=k;d[(g+64>>>9<<4)+15]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,d[(g+64>>>9<<4)+14]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,w.sigBytes=(d.length+1)*4,this._process();for(var O=this._hash,v=O.words,P=0;P<4;P++){var b=v[P];v[P]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360}return O},clone:function(){var w=o.clone.call(this);return w._hash=this._hash.clone(),w}});function f(w,d,k,g,y,_,O){var v=w+(d&k|~d&g)+y+O;return(v<<_|v>>>32-_)+d}function h(w,d,k,g,y,_,O){var v=w+(d&g|k&~g)+y+O;return(v<<_|v>>>32-_)+d}function x(w,d,k,g,y,_,O){var v=w+(d^k^g)+y+O;return(v<<_|v>>>32-_)+d}function m(w,d,k,g,y,_,O){var v=w+(k^(d|~g))+y+O;return(v<<_|v>>>32-_)+d}a.MD5=o._createHelper(l),a.HmacMD5=o._createHmacHelper(l)}(Math),t.MD5})}(is)),is.exports}var os={exports:{}},Yo;function Xo(){return Yo||(Yo=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.WordArray,i=a.Hasher,o=r.algo,c=[],u=o.SHA1=i.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,f){for(var h=this._hash.words,x=h[0],m=h[1],w=h[2],d=h[3],k=h[4],g=0;g<80;g++){if(g<16)c[g]=l[f+g]|0;else{var y=c[g-3]^c[g-8]^c[g-14]^c[g-16];c[g]=y<<1|y>>>31}var _=(x<<5|x>>>27)+k+c[g];g<20?_+=(m&w|~m&d)+1518500249:g<40?_+=(m^w^d)+1859775393:g<60?_+=(m&w|m&d|w&d)-1894007588:_+=(m^w^d)-899497514,k=d,d=w,w=m<<30|m>>>2,m=x,x=_}h[0]=h[0]+x|0,h[1]=h[1]+m|0,h[2]=h[2]+w|0,h[3]=h[3]+d|0,h[4]=h[4]+k|0},_doFinalize:function(){var l=this._data,f=l.words,h=this._nDataBytes*8,x=l.sigBytes*8;return f[x>>>5]|=128<<24-x%32,f[(x+64>>>9<<4)+14]=Math.floor(h/4294967296),f[(x+64>>>9<<4)+15]=h,l.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var l=i.clone.call(this);return l._hash=this._hash.clone(),l}});r.SHA1=i._createHelper(u),r.HmacSHA1=i._createHmacHelper(u)}(),t.SHA1})}(os)),os.exports}var us={exports:{}},Jo;function cs(){return Jo||(Jo=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){return function(r){var a=t,s=a.lib,i=s.WordArray,o=s.Hasher,c=a.algo,u=[],l=[];(function(){function x(k){for(var g=r.sqrt(k),y=2;y<=g;y++)if(!(k%y))return!1;return!0}function m(k){return(k-(k|0))*4294967296|0}for(var w=2,d=0;d<64;)x(w)&&(d<8&&(u[d]=m(r.pow(w,1/2))),l[d]=m(r.pow(w,1/3)),d++),w++})();var f=[],h=c.SHA256=o.extend({_doReset:function(){this._hash=new i.init(u.slice(0))},_doProcessBlock:function(x,m){for(var w=this._hash.words,d=w[0],k=w[1],g=w[2],y=w[3],_=w[4],O=w[5],v=w[6],P=w[7],b=0;b<64;b++){if(b<16)f[b]=x[m+b]|0;else{var C=f[b-15],p=(C<<25|C>>>7)^(C<<14|C>>>18)^C>>>3,A=f[b-2],S=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;f[b]=p+f[b-7]+S+f[b-16]}var T=_&O^~_&v,F=d&k^d&g^k&g,K=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),$=(_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25),X=P+$+T+l[b]+f[b],te=K+F;P=v,v=O,O=_,_=y+X|0,y=g,g=k,k=d,d=X+te|0}w[0]=w[0]+d|0,w[1]=w[1]+k|0,w[2]=w[2]+g|0,w[3]=w[3]+y|0,w[4]=w[4]+_|0,w[5]=w[5]+O|0,w[6]=w[6]+v|0,w[7]=w[7]+P|0},_doFinalize:function(){var x=this._data,m=x.words,w=this._nDataBytes*8,d=x.sigBytes*8;return m[d>>>5]|=128<<24-d%32,m[(d+64>>>9<<4)+14]=r.floor(w/4294967296),m[(d+64>>>9<<4)+15]=w,x.sigBytes=m.length*4,this._process(),this._hash},clone:function(){var x=o.clone.call(this);return x._hash=this._hash.clone(),x}});a.SHA256=o._createHelper(h),a.HmacSHA256=o._createHmacHelper(h)}(Math),t.SHA256})}(us)),us.exports}var ls={exports:{}},Qo;function ch(){return Qo||(Qo=1,function(n,e){(function(t,r,a){n.exports=r(oe(),cs())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.WordArray,i=r.algo,o=i.SHA256,c=i.SHA224=o.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=o._doFinalize.call(this);return u.sigBytes-=4,u}});r.SHA224=o._createHelper(c),r.HmacSHA224=o._createHmacHelper(c)}(),t.SHA224})}(ls)),ls.exports}var hs={exports:{}},eu;function tu(){return eu||(eu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),An())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.Hasher,i=r.x64,o=i.Word,c=i.WordArray,u=r.algo;function l(){return o.create.apply(o,arguments)}var f=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],h=[];(function(){for(var m=0;m<80;m++)h[m]=l()})();var x=u.SHA512=s.extend({_doReset:function(){this._hash=new c.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(m,w){for(var d=this._hash.words,k=d[0],g=d[1],y=d[2],_=d[3],O=d[4],v=d[5],P=d[6],b=d[7],C=k.high,p=k.low,A=g.high,S=g.low,T=y.high,F=y.low,K=_.high,$=_.low,X=O.high,te=O.low,J=v.high,Y=v.low,R=P.high,L=P.low,z=b.high,j=b.low,ye=C,de=p,je=A,D=S,E=T,I=F,B=K,M=$,N=X,V=te,ne=J,xe=Y,ve=R,$e=L,Re=z,Pe=j,fe=0;fe<80;fe++){var le,We,ir=h[fe];if(fe<16)We=ir.high=m[w+fe*2]|0,le=ir.low=m[w+fe*2+1]|0;else{var q0=h[fe-15],Rr=q0.high,_n=q0.low,ob=(Rr>>>1|_n<<31)^(Rr>>>8|_n<<24)^Rr>>>7,W0=(_n>>>1|Rr<<31)^(_n>>>8|Rr<<24)^(_n>>>7|Rr<<25),Z0=h[fe-2],Dr=Z0.high,vn=Z0.low,ub=(Dr>>>19|vn<<13)^(Dr<<3|vn>>>29)^Dr>>>6,G0=(vn>>>19|Dr<<13)^(vn<<3|Dr>>>29)^(vn>>>6|Dr<<26),Y0=h[fe-7],cb=Y0.high,lb=Y0.low,X0=h[fe-16],hb=X0.high,J0=X0.low;le=W0+lb,We=ob+cb+(le>>>0<W0>>>0?1:0),le=le+G0,We=We+ub+(le>>>0<G0>>>0?1:0),le=le+J0,We=We+hb+(le>>>0<J0>>>0?1:0),ir.high=We,ir.low=le}var db=N&ne^~N&ve,Q0=V&xe^~V&$e,fb=ye&je^ye&E^je&E,pb=de&D^de&I^D&I,mb=(ye>>>28|de<<4)^(ye<<30|de>>>2)^(ye<<25|de>>>7),eh=(de>>>28|ye<<4)^(de<<30|ye>>>2)^(de<<25|ye>>>7),gb=(N>>>14|V<<18)^(N>>>18|V<<14)^(N<<23|V>>>9),yb=(V>>>14|N<<18)^(V>>>18|N<<14)^(V<<23|N>>>9),th=f[fe],xb=th.high,rh=th.low,nt=Pe+yb,Ht=Re+gb+(nt>>>0<Pe>>>0?1:0),nt=nt+Q0,Ht=Ht+db+(nt>>>0<Q0>>>0?1:0),nt=nt+rh,Ht=Ht+xb+(nt>>>0<rh>>>0?1:0),nt=nt+le,Ht=Ht+We+(nt>>>0<le>>>0?1:0),nh=eh+pb,bb=mb+fb+(nh>>>0<eh>>>0?1:0);Re=ve,Pe=$e,ve=ne,$e=xe,ne=N,xe=V,V=M+nt|0,N=B+Ht+(V>>>0<M>>>0?1:0)|0,B=E,M=I,E=je,I=D,je=ye,D=de,de=nt+nh|0,ye=Ht+bb+(de>>>0<nt>>>0?1:0)|0}p=k.low=p+de,k.high=C+ye+(p>>>0<de>>>0?1:0),S=g.low=S+D,g.high=A+je+(S>>>0<D>>>0?1:0),F=y.low=F+I,y.high=T+E+(F>>>0<I>>>0?1:0),$=_.low=$+M,_.high=K+B+($>>>0<M>>>0?1:0),te=O.low=te+V,O.high=X+N+(te>>>0<V>>>0?1:0),Y=v.low=Y+xe,v.high=J+ne+(Y>>>0<xe>>>0?1:0),L=P.low=L+$e,P.high=R+ve+(L>>>0<$e>>>0?1:0),j=b.low=j+Pe,b.high=z+Re+(j>>>0<Pe>>>0?1:0)},_doFinalize:function(){var m=this._data,w=m.words,d=this._nDataBytes*8,k=m.sigBytes*8;w[k>>>5]|=128<<24-k%32,w[(k+128>>>10<<5)+30]=Math.floor(d/4294967296),w[(k+128>>>10<<5)+31]=d,m.sigBytes=w.length*4,this._process();var g=this._hash.toX32();return g},clone:function(){var m=s.clone.call(this);return m._hash=this._hash.clone(),m},blockSize:1024/32});r.SHA512=s._createHelper(x),r.HmacSHA512=s._createHmacHelper(x)}(),t.SHA512})}(hs)),hs.exports}var ds={exports:{}},ru;function lh(){return ru||(ru=1,function(n,e){(function(t,r,a){n.exports=r(oe(),An(),tu())})(Q,function(t){return function(){var r=t,a=r.x64,s=a.Word,i=a.WordArray,o=r.algo,c=o.SHA512,u=o.SHA384=c.extend({_doReset:function(){this._hash=new i.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var l=c._doFinalize.call(this);return l.sigBytes-=16,l}});r.SHA384=c._createHelper(u),r.HmacSHA384=c._createHmacHelper(u)}(),t.SHA384})}(ds)),ds.exports}var fs={exports:{}},nu;function hh(){return nu||(nu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),An())})(Q,function(t){return function(r){var a=t,s=a.lib,i=s.WordArray,o=s.Hasher,c=a.x64,u=c.Word,l=a.algo,f=[],h=[],x=[];(function(){for(var d=1,k=0,g=0;g<24;g++){f[d+5*k]=(g+1)*(g+2)/2%64;var y=k%5,_=(2*d+3*k)%5;d=y,k=_}for(var d=0;d<5;d++)for(var k=0;k<5;k++)h[d+5*k]=k+(2*d+3*k)%5*5;for(var O=1,v=0;v<24;v++){for(var P=0,b=0,C=0;C<7;C++){if(O&1){var p=(1<<C)-1;p<32?b^=1<<p:P^=1<<p-32}O&128?O=O<<1^113:O<<=1}x[v]=u.create(P,b)}})();var m=[];(function(){for(var d=0;d<25;d++)m[d]=u.create()})();var w=l.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var d=this._state=[],k=0;k<25;k++)d[k]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(d,k){for(var g=this._state,y=this.blockSize/2,_=0;_<y;_++){var O=d[k+2*_],v=d[k+2*_+1];O=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,v=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360;var P=g[_];P.high^=v,P.low^=O}for(var b=0;b<24;b++){for(var C=0;C<5;C++){for(var p=0,A=0,S=0;S<5;S++){var P=g[C+5*S];p^=P.high,A^=P.low}var T=m[C];T.high=p,T.low=A}for(var C=0;C<5;C++)for(var F=m[(C+4)%5],K=m[(C+1)%5],$=K.high,X=K.low,p=F.high^($<<1|X>>>31),A=F.low^(X<<1|$>>>31),S=0;S<5;S++){var P=g[C+5*S];P.high^=p,P.low^=A}for(var te=1;te<25;te++){var p,A,P=g[te],J=P.high,Y=P.low,R=f[te];R<32?(p=J<<R|Y>>>32-R,A=Y<<R|J>>>32-R):(p=Y<<R-32|J>>>64-R,A=J<<R-32|Y>>>64-R);var L=m[h[te]];L.high=p,L.low=A}var z=m[0],j=g[0];z.high=j.high,z.low=j.low;for(var C=0;C<5;C++)for(var S=0;S<5;S++){var te=C+5*S,P=g[te],ye=m[te],de=m[(C+1)%5+5*S],je=m[(C+2)%5+5*S];P.high=ye.high^~de.high&je.high,P.low=ye.low^~de.low&je.low}var P=g[0],D=x[b];P.high^=D.high,P.low^=D.low}},_doFinalize:function(){var d=this._data,k=d.words;this._nDataBytes*8;var g=d.sigBytes*8,y=this.blockSize*32;k[g>>>5]|=1<<24-g%32,k[(r.ceil((g+1)/y)*y>>>5)-1]|=128,d.sigBytes=k.length*4,this._process();for(var _=this._state,O=this.cfg.outputLength/8,v=O/8,P=[],b=0;b<v;b++){var C=_[b],p=C.high,A=C.low;p=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,A=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,P.push(A),P.push(p)}return new i.init(P,O)},clone:function(){for(var d=o.clone.call(this),k=d._state=this._state.slice(0),g=0;g<25;g++)k[g]=k[g].clone();return d}});a.SHA3=o._createHelper(w),a.HmacSHA3=o._createHmacHelper(w)}(Math),t.SHA3})}(fs)),fs.exports}var ps={exports:{}},au;function dh(){return au||(au=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){/** @preserve
				(c) 2012 by Cédric Mesnil. All rights reserved.

				Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

				    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
				    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

				THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
				*/return function(r){var a=t,s=a.lib,i=s.WordArray,o=s.Hasher,c=a.algo,u=i.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=i.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),f=i.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=i.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),x=i.create([0,1518500249,1859775393,2400959708,2840853838]),m=i.create([1352829926,1548603684,1836072691,2053994217,0]),w=c.RIPEMD160=o.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(v,P){for(var b=0;b<16;b++){var C=P+b,p=v[C];v[C]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360}var A=this._hash.words,S=x.words,T=m.words,F=u.words,K=l.words,$=f.words,X=h.words,te,J,Y,R,L,z,j,ye,de,je;z=te=A[0],j=J=A[1],ye=Y=A[2],de=R=A[3],je=L=A[4];for(var D,b=0;b<80;b+=1)D=te+v[P+F[b]]|0,b<16?D+=d(J,Y,R)+S[0]:b<32?D+=k(J,Y,R)+S[1]:b<48?D+=g(J,Y,R)+S[2]:b<64?D+=y(J,Y,R)+S[3]:D+=_(J,Y,R)+S[4],D=D|0,D=O(D,$[b]),D=D+L|0,te=L,L=R,R=O(Y,10),Y=J,J=D,D=z+v[P+K[b]]|0,b<16?D+=_(j,ye,de)+T[0]:b<32?D+=y(j,ye,de)+T[1]:b<48?D+=g(j,ye,de)+T[2]:b<64?D+=k(j,ye,de)+T[3]:D+=d(j,ye,de)+T[4],D=D|0,D=O(D,X[b]),D=D+je|0,z=je,je=de,de=O(ye,10),ye=j,j=D;D=A[1]+Y+de|0,A[1]=A[2]+R+je|0,A[2]=A[3]+L+z|0,A[3]=A[4]+te+j|0,A[4]=A[0]+J+ye|0,A[0]=D},_doFinalize:function(){var v=this._data,P=v.words,b=this._nDataBytes*8,C=v.sigBytes*8;P[C>>>5]|=128<<24-C%32,P[(C+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,v.sigBytes=(P.length+1)*4,this._process();for(var p=this._hash,A=p.words,S=0;S<5;S++){var T=A[S];A[S]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360}return p},clone:function(){var v=o.clone.call(this);return v._hash=this._hash.clone(),v}});function d(v,P,b){return v^P^b}function k(v,P,b){return v&P|~v&b}function g(v,P,b){return(v|~P)^b}function y(v,P,b){return v&b|P&~b}function _(v,P,b){return v^(P|~b)}function O(v,P){return v<<P|v>>>32-P}a.RIPEMD160=o._createHelper(w),a.HmacRIPEMD160=o._createHmacHelper(w)}(),t.RIPEMD160})}(ps)),ps.exports}var ms={exports:{}},su;function gs(){return su||(su=1,function(n,e){(function(t,r){n.exports=r(oe())})(Q,function(t){(function(){var r=t,a=r.lib,s=a.Base,i=r.enc,o=i.Utf8,c=r.algo;c.HMAC=s.extend({init:function(u,l){u=this._hasher=new u.init,typeof l=="string"&&(l=o.parse(l));var f=u.blockSize,h=f*4;l.sigBytes>h&&(l=u.finalize(l)),l.clamp();for(var x=this._oKey=l.clone(),m=this._iKey=l.clone(),w=x.words,d=m.words,k=0;k<f;k++)w[k]^=1549556828,d[k]^=909522486;x.sigBytes=m.sigBytes=h,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var l=this._hasher,f=l.finalize(u);l.reset();var h=l.finalize(this._oKey.clone().concat(f));return h}})})()})}(ms)),ms.exports}var ys={exports:{}},iu;function fh(){return iu||(iu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),cs(),gs())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.Base,i=a.WordArray,o=r.algo,c=o.SHA256,u=o.HMAC,l=o.PBKDF2=s.extend({cfg:s.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(f){this.cfg=this.cfg.extend(f)},compute:function(f,h){for(var x=this.cfg,m=u.create(x.hasher,f),w=i.create(),d=i.create([1]),k=w.words,g=d.words,y=x.keySize,_=x.iterations;k.length<y;){var O=m.update(h).finalize(d);m.reset();for(var v=O.words,P=v.length,b=O,C=1;C<_;C++){b=m.finalize(b),m.reset();for(var p=b.words,A=0;A<P;A++)v[A]^=p[A]}w.concat(O),g[0]++}return w.sigBytes=y*4,w}});r.PBKDF2=function(f,h,x){return l.create(x).compute(f,h)}}(),t.PBKDF2})}(ys)),ys.exports}var xs={exports:{}},ou;function Nt(){return ou||(ou=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Xo(),gs())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.Base,i=a.WordArray,o=r.algo,c=o.MD5,u=o.EvpKDF=s.extend({cfg:s.extend({keySize:128/32,hasher:c,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,f){for(var h,x=this.cfg,m=x.hasher.create(),w=i.create(),d=w.words,k=x.keySize,g=x.iterations;d.length<k;){h&&m.update(h),h=m.update(l).finalize(f),m.reset();for(var y=1;y<g;y++)h=m.finalize(h),m.reset();w.concat(h)}return w.sigBytes=k*4,w}});r.EvpKDF=function(l,f,h){return u.create(h).compute(l,f)}}(),t.EvpKDF})}(xs)),xs.exports}var bs={exports:{}},uu;function Oe(){return uu||(uu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Nt())})(Q,function(t){t.lib.Cipher||function(r){var a=t,s=a.lib,i=s.Base,o=s.WordArray,c=s.BufferedBlockAlgorithm,u=a.enc;u.Utf8;var l=u.Base64,f=a.algo,h=f.EvpKDF,x=s.Cipher=c.extend({cfg:i.extend(),createEncryptor:function(p,A){return this.create(this._ENC_XFORM_MODE,p,A)},createDecryptor:function(p,A){return this.create(this._DEC_XFORM_MODE,p,A)},init:function(p,A,S){this.cfg=this.cfg.extend(S),this._xformMode=p,this._key=A,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(p){return this._append(p),this._process()},finalize:function(p){p&&this._append(p);var A=this._doFinalize();return A},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function p(A){return typeof A=="string"?C:v}return function(A){return{encrypt:function(S,T,F){return p(T).encrypt(A,S,T,F)},decrypt:function(S,T,F){return p(T).decrypt(A,S,T,F)}}}}()});s.StreamCipher=x.extend({_doFinalize:function(){var p=this._process(!0);return p},blockSize:1});var m=a.mode={},w=s.BlockCipherMode=i.extend({createEncryptor:function(p,A){return this.Encryptor.create(p,A)},createDecryptor:function(p,A){return this.Decryptor.create(p,A)},init:function(p,A){this._cipher=p,this._iv=A}}),d=m.CBC=function(){var p=w.extend();p.Encryptor=p.extend({processBlock:function(S,T){var F=this._cipher,K=F.blockSize;A.call(this,S,T,K),F.encryptBlock(S,T),this._prevBlock=S.slice(T,T+K)}}),p.Decryptor=p.extend({processBlock:function(S,T){var F=this._cipher,K=F.blockSize,$=S.slice(T,T+K);F.decryptBlock(S,T),A.call(this,S,T,K),this._prevBlock=$}});function A(S,T,F){var K,$=this._iv;$?(K=$,this._iv=r):K=this._prevBlock;for(var X=0;X<F;X++)S[T+X]^=K[X]}return p}(),k=a.pad={},g=k.Pkcs7={pad:function(p,A){for(var S=A*4,T=S-p.sigBytes%S,F=T<<24|T<<16|T<<8|T,K=[],$=0;$<T;$+=4)K.push(F);var X=o.create(K,T);p.concat(X)},unpad:function(p){var A=p.words[p.sigBytes-1>>>2]&255;p.sigBytes-=A}};s.BlockCipher=x.extend({cfg:x.cfg.extend({mode:d,padding:g}),reset:function(){var p;x.reset.call(this);var A=this.cfg,S=A.iv,T=A.mode;this._xformMode==this._ENC_XFORM_MODE?p=T.createEncryptor:(p=T.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==p?this._mode.init(this,S&&S.words):(this._mode=p.call(T,this,S&&S.words),this._mode.__creator=p)},_doProcessBlock:function(p,A){this._mode.processBlock(p,A)},_doFinalize:function(){var p,A=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(A.pad(this._data,this.blockSize),p=this._process(!0)):(p=this._process(!0),A.unpad(p)),p},blockSize:128/32});var y=s.CipherParams=i.extend({init:function(p){this.mixIn(p)},toString:function(p){return(p||this.formatter).stringify(this)}}),_=a.format={},O=_.OpenSSL={stringify:function(p){var A,S=p.ciphertext,T=p.salt;return T?A=o.create([1398893684,1701076831]).concat(T).concat(S):A=S,A.toString(l)},parse:function(p){var A,S=l.parse(p),T=S.words;return T[0]==1398893684&&T[1]==1701076831&&(A=o.create(T.slice(2,4)),T.splice(0,4),S.sigBytes-=16),y.create({ciphertext:S,salt:A})}},v=s.SerializableCipher=i.extend({cfg:i.extend({format:O}),encrypt:function(p,A,S,T){T=this.cfg.extend(T);var F=p.createEncryptor(S,T),K=F.finalize(A),$=F.cfg;return y.create({ciphertext:K,key:S,iv:$.iv,algorithm:p,mode:$.mode,padding:$.padding,blockSize:p.blockSize,formatter:T.format})},decrypt:function(p,A,S,T){T=this.cfg.extend(T),A=this._parse(A,T.format);var F=p.createDecryptor(S,T).finalize(A.ciphertext);return F},_parse:function(p,A){return typeof p=="string"?A.parse(p,this):p}}),P=a.kdf={},b=P.OpenSSL={execute:function(p,A,S,T,F){if(T||(T=o.random(64/8)),F)var K=h.create({keySize:A+S,hasher:F}).compute(p,T);else var K=h.create({keySize:A+S}).compute(p,T);var $=o.create(K.words.slice(A),S*4);return K.sigBytes=A*4,y.create({key:K,iv:$,salt:T})}},C=s.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:b}),encrypt:function(p,A,S,T){T=this.cfg.extend(T);var F=T.kdf.execute(S,p.keySize,p.ivSize,T.salt,T.hasher);T.iv=F.iv;var K=v.encrypt.call(this,p,A,F.key,T);return K.mixIn(F),K},decrypt:function(p,A,S,T){T=this.cfg.extend(T),A=this._parse(A,T.format);var F=T.kdf.execute(S,p.keySize,p.ivSize,A.salt,T.hasher);T.iv=F.iv;var K=v.decrypt.call(this,p,A,F.key,T);return K}})}()})}(bs)),bs.exports}var _s={exports:{}},cu;function ph(){return cu||(cu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(s,i){var o=this._cipher,c=o.blockSize;a.call(this,s,i,c,o),this._prevBlock=s.slice(i,i+c)}}),r.Decryptor=r.extend({processBlock:function(s,i){var o=this._cipher,c=o.blockSize,u=s.slice(i,i+c);a.call(this,s,i,c,o),this._prevBlock=u}});function a(s,i,o,c){var u,l=this._iv;l?(u=l.slice(0),this._iv=void 0):u=this._prevBlock,c.encryptBlock(u,0);for(var f=0;f<o;f++)s[i+f]^=u[f]}return r}(),t.mode.CFB})}(_s)),_s.exports}var vs={exports:{}},lu;function mh(){return lu||(lu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(s,i){var o=this._cipher,c=o.blockSize,u=this._iv,l=this._counter;u&&(l=this._counter=u.slice(0),this._iv=void 0);var f=l.slice(0);o.encryptBlock(f,0),l[c-1]=l[c-1]+1|0;for(var h=0;h<c;h++)s[i+h]^=f[h]}});return r.Decryptor=a,r}(),t.mode.CTR})}(vs)),vs.exports}var ws={exports:{}},hu;function gh(){return hu||(hu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function a(o){if((o>>24&255)===255){var c=o>>16&255,u=o>>8&255,l=o&255;c===255?(c=0,u===255?(u=0,l===255?l=0:++l):++u):++c,o=0,o+=c<<16,o+=u<<8,o+=l}else o+=1<<24;return o}function s(o){return(o[0]=a(o[0]))===0&&(o[1]=a(o[1])),o}var i=r.Encryptor=r.extend({processBlock:function(o,c){var u=this._cipher,l=u.blockSize,f=this._iv,h=this._counter;f&&(h=this._counter=f.slice(0),this._iv=void 0),s(h);var x=h.slice(0);u.encryptBlock(x,0);for(var m=0;m<l;m++)o[c+m]^=x[m]}});return r.Decryptor=i,r}(),t.mode.CTRGladman})}(ws)),ws.exports}var As={exports:{}},du;function yh(){return du||(du=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(s,i){var o=this._cipher,c=o.blockSize,u=this._iv,l=this._keystream;u&&(l=this._keystream=u.slice(0),this._iv=void 0),o.encryptBlock(l,0);for(var f=0;f<c;f++)s[i+f]^=l[f]}});return r.Decryptor=a,r}(),t.mode.OFB})}(As)),As.exports}var Es={exports:{}},fu;function xh(){return fu||(fu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(a,s){this._cipher.encryptBlock(a,s)}}),r.Decryptor=r.extend({processBlock:function(a,s){this._cipher.decryptBlock(a,s)}}),r}(),t.mode.ECB})}(Es)),Es.exports}var Cs={exports:{}},pu;function bh(){return pu||(pu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.pad.AnsiX923={pad:function(r,a){var s=r.sigBytes,i=a*4,o=i-s%i,c=s+o-1;r.clamp(),r.words[c>>>2]|=o<<24-c%4*8,r.sigBytes+=o},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},t.pad.Ansix923})}(Cs)),Cs.exports}var Ps={exports:{}},mu;function _h(){return mu||(mu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.pad.Iso10126={pad:function(r,a){var s=a*4,i=s-r.sigBytes%s;r.concat(t.lib.WordArray.random(i-1)).concat(t.lib.WordArray.create([i<<24],1))},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},t.pad.Iso10126})}(Ps)),Ps.exports}var ks={exports:{}},gu;function vh(){return gu||(gu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.pad.Iso97971={pad:function(r,a){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,a)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(ks)),ks.exports}var Ss={exports:{}},yu;function wh(){return yu||(yu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.pad.ZeroPadding={pad:function(r,a){var s=a*4;r.clamp(),r.sigBytes+=s-(r.sigBytes%s||s)},unpad:function(r){for(var a=r.words,s=r.sigBytes-1,s=r.sigBytes-1;s>=0;s--)if(a[s>>>2]>>>24-s%4*8&255){r.sigBytes=s+1;break}}},t.pad.ZeroPadding})}(Ss)),Ss.exports}var Is={exports:{}},xu;function Ah(){return xu||(xu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(Is)),Is.exports}var Os={exports:{}},bu;function Eh(){return bu||(bu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),Oe())})(Q,function(t){return function(r){var a=t,s=a.lib,i=s.CipherParams,o=a.enc,c=o.Hex,u=a.format;u.Hex={stringify:function(l){return l.ciphertext.toString(c)},parse:function(l){var f=c.parse(l);return i.create({ciphertext:f})}}}(),t.format.Hex})}(Os)),Os.exports}var Bs={exports:{}},_u;function Ch(){return _u||(_u=1,function(n,e){(function(t,r,a){n.exports=r(oe(),qt(),Wt(),Nt(),Oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.BlockCipher,i=r.algo,o=[],c=[],u=[],l=[],f=[],h=[],x=[],m=[],w=[],d=[];(function(){for(var y=[],_=0;_<256;_++)_<128?y[_]=_<<1:y[_]=_<<1^283;for(var O=0,v=0,_=0;_<256;_++){var P=v^v<<1^v<<2^v<<3^v<<4;P=P>>>8^P&255^99,o[O]=P,c[P]=O;var b=y[O],C=y[b],p=y[C],A=y[P]*257^P*16843008;u[O]=A<<24|A>>>8,l[O]=A<<16|A>>>16,f[O]=A<<8|A>>>24,h[O]=A;var A=p*16843009^C*65537^b*257^O*16843008;x[P]=A<<24|A>>>8,m[P]=A<<16|A>>>16,w[P]=A<<8|A>>>24,d[P]=A,O?(O=b^y[y[y[p^b]]],v^=y[y[v]]):O=v=1}})();var k=[0,1,2,4,8,16,32,64,128,27,54],g=i.AES=s.extend({_doReset:function(){var y;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var _=this._keyPriorReset=this._key,O=_.words,v=_.sigBytes/4,P=this._nRounds=v+6,b=(P+1)*4,C=this._keySchedule=[],p=0;p<b;p++)p<v?C[p]=O[p]:(y=C[p-1],p%v?v>6&&p%v==4&&(y=o[y>>>24]<<24|o[y>>>16&255]<<16|o[y>>>8&255]<<8|o[y&255]):(y=y<<8|y>>>24,y=o[y>>>24]<<24|o[y>>>16&255]<<16|o[y>>>8&255]<<8|o[y&255],y^=k[p/v|0]<<24),C[p]=C[p-v]^y);for(var A=this._invKeySchedule=[],S=0;S<b;S++){var p=b-S;if(S%4)var y=C[p];else var y=C[p-4];S<4||p<=4?A[S]=y:A[S]=x[o[y>>>24]]^m[o[y>>>16&255]]^w[o[y>>>8&255]]^d[o[y&255]]}}},encryptBlock:function(y,_){this._doCryptBlock(y,_,this._keySchedule,u,l,f,h,o)},decryptBlock:function(y,_){var O=y[_+1];y[_+1]=y[_+3],y[_+3]=O,this._doCryptBlock(y,_,this._invKeySchedule,x,m,w,d,c);var O=y[_+1];y[_+1]=y[_+3],y[_+3]=O},_doCryptBlock:function(y,_,O,v,P,b,C,p){for(var A=this._nRounds,S=y[_]^O[0],T=y[_+1]^O[1],F=y[_+2]^O[2],K=y[_+3]^O[3],$=4,X=1;X<A;X++){var te=v[S>>>24]^P[T>>>16&255]^b[F>>>8&255]^C[K&255]^O[$++],J=v[T>>>24]^P[F>>>16&255]^b[K>>>8&255]^C[S&255]^O[$++],Y=v[F>>>24]^P[K>>>16&255]^b[S>>>8&255]^C[T&255]^O[$++],R=v[K>>>24]^P[S>>>16&255]^b[T>>>8&255]^C[F&255]^O[$++];S=te,T=J,F=Y,K=R}var te=(p[S>>>24]<<24|p[T>>>16&255]<<16|p[F>>>8&255]<<8|p[K&255])^O[$++],J=(p[T>>>24]<<24|p[F>>>16&255]<<16|p[K>>>8&255]<<8|p[S&255])^O[$++],Y=(p[F>>>24]<<24|p[K>>>16&255]<<16|p[S>>>8&255]<<8|p[T&255])^O[$++],R=(p[K>>>24]<<24|p[S>>>16&255]<<16|p[T>>>8&255]<<8|p[F&255])^O[$++];y[_]=te,y[_+1]=J,y[_+2]=Y,y[_+3]=R},keySize:256/32});r.AES=s._createHelper(g)}(),t.AES})}(Bs)),Bs.exports}var Ts={exports:{}},vu;function Ph(){return vu||(vu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),qt(),Wt(),Nt(),Oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.WordArray,i=a.BlockCipher,o=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],f=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],x=o.DES=i.extend({_doReset:function(){for(var k=this._key,g=k.words,y=[],_=0;_<56;_++){var O=c[_]-1;y[_]=g[O>>>5]>>>31-O%32&1}for(var v=this._subKeys=[],P=0;P<16;P++){for(var b=v[P]=[],C=l[P],_=0;_<24;_++)b[_/6|0]|=y[(u[_]-1+C)%28]<<31-_%6,b[4+(_/6|0)]|=y[28+(u[_+24]-1+C)%28]<<31-_%6;b[0]=b[0]<<1|b[0]>>>31;for(var _=1;_<7;_++)b[_]=b[_]>>>(_-1)*4+3;b[7]=b[7]<<5|b[7]>>>27}for(var p=this._invSubKeys=[],_=0;_<16;_++)p[_]=v[15-_]},encryptBlock:function(k,g){this._doCryptBlock(k,g,this._subKeys)},decryptBlock:function(k,g){this._doCryptBlock(k,g,this._invSubKeys)},_doCryptBlock:function(k,g,y){this._lBlock=k[g],this._rBlock=k[g+1],m.call(this,4,252645135),m.call(this,16,65535),w.call(this,2,858993459),w.call(this,8,16711935),m.call(this,1,1431655765);for(var _=0;_<16;_++){for(var O=y[_],v=this._lBlock,P=this._rBlock,b=0,C=0;C<8;C++)b|=f[C][((P^O[C])&h[C])>>>0];this._lBlock=P,this._rBlock=v^b}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,m.call(this,1,1431655765),w.call(this,8,16711935),w.call(this,2,858993459),m.call(this,16,65535),m.call(this,4,252645135),k[g]=this._lBlock,k[g+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function m(k,g){var y=(this._lBlock>>>k^this._rBlock)&g;this._rBlock^=y,this._lBlock^=y<<k}function w(k,g){var y=(this._rBlock>>>k^this._lBlock)&g;this._lBlock^=y,this._rBlock^=y<<k}r.DES=i._createHelper(x);var d=o.TripleDES=i.extend({_doReset:function(){var k=this._key,g=k.words;if(g.length!==2&&g.length!==4&&g.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var y=g.slice(0,2),_=g.length<4?g.slice(0,2):g.slice(2,4),O=g.length<6?g.slice(0,2):g.slice(4,6);this._des1=x.createEncryptor(s.create(y)),this._des2=x.createEncryptor(s.create(_)),this._des3=x.createEncryptor(s.create(O))},encryptBlock:function(k,g){this._des1.encryptBlock(k,g),this._des2.decryptBlock(k,g),this._des3.encryptBlock(k,g)},decryptBlock:function(k,g){this._des3.decryptBlock(k,g),this._des2.encryptBlock(k,g),this._des1.decryptBlock(k,g)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=i._createHelper(d)}(),t.TripleDES})}(Ts)),Ts.exports}var Rs={exports:{}},wu;function kh(){return wu||(wu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),qt(),Wt(),Nt(),Oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.StreamCipher,i=r.algo,o=i.RC4=s.extend({_doReset:function(){for(var l=this._key,f=l.words,h=l.sigBytes,x=this._S=[],m=0;m<256;m++)x[m]=m;for(var m=0,w=0;m<256;m++){var d=m%h,k=f[d>>>2]>>>24-d%4*8&255;w=(w+x[m]+k)%256;var g=x[m];x[m]=x[w],x[w]=g}this._i=this._j=0},_doProcessBlock:function(l,f){l[f]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var l=this._S,f=this._i,h=this._j,x=0,m=0;m<4;m++){f=(f+1)%256,h=(h+l[f])%256;var w=l[f];l[f]=l[h],l[h]=w,x|=l[(l[f]+l[h])%256]<<24-m*8}return this._i=f,this._j=h,x}r.RC4=s._createHelper(o);var u=i.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var l=this.cfg.drop;l>0;l--)c.call(this)}});r.RC4Drop=s._createHelper(u)}(),t.RC4})}(Rs)),Rs.exports}var Ds={exports:{}},Au;function Sh(){return Au||(Au=1,function(n,e){(function(t,r,a){n.exports=r(oe(),qt(),Wt(),Nt(),Oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.StreamCipher,i=r.algo,o=[],c=[],u=[],l=i.Rabbit=s.extend({_doReset:function(){for(var h=this._key.words,x=this.cfg.iv,m=0;m<4;m++)h[m]=(h[m]<<8|h[m]>>>24)&16711935|(h[m]<<24|h[m]>>>8)&4278255360;var w=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],d=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var m=0;m<4;m++)f.call(this);for(var m=0;m<8;m++)d[m]^=w[m+4&7];if(x){var k=x.words,g=k[0],y=k[1],_=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,O=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,v=_>>>16|O&4294901760,P=O<<16|_&65535;d[0]^=_,d[1]^=v,d[2]^=O,d[3]^=P,d[4]^=_,d[5]^=v,d[6]^=O,d[7]^=P;for(var m=0;m<4;m++)f.call(this)}},_doProcessBlock:function(h,x){var m=this._X;f.call(this),o[0]=m[0]^m[5]>>>16^m[3]<<16,o[1]=m[2]^m[7]>>>16^m[5]<<16,o[2]=m[4]^m[1]>>>16^m[7]<<16,o[3]=m[6]^m[3]>>>16^m[1]<<16;for(var w=0;w<4;w++)o[w]=(o[w]<<8|o[w]>>>24)&16711935|(o[w]<<24|o[w]>>>8)&4278255360,h[x+w]^=o[w]},blockSize:128/32,ivSize:64/32});function f(){for(var h=this._X,x=this._C,m=0;m<8;m++)c[m]=x[m];x[0]=x[0]+1295307597+this._b|0,x[1]=x[1]+3545052371+(x[0]>>>0<c[0]>>>0?1:0)|0,x[2]=x[2]+886263092+(x[1]>>>0<c[1]>>>0?1:0)|0,x[3]=x[3]+1295307597+(x[2]>>>0<c[2]>>>0?1:0)|0,x[4]=x[4]+3545052371+(x[3]>>>0<c[3]>>>0?1:0)|0,x[5]=x[5]+886263092+(x[4]>>>0<c[4]>>>0?1:0)|0,x[6]=x[6]+1295307597+(x[5]>>>0<c[5]>>>0?1:0)|0,x[7]=x[7]+3545052371+(x[6]>>>0<c[6]>>>0?1:0)|0,this._b=x[7]>>>0<c[7]>>>0?1:0;for(var m=0;m<8;m++){var w=h[m]+x[m],d=w&65535,k=w>>>16,g=((d*d>>>17)+d*k>>>15)+k*k,y=((w&4294901760)*w|0)+((w&65535)*w|0);u[m]=g^y}h[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,h[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,h[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,h[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,h[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,h[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,h[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,h[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.Rabbit=s._createHelper(l)}(),t.Rabbit})}(Ds)),Ds.exports}var Fs={exports:{}},Eu;function Ih(){return Eu||(Eu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),qt(),Wt(),Nt(),Oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.StreamCipher,i=r.algo,o=[],c=[],u=[],l=i.RabbitLegacy=s.extend({_doReset:function(){var h=this._key.words,x=this.cfg.iv,m=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],w=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var d=0;d<4;d++)f.call(this);for(var d=0;d<8;d++)w[d]^=m[d+4&7];if(x){var k=x.words,g=k[0],y=k[1],_=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,O=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,v=_>>>16|O&4294901760,P=O<<16|_&65535;w[0]^=_,w[1]^=v,w[2]^=O,w[3]^=P,w[4]^=_,w[5]^=v,w[6]^=O,w[7]^=P;for(var d=0;d<4;d++)f.call(this)}},_doProcessBlock:function(h,x){var m=this._X;f.call(this),o[0]=m[0]^m[5]>>>16^m[3]<<16,o[1]=m[2]^m[7]>>>16^m[5]<<16,o[2]=m[4]^m[1]>>>16^m[7]<<16,o[3]=m[6]^m[3]>>>16^m[1]<<16;for(var w=0;w<4;w++)o[w]=(o[w]<<8|o[w]>>>24)&16711935|(o[w]<<24|o[w]>>>8)&4278255360,h[x+w]^=o[w]},blockSize:128/32,ivSize:64/32});function f(){for(var h=this._X,x=this._C,m=0;m<8;m++)c[m]=x[m];x[0]=x[0]+1295307597+this._b|0,x[1]=x[1]+3545052371+(x[0]>>>0<c[0]>>>0?1:0)|0,x[2]=x[2]+886263092+(x[1]>>>0<c[1]>>>0?1:0)|0,x[3]=x[3]+1295307597+(x[2]>>>0<c[2]>>>0?1:0)|0,x[4]=x[4]+3545052371+(x[3]>>>0<c[3]>>>0?1:0)|0,x[5]=x[5]+886263092+(x[4]>>>0<c[4]>>>0?1:0)|0,x[6]=x[6]+1295307597+(x[5]>>>0<c[5]>>>0?1:0)|0,x[7]=x[7]+3545052371+(x[6]>>>0<c[6]>>>0?1:0)|0,this._b=x[7]>>>0<c[7]>>>0?1:0;for(var m=0;m<8;m++){var w=h[m]+x[m],d=w&65535,k=w>>>16,g=((d*d>>>17)+d*k>>>15)+k*k,y=((w&4294901760)*w|0)+((w&65535)*w|0);u[m]=g^y}h[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,h[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,h[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,h[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,h[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,h[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,h[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,h[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.RabbitLegacy=s._createHelper(l)}(),t.RabbitLegacy})}(Fs)),Fs.exports}var Ns={exports:{}},Cu;function Oh(){return Cu||(Cu=1,function(n,e){(function(t,r,a){n.exports=r(oe(),qt(),Wt(),Nt(),Oe())})(Q,function(t){return function(){var r=t,a=r.lib,s=a.BlockCipher,i=r.algo;const o=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],u=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var l={pbox:[],sbox:[]};function f(d,k){let g=k>>24&255,y=k>>16&255,_=k>>8&255,O=k&255,v=d.sbox[0][g]+d.sbox[1][y];return v=v^d.sbox[2][_],v=v+d.sbox[3][O],v}function h(d,k,g){let y=k,_=g,O;for(let v=0;v<o;++v)y=y^d.pbox[v],_=f(d,y)^_,O=y,y=_,_=O;return O=y,y=_,_=O,_=_^d.pbox[o],y=y^d.pbox[o+1],{left:y,right:_}}function x(d,k,g){let y=k,_=g,O;for(let v=o+1;v>1;--v)y=y^d.pbox[v],_=f(d,y)^_,O=y,y=_,_=O;return O=y,y=_,_=O,_=_^d.pbox[1],y=y^d.pbox[0],{left:y,right:_}}function m(d,k,g){for(let P=0;P<4;P++){d.sbox[P]=[];for(let b=0;b<256;b++)d.sbox[P][b]=u[P][b]}let y=0;for(let P=0;P<o+2;P++)d.pbox[P]=c[P]^k[y],y++,y>=g&&(y=0);let _=0,O=0,v=0;for(let P=0;P<o+2;P+=2)v=h(d,_,O),_=v.left,O=v.right,d.pbox[P]=_,d.pbox[P+1]=O;for(let P=0;P<4;P++)for(let b=0;b<256;b+=2)v=h(d,_,O),_=v.left,O=v.right,d.sbox[P][b]=_,d.sbox[P][b+1]=O;return!0}var w=i.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var d=this._keyPriorReset=this._key,k=d.words,g=d.sigBytes/4;m(l,k,g)}},encryptBlock:function(d,k){var g=h(l,d[k],d[k+1]);d[k]=g.left,d[k+1]=g.right},decryptBlock:function(d,k){var g=x(l,d[k],d[k+1]);d[k]=g.left,d[k+1]=g.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=s._createHelper(w)}(),t.Blowfish})}(Ns)),Ns.exports}(function(n,e){(function(t,r,a){n.exports=r(oe(),An(),ih(),oh(),qt(),uh(),Wt(),Xo(),cs(),ch(),tu(),lh(),hh(),dh(),gs(),fh(),Nt(),Oe(),ph(),mh(),gh(),yh(),xh(),bh(),_h(),vh(),wh(),Ah(),Eh(),Ch(),Ph(),kh(),Sh(),Ih(),Oh())})(Q,function(t){return t})})(Uo);var Bh=Uo.exports;const Th=Qe(Bh);class En{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}var Cn={};Cn.byteLength=Fh,Cn.toByteArray=jh,Cn.fromByteArray=zh;for(var gt=[],at=[],Rh=typeof Uint8Array<"u"?Uint8Array:Array,js="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",or=0,Dh=js.length;or<Dh;++or)gt[or]=js[or],at[js.charCodeAt(or)]=or;at["-".charCodeAt(0)]=62,at["_".charCodeAt(0)]=63;function Pu(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Fh(n){var e=Pu(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Nh(n,e,t){return(e+t)*3/4-t}function jh(n){var e,t=Pu(n),r=t[0],a=t[1],s=new Rh(Nh(n,r,a)),i=0,o=a>0?r-4:r,c;for(c=0;c<o;c+=4)e=at[n.charCodeAt(c)]<<18|at[n.charCodeAt(c+1)]<<12|at[n.charCodeAt(c+2)]<<6|at[n.charCodeAt(c+3)],s[i++]=e>>16&255,s[i++]=e>>8&255,s[i++]=e&255;return a===2&&(e=at[n.charCodeAt(c)]<<2|at[n.charCodeAt(c+1)]>>4,s[i++]=e&255),a===1&&(e=at[n.charCodeAt(c)]<<10|at[n.charCodeAt(c+1)]<<4|at[n.charCodeAt(c+2)]>>2,s[i++]=e>>8&255,s[i++]=e&255),s}function $h(n){return gt[n>>18&63]+gt[n>>12&63]+gt[n>>6&63]+gt[n&63]}function Lh(n,e,t){for(var r,a=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),a.push($h(r));return a.join("")}function zh(n){for(var e,t=n.length,r=t%3,a=[],s=16383,i=0,o=t-r;i<o;i+=s)a.push(Lh(n,i,i+s>o?o:i+s));return r===1?(e=n[t-1],a.push(gt[e>>2]+gt[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],a.push(gt[e>>10]+gt[e>>4&63]+gt[e<<2&63]+"=")),a.join("")}var Mh=Object.defineProperty,Uh=(n,e,t)=>e in n?Mh(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Kh=(n,e,t)=>(Uh(n,typeof e!="symbol"?e+"":e,t),t);function Hh(n,e){let t=Array.from({length:n.length},(r,a)=>({start:a,end:a+1}));for(;t.length>1;){let r=null;for(let a=0;a<t.length-1;a++){const s=n.slice(t[a].start,t[a+1].end),i=e.get(s.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,a])}if(r!=null){const a=r[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function Vh(n,e){return n.length===1?[e.get(n.join(","))]:Hh(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function qh(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var $s=class{constructor(n,e){ke(this,"specialTokens");ke(this,"inverseSpecialTokens");ke(this,"patStr");ke(this,"textEncoder",new TextEncoder);ke(this,"textDecoder",new TextDecoder("utf-8"));ke(this,"rankMap",new Map);ke(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,a)=>{const[s,i,...o]=a.split(" "),c=Number.parseInt(i,10);return o.forEach((u,l)=>r[u]=c+l),r},{});for(const[r,a]of Object.entries(t)){const s=Cn.toByteArray(r);this.rankMap.set(s.join(","),a),this.textMap.set(a,s)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[a,s])=>(r[s]=this.textEncoder.encode(a),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),a=$s.specialTokenRegex(Object.keys(this.specialTokens)),s=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(o.size>0){const u=$s.specialTokenRegex([...o]),l=n.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;a.lastIndex=l,u=a.exec(n),!(u==null||i.has(u[0]));)l=u.index+1;const f=(u==null?void 0:u.index)??n.length;for(const x of n.substring(c,f).matchAll(r)){const m=this.textEncoder.encode(x[0]),w=this.rankMap.get(m.join(","));if(w!=null){s.push(w);continue}s.push(...Vh(m,this.rankMap))}if(u==null)break;let h=this.specialTokens[u[0]];s.push(h),c=u.index+u[0].length}return s}decode(n){const e=[];let t=0;for(let s=0;s<n.length;++s){const i=n[s],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let a=0;for(const s of e)r.set(s,a),a+=s.length;return this.textDecoder.decode(r)}},ku=$s;Kh(ku,"specialTokenRegex",n=>new RegExp(n.map(e=>qh(e)).join("|"),"g"));function Wh(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}var Pn={exports:{}},Su={};function st(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Zh=st;st.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},st.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},st.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0},st.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},st.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)},st.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)},st.prototype.start=st.prototype.try,st.prototype.errors=function(){return this._errors},st.prototype.attempts=function(){return this._attempts},st.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var a=this._errors[r],s=a.message,i=(n[s]||0)+1;n[s]=i,i>=t&&(e=a,t=i)}return e},function(n){var e=Zh;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)r[a]=t[a];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],i=0;i<r.retries;i++)s.push(this.createTimeout(i,r));return t&&t.forever&&!s.length&&s.push(this.createTimeout(i,r)),s.sort(function(o,c){return o-c}),s},n.createTimeout=function(t,r){var a=r.randomize?Math.random()+1:1,s=Math.round(a*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return s=Math.min(s,r.maxTimeout),s},n.wrap=function(t,r,a){if(r instanceof Array&&(a=r,r=null),!a){a=[];for(var s in t)typeof t[s]=="function"&&a.push(s)}for(var i=0;i<a.length;i++){var o=a[i],c=t[o];t[o]=(function(l){var f=n.operation(r),h=Array.prototype.slice.call(arguments,1),x=h.pop();h.push(function(m){f.retry(m)||(m&&(arguments[0]=f.mainError()),x.apply(this,arguments))}),f.attempt(function(){l.apply(t,h)})}).bind(t,c),t[o].options=r}}}(Su);var Gh=Su;const Yh=Gh,Xh=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Iu extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Jh=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},Qh=n=>Xh.includes(n),Ou=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const a=Yh.operation(e);a.attempt(async s=>{try{t(await n(s))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof Iu)a.stop(),r(i.originalError);else if(i instanceof TypeError&&!Qh(i.message))a.stop(),r(i);else{Jh(i,s,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}a.retry(i)||r(a.mainError())}}})});Pn.exports=Ou,Pn.exports.default=Ou,Pn.exports.AbortError=Iu;var ed=Pn.exports;const kn=Qe(ed);var Bu={},Tu={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function a(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,f,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var x=new a(l,f||c,h),m=t?t+u:u;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],x]:c._events[m].push(x):(c._events[m]=x,c._eventsCount++),c}function i(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,f;if(this._eventsCount===0)return u;for(f in l=this._events)e.call(l,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=t?t+u:u,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,x=f.length,m=new Array(x);h<x;h++)m[h]=f[h].fn;return m},o.prototype.listenerCount=function(u){var l=t?t+u:u,f=this._events[l];return f?f.fn?1:f.length:0},o.prototype.emit=function(u,l,f,h,x,m){var w=t?t+u:u;if(!this._events[w])return!1;var d=this._events[w],k=arguments.length,g,y;if(d.fn){switch(d.once&&this.removeListener(u,d.fn,void 0,!0),k){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,l),!0;case 3:return d.fn.call(d.context,l,f),!0;case 4:return d.fn.call(d.context,l,f,h),!0;case 5:return d.fn.call(d.context,l,f,h,x),!0;case 6:return d.fn.call(d.context,l,f,h,x,m),!0}for(y=1,g=new Array(k-1);y<k;y++)g[y-1]=arguments[y];d.fn.apply(d.context,g)}else{var _=d.length,O;for(y=0;y<_;y++)switch(d[y].once&&this.removeListener(u,d[y].fn,void 0,!0),k){case 1:d[y].fn.call(d[y].context);break;case 2:d[y].fn.call(d[y].context,l);break;case 3:d[y].fn.call(d[y].context,l,f);break;case 4:d[y].fn.call(d[y].context,l,f,h);break;default:if(!g)for(O=1,g=new Array(k-1);O<k;O++)g[O-1]=arguments[O];d[y].fn.apply(d[y].context,g)}}return!0},o.prototype.on=function(u,l,f){return s(this,u,l,f,!1)},o.prototype.once=function(u,l,f){return s(this,u,l,f,!0)},o.prototype.removeListener=function(u,l,f,h){var x=t?t+u:u;if(!this._events[x])return this;if(!l)return i(this,x),this;var m=this._events[x];if(m.fn)m.fn===l&&(!h||m.once)&&(!f||m.context===f)&&i(this,x);else{for(var w=0,d=[],k=m.length;w<k;w++)(m[w].fn!==l||h&&!m[w].once||f&&m[w].context!==f)&&d.push(m[w]);d.length?this._events[x]=d.length===1?d[0]:d:i(this,x)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&i(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Tu);var td=Tu.exports,Sn={exports:{}},rd=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const nd=rd;class Ru extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Du=(n,e,t)=>new Promise((r,a)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(c){a(c)}return}const i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Ru(i);typeof n.cancel=="function"&&n.cancel(),a(o)},e);nd(n.then(r,a),()=>{clearTimeout(s)})});Sn.exports=Du,Sn.exports.default=Du,Sn.exports.TimeoutError=Ru;var ad=Sn.exports,Ls={},zs={};Object.defineProperty(zs,"__esModule",{value:!0});function sd(n,e,t){let r=0,a=n.length;for(;a>0;){const s=a/2|0;let i=r+s;t(n[i],e)<=0?(r=++i,a-=s+1):a=s}return r}zs.default=sd,Object.defineProperty(Ls,"__esModule",{value:!0});const id=zs;class od{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const a=id.default(this._queue,r,(s,i)=>i.priority-s.priority);this._queue.splice(a,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Ls.default=od,Object.defineProperty(Bu,"__esModule",{value:!0});const ud=td,Fu=ad,cd=Ls,In=()=>{},ld=new Fu.TimeoutError;class hd extends ud{constructor(e){var t,r,a,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=In,this._resolveIdle=In,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:cd.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(a=e.interval)===null||a===void 0?void 0:a.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=In,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=In,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{const s=async()=>{this._pendingCount++,this._intervalCount++;try{const i=this._timeout===void 0&&t.timeout===void 0?e():Fu.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&a(ld)});r(await i)}catch(i){a(i)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Et=Bu.default=hd;const dd=[400,401,402,403,404,405,406,407,408,409],fd=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.name==="TimeoutError"||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&dd.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const a=new Error(n==null?void 0:n.message);throw a.name="InsufficientQuotaError",a}};let On=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??fd;const t="default"in Et?Et.default:Et;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>kn(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,s)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const Bn={},pd=new On({});async function md(n,e){return n in Bn||(Bn[n]=pd.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete Bn[n],t})),new ku(await Bn[n],e==null?void 0:e.extendedSpecialTokens)}async function Nu(n,e){return md(Wh(n),e)}let Tn;const gd=new Uint8Array(16);function yd(){if(!Tn&&(Tn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Tn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tn(gd)}const xd=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function bd(n){return typeof n=="string"&&xd.test(n)}const De=[];for(let n=0;n<256;++n)De.push((n+256).toString(16).slice(1));function _d(n,e=0){return De[n[e+0]]+De[n[e+1]]+De[n[e+2]]+De[n[e+3]]+"-"+De[n[e+4]]+De[n[e+5]]+"-"+De[n[e+6]]+De[n[e+7]]+"-"+De[n[e+8]]+De[n[e+9]]+"-"+De[n[e+10]]+De[n[e+11]]+De[n[e+12]]+De[n[e+13]]+De[n[e+14]]+De[n[e+15]]}const ju={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ct(n,e,t){if(ju.randomUUID&&!e&&!n)return ju.randomUUID();n=n||{};const r=n.random||(n.rng||yd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=r[a];return e}return _d(r)}var vd=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const wd=Qe(vd);var $u={exports:{}};const Ad=/[\p{Lu}]/u,Ed=/[\p{Ll}]/u,Lu=/^[\p{Lu}](?![\p{Lu}])/gu,zu=/([\p{Alpha}\p{N}_]|$)/u,Mu=/[_.\- ]+/,Cd=new RegExp("^"+Mu.source),Uu=new RegExp(Mu.source+zu.source,"gu"),Ku=new RegExp("\\d+"+zu.source,"gu"),Pd=(n,e,t)=>{let r=!1,a=!1,s=!1;for(let i=0;i<n.length;i++){const o=n[i];r&&Ad.test(o)?(n=n.slice(0,i)+"-"+n.slice(i),r=!1,s=a,a=!0,i++):a&&s&&Ed.test(o)?(n=n.slice(0,i-1)+"-"+n.slice(i-1),s=a,a=!1,r=!0):(r=e(o)===o&&t(o)!==o,s=a,a=t(o)===o&&e(o)!==o)}return n},kd=(n,e)=>(Lu.lastIndex=0,n.replace(Lu,t=>e(t))),Sd=(n,e)=>(Uu.lastIndex=0,Ku.lastIndex=0,n.replace(Uu,(t,r)=>e(r)).replace(Ku,t=>e(t))),Hu=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),r=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=Pd(n,t,r)),n=n.replace(Cd,""),e.preserveConsecutiveUppercase?n=kd(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),Sd(n,r))};$u.exports=Hu,$u.exports.default=Hu;function Id(n,e){return(e==null?void 0:e[n])||wd(n)}function Od(n,e,t){const r={};for(const a in n)Object.hasOwn(n,a)&&(r[e(a,t)]=n[a]);return r}function Vu(n){return Array.isArray(n)?[...n]:{...n}}function Bd(n,e){const t=Vu(n);for(const[r,a]of Object.entries(e)){const[s,...i]=r.split(".").reverse();let o=t;for(const c of i.reverse()){if(o[c]===void 0)break;o[c]=Vu(o[c]),o=o[c]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[a]})}return t}function qu(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class Pt{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,qu(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Pt||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((a,s)=>(a[s]=s in this?this[s]:this.lc_kwargs[s],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let s=this,i=r;const[o,...c]=a.split(".").reverse();for(const u of c.reverse()){if(!(u in s)||s[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof s[u]=="object"&&s[u]!=null?i[u]={}:Array.isArray(s[u])&&(i[u]=[])),s=s[u],i=i[u]}o in s&&s[o]!==void 0&&(i[o]=i[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Od(Object.keys(t).length?Bd(r,t):r,Id,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}class Td{}class Nr extends Td{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,qu(this.constructor)]}constructor(e){var t;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?((t=process.env)==null?void 0:t.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return Pt.prototype.toJSON.call(this)}toJSONNotImplemented(){return Pt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Nr{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ct()}),Object.assign(this,e)}}return new t}}var Ms={exports:{}};Ms.exports,function(n){const t=(s=0)=>i=>`\x1B[${38+s};5;${i}m`,r=(s=0)=>(i,o,c)=>`\x1B[${38+s};2;${i};${o};${c}m`;function a(){const s=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,c]of Object.entries(i)){for(const[u,l]of Object.entries(c))i[u]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},c[u]=i[u],s.set(l[0],l[1]);Object.defineProperty(i,o,{value:c,enumerable:!1})}return Object.defineProperty(i,"codes",{value:s,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=t(),i.color.ansi16m=r(),i.bgColor.ansi256=t(10),i.bgColor.ansi16m=r(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(f=>f+f).join(""));const l=Number.parseInt(u,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(n,"exports",{enumerable:!0,get:a})}(Ms);var Rd=Ms.exports;const Wu=Qe(Rd);function Us(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class Ks extends Nr{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,s,i,o){var h;const c=this._getExecutionOrder(a),u=Date.now(),l=o?{...s,metadata:o}:s,f={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:i||[]};this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f))}async handleChatModelStart(e,t,r,a,s,i,o){var h;const c=this._getExecutionOrder(a),u=Date.now(),l=o?{...s,metadata:o}:s,f={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:i||[]};this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f))}async handleLLMEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onLLMEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleLLMError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onLLMError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleChainStart(e,t,r,a,s,i,o){var f;const c=this._getExecutionOrder(a),u=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};this._startTrace(l),await((f=this.onChainStart)==null?void 0:f.call(this,l))}async handleChainEnd(e,t,r,a,s){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");i.end_time=Date.now(),i.outputs=Us(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(i.inputs=Us(s.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i)}async handleChainError(e,t,r,a,s){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");i.end_time=Date.now(),i.error=e.message,i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(i.inputs=Us(s.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i)}async handleToolStart(e,t,r,a,s,i){var l;const o=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};this._startTrace(u),await((l=this.onToolStart)==null?void 0:l.call(this,u))}async handleToolEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleToolError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleAgentAction(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentAction)==null?void 0:s.call(this,r))}async handleAgentEnd(e,t){var a;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,r)))}async handleRetrieverStart(e,t,r,a,s,i){var l;const o=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};this._startTrace(u),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u))}async handleRetrieverEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleRetrieverError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleText(e,t){var a;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,r)))}async handleLLMNewToken(e,t,r,a,s,i){var c;const o=this.runMap.get(r);!o||(o==null?void 0:o.run_type)!=="llm"||(o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i==null?void 0:i.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o)))}}function Ke(n,e){return`${n.open}${e}${n.close}`}function ut(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function jt(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Ze}=Wu;class Zu extends Ks{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const a=this.runMap.get(r.parent_run_id);if(a)t.push(a),r=a;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((a,s,i)=>{const o=`${a.execution_order}:${a.run_type}:${a.name}`;return s===i.length-1?Ke(Wu.bold,o):o}).join(" > ");return Ke(Ze.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.green,"[chain/start]")} [${t}] Entering Chain run with input: ${ut(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.cyan,"[chain/end]")} [${t}] [${jt(e)}] Exiting Chain run with output: ${ut(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.red,"[chain/error]")} [${t}] [${jt(e)}] Chain run errored with error: ${ut(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Ke(Ze.green,"[llm/start]")} [${t}] Entering LLM run with input: ${ut(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.cyan,"[llm/end]")} [${t}] [${jt(e)}] Exiting LLM run with output: ${ut(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.red,"[llm/error]")} [${t}] [${jt(e)}] LLM run errored with error: ${ut(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,a;const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.cyan,"[tool/end]")} [${t}] [${jt(e)}] Exiting Tool run with output: "${(a=(r=e.outputs)==null?void 0:r.output)==null?void 0:a.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.red,"[tool/error]")} [${t}] [${jt(e)}] Tool run errored with error: ${ut(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${ut(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.cyan,"[retriever/end]")} [${t}] [${jt(e)}] Exiting Retriever run with output: ${ut(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Ke(Ze.red,"[retriever/error]")} [${t}] [${jt(e)}] Retriever run errored with error: ${ut(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Ke(Ze.blue,"[agent/action]")} [${r}] Agent selected action: ${ut(t.actions[t.actions.length-1],"[action]")}`)}}const Dd=[400,401,403,404,405,406,407,408],Fd=[409];class Nd{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in Et?Et.default:Et;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>kn(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var s;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const a=(s=r==null?void 0:r.response)==null?void 0:s.status;if(a){if(Dd.includes(+a))throw r;if(Fd.includes(+a))return}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,s)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}function Gu(n){return typeof(n==null?void 0:n._getType)=="function"}function Yu(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}let kt;const jd=()=>typeof window<"u"&&typeof window.document<"u",$d=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ld=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Xu=()=>typeof Deno<"u",zd=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Xu(),Md=()=>kt||(jd()?kt="browser":zd()?kt="node":$d()?kt="webworker":Ld()?kt="jsdom":Xu()?kt="deno":kt="other",kt);let Hs;async function Ud(){if(Hs===void 0){const n=Md(),e=Vd();Hs={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:ec,...e}}return Hs}function Kd(){const n=Hd()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,a]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof a=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[r]=a);return e}function Hd(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Zt(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}let Vs;function Vd(){if(Vs!==void 0)return Vs;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Zt(t);r!==void 0&&(e[t]=r)}return Vs=e,e}async function Ju(n){const e=await Ud(),t=Kd();return n.map(r=>{const a=r.extra??{},s=a.metadata;return r.extra={...a,runtime:{...e,...a==null?void 0:a.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r})}const qd=()=>{const n=Zt("LANGCHAIN_TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},Qu=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},$t=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};async function Wd(n){const e=[];for await(const t of n)e.push(t);return e}function qs(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function we(n){if(!bd(n))throw new Error(`Invalid UUID: ${n}`)}class Ws{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pendingAutoBatchedRuns",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50});const t=Ws.getDefaultClientConfig();this.tracingSampleRate=qd(),this.apiUrl=qs(e.apiUrl??t.apiUrl)??"",this.apiKey=qs(e.apiKey??t.apiKey),this.webUrl=qs(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Nd(e.callerOptions??{}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit}static getDefaultClientConfig(){const e=Zt("LANGCHAIN_API_KEY"),t=Zt("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",r=Zt("LANGCHAIN_HIDE_INPUTS")==="true",a=Zt("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:a}}validateApiKeyIfHosted(){if(!Qu(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:Qu(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={"User-Agent":`langsmith-js/${ec}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs?{}:e}processOutputs(e){return this.hideOutputs?{}:e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);return s}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));const s=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);const o=await i.json();if(o.length===0||(yield o,o.length<a))break;r+=o.length}}async*_getCursorPaginatedList(e,t=null,r="POST",a="runs"){const s=t?{...t}:{};for(;;){const o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(s)})).json();if(!o||!o[a])break;yield o[a];const c=o.cursors;if(!c||!c.next)break;s.cursor=c.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const a of e)this.sampledPostUuids.has(a.id)&&(r.push(a),this.sampledPostUuids.delete(a.id));return r}else{const r=[];for(const a of e)Math.random()<this.tracingSampleRate&&(r.push(a),this.sampledPostUuids.add(a.id));return r}}async triggerAutoBatchSend(e){let t=e;t===void 0&&(t=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit),this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit)),await this.batchIngestRuns({runCreates:t.filter(r=>r.action==="create").map(r=>r.item),runUpdates:t.filter(r=>r.action==="update").map(r=>r.item)})}appendRunCreateToAutoBatchQueue(e){const t=this.autoBatchTimeout;for(clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,this.pendingAutoBatchedRuns.push(e);this.pendingAutoBatchedRuns.length>=this.pendingAutoBatchedRunLimit;){const r=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit);this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit),this.triggerAutoBatchSend(r)}this.pendingAutoBatchedRuns.length>0&&(t?this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchAggregationDelayMs):this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchInitialDelayMs))}async batchEndpointIsSupported(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms)});return e.ok?!0:(await e.text(),!1)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.appendRunCreateToAutoBatchQueue({action:"create",item:a});return}const s=await Ju([a]),i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(s[0]),signal:AbortSignal.timeout(this.timeout_ms)});await $t(i,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[],a=(t==null?void 0:t.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[];if(r.length>0&&a.length>0){const c=r.reduce((l,f)=>(f.id&&(l[f.id]=f),l),{}),u=[];for(const l of a)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);r=Object.values(c),a=u}const s={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!s.post.length&&!s.patch.length)return;if(r=await Ju(r),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const c of s.post)await this.createRun(c);for(const c of s.patch)c.id!==void 0&&await this.updateRun(c.id,c);return}const i={...this.headers,"Content-Type":"application/json",Accept:"application/json"},o=await this.caller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:i,body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});await $t(o,"batch create run")}async updateRun(e,t){we(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){this.appendRunCreateToAutoBatchQueue({action:"update",item:r});return}const a={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await $t(s,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){we(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let a;t.session_id?a=t.session_id:r!=null&&r.projectName?a=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?a=r==null?void 0:r.projectId:a=(await this.readProject({projectName:Zt("LANGCHAIN_PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Wd(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort((s,i)=>((s==null?void 0:s.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),a[s.id]=s}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(a[s].child_runs=r[s]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,traceId:a,referenceExampleId:s,startTime:i,executionOrder:o,runType:c,error:u,id:l,query:f,filter:h,limit:x}){let m=[];if(e&&(m=Array.isArray(e)?e:[e]),t){const d=Array.isArray(t)?t:[t],k=await Promise.all(d.map(g=>this.readProject({projectName:g}).then(y=>y.id)));m.push(...k)}const w={session:m.length?m:null,run_type:c,reference_example:s,query:f,filter:h,execution_order:o,parent_run:r?[r]:null,start_time:i?i.toISOString():null,error:u,id:l,limit:x,trace:a};for await(const d of this._getCursorPaginatedList("/runs/query",w))yield*d}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Ct()};we(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();if(s===null||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){we(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await $t(t,"unshare run")}async readRunSharedLink(e){we(e);const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)r.append("id",i);return we(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),we(e);const a=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};we(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){we(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await $t(t,"unshare dataset")}async readSharedDataset(e){return we(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:s=null,referenceDatasetId:i=null}){const o=a?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,u=s||{};r&&(u.metadata=r);const l={name:e,extra:u,description:t};i!==null&&(l.reference_dataset_id=i);const f=await this.caller.call(fetch,c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),h=await f.json();if(!f.ok)throw new Error(`Failed to create session ${e}: ${f.status} ${f.statusText}`);return h}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:s=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let c=s;a&&(c={...c||{},metadata:a});const u={name:t,extra:c,description:r,end_time:i?new Date(i).toISOString():null},l=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)}),f=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return f}async hasProject({projectId:e,projectName:t}){let r="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)we(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const s=await this.caller.call(fetch,`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});try{const i=await s.json();return s.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)we(e),a+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&s.append("include_stats",r.toString());const i=await this._get(a,s);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:s,referenceFree:i}={}){const o=new URLSearchParams;if(e!==void 0)for(const c of e)o.append("id",c);if(t!==void 0&&o.append("name",t),r!==void 0&&o.append("name_contains",r),a!==void 0)o.append("reference_dataset",a);else if(s!==void 0){const c=await this.readDataset({datasetName:s});o.append("reference_dataset",c.id)}i!==void 0&&o.append("reference_free",i.toString());for await(const c of this._getPaginated("/sessions",o))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,we(r);const a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await $t(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:s,dataType:i,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(h=>{u.append("input_keys",h)}),a.forEach(h=>{u.append("output_keys",h)}),s&&u.append("description",s),i&&u.append("data_type",i),o&&u.append("name",o);const l=await this.caller.call(fetch,c,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok){const h=await l.json();throw h.detail&&h.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const a={name:e,description:t};r&&(a.data_type=r);const s=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok){const o=await s.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${s.status} ${s.statusText}`)}return await s.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)we(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const s=await this._get(r,a);let i;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:s}={}){const i="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)o.append("id",c);a!==void 0&&o.append("name",a),s!==void 0&&o.append("name_contains",s);for await(const c of this._getPaginated(i,o))yield*c}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)we(a),r+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const s=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to delete ${r}: ${s.status} ${s.statusText}`);await s.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:s,exampleId:i}){let o=r;if(o===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:a})).id);const c=s||new Date,u={dataset_id:o,inputs:e,outputs:t,created_at:c==null?void 0:c.toISOString(),id:i},l=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok)throw new Error(`Failed to create example: ${l.status} ${l.statusText}`);return await l.json()}async createExamples(e){const{inputs:t,outputs:r,sourceRunIds:a,exampleIds:s,datasetId:i,datasetName:o}=e;let c=i;if(c===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:o})).id);const u=t.map((h,x)=>({dataset_id:c,inputs:h,outputs:r?r[x]:void 0,id:s?s[x]:void 0,source_run_id:a?a[x]:void 0})),l=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok)throw new Error(`Failed to create examples: ${l.status} ${l.statusText}`);return await l.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const a=e.map(i=>Gu(i)?Yu(i):i),s=Gu(t)?Yu(t):t;return this.createExample({input:a},{output:s},r)}async readExample(e){we(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)a=e;else if(t!==void 0)a=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const s=new URLSearchParams({dataset:a});if(r!==void 0)for(const i of r)s.append("id",i);for await(const i of this._getPaginated("/examples",s))yield*i}async deleteExample(e){we(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){we(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:s}={loadChildRuns:!1}){let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(s=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,s);let c=r??{};o.evaluatorInfo&&(c={...c,...o.evaluatorInfo});const u=o.targetRunId??i.id;return await this.createFeedback(u,o.key,{score:o==null?void 0:o.score,value:o==null?void 0:o.value,comment:o==null?void 0:o.comment,correction:o==null?void 0:o.correction,sourceInfo:c,feedbackSourceType:"model",sourceRunId:o==null?void 0:o.sourceRunId})}async createFeedback(e,t,{score:r,value:a,correction:s,comment:i,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,eager:f=!1}){var d;const h={type:c??"api",metadata:o??{}};u!==void 0&&(h==null?void 0:h.metadata)!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:u}),(h==null?void 0:h.metadata)!==void 0&&((d=h.metadata.__run)==null?void 0:d.run_id)!==void 0&&we(h.metadata.__run.run_id);const x={id:l??Ct(),run_id:e,key:t,score:r,value:a,correction:s,comment:i,feedback_source:h},m=`${this.apiUrl}/feedback`+(f?"/eager":""),w=await this.caller.call(fetch,m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(x),signal:AbortSignal.timeout(this.timeout_ms)});return await $t(w,"create feedback"),x}async updateFeedback(e,{score:t,value:r,correction:a,comment:s}){const i={};t!=null&&(i.score=t),r!=null&&(i.value=r),a!=null&&(i.correction=a),s!=null&&(i.comment=s),we(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await $t(o,"update feedback")}async readFeedback(e){we(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){we(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const s of t)a.append("key",s);if(r)for(const s of r)a.append("source",s);for await(const s of this._getPaginated("/feedback",a))yield*s}}const ec="0.0.70",Zd=()=>typeof window<"u"&&typeof window.document<"u",Gd=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Yd=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),tc=()=>typeof Deno<"u",Xd=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!tc(),Jd=()=>{let n;return Zd()?n="browser":Xd()?n="node":Gd()?n="webworker":Yd()?n="jsdom":tc()?n="deno":n="other",n};let Zs;async function Qd(){return Zs===void 0&&(Zs={library:"langchain-js",runtime:Jd()}),Zs}function ae(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}class ef extends Ks{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:a}=e;this.projectName=r??ae("LANGCHAIN_PROJECT")??ae("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new Ws({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Qd()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}class tf{}const rc=(n,e)=>{if(e!==void 0)return n[e];const t=Object.keys(n);if(t.length===1)return n[t[0]]},rf=(n,e)=>{const t=rc(n,e);if(!t){const r=Object.keys(n);throw new Error(`input values have ${r.length} keys, you must specify an input key or pass only 1 key as input`)}return t},nf=(n,e)=>{const t=rc(n,e);if(!t){const r=Object.keys(n);throw new Error(`output values have ${r.length} keys, you must specify an output key or pass only 1 key as output`)}return t};function Rn(n,e="Human",t="AI"){const r=[];for(const a of n){let s;if(a._getType()==="human")s=e;else if(a._getType()==="ai")s=t;else if(a._getType()==="system")s="System";else if(a._getType()==="function")s="Function";else if(a._getType()==="generic")s=a.role;else throw new Error(`Got unsupported message type: ${a}`);const i=a.name?`${a.name}, `:"";r.push(`${s}: ${i}${a.content}`)}return r.join(`
`)}class af extends Ks{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:ae("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=ae("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var s;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let a;if(e.run_type==="llm"){const i=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(c=>Rn(c));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:i,response:e.outputs}}else if(e.run_type==="chain"){const i=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:i.filter(c=>c.type==="llm"),child_chain_runs:i.filter(c=>c.type==="chain"),child_tool_runs:i.filter(c=>c.type==="tool")}}else if(e.run_type==="tool"){const i=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(s=e.outputs)==null?void 0:s.output,action:JSON.stringify(r),child_llm_runs:i.filter(c=>c.type==="llm"),child_chain_runs:i.filter(c=>c.type==="chain"),child_tool_runs:i.filter(c=>c.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return a}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const a=await t.json();return a.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=a,this.session=r,r)}}async function sf(n){const e=new af;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function of(){return new ef}let Gs;function uf(){const n="default"in Et?Et.default:Et;return new n({autoStart:!0,concurrency:1})}async function Fe(n,e){e===!0?await n():(typeof Gs>"u"&&(Gs=uf()),Gs.add(n))}function nc(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class cf{setHandler(e){return this.setHandlers([e])}}class Dn{constructor(e,t,r,a,s,i,o,c){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:c})}async handleText(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleText: ${a}`)}},t.awaitHandlers)))}}class lf extends Dn{getChild(e){const t=new Le(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${a}`)}},t.awaitHandlers)))}}class ac extends Dn{async handleLLMNewToken(e,t,r,a,s,i){await Promise.all(this.handlers.map(o=>Fe(async()=>{var c;if(!o.ignoreLLM)try{await((c=o.handleLLMNewToken)==null?void 0:c.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${a}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${a}`)}},t.awaitHandlers)))}}class hf extends Dn{getChild(e){const t=new Le(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,s){await Promise.all(this.handlers.map(i=>Fe(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,s))}catch(c){console.error(`Error in handler ${i.constructor.name}, handleChainError: ${c}`)}},i.awaitHandlers)))}async handleChainEnd(e,t,r,a,s){await Promise.all(this.handlers.map(i=>Fe(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,s))}catch(c){console.error(`Error in handler ${i.constructor.name}, handleChainEnd: ${c}`)}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${a}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${a}`)}},t.awaitHandlers)))}}class df extends Dn{getChild(e){const t=new Le(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${a}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${a}`)}},t.awaitHandlers)))}}class Le extends cf{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,a=void 0,s=void 0){return Promise.all(t.map(async i=>{const o=Ct();return await Promise.all(this.handlers.map(c=>Fe(async()=>{var u;if(!c.ignoreLLM)try{await((u=c.handleLLMStart)==null?void 0:u.call(c,e,[i],o,this._parentRunId,s,this.tags,this.metadata))}catch(l){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${l}`)}},c.awaitHandlers))),new ac(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,a=void 0,s=void 0){return Promise.all(t.map(async i=>{const o=Ct();return await Promise.all(this.handlers.map(c=>Fe(async()=>{var u,l;if(!c.ignoreLLM)try{if(c.handleChatModelStart)await((u=c.handleChatModelStart)==null?void 0:u.call(c,e,[i],o,this._parentRunId,s,this.tags,this.metadata));else if(c.handleLLMStart){const f=Rn(i);await((l=c.handleLLMStart)==null?void 0:l.call(c,e,[f],o,this._parentRunId,s,this.tags,this.metadata))}}catch(f){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${f}`)}},c.awaitHandlers))),new ac(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Ct(),a=void 0){return await Promise.all(this.handlers.map(s=>Fe(async()=>{var i;if(!s.ignoreChain)try{await((i=s.handleChainStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags,this.metadata,a))}catch(o){console.error(`Error in handler ${s.constructor.name}, handleChainStart: ${o}`)}},s.awaitHandlers))),new hf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Ct()){return await Promise.all(this.handlers.map(a=>Fe(async()=>{var s;if(!a.ignoreAgent)try{await((s=a.handleToolStart)==null?void 0:s.call(a,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(i){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${i}`)}},a.awaitHandlers))),new df(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Ct(),a=void 0){return await Promise.all(this.handlers.map(s=>Fe(async()=>{var i;if(!s.ignoreRetriever)try{await((i=s.handleRetrieverStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(o){console.error(`Error in handler ${s.constructor.name}, handleRetrieverStart: ${o}`)}},s.awaitHandlers))),new lf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Le(this._parentRunId);for(const a of this.handlers){const s=this.inheritableHandlers.includes(a);r.addHandler(a,s)}for(const a of this.tags){const s=this.inheritableTags.includes(a);r.addTags([a],s)}for(const a of Object.keys(this.metadata)){const s=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},s)}for(const a of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends Nr{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ct()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,s,i,o){let c;(e||t)&&(Array.isArray(e)||!e?(c=new Le,c.setHandlers((e==null?void 0:e.map(sc))??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(sc):t==null?void 0:t.handlers,!1));const u=ae("LANGCHAIN_VERBOSE")||(o==null?void 0:o.verbose),l=ae("LANGCHAIN_TRACING_V2")==="true",f=l||(ae("LANGCHAIN_TRACING")??!1);if(u||f){if(c||(c=new Le),u&&!c.handlers.some(h=>h.name===Zu.prototype.name)){const h=new Zu;c.addHandler(h,!0)}if(f&&!c.handlers.some(h=>h.name==="langchain_tracer"))if(l)c.addHandler(await of(),!0);else{const h=ae("LANGCHAIN_PROJECT")&&ae("LANGCHAIN_SESSION");c.addHandler(await sf(h),!0)}}return(r||a)&&c&&(c.addTags(r??[]),c.addTags(a??[],!1)),(s||i)&&c&&(c.addMetadata(s??{}),c.addMetadata(i??{},!1)),c}}function sc(n){return"name"in n?n:Nr.fromMethods(n)}class Fn extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();const e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new Fn({start(r){return a();function a(){return t.read().then(({done:s,value:i})=>{if(s){r.close();return}return r.enqueue(i),a()})}}})}static fromAsyncGenerator(e){return new Fn({async pull(t){const{value:r,done:a}=await e.next();a?t.close():r&&t.enqueue(r)}})}}async function Gt(n){return Le.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function ze(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class Be extends Pt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new Nn({bound:this,kwargs:e,config:{}})}map(){return new Ys({bound:this})}withRetry(e){return new ff({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Nn({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new gf({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),s=new On({maxConcurrency:r==null?void 0:r.maxConcurrency,onFailedAttempt:o=>{throw o}}),i=e.map((o,c)=>s.call(async()=>{try{return await this.invoke(o,a[c])}catch(u){if(r!=null&&r.returnExceptions)return u;throw u}}));return Promise.all(i)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return Fn.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){const a=await Gt(r),s=await(a==null?void 0:a.handleChainStart(this.toJSON(),ze(t,"input"),void 0,r==null?void 0:r.runType));let i;try{i=await e.bind(this)(t,r,s)}catch(o){throw await(s==null?void 0:s.handleChainError(o)),o}return await(s==null?void 0:s.handleChainEnd(ze(i,"output"))),i}async _batchWithConfig(e,t,r,a){const s=this._getOptionsList(r??{},t.length),i=await Promise.all(s.map(Gt)),o=await Promise.all(i.map((u,l)=>u==null?void 0:u.handleChainStart(this.toJSON(),ze(t[l],"input"))));let c;try{c=await e(t,s,o,a)}catch(u){throw await Promise.all(o.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(ze(c,"output")))),c}async*_transformStreamWithConfig(e,t,r){let a,s=!0,i,o=!0;const c=await Gt(r);let u;const l=this.toJSON();async function*f(){for await(const x of e){if(u||(u=await(c==null?void 0:c.handleChainStart(l,{input:""},void 0,r==null?void 0:r.runType))),s)if(a===void 0)a=x;else try{a=a.concat(x)}catch{a=void 0,s=!1}yield x}}const h=f();try{const x=t(h,u,r);for await(const m of x)if(yield m,o)if(i===void 0)i=m;else try{i=i.concat(m)}catch{i=void 0,o=!1}}catch(x){throw await(u==null?void 0:u.handleChainError(x,void 0,void 0,void 0,{inputs:ze(a,"input")})),x}await(u==null?void 0:u.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:ze(a,"input")}))}_patchConfig(e={},t=void 0){return{...e,callbacks:t}}pipe(e){return new ur({first:this,last:Yt(e)})}async*transform(e,t){let r;for await(const a of e)r?r=r.concat(a):r=a;yield*this._streamIterator(r,t)}static isRunnable(e){return e.lc_runnable}}class Nn extends Be{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config}_mergeConfig(e){const t={...this.config};if(e)for(const r of Object.keys(e))r==="metadata"?t[r]={...t[r],...e[r]}:r==="tags"?t[r]=(t[r]??[]).concat(e[r]??[]):t[r]=e[r]??t[r];return t}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){const a=Array.isArray(t)?t.map(s=>this._mergeConfig({...s,...this.kwargs})):this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,this._mergeConfig({...t,...this.kwargs}))}async*transform(e,t){yield*this.bound.transform(e,this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&Be.isRunnable(e.bound)}}class Ys extends Be{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ys({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r==null?void 0:r.getChild()))}}class ff extends Nn{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r==null?void 0:r.getChild(a))}async _invoke(e,t,r){return kn(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){const s={};try{await kn(async i=>{const o=e.map((h,x)=>x).filter(h=>s[h.toString()]===void 0||s[h.toString()]instanceof Error),c=o.map(h=>e[h]),u=o.map(h=>this._patchConfigForRetry(i,t==null?void 0:t[h],r==null?void 0:r[h])),l=await super.batch(c,u,{...a,returnExceptions:!0});let f;for(let h=0;h<l.length;h+=1){const x=l[h],m=o[h];x instanceof Error&&f===void 0&&(f=x),s[m.toString()]=x}if(f)throw f;return l},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((a==null?void 0:a.returnExceptions)!==!0)throw i}return Object.keys(s).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>s[parseInt(i,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class ur extends Be{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await Gt(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),ze(e,"input")));let s=e,i;try{const o=[this.first,...this.middle];for(let c=0;c<o.length;c+=1)s=await o[c].invoke(s,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${c+1}`)));i=await this.last.invoke(s,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${this.steps.length}`)))}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(ze(i,"output"))),i}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),s=await Promise.all(a.map(Gt)),i=await Promise.all(s.map((u,l)=>u==null?void 0:u.handleChainStart(this.toJSON(),ze(e[l],"input"))));let o=e,c;try{const u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1)o=await u[l].batch(o,i.map((h,x)=>this._patchConfig(a[x],h==null?void 0:h.getChild(`seq:step:${l+1}`))),r);c=await this.last.batch(o,i.map(l=>this._patchConfig(a[this.steps.length-1],l==null?void 0:l.getChild(`seq:step:${this.steps.length}`))),r)}catch(u){throw await Promise.all(i.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(i.map((u,l)=>u==null?void 0:u.handleChainEnd(ze(c[l],"output")))),c}async*_streamIterator(e,t){const r=await Gt(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),ze(e,"input")));let s=e;const i=[this.first,...this.middle,this.last],o=Math.min(i.length-1,i.length-[...i].reverse().findIndex(l=>{var x;const f=l.transform===Be.prototype.transform,h=Nn.isRunnableBinding(l)&&((x=l.bound)==null?void 0:x.transform)===Be.prototype.transform;return f||h})-1);try{const l=i.slice(0,o);for(let f=0;f<l.length;f+=1)s=await l[f].invoke(s,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${f+1}`)))}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}let c=!0,u;try{let l=await i[o]._streamIterator(s,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${o+1}`)));const f=i.slice(o+1);for(let h=0;h<f.length;h+=1)l=await f[h].transform(l,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${o+h+2}`)));for await(const h of l)if(yield h,c)if(u===void 0)u=h;else try{u=u.concat(h)}catch{u=void 0,c=!1}}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}await(a==null?void 0:a.handleChainEnd(ze(u,"output")))}pipe(e){return ur.isRunnableSequence(e)?new ur({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}):new ur({first:this.first,middle:[...this.middle,this.last],last:Yt(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Be.isRunnable(e)}static from([e,...t]){return new ur({first:Yt(e),middle:t.slice(0,-1).map(Yt),last:Yt(t[t.length-1])})}}class pf extends Be{static lc_name(){return"RunnableMap"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Yt(r)}async invoke(e,t){const r=await Gt(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),{input:e})),s={};try{for(const[i,o]of Object.entries(this.steps)){const c=await o.invoke(e,this._patchConfig(t,a==null?void 0:a.getChild()));s[i]=c}}catch(i){throw await(a==null?void 0:a.handleChainError(i)),i}return await(a==null?void 0:a.handleChainEnd(s)),s}}class mf extends Be{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async _invoke(e,t,r){let a=await this.func(e);return a&&Be.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r==null?void 0:r.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class gf extends Be{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await Le.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),ze(e,"input")));let s;for(const i of this.runnables())try{const o=await i.invoke(e,this._patchConfig(t,a==null?void 0:a.getChild()));return await(a==null?void 0:a.handleChainEnd(ze(o,"output"))),o}catch(o){s===void 0&&(s=o)}throw s===void 0?new Error("No error stored at end of fallback."):(await(a==null?void 0:a.handleChainError(s)),s)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),s=await Promise.all(a.map(c=>Le.configure(c==null?void 0:c.callbacks,void 0,c==null?void 0:c.tags,void 0,c==null?void 0:c.metadata))),i=await Promise.all(s.map((c,u)=>c==null?void 0:c.handleChainStart(this.toJSON(),ze(e[u],"input"))));let o;for(const c of this.runnables())try{const u=await c.batch(e,i.map((l,f)=>this._patchConfig(a[f],l==null?void 0:l.getChild())),r);return await Promise.all(i.map((l,f)=>l==null?void 0:l.handleChainEnd(ze(u[f],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Yt(n){if(typeof n=="function")return new mf({func:n});if(Be.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Yt(r);return new pf({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class yf extends Be{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}invoke(e,t){return this.transformDocuments(e)}}class xf extends yf{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const a=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${a})`))}else r=e.split(t);else r=e.split("");return r.filter(a=>a!=="")}async createDocuments(e,t=[],r={}){const a=t.length>0?t:new Array(e.length).fill({}),{chunkHeader:s="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,c=new Array;for(let u=0;u<e.length;u+=1){const l=e[u];let f=1,h=null;for(const x of await this.splitText(l)){let m=s,w=0;if(h){const y=l.indexOf(x),_=l.indexOf(h)+await this.lengthFunction(h);w=(l.slice(_,y).match(/\n/g)||[]).length,o&&(m+=i)}f+=w;const d=(x.match(/\n/g)||[]).length,k=a[u].loc&&typeof a[u].loc=="object"?{...a[u].loc}:{};k.lines={from:f,to:f+d};const g={...a[u],loc:k};m+=x,c.push(new En({pageContent:m,metadata:g})),f+=d,h=x}}return c}async splitDocuments(e,t={}){const r=e.filter(i=>i.pageContent!==void 0),a=r.map(i=>i.pageContent),s=r.map(i=>i.metadata);return this.createDocuments(a,s,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}async mergeSplits(e,t){const r=[],a=[];let s=0;for(const o of e){const c=await this.lengthFunction(o);if(s+c+(a.length>0?t.length:0)>this.chunkSize&&(s>this.chunkSize&&console.warn(`Created a chunk of size ${s}, +
which is longer than the specified ${this.chunkSize}`),a.length>0)){const u=this.joinDocs(a,t);for(u!==null&&r.push(u);s>this.chunkOverlap||s+c>this.chunkSize&&s>0;)s-=await this.lengthFunction(a[0]),a.shift()}a.push(o),s+=c}const i=this.joinDocs(a,t);return i!==null&&r.push(i),r}}class jn extends xf{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let a=t[t.length-1],s;for(let u=0;u<t.length;u+=1){const l=t[u];if(l===""){a=l;break}if(e.includes(l)){a=l,s=t.slice(u+1);break}}const i=this.splitOnSeparator(e,a);let o=[];const c=this.keepSeparator?"":a;for(const u of i)if(await this.lengthFunction(u)<this.chunkSize)o.push(u);else{if(o.length){const l=await this.mergeSplits(o,c);r.push(...l),o=[]}if(!s)r.push(u);else{const l=await this._splitText(u,s);r.push(...l)}}if(o.length){const u=await this.mergeSplits(o,c);r.push(...u)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new jn({...t,separators:jn.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}const Xs="RFC3986",Js={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},bf="RFC1738",_f=Array.isArray,yt=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Qs=1024,vf=(n,e,t,r,a)=>{if(n.length===0)return n;let s=n;if(typeof n=="symbol"?s=Symbol.prototype.toString.call(n):typeof n!="string"&&(s=String(n)),t==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<s.length;o+=Qs){const c=s.length>=Qs?s.slice(o,o+Qs):s,u=[];for(let l=0;l<c.length;++l){let f=c.charCodeAt(l);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||a===bf&&(f===40||f===41)){u[u.length]=c.charAt(l);continue}if(f<128){u[u.length]=yt[f];continue}if(f<2048){u[u.length]=yt[192|f>>6]+yt[128|f&63];continue}if(f<55296||f>=57344){u[u.length]=yt[224|f>>12]+yt[128|f>>6&63]+yt[128|f&63];continue}l+=1,f=65536+((f&1023)<<10|c.charCodeAt(l)&1023),u[u.length]=yt[240|f>>18]+yt[128|f>>12&63]+yt[128|f>>6&63]+yt[128|f&63]}i+=u.join("")}return i};function wf(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function ic(n,e){if(_f(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const Af=Object.prototype.hasOwnProperty,oc={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},xt=Array.isArray,Ef=Array.prototype.push,uc=function(n,e){Ef.apply(n,xt(e)?e:[e])},Cf=Date.prototype.toISOString,Se={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:vf,encodeValuesOnly:!1,format:Xs,formatter:Js[Xs],indices:!1,serializeDate(n){return Cf.call(n)},skipNulls:!1,strictNullHandling:!1};function Pf(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const ei={};function cc(n,e,t,r,a,s,i,o,c,u,l,f,h,x,m,w,d,k){let g=n,y=k,_=0,O=!1;for(;(y=y.get(ei))!==void 0&&!O;){const p=y.get(n);if(_+=1,typeof p<"u"){if(p===_)throw new RangeError("Cyclic object value");O=!0}typeof y.get(ei)>"u"&&(_=0)}if(typeof u=="function"?g=u(e,g):g instanceof Date?g=h==null?void 0:h(g):t==="comma"&&xt(g)&&(g=ic(g,function(p){return p instanceof Date?h==null?void 0:h(p):p})),g===null){if(s)return c&&!w?c(e,Se.encoder,d,"key",x):e;g=""}if(Pf(g)||wf(g)){if(c){const p=w?e:c(e,Se.encoder,d,"key",x);return[(m==null?void 0:m(p))+"="+(m==null?void 0:m(c(g,Se.encoder,d,"value",x)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(g)))]}const v=[];if(typeof g>"u")return v;let P;if(t==="comma"&&xt(g))w&&c&&(g=ic(g,c)),P=[{value:g.length>0?g.join(",")||null:void 0}];else if(xt(u))P=u;else{const p=Object.keys(g);P=l?p.sort(l):p}const b=o?String(e).replace(/\./g,"%2E"):String(e),C=r&&xt(g)&&g.length===1?b+"[]":b;if(a&&xt(g)&&g.length===0)return C+"[]";for(let p=0;p<P.length;++p){const A=P[p],S=typeof A=="object"&&typeof A.value<"u"?A.value:g[A];if(i&&S===null)continue;const T=f&&o?A.replace(/\./g,"%2E"):A,F=xt(g)?typeof t=="function"?t(C,T):C:C+(f?"."+T:"["+T+"]");k.set(n,_);const K=new WeakMap;K.set(ei,k),uc(v,cc(S,F,t,r,a,s,i,o,t==="comma"&&w&&xt(g)?null:c,u,l,f,h,x,m,w,d,K))}return v}function kf(n=Se){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||Se.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Xs;if(typeof n.format<"u"){if(!Af.call(Js,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=Js[t];let a=Se.filter;(typeof n.filter=="function"||xt(n.filter))&&(a=n.filter);let s;if(n.arrayFormat&&n.arrayFormat in oc?s=n.arrayFormat:"indices"in n?s=n.indices?"indices":"repeat":s=Se.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:Se.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Se.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Se.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Se.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?Se.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Se.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Se.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Se.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Se.encodeValuesOnly,filter:a,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Se.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Se.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Se.strictNullHandling}}function Sf(n,e={}){let t=n;const r=kf(e);let a,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):xt(r.filter)&&(s=r.filter,a=s);const i=[];if(typeof t!="object"||t===null)return"";const o=oc[r.arrayFormat],c=o==="comma"&&r.commaRoundTrip;a||(a=Object.keys(t)),r.sort&&a.sort(r.sort);const u=new WeakMap;for(let h=0;h<a.length;++h){const x=a[h];r.skipNulls&&t[x]===null||uc(i,cc(t[x],x,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const l=i.join(r.delimiter);let f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),l.length>0?f+l:""}const cr="4.77.0";let lc=!1,jr,hc,dc,ti,fc,pc,mc,gc,yc;function If(n,e={auto:!1}){if(lc)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(jr)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${jr}'\``);lc=e.auto,jr=n.kind,hc=n.fetch,n.Request,n.Response,n.Headers,dc=n.FormData,n.Blob,ti=n.File,fc=n.ReadableStream,pc=n.getMultipartRequestOptions,mc=n.getDefaultAgent,gc=n.fileFromPath,yc=n.isFsReadStream}let Of=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Bf({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,a,s;try{t=fetch,r=Request,a=Response,s=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:a,Headers:s,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Of(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}jr||If(Bf(),{auto:!0});class ie extends Error{}let Ge=class Lo extends ie{constructor(e,t,r,a){super(`${Lo.makeMessage(e,t,r)}`),this.status=e,this.headers=a,this.request_id=a==null?void 0:a["x-request-id"],this.error=t;const s=t;this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(e,t,r){const a=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,r,a){if(!e||!a)return new $n({message:r,cause:ii(t)});const s=t==null?void 0:t.error;return e===400?new xc(e,s,r,a):e===401?new bc(e,s,r,a):e===403?new _c(e,s,r,a):e===404?new vc(e,s,r,a):e===409?new wc(e,s,r,a):e===422?new Ac(e,s,r,a):e===429?new Ec(e,s,r,a):e>=500?new Cc(e,s,r,a):new Lo(e,s,r,a)}},ct=class extends Ge{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},$n=class extends Ge{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},ri=class extends $n{constructor({message:e}={}){super({message:e??"Request timed out."})}},xc=class extends Ge{},bc=class extends Ge{},_c=class extends Ge{},vc=class extends Ge{},wc=class extends Ge{},Ac=class extends Ge{},Ec=class extends Ge{},Cc=class extends Ge{};class Pc extends ie{constructor(){super("Could not parse response content as the length limit was reached")}}class kc extends ie{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let Ln=class zo{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=zo.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(zo.NEWLINE_REGEXP);return r&&a.pop(),a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ie(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ie(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ie("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};Ln.NEWLINE_CHARS=new Set([`
`,"\r"]),Ln.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let $r=class wn{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const i of Tf(e,t))if(!s){if(i.data.startsWith("[DONE]")){s=!0;continue}if(i.event===null){let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(o&&o.error)throw new Ge(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new Ge(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}s=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{s||t.abort()}}return new wn(a,t)}static fromReadableStream(e,t){let r=!1;async function*a(){const i=new Ln,o=Sc(e);for await(const c of o)for(const u of i.decode(c))yield u;for(const c of i.flush())yield c}async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of a())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new wn(s,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),a=s=>({next:()=>{if(s.length===0){const i=r.next();e.push(i),t.push(i)}return s.shift()}});return[new wn(()=>a(e),this.controller),new wn(()=>a(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new fc({async start(){t=e[Symbol.asyncIterator]()},async pull(a){try{const{value:s,done:i}=await t.next();if(i)return a.close();const o=r.encode(JSON.stringify(s)+`
`);a.enqueue(o)}catch(s){a.error(s)}},async cancel(){var a;await((a=t.return)==null?void 0:a.call(t))}})}};async function*Tf(n,e){if(!n.body)throw e.abort(),new ie("Attempted to iterate over a response with no body");const t=new Ff,r=new Ln,a=Sc(n.body);for await(const s of Rf(a))for(const i of r.decode(s)){const o=t.decode(i);o&&(yield o)}for(const s of r.flush()){const i=t.decode(s);i&&(yield i)}}async function*Rf(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let a=new Uint8Array(e.length+r.length);a.set(e),a.set(r,e.length),e=a;let s;for(;(s=Df(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}function Df(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let Ff=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=Nf(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}};function Nf(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Sc(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Ic=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Oc=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&zn(n),zn=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",jf=n=>Oc(n)||Ic(n)||yc(n);async function Bc(n,e,t){var a;if(n=await n,Oc(n))return n;if(Ic(n)){const s=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=zn(s)?[await s.arrayBuffer()]:[s];return new ti(i,e,t)}const r=await $f(n);if(e||(e=zf(n)??"unknown_file"),!(t!=null&&t.type)){const s=(a=r[0])==null?void 0:a.type;typeof s=="string"&&(t={...t,type:s})}return new ti(r,e,t)}async function $f(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(zn(n))e.push(await n.arrayBuffer());else if(Mf(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Lf(n)}`);return e}function Lf(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function zf(n){var e;return ni(n.name)||ni(n.filename)||((e=ni(n.path))==null?void 0:e.split(/[\\/]/).pop())}const ni=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Mf=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Tc=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",lr=async n=>{const e=await Uf(n.body);return pc(e,n)},Uf=async n=>{const e=new dc;return await Promise.all(Object.entries(n||{}).map(([t,r])=>ai(e,t,r))),e},ai=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(jf(t)){const r=await Bc(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>ai(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>ai(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Kf=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Hf=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Mn;async function Rc(n){const{response:e}=n;if(n.options.stream)return hr("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):$r.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const s=await e.json();return hr("response",e.status,e.url,e.headers,s),Dc(s,e)}const a=await e.text();return hr("response",e.status,e.url,e.headers,a),a}function Dc(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let Fc=class ah extends Promise{constructor(e,t=Rc){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ah(this.responsePromise,async t=>Dc(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Vf=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:a,fetch:s}){this.baseURL=e,this.maxRetries=si("maxRetries",t),this.timeout=si("timeout",r),this.httpAgent=a,this.fetch=s??hc}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Xf(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${tp()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async a=>{const s=a&&zn(a==null?void 0:a.body)?new DataView(await a.body.arrayBuffer()):(a==null?void 0:a.body)instanceof DataView?a.body:(a==null?void 0:a.body)instanceof ArrayBuffer?new DataView(a.body):a&&ArrayBuffer.isView(a==null?void 0:a.body)?new DataView(a.body.buffer):a==null?void 0:a.body;return{method:e,path:t,...a,body:s}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var w;const{method:r,path:a,query:s,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Tc(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(o),u=this.buildURL(a,s);"timeout"in e&&si("timeout",e.timeout);const l=e.timeout??this.timeout,f=e.httpAgent??this.httpAgent??mc(u),h=l+1e3;typeof((w=f==null?void 0:f.options)==null?void 0:w.timeout)=="number"&&h>(f.options.timeout??0)&&(f.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const x=this.buildHeaders({options:e,headers:i,contentLength:c,retryCount:t});return{req:{method:r,...o&&{body:o},headers:x,...f&&{agent:f},signal:e.signal??null},url:u,timeout:l}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:a}){const s={};r&&(s["content-length"]=r);const i=this.defaultHeaders(e);return Uc(s,i),Uc(s,t),Tc(e.body)&&jr!=="node"&&delete s["content-type"],Kc(i,"x-stainless-retry-count")===void 0&&Kc(t,"x-stainless-retry-count")===void 0&&(s["x-stainless-retry-count"]=String(a)),this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return Ge.generate(e,t,r,a)}request(e,t=null){return new Fc(this.makeRequest(e,t))}async makeRequest(e,t){var f,h;const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:s,url:i,timeout:o}=this.buildRequest(r,{retryCount:a-t});if(await this.prepareRequest(s,{url:i,options:r}),hr("request",i,r,s.headers),(f=r.signal)!=null&&f.aborted)throw new ct;const c=new AbortController,u=await this.fetchWithTimeout(i,s,o,c).catch(ii);if(u instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new ct;if(t)return this.retryRequest(r,t);throw u.name==="AbortError"?new ri:new $n({cause:u})}const l=Wf(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const g=`retrying, ${t} attempts remaining`;return hr(`response (error; ${g})`,u.status,i,l),this.retryRequest(r,t,l)}const x=await u.text().catch(g=>ii(g).message),m=Jf(x),w=m?void 0:x;throw hr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,l,w),this.makeStatusError(u.status,m,w,l)}return{response:u,options:r,controller:c}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new qf(this,r,e)}buildURL(e,t){const r=ep(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return zc(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ie(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){const{signal:s,...i}=t||{};s&&s.addEventListener("abort",()=>a.abort());const o=setTimeout(()=>a.abort(),r);return this.fetch.call(void 0,e,{signal:a.signal,...i}).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let a;const s=r==null?void 0:r["retry-after-ms"];if(s){const o=parseFloat(s);Number.isNaN(o)||(a=o)}const i=r==null?void 0:r["retry-after"];if(i&&!a){const o=parseFloat(i);Number.isNaN(o)?a=Date.parse(i)-Date.now():a=o*1e3}if(!(a&&0<=a&&a<60*1e3)){const o=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Lr(a),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e,i=Math.min(.5*Math.pow(2,s),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${cr}`}},Nc=class{constructor(e,t,r,a){Mn.set(this,void 0),Kf(this,Mn,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ie("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,s]of r)e.url.searchParams.set(a,s);t.query=void 0,t.path=e.url.toString()}return await Hf(this,Mn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Mn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},qf=class extends Fc{constructor(e,t,r){super(t,async a=>new r(e,a.response,await Rc(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const Wf=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Zf={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Ye=n=>typeof n=="object"&&n!==null&&!zc(n)&&Object.keys(n).every(e=>Mc(Zf,e)),Gf=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cr,"X-Stainless-OS":$c(Deno.build.os),"X-Stainless-Arch":jc(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cr,"X-Stainless-OS":$c(process.platform),"X-Stainless-Arch":jc(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Yf();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Yf(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const a=r[1]||0,s=r[2]||0,i=r[3]||0;return{browser:e,version:`${a}.${s}.${i}`}}}return null}const jc=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",$c=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Lc;const Xf=()=>Lc??(Lc=Gf()),Jf=n=>{try{return JSON.parse(n)}catch{return}},Qf=/^[a-z][a-z0-9+.-]*:/i,ep=n=>Qf.test(n),Lr=n=>new Promise(e=>setTimeout(e,n)),si=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ie(`${n} must be an integer`);if(e<0)throw new ie(`${n} must be a positive integer`);return e},ii=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},Un=n=>{var e,t,r,a,s;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(s=(a=(r=Deno.env)==null?void 0:r.get)==null?void 0:a.call(r,n))==null?void 0:s.trim()};function zc(n){if(!n)return!0;for(const e in n)return!1;return!0}function Mc(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Uc(n,e){for(const t in e){if(!Mc(e,t))continue;const r=t.toLowerCase();if(!r)continue;const a=e[t];a===null?delete n[r]:a!==void 0&&(n[r]=a)}}function hr(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const tp=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),rp=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",np=n=>typeof(n==null?void 0:n.get)=="function",Kc=(n,e)=>{var r;const t=e.toLowerCase();if(np(n)){const a=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(s,i,o)=>i+o.toUpperCase());for(const s of[e,t,e.toUpperCase(),a]){const i=n.get(s);if(i)return i}}for(const[a,s]of Object.entries(n))if(a.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};function oi(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let ap=class extends Nc{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},lt=class extends Nc{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}},pe=class{constructor(e){this._client=e}},Hc=class extends pe{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},ui=class extends pe{constructor(){super(...arguments),this.completions=new Hc(this._client)}};ui.Completions=Hc;class Vc extends pe{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}let qc=class extends pe{create(e,t){return this._client.post("/audio/transcriptions",lr({body:e,...t}))}},Wc=class extends pe{create(e,t){return this._client.post("/audio/translations",lr({body:e,...t}))}},zr=class extends pe{constructor(){super(...arguments),this.transcriptions=new qc(this._client),this.translations=new Wc(this._client),this.speech=new Vc(this._client)}};zr.Transcriptions=qc,zr.Translations=Wc,zr.Speech=Vc;class ci extends pe{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/batches",li,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class li extends lt{}ci.BatchesPage=li;class hi extends pe{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/assistants",di,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class di extends lt{}hi.AssistantsPage=di;function Zc(n){return typeof n.parse=="function"}const dr=n=>(n==null?void 0:n.role)==="assistant",Gc=n=>(n==null?void 0:n.role)==="function",Yc=n=>(n==null?void 0:n.role)==="tool";var ht=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},_e=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},fi,Kn,Hn,Mr,Ur,Vn,Kr,St,Hr,qn,Wn,fr,Xc;class Jc{constructor(){fi.add(this),this.controller=new AbortController,Kn.set(this,void 0),Hn.set(this,()=>{}),Mr.set(this,()=>{}),Ur.set(this,void 0),Vn.set(this,()=>{}),Kr.set(this,()=>{}),St.set(this,{}),Hr.set(this,!1),qn.set(this,!1),Wn.set(this,!1),fr.set(this,!1),ht(this,Kn,new Promise((e,t)=>{ht(this,Hn,e,"f"),ht(this,Mr,t,"f")}),"f"),ht(this,Ur,new Promise((e,t)=>{ht(this,Vn,e,"f"),ht(this,Kr,t,"f")}),"f"),_e(this,Kn,"f").catch(()=>{}),_e(this,Ur,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},_e(this,fi,"m",Xc).bind(this))},0)}_connected(){this.ended||(_e(this,Hn,"f").call(this),this._emit("connect"))}get ended(){return _e(this,Hr,"f")}get errored(){return _e(this,qn,"f")}get aborted(){return _e(this,Wn,"f")}abort(){this.controller.abort()}on(e,t){return(_e(this,St,"f")[e]||(_e(this,St,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=_e(this,St,"f")[e];if(!r)return this;const a=r.findIndex(s=>s.listener===t);return a>=0&&r.splice(a,1),this}once(e,t){return(_e(this,St,"f")[e]||(_e(this,St,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{ht(this,fr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){ht(this,fr,!0,"f"),await _e(this,Ur,"f")}_emit(e,...t){if(_e(this,Hr,"f"))return;e==="end"&&(ht(this,Hr,!0,"f"),_e(this,Vn,"f").call(this));const r=_e(this,St,"f")[e];if(r&&(_e(this,St,"f")[e]=r.filter(a=>!a.once),r.forEach(({listener:a})=>a(...t))),e==="abort"){const a=t[0];!_e(this,fr,"f")&&!(r!=null&&r.length)&&Promise.reject(a),_e(this,Mr,"f").call(this,a),_e(this,Kr,"f").call(this,a),this._emit("end");return}if(e==="error"){const a=t[0];!_e(this,fr,"f")&&!(r!=null&&r.length)&&Promise.reject(a),_e(this,Mr,"f").call(this,a),_e(this,Kr,"f").call(this,a),this._emit("end")}}_emitFinal(){}}Kn=new WeakMap,Hn=new WeakMap,Mr=new WeakMap,Ur=new WeakMap,Vn=new WeakMap,Kr=new WeakMap,St=new WeakMap,Hr=new WeakMap,qn=new WeakMap,Wn=new WeakMap,fr=new WeakMap,fi=new WeakSet,Xc=function(e){if(ht(this,qn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ct),e instanceof ct)return ht(this,Wn,!0,"f"),this._emit("abort",e);if(e instanceof ie)return this._emit("error",e);if(e instanceof Error){const t=new ie(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ie(String(e)))};function Qc(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Vr(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function sp(n,e){return!e||!el(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:pi(n,e)}function pi(n,e){const t=n.choices.map(r=>{var a;if(r.finish_reason==="length")throw new Pc;if(r.finish_reason==="content_filter")throw new kc;return{...r,message:{...r.message,tool_calls:((a=r.message.tool_calls)==null?void 0:a.map(s=>op(e,s)))??[],parsed:r.message.content&&!r.message.refusal?ip(e,r.message.content):null}}});return{...n,choices:t}}function ip(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function op(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(a=>{var s;return((s=a.function)==null?void 0:s.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Vr(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function up(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(a=>{var s;return((s=a.function)==null?void 0:s.name)===e.function.name});return Vr(t)||(t==null?void 0:t.function.strict)||!1}function el(n){var e;return Qc(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>Vr(t)||t.type==="function"&&t.function.strict===!0))??!1}function cp(n){for(const e of n??[]){if(e.type!=="function")throw new ie(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ie(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Xe=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Me,mi,Zn,gi,yi,xi,tl,bi;const rl=10;class nl extends Jc{constructor(){super(...arguments),Me.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Gc(e)||Yc(e))&&e.content)this._emit("functionCallResult",e.content);else if(dr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(dr(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ie("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Xe(this,Me,"m",mi).call(this)}async finalMessage(){return await this.done(),Xe(this,Me,"m",Zn).call(this)}async finalFunctionCall(){return await this.done(),Xe(this,Me,"m",gi).call(this)}async finalFunctionCallResult(){return await this.done(),Xe(this,Me,"m",yi).call(this)}async totalUsage(){return await this.done(),Xe(this,Me,"m",xi).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Xe(this,Me,"m",Zn).call(this);t&&this._emit("finalMessage",t);const r=Xe(this,Me,"m",mi).call(this);r&&this._emit("finalContent",r);const a=Xe(this,Me,"m",gi).call(this);a&&this._emit("finalFunctionCall",a);const s=Xe(this,Me,"m",yi).call(this);s!=null&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",Xe(this,Me,"m",xi).call(this))}async _createChatCompletion(e,t,r){const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Xe(this,Me,"m",tl).call(this,t);const s=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(pi(s,t))}async _runChatCompletion(e,t,r){for(const a of t.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const a="function",{function_call:s="auto",stream:i,...o}=t,c=typeof s!="string"&&(s==null?void 0:s.name),{maxChatCompletions:u=rl}=r||{},l={};for(const x of t.functions)l[x.name||x.function.name]=x;const f=t.functions.map(x=>({name:x.name||x.function.name,parameters:x.parameters,description:x.description}));for(const x of t.messages)this._addMessage(x,!1);for(let x=0;x<u;++x){const w=(h=(await this._createChatCompletion(e,{...o,function_call:s,functions:f,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!w)throw new ie("missing message in ChatCompletion response");if(!w.function_call)return;const{name:d,arguments:k}=w.function_call,g=l[d];if(g){if(c&&c!==d){const v=`Invalid function_call: ${JSON.stringify(d)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:a,name:d,content:v});continue}}else{const v=`Invalid function_call: ${JSON.stringify(d)}. Available options are: ${f.map(P=>JSON.stringify(P.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:d,content:v});continue}let y;try{y=Zc(g)?await g.parse(k):k}catch(v){this._addMessage({role:a,name:d,content:v instanceof Error?v.message:String(v)});continue}const _=await g.function(y,this),O=Xe(this,Me,"m",bi).call(this,_);if(this._addMessage({role:a,name:d,content:O}),c)return}}async _runTools(e,t,r){var x,m,w;const a="tool",{tool_choice:s="auto",stream:i,...o}=t,c=typeof s!="string"&&((x=s==null?void 0:s.function)==null?void 0:x.name),{maxChatCompletions:u=rl}=r||{},l=t.tools.map(d=>{if(Vr(d)){if(!d.$callback)throw new ie("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:d.$callback,name:d.function.name,description:d.function.description||"",parameters:d.function.parameters,parse:d.$parseRaw,strict:!0}}}return d}),f={};for(const d of l)d.type==="function"&&(f[d.function.name||d.function.function.name]=d.function);const h="tools"in t?l.map(d=>d.type==="function"?{type:"function",function:{name:d.function.name||d.function.function.name,parameters:d.function.parameters,description:d.function.description,strict:d.function.strict}}:d):void 0;for(const d of t.messages)this._addMessage(d,!1);for(let d=0;d<u;++d){const g=(m=(await this._createChatCompletion(e,{...o,tool_choice:s,tools:h,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!g)throw new ie("missing message in ChatCompletion response");if(!((w=g.tool_calls)!=null&&w.length))return;for(const y of g.tool_calls){if(y.type!=="function")continue;const _=y.id,{name:O,arguments:v}=y.function,P=f[O];if(P){if(c&&c!==O){const A=`Invalid tool_call: ${JSON.stringify(O)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:a,tool_call_id:_,content:A});continue}}else{const A=`Invalid tool_call: ${JSON.stringify(O)}. Available options are: ${Object.keys(f).map(S=>JSON.stringify(S)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:_,content:A});continue}let b;try{b=Zc(P)?await P.parse(v):v}catch(A){const S=A instanceof Error?A.message:String(A);this._addMessage({role:a,tool_call_id:_,content:S});continue}const C=await P.function(b,this),p=Xe(this,Me,"m",bi).call(this,C);if(this._addMessage({role:a,tool_call_id:_,content:p}),c)return}}}}Me=new WeakSet,mi=function(){return Xe(this,Me,"m",Zn).call(this).content??null},Zn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(dr(t)){const{function_call:r,...a}=t,s={...a,content:t.content??null,refusal:t.refusal??null};return r&&(s.function_call=r),s}}throw new ie("stream ended without producing a ChatCompletionMessage with role=assistant")},gi=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const a=this.messages[r];if(dr(a)&&(a!=null&&a.function_call))return a.function_call;if(dr(a)&&((e=a==null?void 0:a.tool_calls)!=null&&e.length))return(t=a.tool_calls.at(-1))==null?void 0:t.function}},yi=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Gc(t)&&t.content!=null||Yc(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var a;return r.role==="assistant"&&((a=r.tool_calls)==null?void 0:a.some(s=>s.type==="function"&&s.id===t.tool_call_id))}))return t.content}},xi=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},tl=function(e){if(e.n!=null&&e.n>1)throw new ie("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},bi=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class qr extends nl{static runFunctions(e,t,r){const a=new qr,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,s)),a}static runTools(e,t,r){const a=new qr,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,s)),a}_addMessage(e,t=!0){super._addMessage(e,t),dr(e)&&e.content&&this._emit("content",e.content)}}const al=1,sl=2,il=4,ol=8,ul=16,cl=32,ll=64,hl=128,dl=256,fl=hl|dl,pl=ul|cl|fl|ll,ml=al|sl|pl,gl=il|ol,lp=ml|gl,Te={STR:al,NUM:sl,ARR:il,OBJ:ol,NULL:ul,BOOL:cl,NAN:ll,INFINITY:hl,MINUS_INFINITY:dl,INF:fl,SPECIAL:pl,ATOM:ml,COLLECTION:gl,ALL:lp};class hp extends Error{}class dp extends Error{}function fp(n,e=Te.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return pp(n.trim(),e)}const pp=(n,e)=>{const t=n.length;let r=0;const a=h=>{throw new hp(`${h} at position ${r}`)},s=h=>{throw new dp(`${h} at position ${r}`)},i=()=>(f(),r>=t&&a("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?c():n[r]==="["?u():n.substring(r,r+4)==="null"||Te.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Te.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Te.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Te.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Te.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Te.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):l()),o=()=>{const h=r;let x=!1;for(r++;r<t&&(n[r]!=='"'||x&&n[r-1]==="\\");)x=n[r]==="\\"?!x:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(h,++r-Number(x)))}catch(m){s(String(m))}else if(Te.STR&e)try{return JSON.parse(n.substring(h,r-Number(x))+'"')}catch{return JSON.parse(n.substring(h,n.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},c=()=>{r++,f();const h={};try{for(;n[r]!=="}";){if(f(),r>=t&&Te.OBJ&e)return h;const x=o();f(),r++;try{const m=i();Object.defineProperty(h,x,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Te.OBJ&e)return h;throw m}f(),n[r]===","&&r++}}catch{if(Te.OBJ&e)return h;a("Expected '}' at end of object")}return r++,h},u=()=>{r++;const h=[];try{for(;n[r]!=="]";)h.push(i()),f(),n[r]===","&&r++}catch{if(Te.ARR&e)return h;a("Expected ']' at end of array")}return r++,h},l=()=>{if(r===0){n==="-"&&Te.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(n)}catch(x){if(Te.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}s(String(x))}}const h=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Te.NUM&e)&&a("Unterminated number literal");try{return JSON.parse(n.substring(h,r))}catch{n.substring(h,r)==="-"&&Te.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(n.substring(h,n.lastIndexOf("e")))}catch(m){s(String(m))}}},f=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return i()},yl=n=>fp(n,Te.ALL^Te.NUM);var pr=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},ge=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ie,It,mr,Lt,_i,Gn,vi,wi,Ai,Yn,Ei,xl;class Wr extends nl{constructor(e){super(),Ie.add(this),It.set(this,void 0),mr.set(this,void 0),Lt.set(this,void 0),pr(this,It,e,"f"),pr(this,mr,[],"f")}get currentChatCompletionSnapshot(){return ge(this,Lt,"f")}static fromReadableStream(e){const t=new Wr(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const a=new Wr(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,r){var i;super._createChatCompletion;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),ge(this,Ie,"m",_i).call(this);const s=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of s)ge(this,Ie,"m",vi).call(this,o);if((i=s.controller.signal)!=null&&i.aborted)throw new ct;return this._addChatCompletion(ge(this,Ie,"m",Yn).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ge(this,Ie,"m",_i).call(this),this._connected();const a=$r.fromReadableStream(e,this.controller);let s;for await(const o of a)s&&s!==o.id&&this._addChatCompletion(ge(this,Ie,"m",Yn).call(this)),ge(this,Ie,"m",vi).call(this,o),s=o.id;if((i=a.controller.signal)!=null&&i.aborted)throw new ct;return this._addChatCompletion(ge(this,Ie,"m",Yn).call(this))}[(It=new WeakMap,mr=new WeakMap,Lt=new WeakMap,Ie=new WeakSet,_i=function(){this.ended||pr(this,Lt,void 0,"f")},Gn=function(t){let r=ge(this,mr,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ge(this,mr,"f")[t.index]=r,r)},vi=function(t){var a,s,i,o,c,u,l,f,h,x,m,w,d,k,g;if(this.ended)return;const r=ge(this,Ie,"m",xl).call(this,t);this._emit("chunk",t,r);for(const y of t.choices){const _=r.choices[y.index];y.delta.content!=null&&((a=_.message)==null?void 0:a.role)==="assistant"&&((s=_.message)!=null&&s.content)&&(this._emit("content",y.delta.content,_.message.content),this._emit("content.delta",{delta:y.delta.content,snapshot:_.message.content,parsed:_.message.parsed})),y.delta.refusal!=null&&((i=_.message)==null?void 0:i.role)==="assistant"&&((o=_.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:y.delta.refusal,snapshot:_.message.refusal}),((c=y.logprobs)==null?void 0:c.content)!=null&&((u=_.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(l=y.logprobs)==null?void 0:l.content,snapshot:((f=_.logprobs)==null?void 0:f.content)??[]}),((h=y.logprobs)==null?void 0:h.refusal)!=null&&((x=_.message)==null?void 0:x.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=y.logprobs)==null?void 0:m.refusal,snapshot:((w=_.logprobs)==null?void 0:w.refusal)??[]});const O=ge(this,Ie,"m",Gn).call(this,_);_.finish_reason&&(ge(this,Ie,"m",Ai).call(this,_),O.current_tool_call_index!=null&&ge(this,Ie,"m",wi).call(this,_,O.current_tool_call_index));for(const v of y.delta.tool_calls??[])O.current_tool_call_index!==v.index&&(ge(this,Ie,"m",Ai).call(this,_),O.current_tool_call_index!=null&&ge(this,Ie,"m",wi).call(this,_,O.current_tool_call_index)),O.current_tool_call_index=v.index;for(const v of y.delta.tool_calls??[]){const P=(d=_.message.tool_calls)==null?void 0:d[v.index];P!=null&&P.type&&((P==null?void 0:P.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(k=P.function)==null?void 0:k.name,index:v.index,arguments:P.function.arguments,parsed_arguments:P.function.parsed_arguments,arguments_delta:((g=v.function)==null?void 0:g.arguments)??""}):(P==null||P.type,void 0))}}},wi=function(t,r){var i,o,c;if(ge(this,Ie,"m",Gn).call(this,t).done_tool_calls.has(r))return;const s=(i=t.message.tool_calls)==null?void 0:i[r];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){const u=(c=(o=ge(this,It,"f"))==null?void 0:o.tools)==null?void 0:c.find(l=>l.type==="function"&&l.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:r,arguments:s.function.arguments,parsed_arguments:Vr(u)?u.$parseRaw(s.function.arguments):u!=null&&u.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Ai=function(t){var a,s;const r=ge(this,Ie,"m",Gn).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const i=ge(this,Ie,"m",Ei).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(a=t.logprobs)!=null&&a.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(s=t.logprobs)!=null&&s.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Yn=function(){if(this.ended)throw new ie("stream has ended, this shouldn't happen");const t=ge(this,Lt,"f");if(!t)throw new ie("request ended without sending any chunks");return pr(this,Lt,void 0,"f"),pr(this,mr,[],"f"),mp(t,ge(this,It,"f"))},Ei=function(){var r;const t=(r=ge(this,It,"f"))==null?void 0:r.response_format;return Qc(t)?t:null},xl=function(t){var r,a,s,i;let o=ge(this,Lt,"f");const{choices:c,...u}=t;o?Object.assign(o,u):o=pr(this,Lt,{...u,choices:[]},"f");for(const{delta:l,finish_reason:f,index:h,logprobs:x=null,...m}of t.choices){let w=o.choices[h];if(w||(w=o.choices[h]={finish_reason:f,index:h,message:{},logprobs:x,...m}),x)if(!w.logprobs)w.logprobs=Object.assign({},x);else{const{content:v,refusal:P,...b}=x;Object.assign(w.logprobs,b),v&&((r=w.logprobs).content??(r.content=[]),w.logprobs.content.push(...v)),P&&((a=w.logprobs).refusal??(a.refusal=[]),w.logprobs.refusal.push(...P))}if(f&&(w.finish_reason=f,ge(this,It,"f")&&el(ge(this,It,"f")))){if(f==="length")throw new Pc;if(f==="content_filter")throw new kc}if(Object.assign(w,m),!l)continue;const{content:d,refusal:k,function_call:g,role:y,tool_calls:_,...O}=l;if(Object.assign(w.message,O),k&&(w.message.refusal=(w.message.refusal||"")+k),y&&(w.message.role=y),g&&(w.message.function_call?(g.name&&(w.message.function_call.name=g.name),g.arguments&&((s=w.message.function_call).arguments??(s.arguments=""),w.message.function_call.arguments+=g.arguments)):w.message.function_call=g),d&&(w.message.content=(w.message.content||"")+d,!w.message.refusal&&ge(this,Ie,"m",Ei).call(this)&&(w.message.parsed=yl(w.message.content))),_){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:v,id:P,type:b,function:C,...p}of _){const A=(i=w.message.tool_calls)[v]??(i[v]={});Object.assign(A,p),P&&(A.id=P),b&&(A.type=b),C&&(A.function??(A.function={name:C.name??"",arguments:""})),C!=null&&C.name&&(A.function.name=C.name),C!=null&&C.arguments&&(A.function.arguments+=C.arguments,up(ge(this,It,"f"),A)&&(A.function.parsed_arguments=yl(A.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",a=>{const s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{r=!0;for(const s of t)s.reject(a);t.length=0}),this.on("error",a=>{r=!0;for(const s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new $r(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function mp(n,e){const{id:t,choices:r,created:a,model:s,system_fingerprint:i,...o}=n,c={...o,id:t,choices:r.map(({message:u,finish_reason:l,index:f,logprobs:h,...x})=>{if(!l)throw new ie(`missing finish_reason for choice ${f}`);const{content:m=null,function_call:w,tool_calls:d,...k}=u,g=u.role;if(!g)throw new ie(`missing role for choice ${f}`);if(w){const{arguments:y,name:_}=w;if(y==null)throw new ie(`missing function_call.arguments for choice ${f}`);if(!_)throw new ie(`missing function_call.name for choice ${f}`);return{...x,message:{content:m,function_call:{arguments:y,name:_},role:g,refusal:u.refusal??null},finish_reason:l,index:f,logprobs:h}}return d?{...x,index:f,finish_reason:l,logprobs:h,message:{...k,role:g,content:m,refusal:u.refusal??null,tool_calls:d.map((y,_)=>{const{function:O,type:v,id:P,...b}=y,{arguments:C,name:p,...A}=O||{};if(P==null)throw new ie(`missing choices[${f}].tool_calls[${_}].id
${Xn(n)}`);if(v==null)throw new ie(`missing choices[${f}].tool_calls[${_}].type
${Xn(n)}`);if(p==null)throw new ie(`missing choices[${f}].tool_calls[${_}].function.name
${Xn(n)}`);if(C==null)throw new ie(`missing choices[${f}].tool_calls[${_}].function.arguments
${Xn(n)}`);return{...b,id:P,type:v,function:{...A,name:p,arguments:C}}})}}:{...x,message:{...k,content:m,role:g,refusal:u.refusal??null},finish_reason:l,index:f,logprobs:h}}),created:a,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}};return sp(c,e)}function Xn(n){return JSON.stringify(n)}function Cb(n){}class gr extends Wr{static fromReadableStream(e){const t=new gr(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const a=new gr(null),s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,s)),a}static runTools(e,t,r){const a=new gr(t),s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,s)),a}}let bl=class extends pe{parse(e,t){return cp(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>pi(r,e))}runFunctions(e,t){return e.stream?gr.runFunctions(this._client,e,t):qr.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?gr.runTools(this._client,e,t):qr.runTools(this._client,e,t)}stream(e,t){return Wr.createChatCompletion(this._client,e,t)}},Ci=class extends pe{constructor(){super(...arguments),this.completions=new bl(this._client)}};(function(n){n.Completions=bl})(Ci||(Ci={}));var G=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},et=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Ne,Pi,bt,Jn,dt,Xt,yr,Jt,Qn,tt,ea,ta,Zr,Gr,Yr,_l,vl,wl,Al,El,Cl,Pl;class ft extends Jc{constructor(){super(...arguments),Ne.add(this),Pi.set(this,[]),bt.set(this,{}),Jn.set(this,{}),dt.set(this,void 0),Xt.set(this,void 0),yr.set(this,void 0),Jt.set(this,void 0),Qn.set(this,void 0),tt.set(this,void 0),ea.set(this,void 0),ta.set(this,void 0),Zr.set(this,void 0)}[(Pi=new WeakMap,bt=new WeakMap,Jn=new WeakMap,dt=new WeakMap,Xt=new WeakMap,yr=new WeakMap,Jt=new WeakMap,Qn=new WeakMap,tt=new WeakMap,ea=new WeakMap,ta=new WeakMap,Zr=new WeakMap,Ne=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",a=>{const s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{r=!0;for(const s of t)s.reject(a);t.length=0}),this.on("error",a=>{r=!0;for(const s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ft;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var s;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const a=$r.fromReadableStream(e,this.controller);for await(const i of a)G(this,Ne,"m",Gr).call(this,i);if((s=a.controller.signal)!=null&&s.aborted)throw new ct;return this._addRun(G(this,Ne,"m",Yr).call(this))}toReadableStream(){return new $r(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,a,s){const i=new ft;return i._run(()=>i._runToolAssistantStream(e,t,r,a,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,a,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...a,stream:!0},c=await e.submitToolOutputs(t,r,o,{...s,signal:this.controller.signal});this._connected();for await(const l of c)G(this,Ne,"m",Gr).call(this,l);if((u=c.controller.signal)!=null&&u.aborted)throw new ct;return this._addRun(G(this,Ne,"m",Yr).call(this))}static createThreadAssistantStream(e,t,r){const a=new ft;return a._run(()=>a._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,r,a){const s=new ft;return s._run(()=>s._runAssistantStream(e,t,r,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return G(this,ea,"f")}currentRun(){return G(this,ta,"f")}currentMessageSnapshot(){return G(this,dt,"f")}currentRunStepSnapshot(){return G(this,Zr,"f")}async finalRunSteps(){return await this.done(),Object.values(G(this,bt,"f"))}async finalMessages(){return await this.done(),Object.values(G(this,Jn,"f"))}async finalRun(){if(await this.done(),!G(this,Xt,"f"))throw Error("Final run was not received.");return G(this,Xt,"f")}async _createThreadAssistantStream(e,t,r){var o;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...t,stream:!0},i=await e.createAndRun(s,{...r,signal:this.controller.signal});this._connected();for await(const c of i)G(this,Ne,"m",Gr).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new ct;return this._addRun(G(this,Ne,"m",Yr).call(this))}async _createAssistantStream(e,t,r,a){var c;const s=a==null?void 0:a.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},o=await e.create(t,i,{...a,signal:this.controller.signal});this._connected();for await(const u of o)G(this,Ne,"m",Gr).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new ct;return this._addRun(G(this,Ne,"m",Yr).call(this))}static accumulateDelta(e,t){for(const[r,a]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=a;continue}let s=e[r];if(s==null){e[r]=a;continue}if(r==="index"||r==="type"){e[r]=a;continue}if(typeof s=="string"&&typeof a=="string")s+=a;else if(typeof s=="number"&&typeof a=="number")s+=a;else if(oi(s)&&oi(a))s=this.accumulateDelta(s,a);else if(Array.isArray(s)&&Array.isArray(a)){if(s.every(i=>typeof i=="string"||typeof i=="number")){s.push(...a);continue}for(const i of a){if(!oi(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=s[o];c==null?s.push(i):s[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${a}, accValue: ${s}`);e[r]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,a){return await this._createAssistantStream(t,e,r,a)}async _runToolAssistantStream(e,t,r,a,s){return await this._createToolAssistantStream(r,e,t,a,s)}}Gr=function(e){if(!this.ended)switch(et(this,ea,e,"f"),G(this,Ne,"m",wl).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":G(this,Ne,"m",Pl).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":G(this,Ne,"m",vl).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":G(this,Ne,"m",_l).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Yr=function(){if(this.ended)throw new ie("stream has ended, this shouldn't happen");if(!G(this,Xt,"f"))throw Error("Final run has not been received");return G(this,Xt,"f")},_l=function(e){const[t,r]=G(this,Ne,"m",El).call(this,e,G(this,dt,"f"));et(this,dt,t,"f"),G(this,Jn,"f")[t.id]=t;for(const a of r){const s=t.content[a.index];(s==null?void 0:s.type)=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const a of e.data.delta.content){if(a.type=="text"&&a.text){let s=a.text,i=t.content[a.index];if(i&&i.type=="text")this._emit("textDelta",s,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=G(this,yr,"f")){if(G(this,Jt,"f"))switch(G(this,Jt,"f").type){case"text":this._emit("textDone",G(this,Jt,"f").text,G(this,dt,"f"));break;case"image_file":this._emit("imageFileDone",G(this,Jt,"f").image_file,G(this,dt,"f"));break}et(this,yr,a.index,"f")}et(this,Jt,t.content[a.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(G(this,yr,"f")!==void 0){const a=e.data.content[G(this,yr,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,G(this,dt,"f"));break;case"text":this._emit("textDone",a.text,G(this,dt,"f"));break}}G(this,dt,"f")&&this._emit("messageDone",e.data),et(this,dt,void 0,"f")}},vl=function(e){const t=G(this,Ne,"m",Al).call(this,e);switch(et(this,Zr,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const s of r.step_details.tool_calls)s.index==G(this,Qn,"f")?this._emit("toolCallDelta",s,t.step_details.tool_calls[s.index]):(G(this,tt,"f")&&this._emit("toolCallDone",G(this,tt,"f")),et(this,Qn,s.index,"f"),et(this,tt,t.step_details.tool_calls[s.index],"f"),G(this,tt,"f")&&this._emit("toolCallCreated",G(this,tt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":et(this,Zr,void 0,"f"),e.data.step_details.type=="tool_calls"&&G(this,tt,"f")&&(this._emit("toolCallDone",G(this,tt,"f")),et(this,tt,void 0,"f")),this._emit("runStepDone",e.data,t);break}},wl=function(e){G(this,Pi,"f").push(e),this._emit("event",e)},Al=function(e){switch(e.event){case"thread.run.step.created":return G(this,bt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=G(this,bt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const a=ft.accumulateDelta(t,r.delta);G(this,bt,"f")[e.data.id]=a}return G(this,bt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":G(this,bt,"f")[e.data.id]=e.data;break}if(G(this,bt,"f")[e.data.id])return G(this,bt,"f")[e.data.id];throw new Error("No snapshot available")},El=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(const s of a.delta.content)if(s.index in t.content){let i=t.content[s.index];t.content[s.index]=G(this,Ne,"m",Cl).call(this,s,i)}else t.content[s.index]=s,r.push(s);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Cl=function(e,t){return ft.accumulateDelta(t,e)},Pl=function(e){switch(et(this,ta,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":et(this,Xt,e.data,"f"),G(this,tt,"f")&&(this._emit("toolCallDone",G(this,tt,"f")),et(this,tt,void 0,"f"));break}};class ki extends pe{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t={},r){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Si,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Si extends lt{}ki.MessagesPage=Si;class Ii extends pe{retrieve(e,t,r,a={},s){return Ye(a)?this.retrieve(e,t,r,{},a):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:a,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t,r={},a){return Ye(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Oi,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}}class Oi extends lt{}Ii.RunStepsPage=Oi;class Xr extends pe{constructor(){super(...arguments),this.steps=new Ii(this._client)}create(e,t,r){const{include:a,...s}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:a},body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t={},r){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Bi,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const a=await this.create(e,t,r);return await this.poll(e,a.id,r)}createAndStream(e,t,r){return ft.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:i}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...a}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Lr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return ft.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,a){const s=await this.submitToolOutputs(e,t,r,a);return await this.poll(e,s.id,a)}submitToolOutputsStream(e,t,r,a){return ft.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,a)}}class Bi extends lt{}Xr.RunsPage=Bi,Xr.Steps=Ii,Xr.RunStepsPage=Oi;class xr extends pe{constructor(){super(...arguments),this.runs=new Xr(this._client),this.messages=new ki(this._client)}create(e={},t){return Ye(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return ft.createThreadAssistantStream(e,this._client.beta.threads,t)}}xr.Runs=Xr,xr.RunsPage=Bi,xr.Messages=ki,xr.MessagesPage=Si;const gp=async n=>{const e=await Promise.allSettled(n),t=e.filter(a=>a.status==="rejected");if(t.length){for(const a of t)console.error(a.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const a of e)a.status==="fulfilled"&&r.push(a.value);return r};let Ti=class extends pe{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,ra,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const a=await this.create(e,t,r);return await this.poll(e,a.id,r)}async poll(e,t,r){const a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const s=await this.retrieve(e,t,{...r,headers:a}).withResponse(),i=s.data;switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=s.response.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Lr(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){const a=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:a.id},r)}async uploadAndPoll(e,t,r){const a=await this.upload(e,t,r);return await this.poll(e,a.id,r)}};class ra extends lt{}Ti.VectorStoreFilesPage=ra;class kl extends pe{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const a=await this.create(e,t);return await this.poll(e,a.id,r)}listFiles(e,t,r={},a){return Ye(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,ra,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async poll(e,t,r){const a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:i}=await this.retrieve(e,t,{...r,headers:a}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Lr(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},a){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=(a==null?void 0:a.maxConcurrency)??5,i=Math.min(s,t.length),o=this._client,c=t.values(),u=[...r];async function l(h){for(let x of h){const m=await o.files.create({file:x,purpose:"assistants"},a);u.push(m.id)}}const f=Array(i).fill(c).map(l);return await gp(f),await this.createAndPoll(e,{file_ids:u})}}class br extends pe{constructor(){super(...arguments),this.files=new Ti(this._client),this.fileBatches=new kl(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ri,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ri extends lt{}br.VectorStoresPage=Ri,br.Files=Ti,br.VectorStoreFilesPage=ra,br.FileBatches=kl;class Qt extends pe{constructor(){super(...arguments),this.vectorStores=new br(this._client),this.chat=new Ci(this._client),this.assistants=new hi(this._client),this.threads=new xr(this._client)}}Qt.VectorStores=br,Qt.VectorStoresPage=Ri,Qt.Assistants=hi,Qt.AssistantsPage=di,Qt.Threads=xr;let Sl=class extends pe{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}},Il=class extends pe{create(e,t){return this._client.post("/embeddings",{body:e,...t})}},Di=class extends pe{create(e,t){return this._client.post("/files",lr({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/files",Fi,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const a=new Set(["processed","error","deleted"]),s=Date.now();let i=await this.retrieve(e);for(;!i.status||!a.has(i.status);)if(await Lr(t),i=await this.retrieve(e),Date.now()-s>r)throw new ri({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},Fi=class extends lt{};Di.FileObjectsPage=Fi;class Ni extends pe{list(e,t={},r){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ji,{query:t,...r})}}class ji extends lt{}Ni.FineTuningJobCheckpointsPage=ji;let _r=class extends pe{constructor(){super(...arguments),this.checkpoints=new Ni(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",$i,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Ye(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Li,{query:t,...r})}},$i=class extends lt{},Li=class extends lt{};_r.FineTuningJobsPage=$i,_r.FineTuningJobEventsPage=Li,_r.Checkpoints=Ni,_r.FineTuningJobCheckpointsPage=ji;let Jr=class extends pe{constructor(){super(...arguments),this.jobs=new _r(this._client)}};Jr.Jobs=_r,Jr.FineTuningJobsPage=$i,Jr.FineTuningJobEventsPage=Li;let Ol=class extends pe{createVariation(e,t){return this._client.post("/images/variations",lr({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",lr({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}},zi=class extends pe{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Mi,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Mi=class extends ap{};zi.ModelsPage=Mi;let Bl=class extends pe{create(e,t){return this._client.post("/moderations",{body:e,...t})}};class Tl extends pe{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,lr({body:t,...r}))}}class Ui extends pe{constructor(){super(...arguments),this.parts=new Tl(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Ui.Parts=Tl;var Rl;let ue=class extends Vf{constructor({baseURL:e=Un("OPENAI_BASE_URL"),apiKey:t=Un("OPENAI_API_KEY"),organization:r=Un("OPENAI_ORG_ID")??null,project:a=Un("OPENAI_PROJECT_ID")??null,...s}={}){if(t===void 0)throw new ie("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:r,project:a,...s,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&rp())throw new ie(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Sl(this),this.chat=new ui(this),this.embeddings=new Il(this),this.files=new Di(this),this.images=new Ol(this),this.audio=new zr(this),this.moderations=new Bl(this),this.models=new zi(this),this.fineTuning=new Jr(this),this.beta=new Qt(this),this.batches=new ci(this),this.uploads=new Ui(this),this._options=i,this.apiKey=t,this.organization=r,this.project=a}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Sf(e,{arrayFormat:"brackets"})}};Rl=ue,ue.OpenAI=Rl,ue.DEFAULT_TIMEOUT=6e5,ue.OpenAIError=ie,ue.APIError=Ge,ue.APIConnectionError=$n,ue.APIConnectionTimeoutError=ri,ue.APIUserAbortError=ct,ue.NotFoundError=vc,ue.ConflictError=wc,ue.RateLimitError=Ec,ue.BadRequestError=xc,ue.AuthenticationError=bc,ue.InternalServerError=Cc,ue.PermissionDeniedError=_c,ue.UnprocessableEntityError=Ac,ue.toFile=Bc,ue.fileFromPath=gc,ue.Completions=Sl,ue.Chat=ui,ue.Embeddings=Il,ue.Files=Di,ue.FileObjectsPage=Fi,ue.Images=Ol,ue.Audio=zr,ue.Moderations=Bl,ue.Models=zi,ue.ModelsPage=Mi,ue.FineTuning=Jr,ue.Beta=Qt,ue.Batches=ci,ue.BatchesPage=li,ue.Uploads=Ui;const yp=ue,Ot={sanitizeUrl:n=>{let e;try{e=new URL(n.trim())}catch{return null}return e.href.length>2048||!e.hostname?null:(e.pathname.length===1?e.pathname="/":e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),e.href)},md5:n=>Th.MD5(n).toString(),currTs:()=>Date.now()/1e3,extractHtmlContent:n=>{let e=n;return e=e.replace(/\n+/g,`
`).replace(/\s+/g," ").trim(),e},text2docs:async(n,e)=>{const r=await new jn({chunkSize:500,chunkOverlap:20}).createDocuments([n]);return e&&r.forEach(a=>{a.metadata=e}),r},testOpenAIKey:async n=>{try{return await new yp({apiKey:n,dangerouslyAllowBrowser:!0}).chat.completions.create({messages:[{role:"user",content:"test"}],model:"gpt-3.5-turbo",max_tokens:1,n:1}),null}catch(e){return e.toString()}}},vr="4.4.0";class xp{constructor(e,t){this.response=e,this.controller=t,this.decoder=new bp}async*iterMessages(){if(!this.response.body)throw this.controller.abort(),new Error("Attempted to iterate over a response with no body");const e=new wr,t=vp(this.response.body);for await(const r of t)for(const a of e.decode(r)){const s=this.decoder.decode(a);s&&(yield s)}for(const r of e.flush()){const a=this.decoder.decode(r);a&&(yield a)}}async*[Symbol.asyncIterator](){let e=!1;try{for await(const t of this.iterMessages())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(t.event===null)try{yield JSON.parse(t.data)}catch(r){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),r}}e=!0}catch(t){if(t instanceof Error&&t.name==="AbortError")return;throw t}finally{e||this.controller.abort()}}}class bp{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=_p(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}}class wr{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=wr.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(wr.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Error(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!==null&&t!==void 0||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Error(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Error("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}wr.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]),wr.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function _p(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function vp(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let rt=class Mo extends Error{constructor(e,t,r,a){super(Mo.makeMessage(t,r)),this.status=e,this.headers=a;const s=t;this.error=s,this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(e,t){return e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):t||"Unknown error occurred"}static generate(e,t,r,a){if(!e)return new Qr({cause:Hl(t)});const s=t==null?void 0:t.error;return e===400?new Hi(e,s,r,a):e===401?new Vi(e,s,r,a):e===403?new qi(e,s,r,a):e===404?new Wi(e,s,r,a):e===409?new Zi(e,s,r,a):e===422?new Gi(e,s,r,a):e===429?new Yi(e,s,r,a):e>=500?new Xi(e,s,r,a):new Mo(e,s,r,a)}},na=class extends rt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Qr=class extends rt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},Ki=class extends Qr{constructor(){super({message:"Request timed out."})}},Hi=class extends rt{constructor(){super(...arguments),this.status=400}},Vi=class extends rt{constructor(){super(...arguments),this.status=401}},qi=class extends rt{constructor(){super(...arguments),this.status=403}},Wi=class extends rt{constructor(){super(...arguments),this.status=404}},Zi=class extends rt{constructor(){super(...arguments),this.status=409}},Gi=class extends rt{constructor(){super(...arguments),this.status=422}},Yi=class extends rt{constructor(){super(...arguments),this.status=429}},Xi=class extends rt{};const wp=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:Qr,APIConnectionTimeoutError:Ki,APIError:rt,APIUserAbortError:na,AuthenticationError:Vi,BadRequestError:Hi,ConflictError:Zi,InternalServerError:Xi,NotFoundError:Wi,PermissionDeniedError:qi,RateLimitError:Yi,UnprocessableEntityError:Gi},Symbol.toStringTag,{value:"Module"})),Ap=n=>{},Ep=fetch.bind(void 0),Cp=!1,Pp=FormData,Dl=typeof File<"u"?File:class extends Blob{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'File' is not defined")}};async function kp(n,e){return{...e,body:new Np(n)}}async function Sp(){throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")}function Ip(n){return!1}const Fl=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Op=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Nl(n),Nl=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Bp=n=>Op(n)||Fl(n)||Ip();async function jl(n,e,t={}){var r,a,s;if(n=await n,Fl(n)){const o=await n.blob();return e||(e=(r=new URL(n.url).pathname.split(/[\\/]/).pop())!==null&&r!==void 0?r:"unknown_file"),new Dl([o],e,t)}const i=await Tp(n);if(e||(e=(a=Dp(n))!==null&&a!==void 0?a:"unknown_file"),!t.type){const o=(s=i[0])===null||s===void 0?void 0:s.type;typeof o=="string"&&(t={...t,type:o})}return new Dl(i,e,t)}async function Tp(n){var e;let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(Nl(n))t.push(await n.arrayBuffer());else if(Fp(n))for await(const r of n)t.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(e=n==null?void 0:n.constructor)===null||e===void 0?void 0:e.name}; props: ${Rp(n)}`);return t}function Rp(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Dp(n){var e;return Ji(n.name)||Ji(n.filename)||((e=Ji(n.path))===null||e===void 0?void 0:e.split(/[\\/]/).pop())}const Ji=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Fp=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";class Np{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const $l=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",en=async n=>{const e=await jp(n.body);return kp(e,n)},jp=async n=>{const e=new Pp;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Qi(e,t,r))),e},Qi=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Bp(t)){const r=await jl(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Qi(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>Qi(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var $p=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Lp=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},aa;const zp=2;async function Ll(n){const{response:e}=n;if(n.options.stream)return new xp(e,n.controller);const t=e.headers.get("content-type");if(t!=null&&t.includes("application/json")){const a=await e.json();return oa("response",e.status,e.url,e.headers,a),a}const r=await e.text();return oa("response",e.status,e.url,e.headers,r),r}class sa extends Promise{constructor(e,t=Ll){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new sa(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Mp{constructor({baseURL:e,maxRetries:t,timeout:r=6e5,httpAgent:a,fetch:s}){this.baseURL=e,this.maxRetries=eo("maxRetries",t??zp),this.timeout=eo("timeout",r),this.httpAgent=a,this.fetch=s??Ep}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Wp(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Qp()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(a=>({method:e,path:t,...a})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var t,r,a,s,i,o;const{method:c,path:u,query:l,headers:f={}}=e,h=$l(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,x=this.calculateContentLength(h),m=this.buildURL(u,l);"timeout"in e&&eo("timeout",e.timeout);const w=(t=e.timeout)!==null&&t!==void 0?t:this.timeout,d=(a=(r=e.httpAgent)!==null&&r!==void 0?r:this.httpAgent)!==null&&a!==void 0?a:Ap(),k=w+1e3;typeof((s=d==null?void 0:d.options)===null||s===void 0?void 0:s.timeout)=="number"&&k>((i=d.options.timeout)!==null&&i!==void 0?i:0)&&(d.options.timeout=k),this.idempotencyHeader&&c!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=e.idempotencyKey);const g={...x&&{"Content-Length":x},...this.defaultHeaders(e),...f};$l(e.body)&&!Cp&&delete g["Content-Type"],Object.keys(g).forEach(_=>g[_]===null&&delete g[_]);const y={method:c,...h&&{body:h},headers:g,...d&&{agent:d},signal:(o=e.signal)!==null&&o!==void 0?o:null};return this.validateHeaders(g,f),{req:y,url:m,timeout:w}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return rt.generate(e,t,r,a)}request(e,t=null){return new sa(this.makeRequest(e,t))}async makeRequest(e,t){var r,a,s;const i=await e;t==null&&(t=(r=i.maxRetries)!==null&&r!==void 0?r:this.maxRetries);const{req:o,url:c,timeout:u}=this.buildRequest(i);if(await this.prepareRequest(o,{url:c,options:i}),oa("request",c,i,o.headers),!((a=i.signal)===null||a===void 0)&&a.aborted)throw new na;const l=new AbortController,f=await this.fetchWithTimeout(c,o,u,l).catch(Hl);if(f instanceof Error){if(!((s=i.signal)===null||s===void 0)&&s.aborted)throw new na;if(t)return this.retryRequest(i,t);throw f.name==="AbortError"?new Ki:new Qr({cause:f})}const h=Kp(f.headers);if(!f.ok){if(t&&this.shouldRetry(f))return this.retryRequest(i,t,h);const x=await f.text().catch(()=>"Unknown"),m=Zp(x),w=m?void 0:x;throw oa("response",f.status,c,h,w),this.makeStatusError(f.status,m,w,h)}return{response:f,options:i,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Up(this,r,e)}buildURL(e,t){const r=Yp(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return ql(a)||(t={...a,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Error(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){const{signal:s,...i}=t||{};s&&s.addEventListener("abort",()=>a.abort());const o=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch(e,{signal:a.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var a;t-=1;const s=parseInt((r==null?void 0:r["retry-after"])||""),i=(a=e.maxRetries)!==null&&a!==void 0?a:this.maxRetries,o=this.calculateRetryTimeoutSeconds(t,s,i)*1e3;return await Xp(o),this.makeRequest(e,t)}calculateRetryTimeoutSeconds(e,t,r){if(Number.isInteger(t)&&t<=60)return t;const i=r-e,o=Math.min(.5*Math.pow(i-1,2),2),c=Math.random()-.5;return o+c}getUserAgent(){return`${this.constructor.name}/JS ${vr}`}}class zl{constructor(e,t,r,a){aa.set(this,void 0),$p(this,aa,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Error("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,s]of r)e.url.searchParams.set(a,s);t.query=void 0,t.path=e.url.toString()}return await Lp(this,aa,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(aa=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Up extends sa{constructor(e,t,r){super(t,async a=>new r(e,a.response,await Ll(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Kp=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Hp={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0},Ml=n=>typeof n=="object"&&n!==null&&!ql(n)&&Object.keys(n).every(e=>Jp(Hp,e)),Vp=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vr,"X-Stainless-OS":Kl(Deno.build.os),"X-Stainless-Arch":Ul(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vr,"X-Stainless-OS":Kl(process.platform),"X-Stainless-Arch":Ul(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=qp();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function qp(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const a=r[1]||0,s=r[2]||0,i=r[3]||0;return{browser:e,version:`${a}.${s}.${i}`}}}return null}const Ul=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Kl=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let ia;const Wp=()=>ia??(ia=Vp()),Zp=n=>{try{return JSON.parse(n)}catch{return}},Gp=new RegExp("^(?:[a-z]+:)?//","i"),Yp=n=>Gp.test(n),Xp=n=>new Promise(e=>setTimeout(e,n)),eo=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Error(`${n} must be an integer`);if(e<0)throw new Error(`${n} must be a positive integer`);return e},Hl=n=>n instanceof Error?n:new Error(n),Vl=n=>{var e,t,r,a;if(typeof process<"u")return(t=(e=process.env)===null||e===void 0?void 0:e[n])!==null&&t!==void 0?t:void 0;if(typeof Deno<"u")return(a=(r=Deno.env)===null||r===void 0?void 0:r.get)===null||a===void 0?void 0:a.call(r,n)};function ql(n){if(!n)return!0;for(const e in n)return!1;return!0}function Jp(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function oa(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const Qp=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),em=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";class ua extends zl{constructor(e,t,r,a){super(e,t,r,a),this.object=r.object,this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}}class to extends zl{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e,t;if(!(!((e=this.data)===null||e===void 0)&&e.length))return null;const r=(t=this.data[this.data.length-1])===null||t===void 0?void 0:t.id;return r?{params:{after:r}}:null}}class He{constructor(e){this.client=e,this.get=e.get.bind(e),this.post=e.post.bind(e),this.patch=e.patch.bind(e),this.put=e.put.bind(e),this.delete=e.delete.bind(e),this.getAPIList=e.getAPIList.bind(e)}}class ca extends He{create(e,t){return this.post("/audio/transcriptions",en({body:e,...t}))}}ca||(ca={});class la extends He{create(e,t){return this.post("/audio/translations",en({body:e,...t}))}}la||(la={});class ha extends He{constructor(){super(...arguments),this.transcriptions=new ca(this.client),this.translations=new la(this.client)}}(function(n){n.Transcriptions=ca,n.Translations=la})(ha||(ha={}));let da=class extends He{create(e,t){var r;return this.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}};da||(da={});class fa extends He{constructor(){super(...arguments),this.completions=new da(this.client)}}(function(n){n.Completions=da})(fa||(fa={}));class pa extends He{create(e,t){var r;return this.post("/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}}pa||(pa={});let ma=class extends He{create(e,t){return this.post("/embeddings",{body:e,...t})}};ma||(ma={});class ga extends He{create(e,t){return this.post("/edits",{body:e,...t})}}ga||(ga={});class ya extends He{create(e,t){return this.post("/files",en({body:e,...t}))}retrieve(e,t){return this.get(`/files/${e}`,t)}list(e){return this.getAPIList("/files",Wl,e)}del(e,t){return this.delete(`/files/${e}`,t)}retrieveContent(e,t){return this.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}}class Wl extends ua{}ya||(ya={});class xa extends He{create(e,t){return this.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this.get(`/fine-tunes/${e}`,t)}list(e){return this.getAPIList("/fine-tunes",Zl,e)}cancel(e,t){return this.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){var a;return this.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:(a=t==null?void 0:t.stream)!==null&&a!==void 0?a:!1})}}class Zl extends ua{}xa||(xa={});class ba extends He{create(e,t){return this.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ml(e)?this.list({},e):this.getAPIList("/fine_tuning/jobs",Gl,{query:e,...t})}cancel(e,t){return this.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Ml(t)?this.listEvents(e,{},t):this.getAPIList(`/fine_tuning/jobs/${e}/events`,Yl,{query:t,...r})}}class Gl extends to{}class Yl extends to{}ba||(ba={});class _a extends He{constructor(){super(...arguments),this.jobs=new ba(this.client)}}(function(n){n.Jobs=ba,n.FineTuningJobsPage=Gl,n.FineTuningJobEventsPage=Yl})(_a||(_a={}));class va extends He{createVariation(e,t){return this.post("/images/variations",en({body:e,...t}))}edit(e,t){return this.post("/images/edits",en({body:e,...t}))}generate(e,t){return this.post("/images/generations",{body:e,...t})}}va||(va={});class wa extends He{retrieve(e,t){return this.get(`/models/${e}`,t)}list(e){return this.getAPIList("/models",Xl,e)}del(e,t){return this.delete(`/models/${e}`,t)}}class Xl extends ua{}wa||(wa={});class Aa extends He{create(e,t){return this.post("/moderations",{body:e,...t})}}Aa||(Aa={});var Jl;let Ce=class extends Mp{constructor(e){var t,r,{apiKey:a=Vl("OPENAI_API_KEY"),organization:s=(t=Vl("OPENAI_ORG_ID"))!==null&&t!==void 0?t:null,...i}=e===void 0?{}:e;if(a===void 0)throw new Error("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'my apiKey' }).");const o={apiKey:a,organization:s,baseURL:"https://api.openai.com/v1",...i};if(!o.dangerouslyAllowBrowser&&em())throw new Error(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:(r=o.timeout)!==null&&r!==void 0?r:6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new pa(this),this.chat=new fa(this),this.edits=new ga(this),this.embeddings=new ma(this),this.files=new ya(this),this.images=new va(this),this.audio=new ha(this),this.moderations=new Aa(this),this.models=new wa(this),this.fineTuning=new _a(this),this.fineTunes=new xa(this),this._options=o,this.apiKey=a,this.organization=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Jl=Ce,Ce.OpenAI=Jl,Ce.APIError=rt,Ce.APIConnectionError=Qr,Ce.APIConnectionTimeoutError=Ki,Ce.APIUserAbortError=na,Ce.NotFoundError=Wi,Ce.ConflictError=Zi,Ce.RateLimitError=Yi,Ce.BadRequestError=Hi,Ce.AuthenticationError=Vi,Ce.InternalServerError=Xi,Ce.PermissionDeniedError=qi,Ce.UnprocessableEntityError=Gi;const{APIError:Tb,APIConnectionError:Rb,APIConnectionTimeoutError:tm,APIUserAbortError:rm,NotFoundError:Db,ConflictError:Fb,RateLimitError:Nb,BadRequestError:jb,AuthenticationError:$b,InternalServerError:Lb,PermissionDeniedError:zb,UnprocessableEntityError:Mb}=wp;(function(n){n.toFile=jl,n.fileFromPath=Sp,n.Page=ua,n.CursorPage=to,n.Completions=pa,n.Chat=fa,n.Edits=ga,n.Embeddings=ma,n.Files=ya,n.FileObjectsPage=Wl,n.Images=va,n.Audio=ha,n.Moderations=Aa,n.Models=wa,n.ModelsPage=Xl,n.FineTuning=_a,n.FineTunes=xa,n.FineTunesPage=Zl})(Ce||(Ce={}));const ro=(n,e)=>n.reduce((t,r,a)=>{const s=Math.floor(a/e),i=t[s]||[];return t[s]=i.concat([r]),t},[]);class nm{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new On(e??{})}}function Ea(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:s}=n;if(r&&a&&e)return`${a}/${e}`;if(r){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return s}function Ca(n){let e;return n.constructor.name===tm.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===rm.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}class am extends nm{constructor(e,t){var u,l;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a=(r==null?void 0:r.openAIApiKey)??ae("OPENAI_API_KEY");const s=(r==null?void 0:r.azureOpenAIApiKey)??ae("AZURE_OPENAI_API_KEY");if(!s&&!a)throw new Error("OpenAI or Azure OpenAI API key not found");const i=(r==null?void 0:r.azureOpenAIApiInstanceName)??ae("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(ae("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||ae("AZURE_OPENAI_API_DEPLOYMENT_NAME")),c=(r==null?void 0:r.azureOpenAIApiVersion)??ae("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??ae("AZURE_OPENAI_BASE_PATH"),this.modelName=(r==null?void 0:r.modelName)??this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(s?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.azureOpenAIApiVersion=c,this.azureOpenAIApiKey=s,this.azureOpenAIApiInstanceName=i,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");a=a??""}this.clientConfig={apiKey:a,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(u=t==null?void 0:t.baseOptions)==null?void 0:u.headers,defaultQuery:(l=t==null?void 0:t.baseOptions)==null?void 0:l.params,...t}}async embedDocuments(e){const t=ro(this.stripNewLines?e.map(i=>i.replace(/\n/g," ")):e,this.batchSize),r=t.map(i=>this.embeddingWithRetry({model:this.modelName,input:i})),a=await Promise.all(r),s=[];for(let i=0;i<a.length;i+=1){const o=t[i],{data:c}=a[i];for(let u=0;u<o.length;u+=1)s.push(c[u].embedding)}return s}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=Ea(r),s={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Ce(s)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw Ca(r)}})}}function sm(n,e){let t=0,r=0,a=0;for(let s=0;s<n.length;s++)t+=n[s]*e[s],r+=n[s]*n[s],a+=e[s]*e[s];return t/(Math.sqrt(r)*Math.sqrt(a))}class im extends Be{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,t)}async getRelevantDocuments(e,t){const r=nc(t),a=await Le.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),s=await(a==null?void 0:a.handleRetrieverStart(this.toJSON(),e));try{const i=await this._getRelevantDocuments(e,s);return await(s==null?void 0:s.handleRetrieverEnd(i)),i}catch(i){throw await(s==null?void 0:s.handleRetrieverError(i)),i}}}class no extends im{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain","retrievers","base"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class om extends Pt{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(i=>i[0])}async similaritySearchWithScore(e,t=4,r=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,a,s,i){if(typeof e=="number")return new no({vectorStore:this,k:e,filter:t,tags:[...a??[],this._vectorstoreType()],metadata:s,verbose:i,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new no({...o,searchKwargs:e.searchKwargs}):new no({...o})}}}class ao extends om{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??sm}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((a,s)=>({content:t[s].pageContent,embedding:a,metadata:t[s].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){const a=c=>{if(!r)return!0;const u=new En({metadata:c.metadata,pageContent:c.content});return r(u)},s=this.memoryVectors.filter(a);return s.map((c,u)=>({similarity:this.similarity(e,c.embedding),index:u})).sort((c,u)=>c.similarity>u.similarity?-1:0).slice(0,t).map(c=>[new En({metadata:s[c.index].metadata,pageContent:s[c.index].content}),c.similarity])}static async fromTexts(e,t,r,a){const s=[];for(let i=0;i<e.length;i+=1){const o=Array.isArray(t)?t[i]:t,c=new En({pageContent:e[i],metadata:o});s.push(c)}return ao.fromDocuments(s,r,a)}static async fromDocuments(e,t,r){const a=new this(t,r);return await a.addDocuments(e),a}static async fromExistingIndex(e,t){return new this(e,t)}}class Ql{constructor(){ke(this,"data");ke(this,"QUOTA_BYTES",100);this.data={}}async get(e){const t=this.data[e],r={};return t&&(r[e]=t),r}async set(e){console.log("set ",e),console.log("old data",this.data),this.data={...this.data,...e},console.log("new data ",this.data)}async getBytesInUse(e){return 100}}class um{constructor(){ke(this,"local");ke(this,"sync");this.local=new Ql,this.sync=new Ql}}const tn=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n,cm=n=>{switch(tn(n)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},lm=async({prompt:n,modelName:e})=>{let t;try{t=(await Nu(tn(e))).encode(n).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(n.length/4)}return cm(e)-t},so="__run";class Ar{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Ar({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class zt extends Pt{get text(){return this.content}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class rn extends zt{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[a,s]of Object.entries(t))if(r[a]===void 0)r[a]=s;else{if(typeof r[a]!=typeof s)throw new Error(`additional_kwargs[${a}] already exists in the message chunk, but with a different type.`);if(typeof r[a]=="string")r[a]=r[a]+s;else if(!Array.isArray(r[a])&&typeof r[a]=="object")r[a]=this._mergeAdditionalKwargs(r[a],s);else throw new Error(`additional_kwargs[${a}] already exists in this message chunk.`)}return r}}class Bt extends zt{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Pa extends rn{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Pa({content:this.content+e.content,additional_kwargs:Pa._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class er extends zt{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class ka extends rn{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new ka({content:this.content+e.content,additional_kwargs:ka._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class io extends zt{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Sa extends rn{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Sa({content:this.content+e.content,additional_kwargs:Sa._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class Ia extends rn{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Ia({content:this.content+e.content,additional_kwargs:Ia._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class Oa extends zt{static lc_name(){return"ChatMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}function e0(n){return typeof n._getType=="function"}function Ba(n){if(typeof n=="string")return new Bt(n);if(e0(n))return n;const[e,t]=n;if(e==="human"||e==="user")return new Bt({content:t});if(e==="ai"||e==="assistant")return new er({content:t});if(e==="system")return new io({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class Ta extends rn{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Ta({content:this.content+e.content,additional_kwargs:Ta._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}class oo extends Ar{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new oo({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}class t0 extends Pt{}class hm extends Pt{addUserMessage(e){return this.addMessage(new Bt(e))}addAIChatMessage(e){return this.addMessage(new er(e))}}class dm{}var r0={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(r,a,s){function i(u,l){if(!a[u]){if(!r[u]){var f=typeof Fr=="function"&&Fr;if(!l&&f)return f(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}l=a[u]={exports:{}},r[u][0].call(l.exports,function(h){var x=r[u][1][h];return i(x||h)},l,l.exports,t,r,a,s)}return a[u].exports}for(var o=typeof Fr=="function"&&Fr,c=0;c<s.length;c++)i(s[c]);return i}({1:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){var m=t("crypto");function w(v,P){P=g(v,P);var b;return(b=P.algorithm!=="passthrough"?m.createHash(P.algorithm):new O).write===void 0&&(b.write=b.update,b.end=b.update),_(P,b).dispatch(v),b.update||b.end(""),b.digest?b.digest(P.encoding==="buffer"?void 0:P.encoding):(v=b.read(),P.encoding!=="buffer"?v.toString(P.encoding):v)}(a=r.exports=w).sha1=function(v){return w(v)},a.keys=function(v){return w(v,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(v){return w(v,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(v){return w(v,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var d=m.getHashes?m.getHashes().slice():["sha1","md5"],k=(d.push("passthrough"),["buffer","hex","binary","base64"]);function g(v,P){var b={};if(b.algorithm=(P=P||{}).algorithm||"sha1",b.encoding=P.encoding||"hex",b.excludeValues=!!P.excludeValues,b.algorithm=b.algorithm.toLowerCase(),b.encoding=b.encoding.toLowerCase(),b.ignoreUnknown=P.ignoreUnknown===!0,b.respectType=P.respectType!==!1,b.respectFunctionNames=P.respectFunctionNames!==!1,b.respectFunctionProperties=P.respectFunctionProperties!==!1,b.unorderedArrays=P.unorderedArrays===!0,b.unorderedSets=P.unorderedSets!==!1,b.unorderedObjects=P.unorderedObjects!==!1,b.replacer=P.replacer||void 0,b.excludeKeys=P.excludeKeys||void 0,v===void 0)throw new Error("Object argument required.");for(var C=0;C<d.length;++C)d[C].toLowerCase()===b.algorithm.toLowerCase()&&(b.algorithm=d[C]);if(d.indexOf(b.algorithm)===-1)throw new Error('Algorithm "'+b.algorithm+'"  not supported. supported values: '+d.join(", "));if(k.indexOf(b.encoding)===-1&&b.algorithm!=="passthrough")throw new Error('Encoding "'+b.encoding+'"  not supported. supported values: '+k.join(", "));return b}function y(v){if(typeof v=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(v))!=null}function _(v,P,b){b=b||[];function C(p){return P.update?P.update(p,"utf8"):P.write(p,"utf8")}return{dispatch:function(p){return this["_"+((p=v.replacer?v.replacer(p):p)===null?"null":typeof p)](p)},_object:function(p){var A,S=Object.prototype.toString.call(p),T=/\[object (.*)\]/i.exec(S);if(T=(T=T?T[1]:"unknown:["+S+"]").toLowerCase(),0<=(S=b.indexOf(p)))return this.dispatch("[CIRCULAR:"+S+"]");if(b.push(p),o!==void 0&&o.isBuffer&&o.isBuffer(p))return C("buffer:"),C(p);if(T==="object"||T==="function"||T==="asyncfunction")return S=Object.keys(p),v.unorderedObjects&&(S=S.sort()),v.respectType===!1||y(p)||S.splice(0,0,"prototype","__proto__","constructor"),v.excludeKeys&&(S=S.filter(function(F){return!v.excludeKeys(F)})),C("object:"+S.length+":"),A=this,S.forEach(function(F){A.dispatch(F),C(":"),v.excludeValues||A.dispatch(p[F]),C(",")});if(!this["_"+T]){if(v.ignoreUnknown)return C("["+T+"]");throw new Error('Unknown object type "'+T+'"')}this["_"+T](p)},_array:function(p,F){F=F!==void 0?F:v.unorderedArrays!==!1;var S=this;if(C("array:"+p.length+":"),!F||p.length<=1)return p.forEach(function(K){return S.dispatch(K)});var T=[],F=p.map(function(K){var $=new O,X=b.slice();return _(v,$,X).dispatch(K),T=T.concat(X.slice(b.length)),$.read().toString()});return b=b.concat(T),F.sort(),this._array(F,!1)},_date:function(p){return C("date:"+p.toJSON())},_symbol:function(p){return C("symbol:"+p.toString())},_error:function(p){return C("error:"+p.toString())},_boolean:function(p){return C("bool:"+p.toString())},_string:function(p){C("string:"+p.length+":"),C(p.toString())},_function:function(p){C("fn:"),y(p)?this.dispatch("[native]"):this.dispatch(p.toString()),v.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(p.name)),v.respectFunctionProperties&&this._object(p)},_number:function(p){return C("number:"+p.toString())},_xml:function(p){return C("xml:"+p.toString())},_null:function(){return C("Null")},_undefined:function(){return C("Undefined")},_regexp:function(p){return C("regex:"+p.toString())},_uint8array:function(p){return C("uint8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint8clampedarray:function(p){return C("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(p))},_int8array:function(p){return C("int8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint16array:function(p){return C("uint16array:"),this.dispatch(Array.prototype.slice.call(p))},_int16array:function(p){return C("int16array:"),this.dispatch(Array.prototype.slice.call(p))},_uint32array:function(p){return C("uint32array:"),this.dispatch(Array.prototype.slice.call(p))},_int32array:function(p){return C("int32array:"),this.dispatch(Array.prototype.slice.call(p))},_float32array:function(p){return C("float32array:"),this.dispatch(Array.prototype.slice.call(p))},_float64array:function(p){return C("float64array:"),this.dispatch(Array.prototype.slice.call(p))},_arraybuffer:function(p){return C("arraybuffer:"),this.dispatch(new Uint8Array(p))},_url:function(p){return C("url:"+p.toString())},_map:function(p){return C("map:"),p=Array.from(p),this._array(p,v.unorderedSets!==!1)},_set:function(p){return C("set:"),p=Array.from(p),this._array(p,v.unorderedSets!==!1)},_file:function(p){return C("file:"),this.dispatch([p.name,p.size,p.type,p.lastModfied])},_blob:function(){if(v.ignoreUnknown)return C("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return C("domwindow")},_bigint:function(p){return C("bigint:"+p.toString())},_process:function(){return C("process")},_timer:function(){return C("timer")},_pipe:function(){return C("pipe")},_tcp:function(){return C("tcp")},_udp:function(){return C("udp")},_tty:function(){return C("tty")},_statwatcher:function(){return C("statwatcher")},_securecontext:function(){return C("securecontext")},_connection:function(){return C("connection")},_zlib:function(){return C("zlib")},_context:function(){return C("context")},_nodescript:function(){return C("nodescript")},_httpparser:function(){return C("httpparser")},_dataview:function(){return C("dataview")},_signal:function(){return C("signal")},_fsevent:function(){return C("fsevent")},_tlswrap:function(){return C("tlswrap")}}}function O(){return{buf:"",write:function(v){this.buf+=v},end:function(v){this.buf+=v},read:function(){return this.buf}}}a.writeToStream=function(v,P,b){return b===void 0&&(b=P,P={}),_(P=g(v,P),b).dispatch(v)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){(function(m){var w=typeof Uint8Array<"u"?Uint8Array:Array,d="+".charCodeAt(0),k="/".charCodeAt(0),g="0".charCodeAt(0),y="a".charCodeAt(0),_="A".charCodeAt(0),O="-".charCodeAt(0),v="_".charCodeAt(0);function P(b){return b=b.charCodeAt(0),b===d||b===O?62:b===k||b===v?63:b<g?-1:b<g+10?b-g+26+26:b<_+26?b-_:b<y+26?b-y+26:void 0}m.toByteArray=function(b){var C,p;if(0<b.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var A=b.length,A=b.charAt(A-2)==="="?2:b.charAt(A-1)==="="?1:0,S=new w(3*b.length/4-A),T=0<A?b.length-4:b.length,F=0;function K($){S[F++]=$}for(C=0;C<T;C+=4,0)K((16711680&(p=P(b.charAt(C))<<18|P(b.charAt(C+1))<<12|P(b.charAt(C+2))<<6|P(b.charAt(C+3))))>>16),K((65280&p)>>8),K(255&p);return A==2?K(255&(p=P(b.charAt(C))<<2|P(b.charAt(C+1))>>4)):A==1&&(K((p=P(b.charAt(C))<<10|P(b.charAt(C+1))<<4|P(b.charAt(C+2))>>2)>>8&255),K(255&p)),S},m.fromByteArray=function(b){var C,p,A,S,T=b.length%3,F="";function K($){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt($)}for(C=0,A=b.length-T;C<A;C+=3)p=(b[C]<<16)+(b[C+1]<<8)+b[C+2],F+=K((S=p)>>18&63)+K(S>>12&63)+K(S>>6&63)+K(63&S);switch(T){case 1:F=(F+=K((p=b[b.length-1])>>2))+K(p<<4&63)+"==";break;case 2:F=(F=(F+=K((p=(b[b.length-2]<<8)+b[b.length-1])>>10))+K(p>>4&63))+K(p<<2&63)+"="}return F}})(a===void 0?this.base64js={}:a)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,r,a){(function(s,i,d,c,u,l,f,h,x){var m=t("base64-js"),w=t("ieee754");function d(E,I,B){if(!(this instanceof d))return new d(E,I,B);var M,N,V,ne,xe=typeof E;if(I==="base64"&&xe=="string")for(E=(ne=E).trim?ne.trim():ne.replace(/^\s+|\s+$/g,"");E.length%4!=0;)E+="=";if(xe=="number")M=te(E);else if(xe=="string")M=d.byteLength(E,I);else{if(xe!="object")throw new Error("First argument needs to be a number, array or string.");M=te(E.length)}if(d._useTypedArrays?N=d._augment(new Uint8Array(M)):((N=this).length=M,N._isBuffer=!0),d._useTypedArrays&&typeof E.byteLength=="number")N._set(E);else if(J(ne=E)||d.isBuffer(ne)||ne&&typeof ne=="object"&&typeof ne.length=="number")for(V=0;V<M;V++)d.isBuffer(E)?N[V]=E.readUInt8(V):N[V]=E[V];else if(xe=="string")N.write(E,0,I);else if(xe=="number"&&!d._useTypedArrays&&!B)for(V=0;V<M;V++)N[V]=0;return N}function k(E,I,B,M){return d._charsWritten=z(function(N){for(var V=[],ne=0;ne<N.length;ne++)V.push(255&N.charCodeAt(ne));return V}(I),E,B,M)}function g(E,I,B,M){return d._charsWritten=z(function(N){for(var V,ne,xe=[],ve=0;ve<N.length;ve++)ne=N.charCodeAt(ve),V=ne>>8,ne=ne%256,xe.push(ne),xe.push(V);return xe}(I),E,B,M)}function y(E,I,B){var M="";B=Math.min(E.length,B);for(var N=I;N<B;N++)M+=String.fromCharCode(E[N]);return M}function _(E,I,B,V){V||(D(typeof B=="boolean","missing or invalid endian"),D(I!=null,"missing offset"),D(I+1<E.length,"Trying to read beyond buffer length"));var N,V=E.length;if(!(V<=I))return B?(N=E[I],I+1<V&&(N|=E[I+1]<<8)):(N=E[I]<<8,I+1<V&&(N|=E[I+1])),N}function O(E,I,B,V){V||(D(typeof B=="boolean","missing or invalid endian"),D(I!=null,"missing offset"),D(I+3<E.length,"Trying to read beyond buffer length"));var N,V=E.length;if(!(V<=I))return B?(I+2<V&&(N=E[I+2]<<16),I+1<V&&(N|=E[I+1]<<8),N|=E[I],I+3<V&&(N+=E[I+3]<<24>>>0)):(I+1<V&&(N=E[I+1]<<16),I+2<V&&(N|=E[I+2]<<8),I+3<V&&(N|=E[I+3]),N+=E[I]<<24>>>0),N}function v(E,I,B,M){if(M||(D(typeof B=="boolean","missing or invalid endian"),D(I!=null,"missing offset"),D(I+1<E.length,"Trying to read beyond buffer length")),!(E.length<=I))return M=_(E,I,B,!0),32768&M?-1*(65535-M+1):M}function P(E,I,B,M){if(M||(D(typeof B=="boolean","missing or invalid endian"),D(I!=null,"missing offset"),D(I+3<E.length,"Trying to read beyond buffer length")),!(E.length<=I))return M=O(E,I,B,!0),2147483648&M?-1*(4294967295-M+1):M}function b(E,I,B,M){return M||(D(typeof B=="boolean","missing or invalid endian"),D(I+3<E.length,"Trying to read beyond buffer length")),w.read(E,I,B,23,4)}function C(E,I,B,M){return M||(D(typeof B=="boolean","missing or invalid endian"),D(I+7<E.length,"Trying to read beyond buffer length")),w.read(E,I,B,52,8)}function p(E,I,B,M,N){if(N||(D(I!=null,"missing value"),D(typeof M=="boolean","missing or invalid endian"),D(B!=null,"missing offset"),D(B+1<E.length,"trying to write beyond buffer length"),ye(I,65535)),N=E.length,!(N<=B))for(var V=0,ne=Math.min(N-B,2);V<ne;V++)E[B+V]=(I&255<<8*(M?V:1-V))>>>8*(M?V:1-V)}function A(E,I,B,M,N){if(N||(D(I!=null,"missing value"),D(typeof M=="boolean","missing or invalid endian"),D(B!=null,"missing offset"),D(B+3<E.length,"trying to write beyond buffer length"),ye(I,4294967295)),N=E.length,!(N<=B))for(var V=0,ne=Math.min(N-B,4);V<ne;V++)E[B+V]=I>>>8*(M?V:3-V)&255}function S(E,I,B,M,N){N||(D(I!=null,"missing value"),D(typeof M=="boolean","missing or invalid endian"),D(B!=null,"missing offset"),D(B+1<E.length,"Trying to write beyond buffer length"),de(I,32767,-32768)),E.length<=B||p(E,0<=I?I:65535+I+1,B,M,N)}function T(E,I,B,M,N){N||(D(I!=null,"missing value"),D(typeof M=="boolean","missing or invalid endian"),D(B!=null,"missing offset"),D(B+3<E.length,"Trying to write beyond buffer length"),de(I,2147483647,-2147483648)),E.length<=B||A(E,0<=I?I:4294967295+I+1,B,M,N)}function F(E,I,B,M,N){N||(D(I!=null,"missing value"),D(typeof M=="boolean","missing or invalid endian"),D(B!=null,"missing offset"),D(B+3<E.length,"Trying to write beyond buffer length"),je(I,34028234663852886e22,-34028234663852886e22)),E.length<=B||w.write(E,I,B,M,23,4)}function K(E,I,B,M,N){N||(D(I!=null,"missing value"),D(typeof M=="boolean","missing or invalid endian"),D(B!=null,"missing offset"),D(B+7<E.length,"Trying to write beyond buffer length"),je(I,17976931348623157e292,-17976931348623157e292)),E.length<=B||w.write(E,I,B,M,52,8)}a.Buffer=d,a.SlowBuffer=d,a.INSPECT_MAX_BYTES=50,d.poolSize=8192,d._useTypedArrays=function(){try{var E=new ArrayBuffer(0),I=new Uint8Array(E);return I.foo=function(){return 42},I.foo()===42&&typeof I.subarray=="function"}catch{return!1}}(),d.isEncoding=function(E){switch(String(E).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.isBuffer=function(E){return!(E==null||!E._isBuffer)},d.byteLength=function(E,I){var B;switch(E+="",I||"utf8"){case"hex":B=E.length/2;break;case"utf8":case"utf-8":B=R(E).length;break;case"ascii":case"binary":case"raw":B=E.length;break;case"base64":B=L(E).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=2*E.length;break;default:throw new Error("Unknown encoding")}return B},d.concat=function(E,I){if(D(J(E),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),E.length===0)return new d(0);if(E.length===1)return E[0];if(typeof I!="number")for(N=I=0;N<E.length;N++)I+=E[N].length;for(var B=new d(I),M=0,N=0;N<E.length;N++){var V=E[N];V.copy(B,M),M+=V.length}return B},d.prototype.write=function(E,I,B,M){isFinite(I)?isFinite(B)||(M=B,B=void 0):(ve=M,M=I,I=B,B=ve),I=Number(I)||0;var N,V,ne,xe,ve=this.length-I;switch((!B||ve<(B=Number(B)))&&(B=ve),M=String(M||"utf8").toLowerCase()){case"hex":N=function($e,Re,Pe,fe){Pe=Number(Pe)||0;var le=$e.length-Pe;(!fe||le<(fe=Number(fe)))&&(fe=le),D((le=Re.length)%2==0,"Invalid hex string"),le/2<fe&&(fe=le/2);for(var We=0;We<fe;We++){var ir=parseInt(Re.substr(2*We,2),16);D(!isNaN(ir),"Invalid hex string"),$e[Pe+We]=ir}return d._charsWritten=2*We,We}(this,E,I,B);break;case"utf8":case"utf-8":V=this,ne=I,xe=B,N=d._charsWritten=z(R(E),V,ne,xe);break;case"ascii":case"binary":N=k(this,E,I,B);break;case"base64":V=this,ne=I,xe=B,N=d._charsWritten=z(L(E),V,ne,xe);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":N=g(this,E,I,B);break;default:throw new Error("Unknown encoding")}return N},d.prototype.toString=function(E,I,B){var M,N,V,ne,xe=this;if(E=String(E||"utf8").toLowerCase(),I=Number(I)||0,(B=B!==void 0?Number(B):xe.length)===I)return"";switch(E){case"hex":M=function(ve,$e,Re){var Pe=ve.length;(!$e||$e<0)&&($e=0),(!Re||Re<0||Pe<Re)&&(Re=Pe);for(var fe="",le=$e;le<Re;le++)fe+=Y(ve[le]);return fe}(xe,I,B);break;case"utf8":case"utf-8":M=function(ve,$e,Re){var Pe="",fe="";Re=Math.min(ve.length,Re);for(var le=$e;le<Re;le++)ve[le]<=127?(Pe+=j(fe)+String.fromCharCode(ve[le]),fe=""):fe+="%"+ve[le].toString(16);return Pe+j(fe)}(xe,I,B);break;case"ascii":case"binary":M=y(xe,I,B);break;case"base64":N=xe,ne=B,M=(V=I)===0&&ne===N.length?m.fromByteArray(N):m.fromByteArray(N.slice(V,ne));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":M=function(ve,$e,Re){for(var Pe=ve.slice($e,Re),fe="",le=0;le<Pe.length;le+=2)fe+=String.fromCharCode(Pe[le]+256*Pe[le+1]);return fe}(xe,I,B);break;default:throw new Error("Unknown encoding")}return M},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.copy=function(E,I,B,M){if(I=I||0,(M=M||M===0?M:this.length)!==(B=B||0)&&E.length!==0&&this.length!==0){D(B<=M,"sourceEnd < sourceStart"),D(0<=I&&I<E.length,"targetStart out of bounds"),D(0<=B&&B<this.length,"sourceStart out of bounds"),D(0<=M&&M<=this.length,"sourceEnd out of bounds"),M>this.length&&(M=this.length);var N=(M=E.length-I<M-B?E.length-I+B:M)-B;if(N<100||!d._useTypedArrays)for(var V=0;V<N;V++)E[V+I]=this[V+B];else E._set(this.subarray(B,B+N),I)}},d.prototype.slice=function(E,I){var B=this.length;if(E=X(E,B,0),I=X(I,B,B),d._useTypedArrays)return d._augment(this.subarray(E,I));for(var M=I-E,N=new d(M,void 0,!0),V=0;V<M;V++)N[V]=this[V+E];return N},d.prototype.get=function(E){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(E)},d.prototype.set=function(E,I){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(E,I)},d.prototype.readUInt8=function(E,I){if(I||(D(E!=null,"missing offset"),D(E<this.length,"Trying to read beyond buffer length")),!(E>=this.length))return this[E]},d.prototype.readUInt16LE=function(E,I){return _(this,E,!0,I)},d.prototype.readUInt16BE=function(E,I){return _(this,E,!1,I)},d.prototype.readUInt32LE=function(E,I){return O(this,E,!0,I)},d.prototype.readUInt32BE=function(E,I){return O(this,E,!1,I)},d.prototype.readInt8=function(E,I){if(I||(D(E!=null,"missing offset"),D(E<this.length,"Trying to read beyond buffer length")),!(E>=this.length))return 128&this[E]?-1*(255-this[E]+1):this[E]},d.prototype.readInt16LE=function(E,I){return v(this,E,!0,I)},d.prototype.readInt16BE=function(E,I){return v(this,E,!1,I)},d.prototype.readInt32LE=function(E,I){return P(this,E,!0,I)},d.prototype.readInt32BE=function(E,I){return P(this,E,!1,I)},d.prototype.readFloatLE=function(E,I){return b(this,E,!0,I)},d.prototype.readFloatBE=function(E,I){return b(this,E,!1,I)},d.prototype.readDoubleLE=function(E,I){return C(this,E,!0,I)},d.prototype.readDoubleBE=function(E,I){return C(this,E,!1,I)},d.prototype.writeUInt8=function(E,I,B){B||(D(E!=null,"missing value"),D(I!=null,"missing offset"),D(I<this.length,"trying to write beyond buffer length"),ye(E,255)),I>=this.length||(this[I]=E)},d.prototype.writeUInt16LE=function(E,I,B){p(this,E,I,!0,B)},d.prototype.writeUInt16BE=function(E,I,B){p(this,E,I,!1,B)},d.prototype.writeUInt32LE=function(E,I,B){A(this,E,I,!0,B)},d.prototype.writeUInt32BE=function(E,I,B){A(this,E,I,!1,B)},d.prototype.writeInt8=function(E,I,B){B||(D(E!=null,"missing value"),D(I!=null,"missing offset"),D(I<this.length,"Trying to write beyond buffer length"),de(E,127,-128)),I>=this.length||(0<=E?this.writeUInt8(E,I,B):this.writeUInt8(255+E+1,I,B))},d.prototype.writeInt16LE=function(E,I,B){S(this,E,I,!0,B)},d.prototype.writeInt16BE=function(E,I,B){S(this,E,I,!1,B)},d.prototype.writeInt32LE=function(E,I,B){T(this,E,I,!0,B)},d.prototype.writeInt32BE=function(E,I,B){T(this,E,I,!1,B)},d.prototype.writeFloatLE=function(E,I,B){F(this,E,I,!0,B)},d.prototype.writeFloatBE=function(E,I,B){F(this,E,I,!1,B)},d.prototype.writeDoubleLE=function(E,I,B){K(this,E,I,!0,B)},d.prototype.writeDoubleBE=function(E,I,B){K(this,E,I,!1,B)},d.prototype.fill=function(E,I,B){if(I=I||0,B=B||this.length,D(typeof(E=typeof(E=E||0)=="string"?E.charCodeAt(0):E)=="number"&&!isNaN(E),"value is not a number"),D(I<=B,"end < start"),B!==I&&this.length!==0){D(0<=I&&I<this.length,"start out of bounds"),D(0<=B&&B<=this.length,"end out of bounds");for(var M=I;M<B;M++)this[M]=E}},d.prototype.inspect=function(){for(var E=[],I=this.length,B=0;B<I;B++)if(E[B]=Y(this[B]),B===a.INSPECT_MAX_BYTES){E[B+1]="...";break}return"<Buffer "+E.join(" ")+">"},d.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(d._useTypedArrays)return new d(this).buffer;for(var E=new Uint8Array(this.length),I=0,B=E.length;I<B;I+=1)E[I]=this[I];return E.buffer};var $=d.prototype;function X(E,I,B){return typeof E!="number"?B:I<=(E=~~E)?I:0<=E||0<=(E+=I)?E:0}function te(E){return(E=~~Math.ceil(+E))<0?0:E}function J(E){return(Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"})(E)}function Y(E){return E<16?"0"+E.toString(16):E.toString(16)}function R(E){for(var I=[],B=0;B<E.length;B++){var M=E.charCodeAt(B);if(M<=127)I.push(E.charCodeAt(B));else for(var N=B,V=(55296<=M&&M<=57343&&B++,encodeURIComponent(E.slice(N,B+1)).substr(1).split("%")),ne=0;ne<V.length;ne++)I.push(parseInt(V[ne],16))}return I}function L(E){return m.toByteArray(E)}function z(E,I,B,M){for(var N=0;N<M&&!(N+B>=I.length||N>=E.length);N++)I[N+B]=E[N];return N}function j(E){try{return decodeURIComponent(E)}catch{return String.fromCharCode(65533)}}function ye(E,I){D(typeof E=="number","cannot write a non-number as a number"),D(0<=E,"specified a negative value for writing an unsigned value"),D(E<=I,"value is larger than maximum value for type"),D(Math.floor(E)===E,"value has a fractional component")}function de(E,I,B){D(typeof E=="number","cannot write a non-number as a number"),D(E<=I,"value larger than maximum allowed value"),D(B<=E,"value smaller than minimum allowed value"),D(Math.floor(E)===E,"value has a fractional component")}function je(E,I,B){D(typeof E=="number","cannot write a non-number as a number"),D(E<=I,"value larger than maximum allowed value"),D(B<=E,"value smaller than minimum allowed value")}function D(E,I){if(!E)throw new Error(I||"Failed assertion")}d._augment=function(E){return E._isBuffer=!0,E._get=E.get,E._set=E.set,E.get=$.get,E.set=$.set,E.write=$.write,E.toString=$.toString,E.toLocaleString=$.toString,E.toJSON=$.toJSON,E.copy=$.copy,E.slice=$.slice,E.readUInt8=$.readUInt8,E.readUInt16LE=$.readUInt16LE,E.readUInt16BE=$.readUInt16BE,E.readUInt32LE=$.readUInt32LE,E.readUInt32BE=$.readUInt32BE,E.readInt8=$.readInt8,E.readInt16LE=$.readInt16LE,E.readInt16BE=$.readInt16BE,E.readInt32LE=$.readInt32LE,E.readInt32BE=$.readInt32BE,E.readFloatLE=$.readFloatLE,E.readFloatBE=$.readFloatBE,E.readDoubleLE=$.readDoubleLE,E.readDoubleBE=$.readDoubleBE,E.writeUInt8=$.writeUInt8,E.writeUInt16LE=$.writeUInt16LE,E.writeUInt16BE=$.writeUInt16BE,E.writeUInt32LE=$.writeUInt32LE,E.writeUInt32BE=$.writeUInt32BE,E.writeInt8=$.writeInt8,E.writeInt16LE=$.writeInt16LE,E.writeInt16BE=$.writeInt16BE,E.writeInt32LE=$.writeInt32LE,E.writeInt32BE=$.writeInt32BE,E.writeFloatLE=$.writeFloatLE,E.writeFloatBE=$.writeFloatBE,E.writeDoubleLE=$.writeDoubleLE,E.writeDoubleBE=$.writeDoubleBE,E.fill=$.fill,E.inspect=$.inspect,E.toArrayBuffer=$.toArrayBuffer,E}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,r,a){(function(s,i,m,c,u,l,f,h,x){var m=t("buffer").Buffer,w=4,d=new m(w);d.fill(0),r.exports={hash:function(k,g,y,_){for(var O=g(function(p,A){p.length%w!=0&&(S=p.length+(w-p.length%w),p=m.concat([p,d],S));for(var S,T=[],F=A?p.readInt32BE:p.readInt32LE,K=0;K<p.length;K+=w)T.push(F.call(p,K));return T}(k=m.isBuffer(k)?k:new m(k),_),8*k.length),g=_,v=new m(y),P=g?v.writeInt32BE:v.writeInt32LE,b=0;b<O.length;b++)P.call(v,O[b],4*b,!0);return v}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,r,a){(function(s,i,m,c,u,l,f,h,x){var m=t("buffer").Buffer,w=t("./sha"),d=t("./sha256"),k=t("./rng"),g={sha1:w,sha256:d,md5:t("./md5")},y=64,_=new m(y);function O(p,A){var S=g[p=p||"sha1"],T=[];return S||v("algorithm:",p,"is not yet supported"),{update:function(F){return m.isBuffer(F)||(F=new m(F)),T.push(F),F.length,this},digest:function(F){var K=m.concat(T),K=A?function($,X,te){m.isBuffer(X)||(X=new m(X)),m.isBuffer(te)||(te=new m(te)),X.length>y?X=$(X):X.length<y&&(X=m.concat([X,_],y));for(var J=new m(y),Y=new m(y),R=0;R<y;R++)J[R]=54^X[R],Y[R]=92^X[R];return te=$(m.concat([J,te])),$(m.concat([Y,te]))}(S,A,K):S(K);return T=null,F?K.toString(F):K}}}function v(){var p=[].slice.call(arguments).join(" ");throw new Error([p,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}_.fill(0),a.createHash=function(p){return O(p)},a.createHmac=O,a.randomBytes=function(p,A){if(!A||!A.call)return new m(k(p));try{A.call(this,void 0,new m(k(p)))}catch(S){A(S)}};var P,b=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],C=function(p){a[p]=function(){v("sorry,",p,"is not implemented yet")}};for(P in b)C(b[P])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){var m=t("./helpers");function w(v,P){v[P>>5]|=128<<P%32,v[14+(P+64>>>9<<4)]=P;for(var b=1732584193,C=-271733879,p=-1732584194,A=271733878,S=0;S<v.length;S+=16){var T=b,F=C,K=p,$=A,b=k(b,C,p,A,v[S+0],7,-680876936),A=k(A,b,C,p,v[S+1],12,-389564586),p=k(p,A,b,C,v[S+2],17,606105819),C=k(C,p,A,b,v[S+3],22,-1044525330);b=k(b,C,p,A,v[S+4],7,-176418897),A=k(A,b,C,p,v[S+5],12,1200080426),p=k(p,A,b,C,v[S+6],17,-1473231341),C=k(C,p,A,b,v[S+7],22,-45705983),b=k(b,C,p,A,v[S+8],7,1770035416),A=k(A,b,C,p,v[S+9],12,-1958414417),p=k(p,A,b,C,v[S+10],17,-42063),C=k(C,p,A,b,v[S+11],22,-1990404162),b=k(b,C,p,A,v[S+12],7,1804603682),A=k(A,b,C,p,v[S+13],12,-40341101),p=k(p,A,b,C,v[S+14],17,-1502002290),b=g(b,C=k(C,p,A,b,v[S+15],22,1236535329),p,A,v[S+1],5,-165796510),A=g(A,b,C,p,v[S+6],9,-1069501632),p=g(p,A,b,C,v[S+11],14,643717713),C=g(C,p,A,b,v[S+0],20,-373897302),b=g(b,C,p,A,v[S+5],5,-701558691),A=g(A,b,C,p,v[S+10],9,38016083),p=g(p,A,b,C,v[S+15],14,-660478335),C=g(C,p,A,b,v[S+4],20,-405537848),b=g(b,C,p,A,v[S+9],5,568446438),A=g(A,b,C,p,v[S+14],9,-1019803690),p=g(p,A,b,C,v[S+3],14,-187363961),C=g(C,p,A,b,v[S+8],20,1163531501),b=g(b,C,p,A,v[S+13],5,-1444681467),A=g(A,b,C,p,v[S+2],9,-51403784),p=g(p,A,b,C,v[S+7],14,1735328473),b=y(b,C=g(C,p,A,b,v[S+12],20,-1926607734),p,A,v[S+5],4,-378558),A=y(A,b,C,p,v[S+8],11,-2022574463),p=y(p,A,b,C,v[S+11],16,1839030562),C=y(C,p,A,b,v[S+14],23,-35309556),b=y(b,C,p,A,v[S+1],4,-1530992060),A=y(A,b,C,p,v[S+4],11,1272893353),p=y(p,A,b,C,v[S+7],16,-155497632),C=y(C,p,A,b,v[S+10],23,-1094730640),b=y(b,C,p,A,v[S+13],4,681279174),A=y(A,b,C,p,v[S+0],11,-358537222),p=y(p,A,b,C,v[S+3],16,-722521979),C=y(C,p,A,b,v[S+6],23,76029189),b=y(b,C,p,A,v[S+9],4,-640364487),A=y(A,b,C,p,v[S+12],11,-421815835),p=y(p,A,b,C,v[S+15],16,530742520),b=_(b,C=y(C,p,A,b,v[S+2],23,-995338651),p,A,v[S+0],6,-198630844),A=_(A,b,C,p,v[S+7],10,1126891415),p=_(p,A,b,C,v[S+14],15,-1416354905),C=_(C,p,A,b,v[S+5],21,-57434055),b=_(b,C,p,A,v[S+12],6,1700485571),A=_(A,b,C,p,v[S+3],10,-1894986606),p=_(p,A,b,C,v[S+10],15,-1051523),C=_(C,p,A,b,v[S+1],21,-2054922799),b=_(b,C,p,A,v[S+8],6,1873313359),A=_(A,b,C,p,v[S+15],10,-30611744),p=_(p,A,b,C,v[S+6],15,-1560198380),C=_(C,p,A,b,v[S+13],21,1309151649),b=_(b,C,p,A,v[S+4],6,-145523070),A=_(A,b,C,p,v[S+11],10,-1120210379),p=_(p,A,b,C,v[S+2],15,718787259),C=_(C,p,A,b,v[S+9],21,-343485551),b=O(b,T),C=O(C,F),p=O(p,K),A=O(A,$)}return Array(b,C,p,A)}function d(v,P,b,C,p,A){return O((P=O(O(P,v),O(C,A)))<<p|P>>>32-p,b)}function k(v,P,b,C,p,A,S){return d(P&b|~P&C,v,P,p,A,S)}function g(v,P,b,C,p,A,S){return d(P&C|b&~C,v,P,p,A,S)}function y(v,P,b,C,p,A,S){return d(P^b^C,v,P,p,A,S)}function _(v,P,b,C,p,A,S){return d(b^(P|~C),v,P,p,A,S)}function O(v,P){var b=(65535&v)+(65535&P);return(v>>16)+(P>>16)+(b>>16)<<16|65535&b}r.exports=function(v){return m.hash(v,w,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){r.exports=function(m){for(var w,d=new Array(m),k=0;k<m;k++)!(3&k)&&(w=4294967296*Math.random()),d[k]=w>>>((3&k)<<3)&255;return d}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){var m=t("./helpers");function w(g,y){g[y>>5]|=128<<24-y%32,g[15+(y+64>>9<<4)]=y;for(var _,O,v,P=Array(80),b=1732584193,C=-271733879,p=-1732584194,A=271733878,S=-1009589776,T=0;T<g.length;T+=16){for(var F=b,K=C,$=p,X=A,te=S,J=0;J<80;J++){P[J]=J<16?g[T+J]:k(P[J-3]^P[J-8]^P[J-14]^P[J-16],1);var Y=d(d(k(b,5),(Y=C,O=p,v=A,(_=J)<20?Y&O|~Y&v:!(_<40)&&_<60?Y&O|Y&v|O&v:Y^O^v)),d(d(S,P[J]),(_=J)<20?1518500249:_<40?1859775393:_<60?-1894007588:-899497514)),S=A,A=p,p=k(C,30),C=b,b=Y}b=d(b,F),C=d(C,K),p=d(p,$),A=d(A,X),S=d(S,te)}return Array(b,C,p,A,S)}function d(g,y){var _=(65535&g)+(65535&y);return(g>>16)+(y>>16)+(_>>16)<<16|65535&_}function k(g,y){return g<<y|g>>>32-y}r.exports=function(g){return m.hash(g,w,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){function m(y,_){var O=(65535&y)+(65535&_);return(y>>16)+(_>>16)+(O>>16)<<16|65535&O}function w(y,_){var O,v=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),P=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),b=new Array(64);y[_>>5]|=128<<24-_%32,y[15+(_+64>>9<<4)]=_;for(var C,p,A=0;A<y.length;A+=16){for(var S=P[0],T=P[1],F=P[2],K=P[3],$=P[4],X=P[5],te=P[6],J=P[7],Y=0;Y<64;Y++)b[Y]=Y<16?y[Y+A]:m(m(m((p=b[Y-2],k(p,17)^k(p,19)^g(p,10)),b[Y-7]),(p=b[Y-15],k(p,7)^k(p,18)^g(p,3))),b[Y-16]),O=m(m(m(m(J,k(p=$,6)^k(p,11)^k(p,25)),$&X^~$&te),v[Y]),b[Y]),C=m(k(C=S,2)^k(C,13)^k(C,22),S&T^S&F^T&F),J=te,te=X,X=$,$=m(K,O),K=F,F=T,T=S,S=m(O,C);P[0]=m(S,P[0]),P[1]=m(T,P[1]),P[2]=m(F,P[2]),P[3]=m(K,P[3]),P[4]=m($,P[4]),P[5]=m(X,P[5]),P[6]=m(te,P[6]),P[7]=m(J,P[7])}return P}var d=t("./helpers"),k=function(y,_){return y>>>_|y<<32-_},g=function(y,_){return y>>>_};r.exports=function(y){return d.hash(y,w,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){a.read=function(m,w,d,k,A){var y,_,O=8*A-k-1,v=(1<<O)-1,P=v>>1,b=-7,C=d?A-1:0,p=d?-1:1,A=m[w+C];for(C+=p,y=A&(1<<-b)-1,A>>=-b,b+=O;0<b;y=256*y+m[w+C],C+=p,b-=8);for(_=y&(1<<-b)-1,y>>=-b,b+=k;0<b;_=256*_+m[w+C],C+=p,b-=8);if(y===0)y=1-P;else{if(y===v)return _?NaN:1/0*(A?-1:1);_+=Math.pow(2,k),y-=P}return(A?-1:1)*_*Math.pow(2,y-k)},a.write=function(m,w,d,k,g,S){var _,O,v=8*S-g-1,P=(1<<v)-1,b=P>>1,C=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=k?0:S-1,A=k?1:-1,S=w<0||w===0&&1/w<0?1:0;for(w=Math.abs(w),isNaN(w)||w===1/0?(O=isNaN(w)?1:0,_=P):(_=Math.floor(Math.log(w)/Math.LN2),w*(k=Math.pow(2,-_))<1&&(_--,k*=2),2<=(w+=1<=_+b?C/k:C*Math.pow(2,1-b))*k&&(_++,k/=2),P<=_+b?(O=0,_=P):1<=_+b?(O=(w*k-1)*Math.pow(2,g),_+=b):(O=w*Math.pow(2,b-1)*Math.pow(2,g),_=0));8<=g;m[d+p]=255&O,p+=A,O/=256,g-=8);for(_=_<<g|O,v+=g;0<v;m[d+p]=255&_,p+=A,_/=256,v-=8);m[d+p-A]|=128*S}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,r,a){(function(s,i,o,c,u,l,f,h,x){var m,w,d;function k(){}(s=r.exports={}).nextTick=(w=typeof window<"u"&&window.setImmediate,d=typeof window<"u"&&window.postMessage&&window.addEventListener,w?function(g){return window.setImmediate(g)}:d?(m=[],window.addEventListener("message",function(g){var y=g.source;y!==window&&y!==null||g.data!=="process-tick"||(g.stopPropagation(),0<m.length&&m.shift()())},!0),function(g){m.push(g),window.postMessage("process-tick","*")}):function(g){setTimeout(g,0)}),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.on=k,s.addListener=k,s.once=k,s.off=k,s.removeListener=k,s.removeAllListeners=k,s.emit=k,s.binding=function(g){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(g){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(r0);var fm=r0.exports;const pm=Qe(fm),n0=(...n)=>pm(n.join("_")),mm=new Map;class uo extends dm{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(n0(e,t))??null)}async update(e,t,r){this.cache.set(n0(e,t),r)}static global(){return new uo(mm)}}class a0 extends t0{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Bt(this.value)]}}class co extends Be{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[s,i]of Object.entries(t))typeof i=="string"?r[s]=i:r[s]=await i();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(()=>u0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(()=>u0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>eg);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class s0 extends co{async formatPromptValue(e){const t=await this.format(e);return new a0(t)}}const i0=n=>{const e=n.split(""),t=[],r=(s,i)=>{for(let o=i;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1};let a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){const s=r("}",a);if(s<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,s).join("")}),a=s+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{const s=r("{}",a),i=(s<0?e.slice(a):e.slice(a,s)).join("");t.push({type:"literal",text:i}),a=s<0?e.length:s}}return t},lo={"f-string":(n,e)=>i0(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`Missing value for input ${r.name}`)}return t+r.text},""),jinja2:(n,e)=>""},gm={"f-string":i0,jinja2:n=>[]},ho=(n,e,t)=>lo[e](n,t),ym=(n,e)=>gm[e](n),o0=(n,e,t)=>{if(!(e in lo)){const r=Object.keys(lo);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((a,s)=>(a[s]="foo",a),{});ho(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class be extends s0{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),o0(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return ho(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a=`

`,s=""){const i=[s,...e,t].join(a);return new be({inputVariables:r,template:i})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){if(t==="jinja2")throw new Error("jinja2 templates are not currently supported.");const a=new Set;return ym(e,t).forEach(s=>{s.type==="variable"&&a.add(s.name)}),new be({inputVariables:[...a],templateFormat:t,template:e,...r})}async partial(e){const t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new be(a)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new be({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const u0=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:be},Symbol.toStringTag,{value:"Module"}));class xm extends Be{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class c0 extends t0{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class Ra extends xm{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class bm extends co{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new c0(t)}}class _m extends Ra{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new Oa(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this(be.fromTemplate(e),t)}}class tr extends Ra{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new Bt(await this.prompt.format(e))}static fromTemplate(e){return new this(be.fromTemplate(e))}}class l0 extends Ra{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new er(await this.prompt.format(e))}static fromTemplate(e){return new this(be.fromTemplate(e))}}class nn extends Ra{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new io(await this.prompt.format(e))}static fromTemplate(e){return new this(be.fromTemplate(e))}}function vm(n){return typeof n.formatMessages=="function"}function wm(n){if(vm(n)||e0(n))return n;const e=Ba(n);if(e._getType()==="human")return tr.fromTemplate(e.content);if(e._getType()==="ai")return l0.fromTemplate(e.content);if(e._getType()==="system")return nn.fromTemplate(e.content);if(Oa.isInstance(e))return _m.fromTemplate(e.content,e.role);throw new Error(`Could not coerce message prompt template from input. Received message type: "${e._getType()}".`)}class _t extends bm{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof zt))for(const c of o.inputVariables)t.add(c);const r=this.inputVariables,a=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),s=new Set([...a].filter(o=>!t.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const i=new Set([...t].filter(o=>!a.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const a of this.promptMessages)if(a instanceof zt)r.push(a);else{const s=a.inputVariables.reduce((o,c)=>{if(!(c in t))throw new Error(`Missing value for input variable \`${c.toString()}\``);return o[c]=t[c],o},{}),i=await a.formatMessages(s);r=r.concat(i)}return r}async partial(e){const t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new _t(a)}static fromMessages(e){const t=e.reduce((s,i)=>s.concat(i instanceof _t?i.promptMessages:[wm(i)]),[]),r=e.reduce((s,i)=>i instanceof _t?Object.assign(s,i.partialVariables):s,Object.create(null)),a=new Set;for(const s of t)if(!(s instanceof zt))for(const i of s.inputVariables)i in r||a.add(i);return new _t({inputVariables:[...a],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}const Am=()=>!1;class h0 extends Be{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Am(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class fo extends h0{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new On(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await Nu("modelName"in this?tn(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return typeof e=="string"?new a0(e):Array.isArray(e)?new c0(e.map(Ba)):e}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:r,...a}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);const s={openai:(await Promise.resolve().then(()=>Jx)).ChatOpenAI}[t];if(s===void 0)throw new Error(`Cannot load LLM with type ${t}`);return new s(a)}}class Er extends fo{constructor({cache:e,concurrency:t,...r}){super(t?{maxConcurrency:t,...r}:r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e=="object"?this.cache=e:e?this.cache=uo.global():this.cache=void 0}async invoke(e,t){const r=Er._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async*_streamIterator(e,t){if(this._streamResponseChunks===Er.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=Er._convertInputToPromptValue(e),[a,s]=this._separateRunnableConfigFromCallOptions(t),i=await Le.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),o={options:s,invocation_params:this==null?void 0:this.invocationParams(s)},c=await(i==null?void 0:i.handleLLMStart(this.toJSON(),[r.toString()],void 0,void 0,o));let u=new Ar({text:""});try{for await(const l of this._streamResponseChunks(e.toString(),s,c==null?void 0:c[0]))u?u=u.concat(l):u=l,typeof l.text=="string"&&(yield l.text)}catch(l){throw await Promise.all((c??[]).map(f=>f==null?void 0:f.handleLLMError(l))),l}await Promise.all((c??[]).map(l=>l==null?void 0:l.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(e,t,r){const a=e.map(s=>s.toString());return this.generate(a,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const a=e.generations[r];if(r===0)t.push({generations:[a],llmOutput:e.llmOutput});else{const s=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[a],llmOutput:s})}}return t}async _generateUncached(e,t,r){const a=await Le.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this==null?void 0:this.invocationParams(t)},i=await(a==null?void 0:a.handleLLMStart(this.toJSON(),e,void 0,void 0,s));let o;try{o=await this._generate(e,t,i==null?void 0:i[0])}catch(l){throw await Promise.all((i??[]).map(f=>f==null?void 0:f.handleLLMError(l))),l}const c=this._flattenLLMResult(o);await Promise.all((i??[]).map((l,f)=>l==null?void 0:l.handleLLMEnd(c[f])));const u=(i==null?void 0:i.map(l=>l.runId))||void 0;return Object.defineProperty(o,so,{value:u?{runIds:u}:void 0,configurable:!0}),o}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let a;Array.isArray(t)?a={stop:t}:a=t;const[s,i]=this._separateRunnableConfigFromCallOptions(a);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(e,i,s);const{cache:o}=this,c=this.serialize();c.stop=i.stop??c.stop;const u=`${Object.entries(c).sort()}`,l=[],f=await Promise.all(e.map(async(x,m)=>{const w=await o.lookup(x,u);return w||l.push(m),w}));let h={};if(l.length>0){const x=await this._generateUncached(l.map(m=>e[m]),i,s);await Promise.all(x.generations.map(async(m,w)=>{const d=l[w];return f[d]=m,o.update(e[d],u,m)})),h=x.llmOutput??{}}return{generations:f,llmOutput:h}}async call(e,t,r){const{generations:a}=await this.generate([e],t,r);return a[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const a=Rn(e),s=await this.call(a,t,r);return new er(s)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}static async deserialize(e){const{_type:t,_model:r,...a}=e;if(r&&r!=="base_llm")throw new Error(`Cannot load LLM with model ${r}`);const s={openai:(await Promise.resolve().then(()=>Cm)).OpenAI}[t];if(s===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new s(a)}}class Em extends Er{async _generate(e,t,r){return{generations:await Promise.all(e.map((s,i)=>this._call(s,{...t,promptIndex:i},r).then(o=>[{text:o}])))}}}class d0 extends Em{static lc_name(){return"OpenAIChat"}get callKeys(){return[...super.callKeys,"options","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,s,i,o,c,u,l;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"prefixMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ae("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ae("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ae("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(ae("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||ae("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ae("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ae("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??ae("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.prefixMessages=(e==null?void 0:e.prefixMessages)??this.prefixMessages,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.maxTokens=e==null?void 0:e.maxTokens,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.n>1)throw new Error("Cannot use n > 1 in OpenAIChat LLM. Use ChatOpenAI Chat Model instead.");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((a=e==null?void 0:e.configuration)==null?void 0:a.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((s=t==null?void 0:t.baseOptions)==null?void 0:s.headers)??((o=(i=e==null?void 0:e.configuration)==null?void 0:i.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,logit_bias:this.logitBias,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}formatMessages(e){const t={role:"user",content:e};return this.prefixMessages?[...this.prefixMessages,t]:[t]}async*_streamResponseChunks(e,t,r){var i;const a={...this.invocationParams(t),messages:this.formatMessages(e),stream:!0},s=await this.completionWithRetry(a,t);for await(const o of s){const c=o==null?void 0:o.choices[0];if(!c)continue;const{delta:u}=c,l=new Ar({text:u.content??""});yield l;const f={prompt:t.promptIndex??0,completion:c.index??0};r==null||r.handleLLMNewToken(l.text??"",f)}if((i=t.signal)!=null&&i.aborted)throw new Error("AbortError")}async _call(e,t,r){var s,i;const a=this.invocationParams(t);if(a.stream){const o=await this._streamResponseChunks(e,t,r);let c;for await(const u of o)c===void 0?c=u:c=c.concat(u);return(c==null?void 0:c.text)??""}else{const o=await this.completionWithRetry({...a,stream:!1,messages:this.formatMessages(e)},{signal:t.signal,...t.options});return((i=(s=o==null?void 0:o.choices[0])==null?void 0:s.message)==null?void 0:i.content)??""}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw Ca(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=Ea(r),s={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Ce(s)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}class f0 extends Er{static lc_name(){return"OpenAI"}get callKeys(){return[...super.callKeys,"options"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,s,i,o,c,u,l,f,h,x;if(((r=e==null?void 0:e.modelName)!=null&&r.startsWith("gpt-3.5-turbo")||(a=e==null?void 0:e.modelName)!=null&&a.startsWith("gpt-4"))&&!((s=e==null?void 0:e.modelName)!=null&&s.includes("-instruct")))return new d0(e,t);if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:256}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"bestOf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-davinci-003"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ae("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ae("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ae("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(ae("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||ae("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ae("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ae("AZURE_OPENAI_BASE_PATH"),this.organization=((i=e==null?void 0:e.configuration)==null?void 0:i.organization)??ae("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.batchSize=(e==null?void 0:e.batchSize)??this.batchSize,this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.maxTokens=(e==null?void 0:e.maxTokens)??this.maxTokens,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.bestOf=(e==null?void 0:e.bestOf)??this.bestOf,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.streaming&&this.bestOf&&this.bestOf>1)throw new Error("Cannot stream results when bestOf > 1");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((o=e==null?void 0:e.configuration)==null?void 0:o.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((c=t==null?void 0:t.baseOptions)==null?void 0:c.headers)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.headers),defaultQuery:((f=t==null?void 0:t.baseOptions)==null?void 0:f.params)??((x=(h=e==null?void 0:e.configuration)==null?void 0:h.baseOptions)==null?void 0:x.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,max_tokens:this.maxTokens,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,best_of:this.bestOf,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const a=ro(e,this.batchSize),s=[],i={},o=this.invocationParams(t);if(o.max_tokens===-1){if(e.length!==1)throw new Error("max_tokens set to -1 not supported for multiple inputs");o.max_tokens=await lm({prompt:e[0],modelName:this.modelName})}for(let u=0;u<a.length;u+=1){const l=o.stream?await(async()=>{var k;const m=[];let w;const d=await this.completionWithRetry({...o,stream:!0,prompt:a[u]},t);for await(const g of d){w||(w={id:g.id,object:g.object,created:g.created,model:g.model});for(const y of g.choices){if(!m[y.index])m[y.index]=y;else{const _=m[y.index];_.text+=y.text,_.finish_reason=y.finish_reason,_.logprobs=y.logprobs}r==null||r.handleLLMNewToken(y.text,{prompt:Math.floor(y.index/this.n),completion:y.index%this.n})}}if((k=t.signal)!=null&&k.aborted)throw new Error("AbortError");return{...w,choices:m}})():await this.completionWithRetry({...o,stream:!1,prompt:a[u]},{signal:t.signal,...t.options});s.push(...l.choices);const{completion_tokens:f,prompt_tokens:h,total_tokens:x}=l.usage?l.usage:{completion_tokens:void 0,prompt_tokens:void 0,total_tokens:void 0};f&&(i.completionTokens=(i.completionTokens??0)+f),h&&(i.promptTokens=(i.promptTokens??0)+h),x&&(i.totalTokens=(i.totalTokens??0)+x)}return{generations:ro(s,this.n).map(u=>u.map(l=>({text:l.text??"",generationInfo:{finishReason:l.finish_reason,logprobs:l.logprobs}}))),llmOutput:{tokenUsage:i}}}async*_streamResponseChunks(e,t,r){var i;const a={...this.invocationParams(t),prompt:e,stream:!0},s=await this.completionWithRetry(a,t);for await(const o of s){const c=o==null?void 0:o.choices[0];if(!c)continue;const u=new Ar({text:c.text,generationInfo:{finishReason:c.finish_reason}});yield u,r==null||r.handleLLMNewToken(u.text??"")}if((i=t.signal)!=null&&i.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.completions.create(e,r)}catch(a){throw Ca(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=Ea(r),s={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Ce(s)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}const Cm=Object.freeze(Object.defineProperty({__proto__:null,OpenAI:f0,OpenAIChat:d0},Symbol.toStringTag,{value:"Module"}));class it extends h0{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:a,callbackManager:s,...i}=e;super({...i,callbacks:s??i.callbacks}),this.memory=a}else super({verbose:t,callbacks:r}),this.memory=e}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter(c=>{var u;return!((u=this.memory)!=null&&u.memoryKeys.includes(c))});if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const s=r.length?{[r[0]]:e}:{},i=await this.call(s,t),o=Object.keys(i);if(o.length===1)return i[o[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),this.memory!=null){const r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[a,s]of Object.entries(r))t[a]=s}return t}async call(e,t,r){const a=await this._formatValues(e),s=nc(t),i=await Le.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),o=await(i==null?void 0:i.handleChainStart(this.toJSON(),a));let c;try{c=await(e.signal?Promise.race([this._call(a,o),new Promise((u,l)=>{var f;(f=e.signal)==null||f.addEventListener("abort",()=>{l(new Error("AbortError"))})})]):this._call(a,o))}catch(u){throw await(o==null?void 0:o.handleChainError(u)),u}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),c),await(o==null?void 0:o.handleChainEnd(c)),Object.defineProperty(c,so,{value:o?{runId:o==null?void 0:o.runId}:void 0,configurable:!0}),c}async apply(e,t){return Promise.all(e.map(async(r,a)=>this.call(r,t==null?void 0:t[a])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:r}=await Promise.resolve().then(()=>Im);return r.deserialize(e)}case"sequential_chain":{const{SequentialChain:r}=await Promise.resolve().then(()=>x0);return r.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:r}=await Promise.resolve().then(()=>x0);return r.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:r}=await Promise.resolve().then(()=>yo);return r.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:r}=await Promise.resolve().then(()=>yo);return r.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:r}=await Promise.resolve().then(()=>yo);return r.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:r}=await Promise.resolve().then(()=>gg);return r.deserialize(e,t)}case"api_chain":{const{APIChain:r}=await Promise.resolve().then(()=>Rm);return r.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Pm extends Be{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async r=>this.parseResult([{text:r}]),e,{...t,runType:"parser"}):this._callWithConfig(async r=>this.parseResult([{message:r,text:r.content}]),e,{...t,runType:"parser"})}}class km extends Pm{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Sm extends km{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class Ae extends it{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new Sm,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){let a;return this.outputParser?a=await this.outputParser.parseResultWithPrompt(e,t,r==null?void 0:r.getChild()):a=e[0].text,a}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},a={...this.llmKwargs};for(const o of this.llm.callKeys)o in e&&(a[o]=e[o],delete r[o]);const s=await this.prompt.formatPromptValue(r),{generations:i}=await this.llm.generatePrompt([s],a,t==null?void 0:t.getChild());return{[this.outputKey]:await this._getFinalOutput(i[0],s,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new Ae({llm:await fo.deserialize(t),prompt:await co.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}const Im=Object.freeze(Object.defineProperty({__proto__:null,LLMChain:Ae},Symbol.toStringTag,{value:"Module"})),p0=`You are given the below API Documentation:
{api_docs}
Using this documentation, generate the full API url to call for answering the user question.
You should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.

Question:{question}
API url:`,Om=new be({inputVariables:["api_docs","question"],template:p0}),Bm=`${p0} {api_url}

Here is the response from the API:

{api_response}

Summarize this response to answer the original question.

Summary:`,Tm=new be({inputVariables:["api_docs","question","api_url","api_response"],template:Bm});class po extends it{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,t){const r=e[this.inputKey],a=await this.apiRequestChain.predict({question:r,api_docs:this.apiDocs},t==null?void 0:t.getChild("request")),i=await(await fetch(a,{headers:this.headers})).text(),o=await this.apiAnswerChain.predict({question:r,api_docs:this.apiDocs,api_url:a,api_response:i},t==null?void 0:t.getChild("response"));return{[this.outputKey]:o}}_chainType(){return"api_chain"}static async deserialize(e){const{api_request_chain:t,api_answer_chain:r,api_docs:a}=e;if(!t)throw new Error("LLMChain must have api_request_chain");if(!r)throw new Error("LLMChain must have api_answer_chain");if(!a)throw new Error("LLMChain must have api_docs");return new po({apiAnswerChain:await Ae.deserialize(r),apiRequestChain:await Ae.deserialize(t),apiDocs:a})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,t,r={}){const{apiUrlPrompt:a=Om,apiResponsePrompt:s=Tm}=r,i=new Ae({prompt:a,llm:e}),o=new Ae({prompt:s,llm:e});return new this({apiAnswerChain:o,apiRequestChain:i,apiDocs:t,...r})}}const Rm=Object.freeze(Object.defineProperty({__proto__:null,APIChain:po},Symbol.toStringTag,{value:"Module"}));class m0 extends hm{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}class Dm extends tf{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=(e==null?void 0:e.chatHistory)??new m0,this.returnMessages=(e==null?void 0:e.returnMessages)??this.returnMessages,this.inputKey=(e==null?void 0:e.inputKey)??this.inputKey,this.outputKey=(e==null?void 0:e.outputKey)??this.outputKey}async saveContext(e,t){await this.chatHistory.addUserMessage(rf(e,this.inputKey)),await this.chatHistory.addAIChatMessage(nf(t,this.outputKey))}async clear(){await this.chatHistory.clear()}}class g0 extends Dm{constructor(e){super({chatHistory:e==null?void 0:e.chatHistory,returnMessages:(e==null?void 0:e.returnMessages)??!1,inputKey:e==null?void 0:e.inputKey,outputKey:e==null?void 0:e.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const t=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:t}:{[this.memoryKey]:Rn(t,this.humanPrefix,this.aiPrefix)}}}function y0(n,e){const t=new Set;for(const r of e)n.has(r)&&t.add(r);return t}function Fm(n,e){const t=new Set(n);for(const r of e)t.add(r);return t}function Da(n,e){const t=new Set(n);for(const r of e)t.delete(r);return t}function an(n){return Array.from(n).map(e=>`"${e}"`).join(", ")}class mo extends it{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){var i;if(this.chains.length===0)throw new Error("Sequential chain must have at least one chain.");const e=((i=this.memory)==null?void 0:i.memoryKeys)??[],t=new Set(this.inputKeys),r=new Set(e),a=y0(t,r);if(a.size>0)throw new Error(`The following keys: ${an(a)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const s=Fm(t,r);for(const o of this.chains){let c=Da(new Set(o.inputKeys),s);if(o.memory&&(c=Da(c,new Set(o.memory.memoryKeys))),c.size>0)throw new Error(`Missing variables for chain "${o._chainType()}": ${an(c)}. Only got the following variables: ${an(s)}.`);const u=new Set(o.outputKeys),l=y0(s,u);if(l.size>0)throw new Error(`The following output variables for chain "${o._chainType()}" are overlapping: ${an(l)}. This can lead to unexpected behaviour.`);for(const f of u)s.add(f)}if(this.outputVariables.length===0)if(this.returnAll){const o=Da(s,t);this.outputVariables=Array.from(o)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const o=Da(new Set(this.outputVariables),new Set(s));if(o.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${an(o)}.`)}}async _call(e,t){let r={};const a=e;let s=0;for(const o of this.chains){s+=1,r=await o.call(a,t==null?void 0:t.getChild(`step_${s}`));for(const c of Object.keys(r))a[c]=r[c]}const i={};for(const o of this.outputVariables)i[o]=a[o];return i}_chainType(){return"sequential_chain"}static async deserialize(e){const t=[],r=e.input_variables,a=e.output_variables,s=e.chains;for(const i of s){const o=await it.deserialize(i);t.push(o)}return new mo({chains:t,inputVariables:r,outputVariables:a})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class go extends it{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(e.inputKeys.filter(t=>{var r;return!((r=e.memory)!=null&&r.memoryKeys.includes(t))}).length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(e.outputKeys.length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],a=0;for(const s of this.chains)a+=1,r=(await s.call({[s.inputKeys[0]]:r,signal:e.signal},t==null?void 0:t.getChild(`step_${a}`)))[s.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await(t==null?void 0:t.handleText(r));return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const t=[],r=e.chains;for(const a of r){const s=await it.deserialize(a);t.push(s)}return new go({chains:t})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}const x0=Object.freeze(Object.defineProperty({__proto__:null,SequentialChain:mo,SimpleSequentialChain:go},Symbol.toStringTag,{value:"Module"}));class Mt extends it{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,s=t.map(({pageContent:i})=>i).join(`

`);return{...r,[this.documentVariableName]:s}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t==null?void 0:t.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new Mt({llmChain:await Ae.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class sn extends it{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...a}=e;let s=r,i=[];for(let u=0;u<this.maxIterations;u+=1){const l=s.map(m=>({[this.documentVariableName]:m.pageContent,...a}));if(u!==0||!this.ensureMapStep){const m=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:s,...a}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(m)<this.maxTokens)break}const h=await this.llmChain.apply(l,t?Array.from({length:l.length},(m,w)=>t.getChild(`map_${w+1}`)):void 0),{outputKey:x}=this.llmChain;this.returnIntermediateSteps&&(i=i.concat(h.map(m=>m[x]))),s=h.map(m=>({pageContent:m[x],metadata:{}}))}const o={[this.combineDocumentChain.inputKey]:s,...a},c=await this.combineDocumentChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnIntermediateSteps?{...c,intermediateSteps:i}:c}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new sn({llmChain:await Ae.deserialize(e.llm_chain),combineDocumentChain:await Mt.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class on extends it{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new be({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},a={};return this.documentPrompt.inputVariables.forEach(o=>{a[o]=r[o]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...a})},...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},a={};this.documentPrompt.inputVariables.forEach(o=>{a[o]=r[o]});const s={[this.documentVariableName]:await this.documentPrompt.format({...a})};return{[this.initialResponseName]:t,...s}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...a}=e,s=r,i=await this._constructInitialInputs(s[0],a);let o=await this.llmChain.predict({...i},t==null?void 0:t.getChild("answer"));for(let c=1;c<s.length;c+=1){const l={...await this._constructRefineInputs(s[c],o),...a};o=await this.refineLLMChain.predict({...l},t==null?void 0:t.getChild("refine"))}return{[this.outputKey]:o}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new on({llmChain:await Ae.deserialize(t),refineLLMChain:await Ae.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const yo=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain:sn,RefineDocumentsChain:on,StuffDocumentsChain:Mt},Symbol.toStringTag,{value:"Module"}));class Nm{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class un extends Nm{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function cn(n){return n._modelType()==="base_chat_model"}const jm=new be({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),$m=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,Lm=[nn.fromTemplate($m),tr.fromTemplate("{question}")],zm=_t.fromMessages(Lm),Mm=new un(jm,[[cn,zm]]),Um=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
{context}
Question: {question}
Relevant text, if any:`,Km=be.fromTemplate(Um),Hm=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
----------------
{context}`,Vm=[nn.fromTemplate(Hm),tr.fromTemplate("{question}")],qm=_t.fromMessages(Vm),Wm=new un(Km,[[cn,qm]]),Zm=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.

QUESTION: Which state/country's law governs the interpretation of the contract?
=========
Content: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.

Content: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.

11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.

11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.

11.9 No Third-Party Beneficiaries.

Content: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,
=========
FINAL ANSWER: This Agreement is governed by English law.

QUESTION: What did the president say about Michael Jackson?
=========
Content: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  

Last year COVID-19 kept us apart. This year we are finally together again. 

Tonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. 

With a duty to one another to the American people to the Constitution. 

And with an unwavering resolve that freedom will always triumph over tyranny. 

Six days ago, Russia’s Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. 

He thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. 

He met the Ukrainian people. 

From President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. 

Groups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.

Content: And we won’t stop. 

We have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. 

Let’s use this moment to reset. Let’s stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  

Let’s stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  

We can’t change how divided we’ve been. But we can change how we move forward—on COVID-19 and other issues we must face together. 

I recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. 

They were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. 

Officer Mora was 27 years old. 

Officer Rivera was 22. 

Both Dominican Americans who’d grown up on the same streets they later chose to patrol as police officers. 

I spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.

Content: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  

To all Americans, I will be honest with you, as I’ve always promised. A Russian dictator, invading a foreign country, has costs around the world. 

And I’m taking robust action to make sure the pain of our sanctions  is targeted at Russia’s economy. And I will use every tool at our disposal to protect American businesses and consumers. 

Tonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  

America will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  

These steps will help blunt gas prices here at home. And I know the news about what’s happening can seem alarming. 

But I want you to know that we are going to be okay.

Content: More support for patients and families. 

To get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. 

It’s based on DARPA—the Defense Department project that led to the Internet, GPS, and so much more.  

ARPA-H will have a singular purpose—to drive breakthroughs in cancer, Alzheimer’s, diabetes, and more. 

A unity agenda for the nation. 

We can do this. 

My fellow Americans—tonight , we have gathered in a sacred space—the citadel of our democracy. 

In this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. 

We have fought for freedom, expanded liberty, defeated totalitarianism and terror. 

And built the strongest, freest, and most prosperous nation the world has ever known. 

Now is the hour. 

Our moment of responsibility. 

Our test of resolve and conscience, of history itself. 

It is in this moment that our character is formed. Our purpose is found. Our future is forged. 

Well I know this nation.
=========
FINAL ANSWER: The president did not mention Michael Jackson.

QUESTION: {question}
=========
{summaries}
=========
FINAL ANSWER:`,Gm=be.fromTemplate(Zm),Ym=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.
----------------
{summaries}`,Xm=[nn.fromTemplate(Ym),tr.fromTemplate("{question}")],Jm=_t.fromMessages(Xm),Qm=new un(Gm,[[cn,Jm]]);class Fa extends s0{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),o0(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new Fa(a)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(i=>this.examplePrompt.format(i))),s=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return ho(s,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await be.deserialize(t);let a;if(Array.isArray(e.examples))a=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new Fa({inputVariables:e.input_variables,examplePrompt:r,examples:a,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}const eg=Object.freeze(Object.defineProperty({__proto__:null,FewShotPromptTemplate:Fa},Symbol.toStringTag,{value:"Module"})),tg=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,rg=new be({inputVariables:["question","existing_answer","context"],template:tg}),ng=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,ag=[tr.fromTemplate("{question}"),l0.fromTemplate("{existing_answer}"),tr.fromTemplate(ng)],sg=_t.fromMessages(ag),ig=new un(rg,[[cn,sg]]),og=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer the question: {question}`,ug=new be({inputVariables:["context","question"],template:og}),cg=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer any questions`,lg=[nn.fromTemplate(cg),tr.fromTemplate("{question}")],hg=_t.fromMessages(lg),dg=new un(ug,[[cn,hg]]),fg=(n,e={type:"stuff"})=>{const{type:t}=e;if(t==="stuff")return b0(n,e);if(t==="map_reduce")return pg(n,e);if(t==="refine")return mg(n,e);throw new Error(`Invalid _type: ${t}`)};function b0(n,e={}){const{prompt:t=Mm.getPrompt(n),verbose:r}=e,a=new Ae({prompt:t,llm:n,verbose:r});return new Mt({llmChain:a,verbose:r})}function pg(n,e={}){const{combineMapPrompt:t=Wm.getPrompt(n),combinePrompt:r=Qm.getPrompt(n),verbose:a,combineLLM:s,returnIntermediateSteps:i}=e,o=new Ae({prompt:t,llm:n,verbose:a}),c=new Ae({prompt:r,llm:s??n,verbose:a}),u=new Mt({llmChain:c,documentVariableName:"summaries",verbose:a});return new sn({llmChain:o,combineDocumentChain:u,returnIntermediateSteps:i,verbose:a})}function mg(n,e={}){const{questionPrompt:t=dg.getPrompt(n),refinePrompt:r=ig.getPrompt(n),refineLLM:a,verbose:s}=e,i=new Ae({prompt:t,llm:n,verbose:s}),o=new Ae({prompt:r,llm:a??n,verbose:s});return new on({llmChain:i,refineLLMChain:o,verbose:s})}class xo extends it{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const r=e[this.inputKey],a=await this.vectorstore.similaritySearch(r,this.k,e.filter,t==null?void 0:t.getChild("vectorstore")),s={question:r,input_documents:a},i=await this.combineDocumentsChain.call(s,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...i,sourceDocuments:a}:i}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:r}=t;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new xo({combineDocumentsChain:await it.deserialize(e.combine_documents_chain),k:e.k,vectorstore:r})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,r){const a=b0(e);return new this({vectorstore:t,combineDocumentsChain:a,...r})}}const gg=Object.freeze(Object.defineProperty({__proto__:null,VectorDBQAChain:xo},Symbol.toStringTag,{value:"Module"})),yg=`Write a concise summary of the following:


"{text}"


CONCISE SUMMARY:`,Na=new be({template:yg,inputVariables:["text"]}),xg=`Your job is to produce a final summary
We have provided an existing summary up to a certain point: "{existing_answer}"
We have the opportunity to refine the existing summary
(only if needed) with some more context below.
------------
"{text}"
------------

Given the new context, refine the original summary
If the context isn't useful, return the original summary.

REFINED SUMMARY:`,bg=new be({template:xg,inputVariables:["existing_answer","text"]}),_g=(n,e={type:"map_reduce"})=>{const{verbose:t}=e;if(e.type==="stuff"){const{prompt:r=Na}=e,a=new Ae({prompt:r,llm:n,verbose:t});return new Mt({llmChain:a,documentVariableName:"text",verbose:t})}if(e.type==="map_reduce"){const{combineMapPrompt:r=Na,combinePrompt:a=Na,combineLLM:s,returnIntermediateSteps:i}=e,o=new Ae({prompt:r,llm:n,verbose:t}),c=new Ae({prompt:a,llm:s??n,verbose:t}),u=new Mt({llmChain:c,documentVariableName:"text",verbose:t});return new sn({llmChain:o,combineDocumentChain:u,documentVariableName:"text",returnIntermediateSteps:i,verbose:t})}if(e.type==="refine"){const{refinePrompt:r=bg,refineLLM:a,questionPrompt:s=Na}=e,i=new Ae({prompt:s,llm:n,verbose:t}),o=new Ae({prompt:r,llm:a??n,verbose:t});return new on({llmChain:i,refineLLMChain:o,documentVariableName:"text",verbose:t})}throw new Error(`Invalid _type: ${e.type}`)},vg=`Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.

Chat History:
{chat_history}
Follow Up Input: {question}
Standalone question:`;class bo extends it{static lc_name(){return"ConversationalRetrievalQAChain"}get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}static getChatHistoryString(e){let t;return Array.isArray(e)?(Array.isArray(e[0])&&typeof e[0][0]=="string"?(console.warn(`Passing chat history as an array of strings is deprecated.
Please see https://js.langchain.com/docs/modules/chains/popular/chat_vector_db#externally-managed-memory for more information.`),t=e.flat().map((r,a)=>a%2===0?new Bt(r):new er(r))):t=e,t.map(r=>r._getType()==="human"?`Human: ${r.content}`:r._getType()==="ai"?`Assistant: ${r.content}`:`${r.content}`).join(`
`)):e}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found.`);const r=e[this.inputKey],a=bo.getChatHistoryString(e[this.chatHistoryKey]);let s=r;if(a.length>0){const u=await this.questionGeneratorChain.call({question:r,chat_history:a},t==null?void 0:t.getChild("question_generator")),l=Object.keys(u);if(l.length===1)s=u[l[0]];else throw new Error("Return from llm chain has multiple values, only single values supported.")}const i=await this.retriever.getRelevantDocuments(s,t==null?void 0:t.getChild("retriever")),o={question:s,input_documents:i,chat_history:a},c=await this.combineDocumentsChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...c,sourceDocuments:i}:c}_chainType(){return"conversational_retrieval_chain"}static async deserialize(e,t){throw new Error("Not implemented.")}serialize(){throw new Error("Not implemented.")}static fromLLM(e,t,r={}){const{questionGeneratorTemplate:a,qaTemplate:s,qaChainOptions:i={type:"stuff",prompt:s?be.fromTemplate(s):void 0},questionGeneratorChainOptions:o,verbose:c,...u}=r,l=fg(e,i),f=be.fromTemplate((o==null?void 0:o.template)??a??vg),h=new Ae({prompt:f,llm:(o==null?void 0:o.llm)??e,verbose:c});return new this({retriever:t,combineDocumentsChain:l,questionGeneratorChain:h,verbose:c,...u})}}var ce;(function(n){n.assertEqual=a=>a;function e(a){}n.assertIs=e;function t(a){throw new Error}n.assertNever=t,n.arrayToEnum=a=>{const s={};for(const i of a)s[i]=i;return s},n.getValidEnumValues=a=>{const s=n.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),i={};for(const o of s)i[o]=a[o];return n.objectValues(i)},n.objectValues=a=>n.objectKeys(a).map(function(s){return a[s]}),n.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const s=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&s.push(i);return s},n.find=(a,s)=>{for(const i of a)if(s(i))return i},n.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function r(a,s=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var _0;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(_0||(_0={}));const W=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ut=n=>{switch(typeof n){case"undefined":return W.undefined;case"string":return W.string;case"number":return isNaN(n)?W.nan:W.number;case"boolean":return W.boolean;case"function":return W.function;case"bigint":return W.bigint;case"symbol":return W.symbol;case"object":return Array.isArray(n)?W.array:n===null?W.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?W.promise:typeof Map<"u"&&n instanceof Map?W.map:typeof Set<"u"&&n instanceof Set?W.set:typeof Date<"u"&&n instanceof Date?W.date:W.object;default:return W.unknown}},U=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ot extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},r={_errors:[]},a=s=>{for(const i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let o=r,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return a(this),r}static assert(e){if(!(e instanceof ot))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ot.create=n=>new ot(n);const ln=(n,e)=>{let t;switch(n.code){case U.invalid_type:n.received===W.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case U.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,ce.jsonStringifyReplacer)}`;break;case U.unrecognized_keys:t=`Unrecognized key(s) in object: ${ce.joinValues(n.keys,", ")}`;break;case U.invalid_union:t="Invalid input";break;case U.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ce.joinValues(n.options)}`;break;case U.invalid_enum_value:t=`Invalid enum value. Expected ${ce.joinValues(n.options)}, received '${n.received}'`;break;case U.invalid_arguments:t="Invalid function arguments";break;case U.invalid_return_type:t="Invalid function return type";break;case U.invalid_date:t="Invalid date";break;case U.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:ce.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case U.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case U.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case U.custom:t="Invalid input";break;case U.invalid_intersection_types:t="Intersection results could not be merged";break;case U.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case U.not_finite:t="Number must be finite";break;default:t=e.defaultError,ce.assertNever(n)}return{message:t}};let wg=ln;function _o(){return wg}const vo=n=>{const{data:e,path:t,errorMaps:r,issueData:a}=n,s=[...t,...a.path||[]],i={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let o="";const c=r.filter(u=>!!u).slice().reverse();for(const u of c)o=u(i,{data:e,defaultError:o}).message;return{...a,path:s,message:o}};function q(n,e){const t=_o(),r=vo({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===ln?void 0:ln].filter(a=>!!a)});n.common.issues.push(r)}class Ve{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const a of t){if(a.status==="aborted")return ee;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const a of t){const s=await a.key,i=await a.value;r.push({key:s,value:i})}return Ve.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const a of t){const{key:s,value:i}=a;if(s.status==="aborted"||i.status==="aborted")return ee;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(r[s.value]=i.value)}return{status:e.value,value:r}}}const ee=Object.freeze({status:"aborted"}),hn=n=>({status:"dirty",value:n}),Je=n=>({status:"valid",value:n}),v0=n=>n.status==="aborted",w0=n=>n.status==="dirty",Cr=n=>n.status==="valid",ja=n=>typeof Promise<"u"&&n instanceof Promise;function $a(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function A0(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t}typeof SuppressedError=="function"&&SuppressedError;var Z;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Z||(Z={}));var dn,fn;class vt{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const E0=(n,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ot(n.common.issues);return this._error=t,this._error}}};function re(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:a}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(i,o)=>{var c,u;const{message:l}=n;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(u=l??t)!==null&&u!==void 0?u:o.defaultError}},description:a}}class se{get description(){return this._def.description}_getType(e){return Ut(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ut(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ve,ctx:{common:e.parent.common,data:e.data,parsedType:Ut(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ja(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const a={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ut(e)},s=this._parseSync({data:e,path:a.path,parent:a});return E0(a,s)}"~validate"(e){var t,r;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ut(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:a});return Cr(s)?{value:s.value}:{issues:a.common.issues}}catch(s){!((r=(t=s==null?void 0:s.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(s=>Cr(s)?{value:s.value}:{issues:a.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ut(e)},a=this._parse({data:e,path:r.path,parent:r}),s=await(ja(a)?a:Promise.resolve(a));return E0(r,s)}refine(e,t){const r=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,s)=>{const i=e(a),o=()=>s.addIssue({code:U.custom,...r(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof t=="function"?t(r,a):t),!1))}_refinement(e){return new Ft({schema:this,typeName:H.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return At.create(this,this._def)}nullable(){return nr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wt.create(this)}promise(){return gn.create(this,this._def)}or(e){return Ma.create([this,e],this._def)}and(e){return Ua.create(this,e,this._def)}transform(e){return new Ft({...re(this._def),schema:this,typeName:H.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Wa({...re(this._def),innerType:this,defaultValue:t,typeName:H.ZodDefault})}brand(){return new S0({typeName:H.ZodBranded,type:this,...re(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Za({...re(this._def),innerType:this,catchValue:t,typeName:H.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ga.create(this,e)}readonly(){return Ya.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ag=/^c[^\s-]{8,}$/i,Eg=/^[0-9a-z]+$/,Cg=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Pg=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kg=/^[a-z0-9_-]{21}$/i,Sg=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ig=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Og=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Bg="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let wo;const Tg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Rg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Dg=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Fg=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ng=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,jg=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,C0="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$g=new RegExp(`^${C0}$`);function P0(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Lg(n){return new RegExp(`^${P0(n)}$`)}function zg(n){let e=`${C0}T${P0(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Mg(n,e){return!!((e==="v4"||!e)&&Tg.test(n)||(e==="v6"||!e)&&Dg.test(n))}function Ug(n,e){if(!Sg.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||!a.typ||!a.alg||e&&a.alg!==e)}catch{return!1}}function Kg(n,e){return!!((e==="v4"||!e)&&Rg.test(n)||(e==="v6"||!e)&&Fg.test(n))}class Tt extends se{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==W.string){const s=this._getOrReturnCtx(e);return q(s,{code:U.invalid_type,expected:W.string,received:s.parsedType}),ee}const r=new Ve;let a;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(a=this._getOrReturnCtx(e,a),q(a,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(a=this._getOrReturnCtx(e,a),q(a,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const i=e.data.length>s.value,o=e.data.length<s.value;(i||o)&&(a=this._getOrReturnCtx(e,a),i?q(a,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&q(a,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")Og.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"email",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")wo||(wo=new RegExp(Bg,"u")),wo.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"emoji",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Pg.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"uuid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")kg.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"nanoid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Ag.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"cuid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Eg.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"cuid2",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Cg.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"ulid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),q(a,{validation:"url",code:U.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"regex",code:U.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(e,a),q(a,{code:U.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(a=this._getOrReturnCtx(e,a),q(a,{code:U.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(a=this._getOrReturnCtx(e,a),q(a,{code:U.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?zg(s).test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{code:U.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?$g.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{code:U.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?Lg(s).test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{code:U.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Ig.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"duration",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?Mg(e.data,s.version)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"ip",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?Ug(e.data,s.alg)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"jwt",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?Kg(e.data,s.version)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"cidr",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?Ng.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"base64",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?jg.test(e.data)||(a=this._getOrReturnCtx(e,a),q(a,{validation:"base64url",code:U.invalid_string,message:s.message}),r.dirty()):ce.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(a=>e.test(a),{validation:t,code:U.invalid_string,...Z.errToObj(r)})}_addCheck(e){return new Tt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Z.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...Z.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Z.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Z.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Z.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Z.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Z.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Z.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Z.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Z.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Z.errToObj(t)})}nonempty(e){return this.min(1,Z.errToObj(e))}trim(){return new Tt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Tt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Tt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Tt.create=n=>{var e;return new Tt({checks:[],typeName:H.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...re(n)})};function Hg(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=t>r?t:r,s=parseInt(n.toFixed(a).replace(".","")),i=parseInt(e.toFixed(a).replace(".",""));return s%i/Math.pow(10,a)}class Pr extends se{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==W.number){const s=this._getOrReturnCtx(e);return q(s,{code:U.invalid_type,expected:W.number,received:s.parsedType}),ee}let r;const a=new Ve;for(const s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:U.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:U.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:U.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?Hg(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),q(r,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:U.not_finite,message:s.message}),a.dirty()):ce.assertNever(s);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Z.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Z.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Z.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Z.toString(t))}setLimit(e,t,r,a){return new Pr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Z.toString(a)}]})}_addCheck(e){return new Pr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Pr.create=n=>new Pr({checks:[],typeName:H.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...re(n)});class kr extends se{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==W.bigint)return this._getInvalidInput(e);let r;const a=new Ve;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:U.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:U.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),q(r,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):ce.assertNever(s);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return q(t,{code:U.invalid_type,expected:W.bigint,received:t.parsedType}),ee}gte(e,t){return this.setLimit("min",e,!0,Z.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Z.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Z.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Z.toString(t))}setLimit(e,t,r,a){return new kr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Z.toString(a)}]})}_addCheck(e){return new kr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}kr.create=n=>{var e;return new kr({checks:[],typeName:H.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...re(n)})};class Ao extends se{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==W.boolean){const r=this._getOrReturnCtx(e);return q(r,{code:U.invalid_type,expected:W.boolean,received:r.parsedType}),ee}return Je(e.data)}}Ao.create=n=>new Ao({typeName:H.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...re(n)});class pn extends se{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==W.date){const s=this._getOrReturnCtx(e);return q(s,{code:U.invalid_type,expected:W.date,received:s.parsedType}),ee}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return q(s,{code:U.invalid_date}),ee}const r=new Ve;let a;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(a=this._getOrReturnCtx(e,a),q(a,{code:U.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(a=this._getOrReturnCtx(e,a),q(a,{code:U.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):ce.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new pn({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Z.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Z.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}pn.create=n=>new pn({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:H.ZodDate,...re(n)});class Eo extends se{_parse(e){if(this._getType(e)!==W.symbol){const r=this._getOrReturnCtx(e);return q(r,{code:U.invalid_type,expected:W.symbol,received:r.parsedType}),ee}return Je(e.data)}}Eo.create=n=>new Eo({typeName:H.ZodSymbol,...re(n)});class La extends se{_parse(e){if(this._getType(e)!==W.undefined){const r=this._getOrReturnCtx(e);return q(r,{code:U.invalid_type,expected:W.undefined,received:r.parsedType}),ee}return Je(e.data)}}La.create=n=>new La({typeName:H.ZodUndefined,...re(n)});class za extends se{_parse(e){if(this._getType(e)!==W.null){const r=this._getOrReturnCtx(e);return q(r,{code:U.invalid_type,expected:W.null,received:r.parsedType}),ee}return Je(e.data)}}za.create=n=>new za({typeName:H.ZodNull,...re(n)});class Co extends se{constructor(){super(...arguments),this._any=!0}_parse(e){return Je(e.data)}}Co.create=n=>new Co({typeName:H.ZodAny,...re(n)});class Sr extends se{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Je(e.data)}}Sr.create=n=>new Sr({typeName:H.ZodUnknown,...re(n)});class Kt extends se{_parse(e){const t=this._getOrReturnCtx(e);return q(t,{code:U.invalid_type,expected:W.never,received:t.parsedType}),ee}}Kt.create=n=>new Kt({typeName:H.ZodNever,...re(n)});class Po extends se{_parse(e){if(this._getType(e)!==W.undefined){const r=this._getOrReturnCtx(e);return q(r,{code:U.invalid_type,expected:W.void,received:r.parsedType}),ee}return Je(e.data)}}Po.create=n=>new Po({typeName:H.ZodVoid,...re(n)});class wt extends se{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==W.array)return q(t,{code:U.invalid_type,expected:W.array,received:t.parsedType}),ee;if(a.exactLength!==null){const i=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(i||o)&&(q(t,{code:i?U.too_big:U.too_small,minimum:o?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(q(t,{code:U.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(q(t,{code:U.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>a.type._parseAsync(new vt(t,i,t.path,o)))).then(i=>Ve.mergeArray(r,i));const s=[...t.data].map((i,o)=>a.type._parseSync(new vt(t,i,t.path,o)));return Ve.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new wt({...this._def,minLength:{value:e,message:Z.toString(t)}})}max(e,t){return new wt({...this._def,maxLength:{value:e,message:Z.toString(t)}})}length(e,t){return new wt({...this._def,exactLength:{value:e,message:Z.toString(t)}})}nonempty(e){return this.min(1,e)}}wt.create=(n,e)=>new wt({type:n,minLength:null,maxLength:null,exactLength:null,typeName:H.ZodArray,...re(e)});function Ir(n){if(n instanceof Ee){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=At.create(Ir(r))}return new Ee({...n._def,shape:()=>e})}else return n instanceof wt?new wt({...n._def,type:Ir(n.element)}):n instanceof At?At.create(Ir(n.unwrap())):n instanceof nr?nr.create(Ir(n.unwrap())):n instanceof Dt?Dt.create(n.items.map(e=>Ir(e))):n}class Ee extends se{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ce.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==W.object){const u=this._getOrReturnCtx(e);return q(u,{code:U.invalid_type,expected:W.object,received:u.parsedType}),ee}const{status:r,ctx:a}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Kt&&this._def.unknownKeys==="strip"))for(const u in a.data)i.includes(u)||o.push(u);const c=[];for(const u of i){const l=s[u],f=a.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new vt(a,f,a.path,u)),alwaysSet:u in a.data})}if(this._def.catchall instanceof Kt){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:a.data[l]}});else if(u==="strict")o.length>0&&(q(a,{code:U.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const f=a.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new vt(a,f,a.path,l)),alwaysSet:l in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of c){const f=await l.key,h=await l.value;u.push({key:f,value:h,alwaysSet:l.alwaysSet})}return u}).then(u=>Ve.mergeObjectSync(r,u)):Ve.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return Z.errToObj,new Ee({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var a,s,i,o;const c=(i=(s=(a=this._def).errorMap)===null||s===void 0?void 0:s.call(a,t,r).message)!==null&&i!==void 0?i:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=Z.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new Ee({...this._def,unknownKeys:"strip"})}passthrough(){return new Ee({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ee({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ee({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:H.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ee({...this._def,catchall:e})}pick(e){const t={};return ce.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new Ee({...this._def,shape:()=>t})}omit(e){const t={};return ce.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new Ee({...this._def,shape:()=>t})}deepPartial(){return Ir(this)}partial(e){const t={};return ce.objectKeys(this.shape).forEach(r=>{const a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new Ee({...this._def,shape:()=>t})}required(e){const t={};return ce.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof At;)s=s._def.innerType;t[r]=s}}),new Ee({...this._def,shape:()=>t})}keyof(){return k0(ce.objectKeys(this.shape))}}Ee.create=(n,e)=>new Ee({shape:()=>n,unknownKeys:"strip",catchall:Kt.create(),typeName:H.ZodObject,...re(e)}),Ee.strictCreate=(n,e)=>new Ee({shape:()=>n,unknownKeys:"strict",catchall:Kt.create(),typeName:H.ZodObject,...re(e)}),Ee.lazycreate=(n,e)=>new Ee({shape:n,unknownKeys:"strip",catchall:Kt.create(),typeName:H.ZodObject,...re(e)});class Ma extends se{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function a(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=s.map(o=>new ot(o.ctx.common.issues));return q(t,{code:U.invalid_union,unionErrors:i}),ee}if(t.common.async)return Promise.all(r.map(async s=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(a);{let s;const i=[];for(const c of r){const u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const o=i.map(c=>new ot(c));return q(t,{code:U.invalid_union,unionErrors:o}),ee}}get options(){return this._def.options}}Ma.create=(n,e)=>new Ma({options:n,typeName:H.ZodUnion,...re(e)});const Rt=n=>n instanceof Ha?Rt(n.schema):n instanceof Ft?Rt(n.innerType()):n instanceof Va?[n.value]:n instanceof rr?n.options:n instanceof qa?ce.objectValues(n.enum):n instanceof Wa?Rt(n._def.innerType):n instanceof La?[void 0]:n instanceof za?[null]:n instanceof At?[void 0,...Rt(n.unwrap())]:n instanceof nr?[null,...Rt(n.unwrap())]:n instanceof S0||n instanceof Ya?Rt(n.unwrap()):n instanceof Za?Rt(n._def.innerType):[];class ko extends se{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.object)return q(t,{code:U.invalid_type,expected:W.object,received:t.parsedType}),ee;const r=this.discriminator,a=t.data[r],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(q(t,{code:U.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ee)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const a=new Map;for(const s of t){const i=Rt(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,s)}}return new ko({typeName:H.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...re(r)})}}function So(n,e){const t=Ut(n),r=Ut(e);if(n===e)return{valid:!0,data:n};if(t===W.object&&r===W.object){const a=ce.objectKeys(e),s=ce.objectKeys(n).filter(o=>a.indexOf(o)!==-1),i={...n,...e};for(const o of s){const c=So(n[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===W.array&&r===W.array){if(n.length!==e.length)return{valid:!1};const a=[];for(let s=0;s<n.length;s++){const i=n[s],o=e[s],c=So(i,o);if(!c.valid)return{valid:!1};a.push(c.data)}return{valid:!0,data:a}}else return t===W.date&&r===W.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Ua extends se{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=(s,i)=>{if(v0(s)||v0(i))return ee;const o=So(s.value,i.value);return o.valid?((w0(s)||w0(i))&&t.dirty(),{status:t.value,value:o.data}):(q(r,{code:U.invalid_intersection_types}),ee)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,i])=>a(s,i)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Ua.create=(n,e,t)=>new Ua({left:n,right:e,typeName:H.ZodIntersection,...re(t)});class Dt extends se{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.array)return q(r,{code:U.invalid_type,expected:W.array,received:r.parsedType}),ee;if(r.data.length<this._def.items.length)return q(r,{code:U.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ee;!this._def.rest&&r.data.length>this._def.items.length&&(q(r,{code:U.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new vt(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(s).then(i=>Ve.mergeArray(t,i)):Ve.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new Dt({...this._def,rest:e})}}Dt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Dt({items:n,typeName:H.ZodTuple,rest:null,...re(e)})};class Ka extends se{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.object)return q(r,{code:U.invalid_type,expected:W.object,received:r.parsedType}),ee;const a=[],s=this._def.keyType,i=this._def.valueType;for(const o in r.data)a.push({key:s._parse(new vt(r,o,r.path,o)),value:i._parse(new vt(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Ve.mergeObjectAsync(t,a):Ve.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof se?new Ka({keyType:e,valueType:t,typeName:H.ZodRecord,...re(r)}):new Ka({keyType:Tt.create(),valueType:e,typeName:H.ZodRecord,...re(t)})}}class Io extends se{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.map)return q(r,{code:U.invalid_type,expected:W.map,received:r.parsedType}),ee;const a=this._def.keyType,s=this._def.valueType,i=[...r.data.entries()].map(([o,c],u)=>({key:a._parse(new vt(r,o,r.path,[u,"key"])),value:s._parse(new vt(r,c,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return ee;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return ee;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}}}}Io.create=(n,e,t)=>new Io({valueType:e,keyType:n,typeName:H.ZodMap,...re(t)});class Or extends se{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.set)return q(r,{code:U.invalid_type,expected:W.set,received:r.parsedType}),ee;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(q(r,{code:U.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(q(r,{code:U.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const s=this._def.valueType;function i(c){const u=new Set;for(const l of c){if(l.status==="aborted")return ee;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((c,u)=>s._parse(new vt(r,c,r.path,u)));return r.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new Or({...this._def,minSize:{value:e,message:Z.toString(t)}})}max(e,t){return new Or({...this._def,maxSize:{value:e,message:Z.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Or.create=(n,e)=>new Or({valueType:n,minSize:null,maxSize:null,typeName:H.ZodSet,...re(e)});class mn extends se{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.function)return q(t,{code:U.invalid_type,expected:W.function,received:t.parsedType}),ee;function r(o,c){return vo({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,_o(),ln].filter(u=>!!u),issueData:{code:U.invalid_arguments,argumentsError:c}})}function a(o,c){return vo({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,_o(),ln].filter(u=>!!u),issueData:{code:U.invalid_return_type,returnTypeError:c}})}const s={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof gn){const o=this;return Je(async function(...c){const u=new ot([]),l=await o._def.args.parseAsync(c,s).catch(x=>{throw u.addIssue(r(c,x)),u}),f=await Reflect.apply(i,this,l);return await o._def.returns._def.type.parseAsync(f,s).catch(x=>{throw u.addIssue(a(f,x)),u})})}else{const o=this;return Je(function(...c){const u=o._def.args.safeParse(c,s);if(!u.success)throw new ot([r(c,u.error)]);const l=Reflect.apply(i,this,u.data),f=o._def.returns.safeParse(l,s);if(!f.success)throw new ot([a(l,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new mn({...this._def,args:Dt.create(e).rest(Sr.create())})}returns(e){return new mn({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new mn({args:e||Dt.create([]).rest(Sr.create()),returns:t||Sr.create(),typeName:H.ZodFunction,...re(r)})}}class Ha extends se{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ha.create=(n,e)=>new Ha({getter:n,typeName:H.ZodLazy,...re(e)});class Va extends se{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return q(t,{received:t.data,code:U.invalid_literal,expected:this._def.value}),ee}return{status:"valid",value:e.data}}get value(){return this._def.value}}Va.create=(n,e)=>new Va({value:n,typeName:H.ZodLiteral,...re(e)});function k0(n,e){return new rr({values:n,typeName:H.ZodEnum,...re(e)})}class rr extends se{constructor(){super(...arguments),dn.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return q(t,{expected:ce.joinValues(r),received:t.parsedType,code:U.invalid_type}),ee}if($a(this,dn,"f")||A0(this,dn,new Set(this._def.values),"f"),!$a(this,dn,"f").has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return q(t,{received:t.data,code:U.invalid_enum_value,options:r}),ee}return Je(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return rr.create(e,{...this._def,...t})}exclude(e,t=this._def){return rr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}dn=new WeakMap,rr.create=k0;class qa extends se{constructor(){super(...arguments),fn.set(this,void 0)}_parse(e){const t=ce.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==W.string&&r.parsedType!==W.number){const a=ce.objectValues(t);return q(r,{expected:ce.joinValues(a),received:r.parsedType,code:U.invalid_type}),ee}if($a(this,fn,"f")||A0(this,fn,new Set(ce.getValidEnumValues(this._def.values)),"f"),!$a(this,fn,"f").has(e.data)){const a=ce.objectValues(t);return q(r,{received:r.data,code:U.invalid_enum_value,options:a}),ee}return Je(e.data)}get enum(){return this._def.values}}fn=new WeakMap,qa.create=(n,e)=>new qa({values:n,typeName:H.ZodNativeEnum,...re(e)});class gn extends se{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.promise&&t.common.async===!1)return q(t,{code:U.invalid_type,expected:W.promise,received:t.parsedType}),ee;const r=t.parsedType===W.promise?t.data:Promise.resolve(t.data);return Je(r.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}gn.create=(n,e)=>new gn({type:n,typeName:H.ZodPromise,...re(e)});class Ft extends se{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===H.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:i=>{q(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){const i=a.transform(r.data,s);if(r.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return ee;const c=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return c.status==="aborted"?ee:c.status==="dirty"||t.value==="dirty"?hn(c.value):c});{if(t.value==="aborted")return ee;const o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?ee:o.status==="dirty"||t.value==="dirty"?hn(o.value):o}}if(a.type==="refinement"){const i=o=>{const c=a.refinement(o,s);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?ee:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?ee:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Cr(i))return i;const o=a.transform(i.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>Cr(i)?Promise.resolve(a.transform(i.value,s)).then(o=>({status:t.value,value:o})):i);ce.assertNever(a)}}Ft.create=(n,e,t)=>new Ft({schema:n,typeName:H.ZodEffects,effect:e,...re(t)}),Ft.createWithPreprocess=(n,e,t)=>new Ft({schema:e,effect:{type:"preprocess",transform:n},typeName:H.ZodEffects,...re(t)});class At extends se{_parse(e){return this._getType(e)===W.undefined?Je(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}At.create=(n,e)=>new At({innerType:n,typeName:H.ZodOptional,...re(e)});class nr extends se{_parse(e){return this._getType(e)===W.null?Je(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}nr.create=(n,e)=>new nr({innerType:n,typeName:H.ZodNullable,...re(e)});class Wa extends se{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===W.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Wa.create=(n,e)=>new Wa({innerType:n,typeName:H.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...re(e)});class Za extends se{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ja(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ot(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new ot(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Za.create=(n,e)=>new Za({innerType:n,typeName:H.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...re(e)});class Oo extends se{_parse(e){if(this._getType(e)!==W.nan){const r=this._getOrReturnCtx(e);return q(r,{code:U.invalid_type,expected:W.nan,received:r.parsedType}),ee}return{status:"valid",value:e.data}}}Oo.create=n=>new Oo({typeName:H.ZodNaN,...re(n)});class S0 extends se{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ga extends se{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ee:s.status==="dirty"?(t.dirty(),hn(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ee:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,t){return new Ga({in:e,out:t,typeName:H.ZodPipeline})}}class Ya extends se{_parse(e){const t=this._def.innerType._parse(e),r=a=>(Cr(a)&&(a.value=Object.freeze(a.value)),a);return ja(t)?t.then(a=>r(a)):r(t)}unwrap(){return this._def.innerType}}Ya.create=(n,e)=>new Ya({innerType:n,typeName:H.ZodReadonly,...re(e)}),Ee.lazycreate;var H;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(H||(H={})),Tt.create,Pr.create,Oo.create,kr.create,Ao.create,pn.create,Eo.create,La.create,za.create,Co.create,Sr.create,Kt.create,Po.create,wt.create,Ee.create,Ee.strictCreate,Ma.create,ko.create,Ua.create,Dt.create,Ka.create,Io.create,Or.create,mn.create,Ha.create,Va.create,rr.create,qa.create,gn.create,Ft.create,At.create,nr.create,Ft.createWithPreprocess,Ga.create;const Vg=Symbol("Let zodToJsonSchema decide on which parser to use"),I0={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},qg=n=>typeof n=="string"?{...I0,name:n}:{...I0,...n},Wg=n=>{const e=qg(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function O0(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function me(n,e,t,r,a){n[e]=t,O0(n,e,r,a)}function Zg(){return{}}function Gg(n,e){var r,a,s;const t={type:"array"};return(r=n.type)!=null&&r._def&&((s=(a=n.type)==null?void 0:a._def)==null?void 0:s.typeName)!==H.ZodAny&&(t.items=he(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&me(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&me(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(me(t,"minItems",n.exactLength.value,n.exactLength.message,e),me(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Yg(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?me(t,"minimum",r.value,r.message,e):me(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),me(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?me(t,"maximum",r.value,r.message,e):me(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),me(t,"maximum",r.value,r.message,e));break;case"multipleOf":me(t,"multipleOf",r.value,r.message,e);break}return t}function Xg(){return{type:"boolean"}}function B0(n,e){return he(n.type._def,e)}const Jg=(n,e)=>he(n.innerType._def,e);function T0(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,s)=>T0(n,e,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Qg(n,e)}}const Qg=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":me(t,"minimum",r.value,r.message,e);break;case"max":me(t,"maximum",r.value,r.message,e);break}return t};function ey(n,e){return{...he(n.innerType._def,e),default:n.defaultValue()}}function ty(n,e){return e.effectStrategy==="input"?he(n.schema._def,e):{}}function ry(n){return{type:"string",enum:Array.from(n.values)}}const ny=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function ay(n,e){const t=[he(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),he(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(s=>{if(ny(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...c}=s;i=c}else r=void 0;a.push(i)}}),a.length?{allOf:a,...r}:void 0}function sy(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let Bo;const pt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Bo===void 0&&(Bo=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Bo),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function R0(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":me(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":me(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":mt(t,"email",r.message,e);break;case"format:idn-email":mt(t,"idn-email",r.message,e);break;case"pattern:zod":qe(t,pt.email,r.message,e);break}break;case"url":mt(t,"uri",r.message,e);break;case"uuid":mt(t,"uuid",r.message,e);break;case"regex":qe(t,r.regex,r.message,e);break;case"cuid":qe(t,pt.cuid,r.message,e);break;case"cuid2":qe(t,pt.cuid2,r.message,e);break;case"startsWith":qe(t,RegExp(`^${To(r.value,e)}`),r.message,e);break;case"endsWith":qe(t,RegExp(`${To(r.value,e)}$`),r.message,e);break;case"datetime":mt(t,"date-time",r.message,e);break;case"date":mt(t,"date",r.message,e);break;case"time":mt(t,"time",r.message,e);break;case"duration":mt(t,"duration",r.message,e);break;case"length":me(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),me(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{qe(t,RegExp(To(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&mt(t,"ipv4",r.message,e),r.version!=="v4"&&mt(t,"ipv6",r.message,e);break}case"base64url":qe(t,pt.base64url,r.message,e);break;case"jwt":qe(t,pt.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&qe(t,pt.ipv4Cidr,r.message,e),r.version!=="v4"&&qe(t,pt.ipv6Cidr,r.message,e);break}case"emoji":qe(t,pt.emoji(),r.message,e);break;case"ulid":{qe(t,pt.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{mt(t,"binary",r.message,e);break}case"contentEncoding:base64":{me(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{qe(t,pt.base64,r.message,e);break}}break}case"nanoid":qe(t,pt.nanoid,r.message,e)}return t}function To(n,e){return e.patternStrategy==="escape"?oy(n):n}const iy=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function oy(n){let e="";for(let t=0;t<n.length;t++)iy.has(n[t])||(e+="\\"),e+=n[t];return e}function mt(n,e,t,r){var a;n.format||(a=n.anyOf)!=null&&a.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):me(n,"format",e,t,r)}function qe(n,e,t,r){var a;n.pattern||(a=n.allOf)!=null&&a.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:D0(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):me(n,"pattern",D0(e,r),t,r)}function D0(n,e){var c;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let a="",s=!1,i=!1,o=!1;for(let u=0;u<r.length;u++){if(s){a+=r[u],s=!1;continue}if(t.i){if(i){if(r[u].match(/[a-z]/)){o?(a+=r[u],a+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((c=r[u+2])!=null&&c.match(/[a-z]/))?(a+=r[u],o=!0):a+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){a+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(t.m){if(r[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(t.s&&r[u]==="."){a+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}a+=r[u],r[u]==="\\"?s=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a}function F0(n,e){var r,a,s,i,o,c;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===H.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((u,l)=>({...u,[l]:he(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:he(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((a=n.keyType)==null?void 0:a._def.typeName)===H.ZodString&&((s=n.keyType._def.checks)!=null&&s.length)){const{type:u,...l}=R0(n.keyType._def,e);return{...t,propertyNames:l}}else{if(((i=n.keyType)==null?void 0:i._def.typeName)===H.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===H.ZodBranded&&n.keyType._def.type._def.typeName===H.ZodString&&((c=n.keyType._def.type._def.checks)!=null&&c.length)){const{type:u,...l}=B0(n.keyType._def,e);return{...t,propertyNames:l}}}return t}function uy(n,e){if(e.mapStrategy==="record")return F0(n,e);const t=he(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=he(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function cy(n){const e=n.values,r=Object.keys(n.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),a=Array.from(new Set(r.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function ly(){return{not:{}}}function hy(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Xa={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function dy(n,e){if(e.target==="openApi3")return N0(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Xa&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((a,s)=>{const i=Xa[s._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((a,s)=>{const i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(s._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===t.length){const a=r.filter((s,i,o)=>o.indexOf(s)===i);return{type:a.length>1?a:a[0],enum:t.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,a)=>[...r,...a._def.values.filter(s=>!r.includes(s))],[])};return N0(n,e)}const N0=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,a)=>he(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function fy(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Xa[n.innerType._def.typeName],nullable:!0}:{type:[Xa[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=he(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=he(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function py(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",O0(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?me(t,"minimum",r.value,r.message,e):me(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),me(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?me(t,"maximum",r.value,r.message,e):me(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),me(t,"maximum",r.value,r.message,e));break;case"multipleOf":me(t,"multipleOf",r.value,r.message,e);break}return t}function my(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":he(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":he(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function gy(n,e){const t=e.target==="openAi",r={type:"object",...Object.entries(n.shape()).reduce((a,[s,i])=>{if(i===void 0||i._def===void 0)return a;let o=i.isOptional();o&&t&&(i instanceof At&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);const c=he(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return c===void 0?a:{properties:{...a.properties,[s]:c},required:o?a.required:[...a.required,s]}},{properties:{},required:[]}),additionalProperties:my(n,e)};return r.required.length||delete r.required,r}const yy=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return he(n.innerType._def,e);const t=he(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},xy=(n,e)=>{if(e.pipeStrategy==="input")return he(n.in._def,e);if(e.pipeStrategy==="output")return he(n.out._def,e);const t=he(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=he(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(a=>a!==void 0)}};function by(n,e){return he(n.type._def,e)}function _y(n,e){const r={type:"array",uniqueItems:!0,items:he(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&me(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&me(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function vy(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>he(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:he(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>he(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function wy(){return{not:{}}}function Ay(){return{}}const Ey=(n,e)=>he(n.innerType._def,e);function he(n,e,t=!1){var i;const r=e.seen.get(n);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,n,e,r,t);if(o!==Vg)return o}if(r&&!t){const o=Cy(r,e);if(o!==void 0)return o}const a={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,a);const s=ky(n,n.typeName,e);return s&&Sy(n,e,s),a.jsonSchema=s,s}const Cy=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:Py(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},Py=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},ky=(n,e,t)=>{switch(e){case H.ZodString:return R0(n,t);case H.ZodNumber:return py(n,t);case H.ZodObject:return gy(n,t);case H.ZodBigInt:return Yg(n,t);case H.ZodBoolean:return Xg();case H.ZodDate:return T0(n,t);case H.ZodUndefined:return wy();case H.ZodNull:return hy(t);case H.ZodArray:return Gg(n,t);case H.ZodUnion:case H.ZodDiscriminatedUnion:return dy(n,t);case H.ZodIntersection:return ay(n,t);case H.ZodTuple:return vy(n,t);case H.ZodRecord:return F0(n,t);case H.ZodLiteral:return sy(n,t);case H.ZodEnum:return ry(n);case H.ZodNativeEnum:return cy(n);case H.ZodNullable:return fy(n,t);case H.ZodOptional:return yy(n,t);case H.ZodMap:return uy(n,t);case H.ZodSet:return _y(n,t);case H.ZodLazy:return he(n.getter()._def,t);case H.ZodPromise:return by(n,t);case H.ZodNaN:case H.ZodNever:return ly();case H.ZodEffects:return ty(n,t);case H.ZodAny:return Zg();case H.ZodUnknown:return Ay();case H.ZodDefault:return ey(n,t);case H.ZodBranded:return B0(n,t);case H.ZodReadonly:return Ey(n,t);case H.ZodCatch:return Jg(n,t);case H.ZodPipeline:return xy(n,t);case H.ZodFunction:case H.ZodVoid:case H.ZodSymbol:return;default:return(r=>{})()}},Sy=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),Iy=(n,e)=>{const t=Wg(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:he(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,u]},!0)??{}}),{}):void 0,a=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=he(n._def,a===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,a]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const o=a===void 0?r?{...s,[t.definitionPath]:r}:s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:{...r,[a]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function j0(n){return typeof n>"u"||n===null}function Oy(n){return typeof n=="object"&&n!==null}function By(n){return Array.isArray(n)?n:j0(n)?[]:[n]}function Ty(n,e){var t,r,a,s;if(e)for(s=Object.keys(e),t=0,r=s.length;t<r;t+=1)a=s[t],n[a]=e[a];return n}function Ry(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}function Dy(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var Fy=j0,Ny=Oy,jy=By,$y=Ry,Ly=Dy,zy=Ty,Ro={isNothing:Fy,isObject:Ny,toArray:jy,repeat:$y,isNegativeZero:Ly,extend:zy};function $0(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}function yn(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=$0(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}yn.prototype=Object.create(Error.prototype),yn.prototype.constructor=yn,yn.prototype.toString=function(e){return this.name+": "+$0(this,e)};var ar=yn,My=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Uy=["scalar","sequence","mapping"];function Ky(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}function Hy(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(My.indexOf(t)===-1)throw new ar('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=Ky(e.styleAliases||null),Uy.indexOf(this.kind)===-1)throw new ar('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var Ue=Hy;function L0(n,e){var t=[];return n[e].forEach(function(r){var a=t.length;t.forEach(function(s,i){s.tag===r.tag&&s.kind===r.kind&&s.multi===r.multi&&(a=i)}),t[a]=r}),t}function Vy(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(a){a.multi?(n.multi[a.kind].push(a),n.multi.fallback.push(a)):n[a.kind][a.tag]=n.fallback[a.tag]=a}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}function Do(n){return this.extend(n)}Do.prototype.extend=function(e){var t=[],r=[];if(e instanceof Ue)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new ar("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(s){if(!(s instanceof Ue))throw new ar("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new ar("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new ar("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(s){if(!(s instanceof Ue))throw new ar("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var a=Object.create(Do.prototype);return a.implicit=(this.implicit||[]).concat(t),a.explicit=(this.explicit||[]).concat(r),a.compiledImplicit=L0(a,"implicit"),a.compiledExplicit=L0(a,"explicit"),a.compiledTypeMap=Vy(a.compiledImplicit,a.compiledExplicit),a};var qy=Do,Wy=new Ue("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),Zy=new Ue("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),Gy=new Ue("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),Yy=new qy({explicit:[Wy,Zy,Gy]});function Xy(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function Jy(){return null}function Qy(n){return n===null}var ex=new Ue("tag:yaml.org,2002:null",{kind:"scalar",resolve:Xy,construct:Jy,predicate:Qy,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function tx(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function rx(n){return n==="true"||n==="True"||n==="TRUE"}function nx(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var ax=new Ue("tag:yaml.org,2002:bool",{kind:"scalar",resolve:tx,construct:rx,predicate:nx,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function sx(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function ix(n){return 48<=n&&n<=55}function ox(n){return 48<=n&&n<=57}function ux(n){if(n===null)return!1;var e=n.length,t=0,r=!1,a;if(!e)return!1;if(a=n[t],(a==="-"||a==="+")&&(a=n[++t]),a==="0"){if(t+1===e)return!0;if(a=n[++t],a==="b"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(a!=="0"&&a!=="1")return!1;r=!0}return r&&a!=="_"}if(a==="x"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(!sx(n.charCodeAt(t)))return!1;r=!0}return r&&a!=="_"}if(a==="o"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(!ix(n.charCodeAt(t)))return!1;r=!0}return r&&a!=="_"}}if(a==="_")return!1;for(;t<e;t++)if(a=n[t],a!=="_"){if(!ox(n.charCodeAt(t)))return!1;r=!0}return!(!r||a==="_")}function cx(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function lx(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!Ro.isNegativeZero(n)}var hx=new Ue("tag:yaml.org,2002:int",{kind:"scalar",resolve:ux,construct:cx,predicate:lx,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),dx=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function fx(n){return!(n===null||!dx.test(n)||n[n.length-1]==="_")}function px(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var mx=/^[-+]?[0-9]+e/;function gx(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Ro.isNegativeZero(n))return"-0.0";return t=n.toString(10),mx.test(t)?t.replace("e",".e"):t}function yx(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||Ro.isNegativeZero(n))}var xx=new Ue("tag:yaml.org,2002:float",{kind:"scalar",resolve:fx,construct:px,predicate:yx,represent:gx,defaultStyle:"lowercase"}),bx=Yy.extend({implicit:[ex,ax,hx,xx]}),_x=bx,z0=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),M0=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function vx(n){return n===null?!1:z0.exec(n)!==null||M0.exec(n)!==null}function wx(n){var e,t,r,a,s,i,o,c=0,u=null,l,f,h;if(e=z0.exec(n),e===null&&(e=M0.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,a=+e[3],!e[4])return new Date(Date.UTC(t,r,a));if(s=+e[4],i=+e[5],o=+e[6],e[7]){for(c=e[7].slice(0,3);c.length<3;)c+="0";c=+c}return e[9]&&(l=+e[10],f=+(e[11]||0),u=(l*60+f)*6e4,e[9]==="-"&&(u=-u)),h=new Date(Date.UTC(t,r,a,s,i,o,c)),u&&h.setTime(h.getTime()-u),h}function Ax(n){return n.toISOString()}var Ex=new Ue("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:vx,construct:wx,instanceOf:Date,represent:Ax});function Cx(n){return n==="<<"||n===null}var Px=new Ue("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Cx}),Fo=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function kx(n){if(n===null)return!1;var e,t,r=0,a=n.length,s=Fo;for(t=0;t<a;t++)if(e=s.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function Sx(n){var e,t,r=n.replace(/[\r\n=]/g,""),a=r.length,s=Fo,i=0,o=[];for(e=0;e<a;e++)e%4===0&&e&&(o.push(i>>16&255),o.push(i>>8&255),o.push(i&255)),i=i<<6|s.indexOf(r.charAt(e));return t=a%4*6,t===0?(o.push(i>>16&255),o.push(i>>8&255),o.push(i&255)):t===18?(o.push(i>>10&255),o.push(i>>2&255)):t===12&&o.push(i>>4&255),new Uint8Array(o)}function Ix(n){var e="",t=0,r,a,s=n.length,i=Fo;for(r=0;r<s;r++)r%3===0&&r&&(e+=i[t>>18&63],e+=i[t>>12&63],e+=i[t>>6&63],e+=i[t&63]),t=(t<<8)+n[r];return a=s%3,a===0?(e+=i[t>>18&63],e+=i[t>>12&63],e+=i[t>>6&63],e+=i[t&63]):a===2?(e+=i[t>>10&63],e+=i[t>>4&63],e+=i[t<<2&63],e+=i[64]):a===1&&(e+=i[t>>2&63],e+=i[t<<4&63],e+=i[64],e+=i[64]),e}function Ox(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var Bx=new Ue("tag:yaml.org,2002:binary",{kind:"scalar",resolve:kx,construct:Sx,predicate:Ox,represent:Ix}),Tx=Object.prototype.hasOwnProperty,Rx=Object.prototype.toString;function Dx(n){if(n===null)return!0;var e=[],t,r,a,s,i,o=n;for(t=0,r=o.length;t<r;t+=1){if(a=o[t],i=!1,Rx.call(a)!=="[object Object]")return!1;for(s in a)if(Tx.call(a,s))if(!i)i=!0;else return!1;if(!i)return!1;if(e.indexOf(s)===-1)e.push(s);else return!1}return!0}function Fx(n){return n!==null?n:[]}var Nx=new Ue("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Dx,construct:Fx}),jx=Object.prototype.toString;function $x(n){if(n===null)return!0;var e,t,r,a,s,i=n;for(s=new Array(i.length),e=0,t=i.length;e<t;e+=1){if(r=i[e],jx.call(r)!=="[object Object]"||(a=Object.keys(r),a.length!==1))return!1;s[e]=[a[0],r[a[0]]]}return!0}function Lx(n){if(n===null)return[];var e,t,r,a,s,i=n;for(s=new Array(i.length),e=0,t=i.length;e<t;e+=1)r=i[e],a=Object.keys(r),s[e]=[a[0],r[a[0]]];return s}var zx=new Ue("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:$x,construct:Lx}),Mx=Object.prototype.hasOwnProperty;function Ux(n){if(n===null)return!0;var e,t=n;for(e in t)if(Mx.call(t,e)&&t[e]!==null)return!1;return!0}function Kx(n){return n!==null?n:{}}var Hx=new Ue("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ux,construct:Kx});_x.extend({implicit:[Ex,Px],explicit:[Bx,Nx,zx,Hx]});function U0(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"":n===95?" ":n===76?"\u2028":n===80?"\u2029":""}for(var Vx=new Array(256),qx=new Array(256),Br=0;Br<256;Br++)Vx[Br]=U0(Br)?1:0,qx[Br]=U0(Br);function Wx(n){return{name:n.name,description:n.description,parameters:Iy(n.schema)}}class xn extends fo{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=xn._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===xn.prototype._streamResponseChunks)yield this.invoke(e,t);else{const a=xn._convertInputToPromptValue(e).toChatMessages(),[s,i]=this._separateRunnableConfigFromCallOptions(t),o=await Le.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),c={options:i,invocation_params:this==null?void 0:this.invocationParams(i)},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[a],void 0,void 0,c));let l;try{for await(const f of this._streamResponseChunks(a,i,u==null?void 0:u[0]))yield f.message,l?l=l.concat(f):l=f}catch(f){throw await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMError(f))),f}await Promise.all((u??[]).map(f=>f==null?void 0:f.handleLLMEnd({generations:[[l]]})))}}async generate(e,t,r){var w;let a;Array.isArray(t)?a={stop:t}:a=t;const s=e.map(d=>d.map(Ba)),[i,o]=this._separateRunnableConfigFromCallOptions(a),c=await Le.configure(i.callbacks??r,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(a)},l=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),s,void 0,void 0,u)),f=await Promise.allSettled(s.map((d,k)=>this._generate(d,{...o,promptIndex:k},l==null?void 0:l[k]))),h=[],x=[];await Promise.all(f.map(async(d,k)=>{var g,y;if(d.status==="fulfilled"){const _=d.value;return h[k]=_.generations,x[k]=_.llmOutput,(g=l==null?void 0:l[k])==null?void 0:g.handleLLMEnd({generations:[_.generations],llmOutput:_.llmOutput})}else return await((y=l==null?void 0:l[k])==null?void 0:y.handleLLMError(d.reason)),Promise.reject(d.reason)}));const m={generations:h,llmOutput:x.length?(w=this._combineLLMOutput)==null?void 0:w.call(this,...x):void 0};return Object.defineProperty(m,so,{value:l?{runIds:l==null?void 0:l.map(d=>d.runId)}:void 0,configurable:!0}),m}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const a=e.map(s=>s.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(Ba)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const a=new Bt(e);return(await this.call([a],t,r)).content}}function Zx(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&console.warn(`Unknown message role: ${n.role}`),n.role}function No(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":{if(!Oa.isInstance(n))throw new Error("Invalid generic chat message");return Zx(n)}default:throw new Error(`Unknown message type: ${e}`)}}function Gx(n){switch(n.role){case"user":return new Bt(n.content||"");case"assistant":return new er(n.content||"",{function_call:n.function_call});case"system":return new io(n.content||"");default:return new Oa(n.content||"",n.role??"unknown")}}function Yx(n,e){const t=n.role??e,r=n.content??"";let a;return n.function_call?a={function_call:n.function_call}:a={},t==="user"?new Pa({content:r}):t==="assistant"?new ka({content:r,additional_kwargs:a}):t==="system"?new Sa({content:r}):t==="function"?new Ia({content:r,additional_kwargs:a,name:n.name}):new Ta({content:r,role:t})}class Xx extends xn{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,s,i,o,c,u,l;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ae("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ae("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ae("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??ae("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ae("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ae("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??ae("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((a=e==null?void 0:e.configuration)==null?void 0:a.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((s=t==null?void 0:t.baseOptions)==null?void 0:s.headers)??((o=(i=e==null?void 0:e.configuration)==null?void 0:i.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,functions:(e==null?void 0:e.functions)??(e!=null&&e.tools?e==null?void 0:e.tools.map(Wx):void 0),function_call:e==null?void 0:e.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c;const a=e.map(u=>({role:No(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call})),s={...this.invocationParams(t),messages:a,stream:!0};let i;const o=await this.completionWithRetry(s,t);for await(const u of o){const l=u==null?void 0:u.choices[0];if(!l)continue;const{delta:f}=l,h=Yx(f,i);i=f.role??i;const x={prompt:t.promptIndex??0,completion:l.index??0},m=new oo({message:h,text:h.content,generationInfo:x});yield m,r==null||r.handleLLMNewToken(m.text??"",x,void 0,void 0,void 0,{chunk:m})}if((c=t.signal)!=null&&c.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,c;const a={},s=this.invocationParams(t),i=e.map(u=>({role:No(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call}));if(s.stream){const u=await this._streamResponseChunks(e,t,r),l={};for await(const h of u){const x=((o=h.generationInfo)==null?void 0:o.completion)??0;l[x]===void 0?l[x]=h:l[x]=l[x].concat(h)}return{generations:Object.entries(l).sort(([h],[x])=>parseInt(h,10)-parseInt(x,10)).map(([h,x])=>x)}}else{const u=await this.completionWithRetry({...s,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:l,prompt_tokens:f,total_tokens:h}=(u==null?void 0:u.usage)??{};l&&(a.completionTokens=(a.completionTokens??0)+l),f&&(a.promptTokens=(a.promptTokens??0)+f),h&&(a.totalTokens=(a.totalTokens??0)+h);const x=[];for(const m of(u==null?void 0:u.choices)??[]){const d={text:((c=m.message)==null?void 0:c.content)??"",message:Gx(m.message??{role:"assistant"})};m.finish_reason&&(d.generationInfo={finish_reason:m.finish_reason}),x.push(d)}return{generations:x,llmOutput:{tokenUsage:a}}}}async getNumTokensFromMessages(e){let t=0,r=0,a=0;tn(this.modelName)==="gpt-3.5-turbo"?(r=4,a=-1):tn(this.modelName).startsWith("gpt-4")&&(r=3,a=1);const s=await Promise.all(e.map(async i=>{const o=await this.getNumTokens(i.content),c=await this.getNumTokens(No(i)),u=i.name!==void 0?a+await this.getNumTokens(i.name):0,l=o+r+c+u;return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:s}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw Ca(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=Ea(r),s={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Ce(s)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}const Jx=Object.freeze(Object.defineProperty({__proto__:null,ChatOpenAI:Xx},Symbol.toStringTag,{value:"Module"})),Qx=`Write a concise summary of the following content from a webpage:


"{text}"


CONCISE SUMMARY:`,eb=new be({template:Qx,inputVariables:["text"]}),Ja=n=>`embed-${n}`,Qa=n=>`chatlog-${n||""}`,Tr="pageInfo",K0="chat_history";let jo;jo=chrome.storage;const H0=async()=>{const n=await jo.local.get("key");return n?n.key:null},tb=async n=>{await jo.local.set({key:n})};class $o{constructor(e){ke(this,"storage");ke(this,"key");ke(this,"openai");ke(this,"vectorStore");ke(this,"chain");ke(this,"sumChain");ke(this,"memory");ke(this,"targetLinkHash",null);let t;e?t=chrome.storage:t=new um,this.storage=t}async init(e){this.key!==e&&(this.key=e,await this.initOpenAI())}async info(){return{quota:this.storage.local.QUOTA_BYTES,size:await this.storage.local.getBytesInUse()}}async search(e,t,r){var a;return await((a=this.vectorStore)==null?void 0:a.similaritySearchWithScore(e,t,r))}async query(e){var a;const t=await((a=this.chain)==null?void 0:a.call({question:e}));return(t==null?void 0:t.text)||""}async initOpenAI(e){let t=e?Ot.md5(e):null;const r=new am({openAIApiKey:this.key}),a=new f0({openAIApiKey:this.key,modelName:"gpt-3.5-turbo-instruct"});this.vectorStore=new ao(r);let s=this.vectorStore.asRetriever();t?(this.targetLinkHash=t,s=this.vectorStore.asRetriever({filter:o=>o.metadata.linkHash===t})):this.targetLinkHash=null,this.memory=await this.loadChatHistory(),await this.loadMemoryVectorStore();const i=bo.fromLLM(a,s,{memory:this.memory});this.chain=i,this.sumChain=_g(a,{type:"map_reduce",combinePrompt:eb})}async getChatLogByKey(e){let t=[];const r=await this.storage.local.get(e);return r&&r[e]&&(t=r[e]),t}async getChatLog(e){const t=Qa(e?Ot.md5(e):null);return await this.getChatLogByKey(t)}async addChatLog(e,t){const r=await this.getChatLog(t);r.push(e);const a=Qa(t?Ot.md5(t):null);await this.storage.local.set({[a]:r})}async getPageList(e){let t={};const a=(await this.storage.local.get(Tr))[Tr]||{};let s=[];if(e){const i=Ot.md5(e),o=a[i];o&&s.push(o)}else s=Object.values(a);for(let i=0;i<s.length;i++){const o=s[i],c=Ja(o.linkHash),u=await this.storage.local.getBytesInUse(c);t[o.linkHash]={...o,size:u}}return t}async summary(e){var r;const t=await((r=this.sumChain)==null?void 0:r.call({input_documents:e}));return(t==null?void 0:t.text)||""}async addPage(e,t,r){const a=Ot.md5(e),s={link:e,linkHash:a,title:t},i=await Ot.text2docs(r),o=await this.content2Vectors(s,i);o.length>0&&this.addVectorData(o);const c=await this.summary(i.slice(0,2)),u={link:e,linkHash:a,title:t,summary:c,ts:Ot.currTs()},f=(await this.storage.local.get(Tr))[Tr]||{};f[a]=u,await this.storage.local.set({[Tr]:f});const h=Ja(a);return await this.storage.local.set({[h]:o}),c}async delPage(e){if(!e)return;const t=Ot.md5(e),r=await this.getPageList();delete r[t],await this.storage.local.set({[Tr]:r}),await this.storage.local.remove(Ja(t)),await this.storage.local.remove(Qa(t))}async text2Vector(e){return this.vectorStore?this.vectorStore.embeddings.embedQuery(e):void 0}async content2Vectors(e,t){const r=[];for(let a=0;a<t.length;a++){const s=t[a],i=await this.text2Vector(s.pageContent);if(i){const o={embedding:i,content:s.pageContent,metadata:e};r.push(o)}}return r}async addVectorData(e){const t=this.vectorStore;t&&t.addVectors(e.map(r=>r.embedding),e.map(r=>({pageContent:r.content,metadata:r.metadata})))}async loadMemoryVectorStore(){if(!this.vectorStore)return;const t=await this.getPageList(),r=Object.values(t);for(let a=0;a<r.length;a++){const i=r[a].linkHash;if(!i||this.targetLinkHash&&this.targetLinkHash!==i)continue;const o=Ja(i),c=await this.storage.local.get(o);if(!c[o])continue;const u=c[o];this.addVectorData(u)}}async loadChatHistory(){let e=new g0({memoryKey:K0});const t=Qa(this.targetLinkHash),a=(await this.getChatLogByKey(t)).map(s=>s.isBot?new er(s.msg):new Bt(s.msg));return e=new g0({memoryKey:K0,chatHistory:new m0(a)}),e}}let bn,sr;const V0=async n=>{bn=new $o(!0),await bn.init(n),await bn.initOpenAI(),sr=new $o(!1),await sr.init(n)},rb=async()=>{const n=sr.key;n&&(sr=new $o(!1),await sr.init(n))},nb=async n=>{let e=n.temp?sr:bn;if(!e){const t=await H0();t&&(V0(t),e=n.temp?sr:bn)}return e},ab=(n,e,t)=>{console.log(`[${n}]`);for(let r in e)console.log(`  ->${r}: ${e[r]}`);for(let r in t)console.log(`  <-${r}: ${t[r]}`)},sb=async n=>{let e={ok:!1};if(n.type==="setKey"){const t=await Ot.testOpenAIKey(n.key);t?e.error=t:(await V0(n.key),await tb(n.key),e.ok=!0)}else{const t=await nb(n);if(t)switch(n.type){case"chat":t?(e.ok=!0,e.msg=await t.query(n.query)):e.error="asst not ready";break;case"getChatLog":const r=await t.getChatLog(n.link);e.ok=!0,e.data=r;break;case"addChatLog":await t.addChatLog(n.log,n.link),e.ok=!0;break;case"getKey":const a=await H0();e.ok=!!a,e.data=a;break;case"handshake":e.ok=!!t;break;case"addPage":n.temp&&await rb();const s=await t.addPage(n.link,n.title,n.content);e.ok=!0,e.summary=s;break;case"delPage":await t.delPage(n.link),e.ok=!0;break;case"setScope":await t.initOpenAI(n.scope),e.ok=!0;break;case"getPageList":const i=await t.getPageList(n.link);e.ok=!0,e.data=i;break;case"log":console.log("[LOG] ",n),e.ok=!0;break;case"info":const o=await t.info();e.ok=!0,e.data=o;break}else e.error="asst not ready"}return e},ib=async(n,e,t)=>{let r={ok:!1};try{r=await sb(n)}catch(a){r.error=a.toString()}ab(n.type,n,r),t(r)};(async()=>{chrome.runtime.onMessage.addListener((n,e,t)=>(ib(n,e,t),!0))})()});
