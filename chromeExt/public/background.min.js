(function(J){typeof define=="function"&&define.amd?define(J):J()})(function(){"use strict";var tg=Object.defineProperty;var rg=(J,Ke,Ct)=>Ke in J?tg(J,Ke,{enumerable:!0,configurable:!0,writable:!0,value:Ct}):J[Ke]=Ct;var Ee=(J,Ke,Ct)=>(rg(J,typeof Ke!="symbol"?Ke+"":Ke,Ct),Ct);var J=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ke(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ct(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var a=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return n[r]}})}),t}var ro={exports:{}};function sr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ta={exports:{}};const Al=Ct(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var no;function se(){return no||(no=1,function(n,e){(function(t,r){n.exports=r()})(J,function(){var t=t||function(r,a){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof J<"u"&&J.crypto&&(i=J.crypto),!i&&typeof sr=="function")try{i=Al}catch{}var s=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function b(){}return function(g){var v;return b.prototype=g,v=new b,b.prototype=null,v}}(),c={},u=c.lib={},l=u.Base=function(){return{extend:function(b){var g=o(this);return b&&g.mixIn(b),(!g.hasOwnProperty("init")||this.init===g.init)&&(g.init=function(){g.$super.init.apply(this,arguments)}),g.init.prototype=g,g.$super=this,g},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var g in b)b.hasOwnProperty(g)&&(this[g]=b[g]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),m=u.WordArray=l.extend({init:function(b,g){b=this.words=b||[],g!=a?this.sigBytes=g:this.sigBytes=b.length*4},toString:function(b){return(b||y).stringify(this)},concat:function(b){var g=this.words,v=b.words,O=this.sigBytes,w=b.sigBytes;if(this.clamp(),O%4)for(var k=0;k<w;k++){var x=v[k>>>2]>>>24-k%4*8&255;g[O+k>>>2]|=x<<24-(O+k)%4*8}else for(var E=0;E<w;E+=4)g[O+E>>>2]=v[E>>>2];return this.sigBytes+=w,this},clamp:function(){var b=this.words,g=this.sigBytes;b[g>>>2]&=4294967295<<32-g%4*8,b.length=r.ceil(g/4)},clone:function(){var b=l.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var g=[],v=0;v<b;v+=4)g.push(s());return new m.init(g,b)}}),h=c.enc={},y=h.Hex={stringify:function(b){for(var g=b.words,v=b.sigBytes,O=[],w=0;w<v;w++){var k=g[w>>>2]>>>24-w%4*8&255;O.push((k>>>4).toString(16)),O.push((k&15).toString(16))}return O.join("")},parse:function(b){for(var g=b.length,v=[],O=0;O<g;O+=2)v[O>>>3]|=parseInt(b.substr(O,2),16)<<24-O%8*4;return new m.init(v,g/2)}},p=h.Latin1={stringify:function(b){for(var g=b.words,v=b.sigBytes,O=[],w=0;w<v;w++){var k=g[w>>>2]>>>24-w%4*8&255;O.push(String.fromCharCode(k))}return O.join("")},parse:function(b){for(var g=b.length,v=[],O=0;O<g;O++)v[O>>>2]|=(b.charCodeAt(O)&255)<<24-O%4*8;return new m.init(v,g)}},A=h.Utf8={stringify:function(b){try{return decodeURIComponent(escape(p.stringify(b)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(b){return p.parse(unescape(encodeURIComponent(b)))}},f=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new m.init,this._nDataBytes=0},_append:function(b){typeof b=="string"&&(b=A.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var g,v=this._data,O=v.words,w=v.sigBytes,k=this.blockSize,x=k*4,E=w/x;b?E=r.ceil(E):E=r.max((E|0)-this._minBufferSize,0);var d=E*k,C=r.min(d*4,w);if(d){for(var S=0;S<d;S+=k)this._doProcessBlock(O,S);g=O.splice(0,d),v.sigBytes-=C}return new m.init(g,C)},clone:function(){var b=l.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0});u.Hasher=f.extend({cfg:l.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){b&&this._append(b);var g=this._doFinalize();return g},blockSize:16,_createHelper:function(b){return function(g,v){return new b.init(v).finalize(g)}},_createHmacHelper:function(b){return function(g,v){return new P.HMAC.init(b,v).finalize(g)}}});var P=c.algo={};return c}(Math);return t})}(Ta)),Ta.exports}var Da={exports:{}},ao;function Lr(){return ao||(ao=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(r){var a=t,i=a.lib,s=i.Base,o=i.WordArray,c=a.x64={};c.Word=s.extend({init:function(u,l){this.high=u,this.low=l}}),c.WordArray=s.extend({init:function(u,l){u=this.words=u||[],l!=r?this.sigBytes=l:this.sigBytes=u.length*8},toX32:function(){for(var u=this.words,l=u.length,m=[],h=0;h<l;h++){var y=u[h];m.push(y.high),m.push(y.low)}return o.create(m,this.sigBytes)},clone:function(){for(var u=s.clone.call(this),l=u.words=this.words.slice(0),m=l.length,h=0;h<m;h++)l[h]=l[h].clone();return u}})}(),t})}(Da)),Da.exports}var Ra={exports:{}},io;function El(){return io||(io=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,a=r.lib,i=a.WordArray,s=i.init,o=i.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var u=c.byteLength,l=[],m=0;m<u;m++)l[m>>>2]|=c[m]<<24-m%4*8;s.call(this,l,u)}else s.apply(this,arguments)};o.prototype=i}}(),t.lib.WordArray})}(Ra)),Ra.exports}var Fa={exports:{}},so;function Cl(){return so||(so=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.enc;s.Utf16=s.Utf16BE={stringify:function(c){for(var u=c.words,l=c.sigBytes,m=[],h=0;h<l;h+=2){var y=u[h>>>2]>>>16-h%4*8&65535;m.push(String.fromCharCode(y))}return m.join("")},parse:function(c){for(var u=c.length,l=[],m=0;m<u;m++)l[m>>>1]|=c.charCodeAt(m)<<16-m%2*16;return i.create(l,u*2)}},s.Utf16LE={stringify:function(c){for(var u=c.words,l=c.sigBytes,m=[],h=0;h<l;h+=2){var y=o(u[h>>>2]>>>16-h%4*8&65535);m.push(String.fromCharCode(y))}return m.join("")},parse:function(c){for(var u=c.length,l=[],m=0;m<u;m++)l[m>>>1]|=o(c.charCodeAt(m)<<16-m%2*16);return i.create(l,u*2)}};function o(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(Fa)),Fa.exports}var Na={exports:{}},oo;function Pt(){return oo||(oo=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.enc;s.Base64={stringify:function(c){var u=c.words,l=c.sigBytes,m=this._map;c.clamp();for(var h=[],y=0;y<l;y+=3)for(var p=u[y>>>2]>>>24-y%4*8&255,A=u[y+1>>>2]>>>24-(y+1)%4*8&255,f=u[y+2>>>2]>>>24-(y+2)%4*8&255,P=p<<16|A<<8|f,b=0;b<4&&y+b*.75<l;b++)h.push(m.charAt(P>>>6*(3-b)&63));var g=m.charAt(64);if(g)for(;h.length%4;)h.push(g);return h.join("")},parse:function(c){var u=c.length,l=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var h=0;h<l.length;h++)m[l.charCodeAt(h)]=h}var y=l.charAt(64);if(y){var p=c.indexOf(y);p!==-1&&(u=p)}return o(c,u,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function o(c,u,l){for(var m=[],h=0,y=0;y<u;y++)if(y%4){var p=l[c.charCodeAt(y-1)]<<y%4*2,A=l[c.charCodeAt(y)]>>>6-y%4*2,f=p|A;m[h>>>2]|=f<<24-h%4*8,h++}return i.create(m,h)}}(),t.enc.Base64})}(Na)),Na.exports}var ja={exports:{}},uo;function Pl(){return uo||(uo=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.enc;s.Base64url={stringify:function(c,u){u===void 0&&(u=!0);var l=c.words,m=c.sigBytes,h=u?this._safe_map:this._map;c.clamp();for(var y=[],p=0;p<m;p+=3)for(var A=l[p>>>2]>>>24-p%4*8&255,f=l[p+1>>>2]>>>24-(p+1)%4*8&255,P=l[p+2>>>2]>>>24-(p+2)%4*8&255,b=A<<16|f<<8|P,g=0;g<4&&p+g*.75<m;g++)y.push(h.charAt(b>>>6*(3-g)&63));var v=h.charAt(64);if(v)for(;y.length%4;)y.push(v);return y.join("")},parse:function(c,u){u===void 0&&(u=!0);var l=c.length,m=u?this._safe_map:this._map,h=this._reverseMap;if(!h){h=this._reverseMap=[];for(var y=0;y<m.length;y++)h[m.charCodeAt(y)]=y}var p=m.charAt(64);if(p){var A=c.indexOf(p);A!==-1&&(l=A)}return o(c,l,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function o(c,u,l){for(var m=[],h=0,y=0;y<u;y++)if(y%4){var p=l[c.charCodeAt(y-1)]<<y%4*2,A=l[c.charCodeAt(y)]>>>6-y%4*2,f=p|A;m[h>>>2]|=f<<24-h%4*8,h++}return i.create(m,h)}}(),t.enc.Base64url})}(ja)),ja.exports}var La={exports:{}},co;function kt(){return co||(co=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.algo,u=[];(function(){for(var A=0;A<64;A++)u[A]=r.abs(r.sin(A+1))*4294967296|0})();var l=c.MD5=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(A,f){for(var P=0;P<16;P++){var b=f+P,g=A[b];A[b]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}var v=this._hash.words,O=A[f+0],w=A[f+1],k=A[f+2],x=A[f+3],E=A[f+4],d=A[f+5],C=A[f+6],S=A[f+7],T=A[f+8],N=A[f+9],U=A[f+10],L=A[f+11],Y=A[f+12],Q=A[f+13],X=A[f+14],W=A[f+15],D=v[0],$=v[1],z=v[2],j=v[3];D=m(D,$,z,j,O,7,u[0]),j=m(j,D,$,z,w,12,u[1]),z=m(z,j,D,$,k,17,u[2]),$=m($,z,j,D,x,22,u[3]),D=m(D,$,z,j,E,7,u[4]),j=m(j,D,$,z,d,12,u[5]),z=m(z,j,D,$,C,17,u[6]),$=m($,z,j,D,S,22,u[7]),D=m(D,$,z,j,T,7,u[8]),j=m(j,D,$,z,N,12,u[9]),z=m(z,j,D,$,U,17,u[10]),$=m($,z,j,D,L,22,u[11]),D=m(D,$,z,j,Y,7,u[12]),j=m(j,D,$,z,Q,12,u[13]),z=m(z,j,D,$,X,17,u[14]),$=m($,z,j,D,W,22,u[15]),D=h(D,$,z,j,w,5,u[16]),j=h(j,D,$,z,C,9,u[17]),z=h(z,j,D,$,L,14,u[18]),$=h($,z,j,D,O,20,u[19]),D=h(D,$,z,j,d,5,u[20]),j=h(j,D,$,z,U,9,u[21]),z=h(z,j,D,$,W,14,u[22]),$=h($,z,j,D,E,20,u[23]),D=h(D,$,z,j,N,5,u[24]),j=h(j,D,$,z,X,9,u[25]),z=h(z,j,D,$,x,14,u[26]),$=h($,z,j,D,T,20,u[27]),D=h(D,$,z,j,Q,5,u[28]),j=h(j,D,$,z,k,9,u[29]),z=h(z,j,D,$,S,14,u[30]),$=h($,z,j,D,Y,20,u[31]),D=y(D,$,z,j,d,4,u[32]),j=y(j,D,$,z,T,11,u[33]),z=y(z,j,D,$,L,16,u[34]),$=y($,z,j,D,X,23,u[35]),D=y(D,$,z,j,w,4,u[36]),j=y(j,D,$,z,E,11,u[37]),z=y(z,j,D,$,S,16,u[38]),$=y($,z,j,D,U,23,u[39]),D=y(D,$,z,j,Q,4,u[40]),j=y(j,D,$,z,O,11,u[41]),z=y(z,j,D,$,x,16,u[42]),$=y($,z,j,D,C,23,u[43]),D=y(D,$,z,j,N,4,u[44]),j=y(j,D,$,z,Y,11,u[45]),z=y(z,j,D,$,W,16,u[46]),$=y($,z,j,D,k,23,u[47]),D=p(D,$,z,j,O,6,u[48]),j=p(j,D,$,z,S,10,u[49]),z=p(z,j,D,$,X,15,u[50]),$=p($,z,j,D,d,21,u[51]),D=p(D,$,z,j,Y,6,u[52]),j=p(j,D,$,z,x,10,u[53]),z=p(z,j,D,$,U,15,u[54]),$=p($,z,j,D,w,21,u[55]),D=p(D,$,z,j,T,6,u[56]),j=p(j,D,$,z,W,10,u[57]),z=p(z,j,D,$,C,15,u[58]),$=p($,z,j,D,Q,21,u[59]),D=p(D,$,z,j,E,6,u[60]),j=p(j,D,$,z,L,10,u[61]),z=p(z,j,D,$,k,15,u[62]),$=p($,z,j,D,N,21,u[63]),v[0]=v[0]+D|0,v[1]=v[1]+$|0,v[2]=v[2]+z|0,v[3]=v[3]+j|0},_doFinalize:function(){var A=this._data,f=A.words,P=this._nDataBytes*8,b=A.sigBytes*8;f[b>>>5]|=128<<24-b%32;var g=r.floor(P/4294967296),v=P;f[(b+64>>>9<<4)+15]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,f[(b+64>>>9<<4)+14]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,A.sigBytes=(f.length+1)*4,this._process();for(var O=this._hash,w=O.words,k=0;k<4;k++){var x=w[k];w[k]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360}return O},clone:function(){var A=o.clone.call(this);return A._hash=this._hash.clone(),A}});function m(A,f,P,b,g,v,O){var w=A+(f&P|~f&b)+g+O;return(w<<v|w>>>32-v)+f}function h(A,f,P,b,g,v,O){var w=A+(f&b|P&~b)+g+O;return(w<<v|w>>>32-v)+f}function y(A,f,P,b,g,v,O){var w=A+(f^P^b)+g+O;return(w<<v|w>>>32-v)+f}function p(A,f,P,b,g,v,O){var w=A+(P^(f|~b))+g+O;return(w<<v|w>>>32-v)+f}a.MD5=o._createHelper(l),a.HmacMD5=o._createHmacHelper(l)}(Math),t.MD5})}(La)),La.exports}var $a={exports:{}},lo;function ho(){return lo||(lo=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=a.Hasher,o=r.algo,c=[],u=o.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,m){for(var h=this._hash.words,y=h[0],p=h[1],A=h[2],f=h[3],P=h[4],b=0;b<80;b++){if(b<16)c[b]=l[m+b]|0;else{var g=c[b-3]^c[b-8]^c[b-14]^c[b-16];c[b]=g<<1|g>>>31}var v=(y<<5|y>>>27)+P+c[b];b<20?v+=(p&A|~p&f)+1518500249:b<40?v+=(p^A^f)+1859775393:b<60?v+=(p&A|p&f|A&f)-1894007588:v+=(p^A^f)-899497514,P=f,f=A,A=p<<30|p>>>2,p=y,y=v}h[0]=h[0]+y|0,h[1]=h[1]+p|0,h[2]=h[2]+A|0,h[3]=h[3]+f|0,h[4]=h[4]+P|0},_doFinalize:function(){var l=this._data,m=l.words,h=this._nDataBytes*8,y=l.sigBytes*8;return m[y>>>5]|=128<<24-y%32,m[(y+64>>>9<<4)+14]=Math.floor(h/4294967296),m[(y+64>>>9<<4)+15]=h,l.sigBytes=m.length*4,this._process(),this._hash},clone:function(){var l=s.clone.call(this);return l._hash=this._hash.clone(),l}});r.SHA1=s._createHelper(u),r.HmacSHA1=s._createHmacHelper(u)}(),t.SHA1})}($a)),$a.exports}var za={exports:{}},fo;function Ma(){return fo||(fo=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.algo,u=[],l=[];(function(){function y(P){for(var b=r.sqrt(P),g=2;g<=b;g++)if(!(P%g))return!1;return!0}function p(P){return(P-(P|0))*4294967296|0}for(var A=2,f=0;f<64;)y(A)&&(f<8&&(u[f]=p(r.pow(A,1/2))),l[f]=p(r.pow(A,1/3)),f++),A++})();var m=[],h=c.SHA256=o.extend({_doReset:function(){this._hash=new s.init(u.slice(0))},_doProcessBlock:function(y,p){for(var A=this._hash.words,f=A[0],P=A[1],b=A[2],g=A[3],v=A[4],O=A[5],w=A[6],k=A[7],x=0;x<64;x++){if(x<16)m[x]=y[p+x]|0;else{var E=m[x-15],d=(E<<25|E>>>7)^(E<<14|E>>>18)^E>>>3,C=m[x-2],S=(C<<15|C>>>17)^(C<<13|C>>>19)^C>>>10;m[x]=d+m[x-7]+S+m[x-16]}var T=v&O^~v&w,N=f&P^f&b^P&b,U=(f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22),L=(v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25),Y=k+L+T+l[x]+m[x],Q=U+N;k=w,w=O,O=v,v=g+Y|0,g=b,b=P,P=f,f=Y+Q|0}A[0]=A[0]+f|0,A[1]=A[1]+P|0,A[2]=A[2]+b|0,A[3]=A[3]+g|0,A[4]=A[4]+v|0,A[5]=A[5]+O|0,A[6]=A[6]+w|0,A[7]=A[7]+k|0},_doFinalize:function(){var y=this._data,p=y.words,A=this._nDataBytes*8,f=y.sigBytes*8;return p[f>>>5]|=128<<24-f%32,p[(f+64>>>9<<4)+14]=r.floor(A/4294967296),p[(f+64>>>9<<4)+15]=A,y.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var y=o.clone.call(this);return y._hash=this._hash.clone(),y}});a.SHA256=o._createHelper(h),a.HmacSHA256=o._createHmacHelper(h)}(Math),t.SHA256})}(za)),za.exports}var Ua={exports:{}},po;function kl(){return po||(po=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ma())})(J,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=r.algo,o=s.SHA256,c=s.SHA224=o.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=o._doFinalize.call(this);return u.sigBytes-=4,u}});r.SHA224=o._createHelper(c),r.HmacSHA224=o._createHmacHelper(c)}(),t.SHA224})}(Ua)),Ua.exports}var Ka={exports:{}},mo;function xo(){return mo||(mo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Lr())})(J,function(t){return function(){var r=t,a=r.lib,i=a.Hasher,s=r.x64,o=s.Word,c=s.WordArray,u=r.algo;function l(){return o.create.apply(o,arguments)}var m=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],h=[];(function(){for(var p=0;p<80;p++)h[p]=l()})();var y=u.SHA512=i.extend({_doReset:function(){this._hash=new c.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(p,A){for(var f=this._hash.words,P=f[0],b=f[1],g=f[2],v=f[3],O=f[4],w=f[5],k=f[6],x=f[7],E=P.high,d=P.low,C=b.high,S=b.low,T=g.high,N=g.low,U=v.high,L=v.low,Y=O.high,Q=O.low,X=w.high,W=w.low,D=k.high,$=k.low,z=x.high,j=x.low,pe=E,he=d,Be=C,R=S,_=T,I=N,B=U,M=L,F=Y,q=Q,re=X,me=W,ye=D,Te=$,Ie=z,Ae=j,de=0;de<80;de++){var oe,ze,$t=h[de];if(de<16)ze=$t.high=p[A+de*2]|0,oe=$t.low=p[A+de*2+1]|0;else{var ll=h[de-15],ar=ll.high,Fr=ll.low,Ux=(ar>>>1|Fr<<31)^(ar>>>8|Fr<<24)^ar>>>7,hl=(Fr>>>1|ar<<31)^(Fr>>>8|ar<<24)^(Fr>>>7|ar<<25),dl=h[de-2],ir=dl.high,Nr=dl.low,Kx=(ir>>>19|Nr<<13)^(ir<<3|Nr>>>29)^ir>>>6,fl=(Nr>>>19|ir<<13)^(Nr<<3|ir>>>29)^(Nr>>>6|ir<<26),pl=h[de-7],Hx=pl.high,qx=pl.low,ml=h[de-16],Vx=ml.high,xl=ml.low;oe=hl+qx,ze=Ux+Hx+(oe>>>0<hl>>>0?1:0),oe=oe+fl,ze=ze+Kx+(oe>>>0<fl>>>0?1:0),oe=oe+xl,ze=ze+Vx+(oe>>>0<xl>>>0?1:0),$t.high=ze,$t.low=oe}var Zx=F&re^~F&ye,gl=q&me^~q&Te,Wx=pe&Be^pe&_^Be&_,Gx=he&R^he&I^R&I,Yx=(pe>>>28|he<<4)^(pe<<30|he>>>2)^(pe<<25|he>>>7),yl=(he>>>28|pe<<4)^(he<<30|pe>>>2)^(he<<25|pe>>>7),Xx=(F>>>14|q<<18)^(F>>>18|q<<14)^(F<<23|q>>>9),Jx=(q>>>14|F<<18)^(q>>>18|F<<14)^(q<<23|F>>>9),bl=m[de],Qx=bl.high,vl=bl.low,Ve=Ae+Jx,Et=Ie+Xx+(Ve>>>0<Ae>>>0?1:0),Ve=Ve+gl,Et=Et+Zx+(Ve>>>0<gl>>>0?1:0),Ve=Ve+vl,Et=Et+Qx+(Ve>>>0<vl>>>0?1:0),Ve=Ve+oe,Et=Et+ze+(Ve>>>0<oe>>>0?1:0),_l=yl+Gx,eg=Yx+Wx+(_l>>>0<yl>>>0?1:0);Ie=ye,Ae=Te,ye=re,Te=me,re=F,me=q,q=M+Ve|0,F=B+Et+(q>>>0<M>>>0?1:0)|0,B=_,M=I,_=Be,I=R,Be=pe,R=he,he=Ve+_l|0,pe=Et+eg+(he>>>0<Ve>>>0?1:0)|0}d=P.low=d+he,P.high=E+pe+(d>>>0<he>>>0?1:0),S=b.low=S+R,b.high=C+Be+(S>>>0<R>>>0?1:0),N=g.low=N+I,g.high=T+_+(N>>>0<I>>>0?1:0),L=v.low=L+M,v.high=U+B+(L>>>0<M>>>0?1:0),Q=O.low=Q+q,O.high=Y+F+(Q>>>0<q>>>0?1:0),W=w.low=W+me,w.high=X+re+(W>>>0<me>>>0?1:0),$=k.low=$+Te,k.high=D+ye+($>>>0<Te>>>0?1:0),j=x.low=j+Ae,x.high=z+Ie+(j>>>0<Ae>>>0?1:0)},_doFinalize:function(){var p=this._data,A=p.words,f=this._nDataBytes*8,P=p.sigBytes*8;A[P>>>5]|=128<<24-P%32,A[(P+128>>>10<<5)+30]=Math.floor(f/4294967296),A[(P+128>>>10<<5)+31]=f,p.sigBytes=A.length*4,this._process();var b=this._hash.toX32();return b},clone:function(){var p=i.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=i._createHelper(y),r.HmacSHA512=i._createHmacHelper(y)}(),t.SHA512})}(Ka)),Ka.exports}var Ha={exports:{}},go;function Il(){return go||(go=1,function(n,e){(function(t,r,a){n.exports=r(se(),Lr(),xo())})(J,function(t){return function(){var r=t,a=r.x64,i=a.Word,s=a.WordArray,o=r.algo,c=o.SHA512,u=o.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var l=c._doFinalize.call(this);return l.sigBytes-=16,l}});r.SHA384=c._createHelper(u),r.HmacSHA384=c._createHmacHelper(u)}(),t.SHA384})}(Ha)),Ha.exports}var qa={exports:{}},yo;function Sl(){return yo||(yo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Lr())})(J,function(t){return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.x64,u=c.Word,l=a.algo,m=[],h=[],y=[];(function(){for(var f=1,P=0,b=0;b<24;b++){m[f+5*P]=(b+1)*(b+2)/2%64;var g=P%5,v=(2*f+3*P)%5;f=g,P=v}for(var f=0;f<5;f++)for(var P=0;P<5;P++)h[f+5*P]=P+(2*f+3*P)%5*5;for(var O=1,w=0;w<24;w++){for(var k=0,x=0,E=0;E<7;E++){if(O&1){var d=(1<<E)-1;d<32?x^=1<<d:k^=1<<d-32}O&128?O=O<<1^113:O<<=1}y[w]=u.create(k,x)}})();var p=[];(function(){for(var f=0;f<25;f++)p[f]=u.create()})();var A=l.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var f=this._state=[],P=0;P<25;P++)f[P]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(f,P){for(var b=this._state,g=this.blockSize/2,v=0;v<g;v++){var O=f[P+2*v],w=f[P+2*v+1];O=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360;var k=b[v];k.high^=w,k.low^=O}for(var x=0;x<24;x++){for(var E=0;E<5;E++){for(var d=0,C=0,S=0;S<5;S++){var k=b[E+5*S];d^=k.high,C^=k.low}var T=p[E];T.high=d,T.low=C}for(var E=0;E<5;E++)for(var N=p[(E+4)%5],U=p[(E+1)%5],L=U.high,Y=U.low,d=N.high^(L<<1|Y>>>31),C=N.low^(Y<<1|L>>>31),S=0;S<5;S++){var k=b[E+5*S];k.high^=d,k.low^=C}for(var Q=1;Q<25;Q++){var d,C,k=b[Q],X=k.high,W=k.low,D=m[Q];D<32?(d=X<<D|W>>>32-D,C=W<<D|X>>>32-D):(d=W<<D-32|X>>>64-D,C=X<<D-32|W>>>64-D);var $=p[h[Q]];$.high=d,$.low=C}var z=p[0],j=b[0];z.high=j.high,z.low=j.low;for(var E=0;E<5;E++)for(var S=0;S<5;S++){var Q=E+5*S,k=b[Q],pe=p[Q],he=p[(E+1)%5+5*S],Be=p[(E+2)%5+5*S];k.high=pe.high^~he.high&Be.high,k.low=pe.low^~he.low&Be.low}var k=b[0],R=y[x];k.high^=R.high,k.low^=R.low}},_doFinalize:function(){var f=this._data,P=f.words;this._nDataBytes*8;var b=f.sigBytes*8,g=this.blockSize*32;P[b>>>5]|=1<<24-b%32,P[(r.ceil((b+1)/g)*g>>>5)-1]|=128,f.sigBytes=P.length*4,this._process();for(var v=this._state,O=this.cfg.outputLength/8,w=O/8,k=[],x=0;x<w;x++){var E=v[x],d=E.high,C=E.low;d=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,k.push(C),k.push(d)}return new s.init(k,O)},clone:function(){for(var f=o.clone.call(this),P=f._state=this._state.slice(0),b=0;b<25;b++)P[b]=P[b].clone();return f}});a.SHA3=o._createHelper(A),a.HmacSHA3=o._createHmacHelper(A)}(Math),t.SHA3})}(qa)),qa.exports}var Va={exports:{}},bo;function Ol(){return bo||(bo=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){/** @preserve
				(c) 2012 by CÃ©dric Mesnil. All rights reserved.

				Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

				    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
				    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

				THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
				*/return function(r){var a=t,i=a.lib,s=i.WordArray,o=i.Hasher,c=a.algo,u=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),m=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),y=s.create([0,1518500249,1859775393,2400959708,2840853838]),p=s.create([1352829926,1548603684,1836072691,2053994217,0]),A=c.RIPEMD160=o.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(w,k){for(var x=0;x<16;x++){var E=k+x,d=w[E];w[E]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360}var C=this._hash.words,S=y.words,T=p.words,N=u.words,U=l.words,L=m.words,Y=h.words,Q,X,W,D,$,z,j,pe,he,Be;z=Q=C[0],j=X=C[1],pe=W=C[2],he=D=C[3],Be=$=C[4];for(var R,x=0;x<80;x+=1)R=Q+w[k+N[x]]|0,x<16?R+=f(X,W,D)+S[0]:x<32?R+=P(X,W,D)+S[1]:x<48?R+=b(X,W,D)+S[2]:x<64?R+=g(X,W,D)+S[3]:R+=v(X,W,D)+S[4],R=R|0,R=O(R,L[x]),R=R+$|0,Q=$,$=D,D=O(W,10),W=X,X=R,R=z+w[k+U[x]]|0,x<16?R+=v(j,pe,he)+T[0]:x<32?R+=g(j,pe,he)+T[1]:x<48?R+=b(j,pe,he)+T[2]:x<64?R+=P(j,pe,he)+T[3]:R+=f(j,pe,he)+T[4],R=R|0,R=O(R,Y[x]),R=R+Be|0,z=Be,Be=he,he=O(pe,10),pe=j,j=R;R=C[1]+W+he|0,C[1]=C[2]+D+Be|0,C[2]=C[3]+$+z|0,C[3]=C[4]+Q+j|0,C[4]=C[0]+X+pe|0,C[0]=R},_doFinalize:function(){var w=this._data,k=w.words,x=this._nDataBytes*8,E=w.sigBytes*8;k[E>>>5]|=128<<24-E%32,k[(E+64>>>9<<4)+14]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,w.sigBytes=(k.length+1)*4,this._process();for(var d=this._hash,C=d.words,S=0;S<5;S++){var T=C[S];C[S]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360}return d},clone:function(){var w=o.clone.call(this);return w._hash=this._hash.clone(),w}});function f(w,k,x){return w^k^x}function P(w,k,x){return w&k|~w&x}function b(w,k,x){return(w|~k)^x}function g(w,k,x){return w&x|k&~x}function v(w,k,x){return w^(k|~x)}function O(w,k){return w<<k|w>>>32-k}a.RIPEMD160=o._createHelper(A),a.HmacRIPEMD160=o._createHmacHelper(A)}(),t.RIPEMD160})}(Va)),Va.exports}var Za={exports:{}},vo;function Wa(){return vo||(vo=1,function(n,e){(function(t,r){n.exports=r(se())})(J,function(t){(function(){var r=t,a=r.lib,i=a.Base,s=r.enc,o=s.Utf8,c=r.algo;c.HMAC=i.extend({init:function(u,l){u=this._hasher=new u.init,typeof l=="string"&&(l=o.parse(l));var m=u.blockSize,h=m*4;l.sigBytes>h&&(l=u.finalize(l)),l.clamp();for(var y=this._oKey=l.clone(),p=this._iKey=l.clone(),A=y.words,f=p.words,P=0;P<m;P++)A[P]^=1549556828,f[P]^=909522486;y.sigBytes=p.sigBytes=h,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var l=this._hasher,m=l.finalize(u);l.reset();var h=l.finalize(this._oKey.clone().concat(m));return h}})})()})}(Za)),Za.exports}var Ga={exports:{}},_o;function Bl(){return _o||(_o=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ma(),Wa())})(J,function(t){return function(){var r=t,a=r.lib,i=a.Base,s=a.WordArray,o=r.algo,c=o.SHA256,u=o.HMAC,l=o.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(m){this.cfg=this.cfg.extend(m)},compute:function(m,h){for(var y=this.cfg,p=u.create(y.hasher,m),A=s.create(),f=s.create([1]),P=A.words,b=f.words,g=y.keySize,v=y.iterations;P.length<g;){var O=p.update(h).finalize(f);p.reset();for(var w=O.words,k=w.length,x=O,E=1;E<v;E++){x=p.finalize(x),p.reset();for(var d=x.words,C=0;C<k;C++)w[C]^=d[C]}A.concat(O),b[0]++}return A.sigBytes=g*4,A}});r.PBKDF2=function(m,h,y){return l.create(y).compute(m,h)}}(),t.PBKDF2})}(Ga)),Ga.exports}var Ya={exports:{}},wo;function gt(){return wo||(wo=1,function(n,e){(function(t,r,a){n.exports=r(se(),ho(),Wa())})(J,function(t){return function(){var r=t,a=r.lib,i=a.Base,s=a.WordArray,o=r.algo,c=o.MD5,u=o.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,m){for(var h,y=this.cfg,p=y.hasher.create(),A=s.create(),f=A.words,P=y.keySize,b=y.iterations;f.length<P;){h&&p.update(h),h=p.update(l).finalize(m),p.reset();for(var g=1;g<b;g++)h=p.finalize(h),p.reset();A.concat(h)}return A.sigBytes=P*4,A}});r.EvpKDF=function(l,m,h){return u.create(h).compute(l,m)}}(),t.EvpKDF})}(Ya)),Ya.exports}var Xa={exports:{}},Ao;function Ce(){return Ao||(Ao=1,function(n,e){(function(t,r,a){n.exports=r(se(),gt())})(J,function(t){t.lib.Cipher||function(r){var a=t,i=a.lib,s=i.Base,o=i.WordArray,c=i.BufferedBlockAlgorithm,u=a.enc;u.Utf8;var l=u.Base64,m=a.algo,h=m.EvpKDF,y=i.Cipher=c.extend({cfg:s.extend(),createEncryptor:function(d,C){return this.create(this._ENC_XFORM_MODE,d,C)},createDecryptor:function(d,C){return this.create(this._DEC_XFORM_MODE,d,C)},init:function(d,C,S){this.cfg=this.cfg.extend(S),this._xformMode=d,this._key=C,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(d){return this._append(d),this._process()},finalize:function(d){d&&this._append(d);var C=this._doFinalize();return C},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function d(C){return typeof C=="string"?E:w}return function(C){return{encrypt:function(S,T,N){return d(T).encrypt(C,S,T,N)},decrypt:function(S,T,N){return d(T).decrypt(C,S,T,N)}}}}()});i.StreamCipher=y.extend({_doFinalize:function(){var d=this._process(!0);return d},blockSize:1});var p=a.mode={},A=i.BlockCipherMode=s.extend({createEncryptor:function(d,C){return this.Encryptor.create(d,C)},createDecryptor:function(d,C){return this.Decryptor.create(d,C)},init:function(d,C){this._cipher=d,this._iv=C}}),f=p.CBC=function(){var d=A.extend();d.Encryptor=d.extend({processBlock:function(S,T){var N=this._cipher,U=N.blockSize;C.call(this,S,T,U),N.encryptBlock(S,T),this._prevBlock=S.slice(T,T+U)}}),d.Decryptor=d.extend({processBlock:function(S,T){var N=this._cipher,U=N.blockSize,L=S.slice(T,T+U);N.decryptBlock(S,T),C.call(this,S,T,U),this._prevBlock=L}});function C(S,T,N){var U,L=this._iv;L?(U=L,this._iv=r):U=this._prevBlock;for(var Y=0;Y<N;Y++)S[T+Y]^=U[Y]}return d}(),P=a.pad={},b=P.Pkcs7={pad:function(d,C){for(var S=C*4,T=S-d.sigBytes%S,N=T<<24|T<<16|T<<8|T,U=[],L=0;L<T;L+=4)U.push(N);var Y=o.create(U,T);d.concat(Y)},unpad:function(d){var C=d.words[d.sigBytes-1>>>2]&255;d.sigBytes-=C}};i.BlockCipher=y.extend({cfg:y.cfg.extend({mode:f,padding:b}),reset:function(){var d;y.reset.call(this);var C=this.cfg,S=C.iv,T=C.mode;this._xformMode==this._ENC_XFORM_MODE?d=T.createEncryptor:(d=T.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==d?this._mode.init(this,S&&S.words):(this._mode=d.call(T,this,S&&S.words),this._mode.__creator=d)},_doProcessBlock:function(d,C){this._mode.processBlock(d,C)},_doFinalize:function(){var d,C=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(C.pad(this._data,this.blockSize),d=this._process(!0)):(d=this._process(!0),C.unpad(d)),d},blockSize:128/32});var g=i.CipherParams=s.extend({init:function(d){this.mixIn(d)},toString:function(d){return(d||this.formatter).stringify(this)}}),v=a.format={},O=v.OpenSSL={stringify:function(d){var C,S=d.ciphertext,T=d.salt;return T?C=o.create([1398893684,1701076831]).concat(T).concat(S):C=S,C.toString(l)},parse:function(d){var C,S=l.parse(d),T=S.words;return T[0]==1398893684&&T[1]==1701076831&&(C=o.create(T.slice(2,4)),T.splice(0,4),S.sigBytes-=16),g.create({ciphertext:S,salt:C})}},w=i.SerializableCipher=s.extend({cfg:s.extend({format:O}),encrypt:function(d,C,S,T){T=this.cfg.extend(T);var N=d.createEncryptor(S,T),U=N.finalize(C),L=N.cfg;return g.create({ciphertext:U,key:S,iv:L.iv,algorithm:d,mode:L.mode,padding:L.padding,blockSize:d.blockSize,formatter:T.format})},decrypt:function(d,C,S,T){T=this.cfg.extend(T),C=this._parse(C,T.format);var N=d.createDecryptor(S,T).finalize(C.ciphertext);return N},_parse:function(d,C){return typeof d=="string"?C.parse(d,this):d}}),k=a.kdf={},x=k.OpenSSL={execute:function(d,C,S,T,N){if(T||(T=o.random(64/8)),N)var U=h.create({keySize:C+S,hasher:N}).compute(d,T);else var U=h.create({keySize:C+S}).compute(d,T);var L=o.create(U.words.slice(C),S*4);return U.sigBytes=C*4,g.create({key:U,iv:L,salt:T})}},E=i.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:x}),encrypt:function(d,C,S,T){T=this.cfg.extend(T);var N=T.kdf.execute(S,d.keySize,d.ivSize,T.salt,T.hasher);T.iv=N.iv;var U=w.encrypt.call(this,d,C,N.key,T);return U.mixIn(N),U},decrypt:function(d,C,S,T){T=this.cfg.extend(T),C=this._parse(C,T.format);var N=T.kdf.execute(S,d.keySize,d.ivSize,C.salt,T.hasher);T.iv=N.iv;var U=w.decrypt.call(this,d,C,N.key,T);return U}})}()})}(Xa)),Xa.exports}var Ja={exports:{}},Eo;function Tl(){return Eo||(Eo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize;a.call(this,i,s,c,o),this._prevBlock=i.slice(s,s+c)}}),r.Decryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize,u=i.slice(s,s+c);a.call(this,i,s,c,o),this._prevBlock=u}});function a(i,s,o,c){var u,l=this._iv;l?(u=l.slice(0),this._iv=void 0):u=this._prevBlock,c.encryptBlock(u,0);for(var m=0;m<o;m++)i[s+m]^=u[m]}return r}(),t.mode.CFB})}(Ja)),Ja.exports}var Qa={exports:{}},Co;function Dl(){return Co||(Co=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize,u=this._iv,l=this._counter;u&&(l=this._counter=u.slice(0),this._iv=void 0);var m=l.slice(0);o.encryptBlock(m,0),l[c-1]=l[c-1]+1|0;for(var h=0;h<c;h++)i[s+h]^=m[h]}});return r.Decryptor=a,r}(),t.mode.CTR})}(Qa)),Qa.exports}var ei={exports:{}},Po;function Rl(){return Po||(Po=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function a(o){if((o>>24&255)===255){var c=o>>16&255,u=o>>8&255,l=o&255;c===255?(c=0,u===255?(u=0,l===255?l=0:++l):++u):++c,o=0,o+=c<<16,o+=u<<8,o+=l}else o+=1<<24;return o}function i(o){return(o[0]=a(o[0]))===0&&(o[1]=a(o[1])),o}var s=r.Encryptor=r.extend({processBlock:function(o,c){var u=this._cipher,l=u.blockSize,m=this._iv,h=this._counter;m&&(h=this._counter=m.slice(0),this._iv=void 0),i(h);var y=h.slice(0);u.encryptBlock(y,0);for(var p=0;p<l;p++)o[c+p]^=y[p]}});return r.Decryptor=s,r}(),t.mode.CTRGladman})}(ei)),ei.exports}var ti={exports:{}},ko;function Fl(){return ko||(ko=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(i,s){var o=this._cipher,c=o.blockSize,u=this._iv,l=this._keystream;u&&(l=this._keystream=u.slice(0),this._iv=void 0),o.encryptBlock(l,0);for(var m=0;m<c;m++)i[s+m]^=l[m]}});return r.Decryptor=a,r}(),t.mode.OFB})}(ti)),ti.exports}var ri={exports:{}},Io;function Nl(){return Io||(Io=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(a,i){this._cipher.encryptBlock(a,i)}}),r.Decryptor=r.extend({processBlock:function(a,i){this._cipher.decryptBlock(a,i)}}),r}(),t.mode.ECB})}(ri)),ri.exports}var ni={exports:{}},So;function jl(){return So||(So=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.pad.AnsiX923={pad:function(r,a){var i=r.sigBytes,s=a*4,o=s-i%s,c=i+o-1;r.clamp(),r.words[c>>>2]|=o<<24-c%4*8,r.sigBytes+=o},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},t.pad.Ansix923})}(ni)),ni.exports}var ai={exports:{}},Oo;function Ll(){return Oo||(Oo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.pad.Iso10126={pad:function(r,a){var i=a*4,s=i-r.sigBytes%i;r.concat(t.lib.WordArray.random(s-1)).concat(t.lib.WordArray.create([s<<24],1))},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},t.pad.Iso10126})}(ai)),ai.exports}var ii={exports:{}},Bo;function $l(){return Bo||(Bo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.pad.Iso97971={pad:function(r,a){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,a)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(ii)),ii.exports}var si={exports:{}},To;function zl(){return To||(To=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.pad.ZeroPadding={pad:function(r,a){var i=a*4;r.clamp(),r.sigBytes+=i-(r.sigBytes%i||i)},unpad:function(r){for(var a=r.words,i=r.sigBytes-1,i=r.sigBytes-1;i>=0;i--)if(a[i>>>2]>>>24-i%4*8&255){r.sigBytes=i+1;break}}},t.pad.ZeroPadding})}(si)),si.exports}var oi={exports:{}},Do;function Ml(){return Do||(Do=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(oi)),oi.exports}var ui={exports:{}},Ro;function Ul(){return Ro||(Ro=1,function(n,e){(function(t,r,a){n.exports=r(se(),Ce())})(J,function(t){return function(r){var a=t,i=a.lib,s=i.CipherParams,o=a.enc,c=o.Hex,u=a.format;u.Hex={stringify:function(l){return l.ciphertext.toString(c)},parse:function(l){var m=c.parse(l);return s.create({ciphertext:m})}}}(),t.format.Hex})}(ui)),ui.exports}var ci={exports:{}},Fo;function Kl(){return Fo||(Fo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Pt(),kt(),gt(),Ce())})(J,function(t){return function(){var r=t,a=r.lib,i=a.BlockCipher,s=r.algo,o=[],c=[],u=[],l=[],m=[],h=[],y=[],p=[],A=[],f=[];(function(){for(var g=[],v=0;v<256;v++)v<128?g[v]=v<<1:g[v]=v<<1^283;for(var O=0,w=0,v=0;v<256;v++){var k=w^w<<1^w<<2^w<<3^w<<4;k=k>>>8^k&255^99,o[O]=k,c[k]=O;var x=g[O],E=g[x],d=g[E],C=g[k]*257^k*16843008;u[O]=C<<24|C>>>8,l[O]=C<<16|C>>>16,m[O]=C<<8|C>>>24,h[O]=C;var C=d*16843009^E*65537^x*257^O*16843008;y[k]=C<<24|C>>>8,p[k]=C<<16|C>>>16,A[k]=C<<8|C>>>24,f[k]=C,O?(O=x^g[g[g[d^x]]],w^=g[g[w]]):O=w=1}})();var P=[0,1,2,4,8,16,32,64,128,27,54],b=s.AES=i.extend({_doReset:function(){var g;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var v=this._keyPriorReset=this._key,O=v.words,w=v.sigBytes/4,k=this._nRounds=w+6,x=(k+1)*4,E=this._keySchedule=[],d=0;d<x;d++)d<w?E[d]=O[d]:(g=E[d-1],d%w?w>6&&d%w==4&&(g=o[g>>>24]<<24|o[g>>>16&255]<<16|o[g>>>8&255]<<8|o[g&255]):(g=g<<8|g>>>24,g=o[g>>>24]<<24|o[g>>>16&255]<<16|o[g>>>8&255]<<8|o[g&255],g^=P[d/w|0]<<24),E[d]=E[d-w]^g);for(var C=this._invKeySchedule=[],S=0;S<x;S++){var d=x-S;if(S%4)var g=E[d];else var g=E[d-4];S<4||d<=4?C[S]=g:C[S]=y[o[g>>>24]]^p[o[g>>>16&255]]^A[o[g>>>8&255]]^f[o[g&255]]}}},encryptBlock:function(g,v){this._doCryptBlock(g,v,this._keySchedule,u,l,m,h,o)},decryptBlock:function(g,v){var O=g[v+1];g[v+1]=g[v+3],g[v+3]=O,this._doCryptBlock(g,v,this._invKeySchedule,y,p,A,f,c);var O=g[v+1];g[v+1]=g[v+3],g[v+3]=O},_doCryptBlock:function(g,v,O,w,k,x,E,d){for(var C=this._nRounds,S=g[v]^O[0],T=g[v+1]^O[1],N=g[v+2]^O[2],U=g[v+3]^O[3],L=4,Y=1;Y<C;Y++){var Q=w[S>>>24]^k[T>>>16&255]^x[N>>>8&255]^E[U&255]^O[L++],X=w[T>>>24]^k[N>>>16&255]^x[U>>>8&255]^E[S&255]^O[L++],W=w[N>>>24]^k[U>>>16&255]^x[S>>>8&255]^E[T&255]^O[L++],D=w[U>>>24]^k[S>>>16&255]^x[T>>>8&255]^E[N&255]^O[L++];S=Q,T=X,N=W,U=D}var Q=(d[S>>>24]<<24|d[T>>>16&255]<<16|d[N>>>8&255]<<8|d[U&255])^O[L++],X=(d[T>>>24]<<24|d[N>>>16&255]<<16|d[U>>>8&255]<<8|d[S&255])^O[L++],W=(d[N>>>24]<<24|d[U>>>16&255]<<16|d[S>>>8&255]<<8|d[T&255])^O[L++],D=(d[U>>>24]<<24|d[S>>>16&255]<<16|d[T>>>8&255]<<8|d[N&255])^O[L++];g[v]=Q,g[v+1]=X,g[v+2]=W,g[v+3]=D},keySize:256/32});r.AES=i._createHelper(b)}(),t.AES})}(ci)),ci.exports}var li={exports:{}},No;function Hl(){return No||(No=1,function(n,e){(function(t,r,a){n.exports=r(se(),Pt(),kt(),gt(),Ce())})(J,function(t){return function(){var r=t,a=r.lib,i=a.WordArray,s=a.BlockCipher,o=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],m=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],y=o.DES=s.extend({_doReset:function(){for(var P=this._key,b=P.words,g=[],v=0;v<56;v++){var O=c[v]-1;g[v]=b[O>>>5]>>>31-O%32&1}for(var w=this._subKeys=[],k=0;k<16;k++){for(var x=w[k]=[],E=l[k],v=0;v<24;v++)x[v/6|0]|=g[(u[v]-1+E)%28]<<31-v%6,x[4+(v/6|0)]|=g[28+(u[v+24]-1+E)%28]<<31-v%6;x[0]=x[0]<<1|x[0]>>>31;for(var v=1;v<7;v++)x[v]=x[v]>>>(v-1)*4+3;x[7]=x[7]<<5|x[7]>>>27}for(var d=this._invSubKeys=[],v=0;v<16;v++)d[v]=w[15-v]},encryptBlock:function(P,b){this._doCryptBlock(P,b,this._subKeys)},decryptBlock:function(P,b){this._doCryptBlock(P,b,this._invSubKeys)},_doCryptBlock:function(P,b,g){this._lBlock=P[b],this._rBlock=P[b+1],p.call(this,4,252645135),p.call(this,16,65535),A.call(this,2,858993459),A.call(this,8,16711935),p.call(this,1,1431655765);for(var v=0;v<16;v++){for(var O=g[v],w=this._lBlock,k=this._rBlock,x=0,E=0;E<8;E++)x|=m[E][((k^O[E])&h[E])>>>0];this._lBlock=k,this._rBlock=w^x}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),A.call(this,8,16711935),A.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),P[b]=this._lBlock,P[b+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(P,b){var g=(this._lBlock>>>P^this._rBlock)&b;this._rBlock^=g,this._lBlock^=g<<P}function A(P,b){var g=(this._rBlock>>>P^this._lBlock)&b;this._lBlock^=g,this._rBlock^=g<<P}r.DES=s._createHelper(y);var f=o.TripleDES=s.extend({_doReset:function(){var P=this._key,b=P.words;if(b.length!==2&&b.length!==4&&b.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var g=b.slice(0,2),v=b.length<4?b.slice(0,2):b.slice(2,4),O=b.length<6?b.slice(0,2):b.slice(4,6);this._des1=y.createEncryptor(i.create(g)),this._des2=y.createEncryptor(i.create(v)),this._des3=y.createEncryptor(i.create(O))},encryptBlock:function(P,b){this._des1.encryptBlock(P,b),this._des2.decryptBlock(P,b),this._des3.encryptBlock(P,b)},decryptBlock:function(P,b){this._des3.decryptBlock(P,b),this._des2.encryptBlock(P,b),this._des1.decryptBlock(P,b)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=s._createHelper(f)}(),t.TripleDES})}(li)),li.exports}var hi={exports:{}},jo;function ql(){return jo||(jo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Pt(),kt(),gt(),Ce())})(J,function(t){return function(){var r=t,a=r.lib,i=a.StreamCipher,s=r.algo,o=s.RC4=i.extend({_doReset:function(){for(var l=this._key,m=l.words,h=l.sigBytes,y=this._S=[],p=0;p<256;p++)y[p]=p;for(var p=0,A=0;p<256;p++){var f=p%h,P=m[f>>>2]>>>24-f%4*8&255;A=(A+y[p]+P)%256;var b=y[p];y[p]=y[A],y[A]=b}this._i=this._j=0},_doProcessBlock:function(l,m){l[m]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var l=this._S,m=this._i,h=this._j,y=0,p=0;p<4;p++){m=(m+1)%256,h=(h+l[m])%256;var A=l[m];l[m]=l[h],l[h]=A,y|=l[(l[m]+l[h])%256]<<24-p*8}return this._i=m,this._j=h,y}r.RC4=i._createHelper(o);var u=s.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var l=this.cfg.drop;l>0;l--)c.call(this)}});r.RC4Drop=i._createHelper(u)}(),t.RC4})}(hi)),hi.exports}var di={exports:{}},Lo;function Vl(){return Lo||(Lo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Pt(),kt(),gt(),Ce())})(J,function(t){return function(){var r=t,a=r.lib,i=a.StreamCipher,s=r.algo,o=[],c=[],u=[],l=s.Rabbit=i.extend({_doReset:function(){for(var h=this._key.words,y=this.cfg.iv,p=0;p<4;p++)h[p]=(h[p]<<8|h[p]>>>24)&16711935|(h[p]<<24|h[p]>>>8)&4278255360;var A=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],f=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var p=0;p<4;p++)m.call(this);for(var p=0;p<8;p++)f[p]^=A[p+4&7];if(y){var P=y.words,b=P[0],g=P[1],v=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,O=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,w=v>>>16|O&4294901760,k=O<<16|v&65535;f[0]^=v,f[1]^=w,f[2]^=O,f[3]^=k,f[4]^=v,f[5]^=w,f[6]^=O,f[7]^=k;for(var p=0;p<4;p++)m.call(this)}},_doProcessBlock:function(h,y){var p=this._X;m.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var A=0;A<4;A++)o[A]=(o[A]<<8|o[A]>>>24)&16711935|(o[A]<<24|o[A]>>>8)&4278255360,h[y+A]^=o[A]},blockSize:128/32,ivSize:64/32});function m(){for(var h=this._X,y=this._C,p=0;p<8;p++)c[p]=y[p];y[0]=y[0]+1295307597+this._b|0,y[1]=y[1]+3545052371+(y[0]>>>0<c[0]>>>0?1:0)|0,y[2]=y[2]+886263092+(y[1]>>>0<c[1]>>>0?1:0)|0,y[3]=y[3]+1295307597+(y[2]>>>0<c[2]>>>0?1:0)|0,y[4]=y[4]+3545052371+(y[3]>>>0<c[3]>>>0?1:0)|0,y[5]=y[5]+886263092+(y[4]>>>0<c[4]>>>0?1:0)|0,y[6]=y[6]+1295307597+(y[5]>>>0<c[5]>>>0?1:0)|0,y[7]=y[7]+3545052371+(y[6]>>>0<c[6]>>>0?1:0)|0,this._b=y[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var A=h[p]+y[p],f=A&65535,P=A>>>16,b=((f*f>>>17)+f*P>>>15)+P*P,g=((A&4294901760)*A|0)+((A&65535)*A|0);u[p]=b^g}h[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,h[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,h[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,h[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,h[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,h[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,h[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,h[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.Rabbit=i._createHelper(l)}(),t.Rabbit})}(di)),di.exports}var fi={exports:{}},$o;function Zl(){return $o||($o=1,function(n,e){(function(t,r,a){n.exports=r(se(),Pt(),kt(),gt(),Ce())})(J,function(t){return function(){var r=t,a=r.lib,i=a.StreamCipher,s=r.algo,o=[],c=[],u=[],l=s.RabbitLegacy=i.extend({_doReset:function(){var h=this._key.words,y=this.cfg.iv,p=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],A=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var f=0;f<4;f++)m.call(this);for(var f=0;f<8;f++)A[f]^=p[f+4&7];if(y){var P=y.words,b=P[0],g=P[1],v=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,O=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,w=v>>>16|O&4294901760,k=O<<16|v&65535;A[0]^=v,A[1]^=w,A[2]^=O,A[3]^=k,A[4]^=v,A[5]^=w,A[6]^=O,A[7]^=k;for(var f=0;f<4;f++)m.call(this)}},_doProcessBlock:function(h,y){var p=this._X;m.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var A=0;A<4;A++)o[A]=(o[A]<<8|o[A]>>>24)&16711935|(o[A]<<24|o[A]>>>8)&4278255360,h[y+A]^=o[A]},blockSize:128/32,ivSize:64/32});function m(){for(var h=this._X,y=this._C,p=0;p<8;p++)c[p]=y[p];y[0]=y[0]+1295307597+this._b|0,y[1]=y[1]+3545052371+(y[0]>>>0<c[0]>>>0?1:0)|0,y[2]=y[2]+886263092+(y[1]>>>0<c[1]>>>0?1:0)|0,y[3]=y[3]+1295307597+(y[2]>>>0<c[2]>>>0?1:0)|0,y[4]=y[4]+3545052371+(y[3]>>>0<c[3]>>>0?1:0)|0,y[5]=y[5]+886263092+(y[4]>>>0<c[4]>>>0?1:0)|0,y[6]=y[6]+1295307597+(y[5]>>>0<c[5]>>>0?1:0)|0,y[7]=y[7]+3545052371+(y[6]>>>0<c[6]>>>0?1:0)|0,this._b=y[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var A=h[p]+y[p],f=A&65535,P=A>>>16,b=((f*f>>>17)+f*P>>>15)+P*P,g=((A&4294901760)*A|0)+((A&65535)*A|0);u[p]=b^g}h[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,h[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,h[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,h[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,h[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,h[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,h[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,h[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.RabbitLegacy=i._createHelper(l)}(),t.RabbitLegacy})}(fi)),fi.exports}var pi={exports:{}},zo;function Wl(){return zo||(zo=1,function(n,e){(function(t,r,a){n.exports=r(se(),Pt(),kt(),gt(),Ce())})(J,function(t){return function(){var r=t,a=r.lib,i=a.BlockCipher,s=r.algo;const o=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],u=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var l={pbox:[],sbox:[]};function m(f,P){let b=P>>24&255,g=P>>16&255,v=P>>8&255,O=P&255,w=f.sbox[0][b]+f.sbox[1][g];return w=w^f.sbox[2][v],w=w+f.sbox[3][O],w}function h(f,P,b){let g=P,v=b,O;for(let w=0;w<o;++w)g=g^f.pbox[w],v=m(f,g)^v,O=g,g=v,v=O;return O=g,g=v,v=O,v=v^f.pbox[o],g=g^f.pbox[o+1],{left:g,right:v}}function y(f,P,b){let g=P,v=b,O;for(let w=o+1;w>1;--w)g=g^f.pbox[w],v=m(f,g)^v,O=g,g=v,v=O;return O=g,g=v,v=O,v=v^f.pbox[1],g=g^f.pbox[0],{left:g,right:v}}function p(f,P,b){for(let k=0;k<4;k++){f.sbox[k]=[];for(let x=0;x<256;x++)f.sbox[k][x]=u[k][x]}let g=0;for(let k=0;k<o+2;k++)f.pbox[k]=c[k]^P[g],g++,g>=b&&(g=0);let v=0,O=0,w=0;for(let k=0;k<o+2;k+=2)w=h(f,v,O),v=w.left,O=w.right,f.pbox[k]=v,f.pbox[k+1]=O;for(let k=0;k<4;k++)for(let x=0;x<256;x+=2)w=h(f,v,O),v=w.left,O=w.right,f.sbox[k][x]=v,f.sbox[k][x+1]=O;return!0}var A=s.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var f=this._keyPriorReset=this._key,P=f.words,b=f.sigBytes/4;p(l,P,b)}},encryptBlock:function(f,P){var b=h(l,f[P],f[P+1]);f[P]=b.left,f[P+1]=b.right},decryptBlock:function(f,P){var b=y(l,f[P],f[P+1]);f[P]=b.left,f[P+1]=b.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=i._createHelper(A)}(),t.Blowfish})}(pi)),pi.exports}(function(n,e){(function(t,r,a){n.exports=r(se(),Lr(),El(),Cl(),Pt(),Pl(),kt(),ho(),Ma(),kl(),xo(),Il(),Sl(),Ol(),Wa(),Bl(),gt(),Ce(),Tl(),Dl(),Rl(),Fl(),Nl(),jl(),Ll(),$l(),zl(),Ml(),Ul(),Kl(),Hl(),ql(),Vl(),Zl(),Wl())})(J,function(t){return t})})(ro);var Gl=ro.exports;const Yl=Ke(Gl);class $r{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}var zr={};zr.byteLength=Ql,zr.toByteArray=t0,zr.fromByteArray=a0;for(var Qe=[],Ze=[],Xl=typeof Uint8Array<"u"?Uint8Array:Array,mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zt=0,Jl=mi.length;zt<Jl;++zt)Qe[zt]=mi[zt],Ze[mi.charCodeAt(zt)]=zt;Ze["-".charCodeAt(0)]=62,Ze["_".charCodeAt(0)]=63;function Mo(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Ql(n){var e=Mo(n),t=e[0],r=e[1];return(t+r)*3/4-r}function e0(n,e,t){return(e+t)*3/4-t}function t0(n){var e,t=Mo(n),r=t[0],a=t[1],i=new Xl(e0(n,r,a)),s=0,o=a>0?r-4:r,c;for(c=0;c<o;c+=4)e=Ze[n.charCodeAt(c)]<<18|Ze[n.charCodeAt(c+1)]<<12|Ze[n.charCodeAt(c+2)]<<6|Ze[n.charCodeAt(c+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=e&255;return a===2&&(e=Ze[n.charCodeAt(c)]<<2|Ze[n.charCodeAt(c+1)]>>4,i[s++]=e&255),a===1&&(e=Ze[n.charCodeAt(c)]<<10|Ze[n.charCodeAt(c+1)]<<4|Ze[n.charCodeAt(c+2)]>>2,i[s++]=e>>8&255,i[s++]=e&255),i}function r0(n){return Qe[n>>18&63]+Qe[n>>12&63]+Qe[n>>6&63]+Qe[n&63]}function n0(n,e,t){for(var r,a=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),a.push(r0(r));return a.join("")}function a0(n){for(var e,t=n.length,r=t%3,a=[],i=16383,s=0,o=t-r;s<o;s+=i)a.push(n0(n,s,s+i>o?o:s+i));return r===1?(e=n[t-1],a.push(Qe[e>>2]+Qe[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],a.push(Qe[e>>10]+Qe[e>>4&63]+Qe[e<<2&63]+"=")),a.join("")}var i0=Object.defineProperty,s0=(n,e,t)=>e in n?i0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,o0=(n,e,t)=>(s0(n,typeof e!="symbol"?e+"":e,t),t);function u0(n,e){let t=Array.from({length:n.length},(r,a)=>({start:a,end:a+1}));for(;t.length>1;){let r=null;for(let a=0;a<t.length-1;a++){const i=n.slice(t[a].start,t[a+1].end),s=e.get(i.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,a])}if(r!=null){const a=r[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function c0(n,e){return n.length===1?[e.get(n.join(","))]:u0(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function l0(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var xi=class{constructor(n,e){Ee(this,"specialTokens");Ee(this,"inverseSpecialTokens");Ee(this,"patStr");Ee(this,"textEncoder",new TextEncoder);Ee(this,"textDecoder",new TextDecoder("utf-8"));Ee(this,"rankMap",new Map);Ee(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,a)=>{const[i,s,...o]=a.split(" "),c=Number.parseInt(s,10);return o.forEach((u,l)=>r[u]=c+l),r},{});for(const[r,a]of Object.entries(t)){const i=zr.toByteArray(r);this.rankMap.set(i.join(","),a),this.textMap.set(a,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[a,i])=>(r[i]=this.textEncoder.encode(a),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),a=xi.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!s.has(u)):t);if(o.size>0){const u=xi.specialTokenRegex([...o]),l=n.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;a.lastIndex=l,u=a.exec(n),!(u==null||s.has(u[0]));)l=u.index+1;const m=(u==null?void 0:u.index)??n.length;for(const y of n.substring(c,m).matchAll(r)){const p=this.textEncoder.encode(y[0]),A=this.rankMap.get(p.join(","));if(A!=null){i.push(A);continue}i.push(...c0(p,this.rankMap))}if(u==null)break;let h=this.specialTokens[u[0]];i.push(h),c=u.index+u[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const s=n[i],o=this.textMap.get(s)??this.inverseSpecialTokens[s];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let a=0;for(const i of e)r.set(i,a),a+=i.length;return this.textDecoder.decode(r)}},Uo=xi;o0(Uo,"specialTokenRegex",n=>new RegExp(n.map(e=>l0(e)).join("|"),"g"));function h0(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var Mr={exports:{}},Ko={};function We(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var d0=We;We.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},We.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},We.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0},We.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},We.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)},We.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)},We.prototype.start=We.prototype.try,We.prototype.errors=function(){return this._errors},We.prototype.attempts=function(){return this._attempts},We.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var a=this._errors[r],i=a.message,s=(n[i]||0)+1;n[i]=s,s>=t&&(e=a,t=s)}return e},function(n){var e=d0;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)r[a]=t[a];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],s=0;s<r.retries;s++)i.push(this.createTimeout(s,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(s,r)),i.sort(function(o,c){return o-c}),i},n.createTimeout=function(t,r){var a=r.randomize?Math.random()+1:1,i=Math.round(a*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,a){if(r instanceof Array&&(a=r,r=null),!a){a=[];for(var i in t)typeof t[i]=="function"&&a.push(i)}for(var s=0;s<a.length;s++){var o=a[s],c=t[o];t[o]=(function(l){var m=n.operation(r),h=Array.prototype.slice.call(arguments,1),y=h.pop();h.push(function(p){m.retry(p)||(p&&(arguments[0]=m.mainError()),y.apply(this,arguments))}),m.attempt(function(){l.apply(t,h)})}).bind(t,c),t[o].options=r}}}(Ko);var f0=Ko;const p0=f0,m0=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Ho extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const x0=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},g0=n=>m0.includes(n),qo=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const a=p0.operation(e);a.attempt(async i=>{try{t(await n(i))}catch(s){if(!(s instanceof Error)){r(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof Ho)a.stop(),r(s.originalError);else if(s instanceof TypeError&&!g0(s.message))a.stop(),r(s);else{x0(s,i,e);try{await e.onFailedAttempt(s)}catch(o){r(o);return}a.retry(s)||r(a.mainError())}}})});Mr.exports=qo,Mr.exports.default=qo,Mr.exports.AbortError=Ho;var y0=Mr.exports;const Ur=Ke(y0);var Vo={},Zo={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function a(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function i(c,u,l,m,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var y=new a(l,m||c,h),p=t?t+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],y]:c._events[p].push(y):(c._events[p]=y,c._eventsCount++),c}function s(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,m;if(this._eventsCount===0)return u;for(m in l=this._events)e.call(l,m)&&u.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=t?t+u:u,m=this._events[l];if(!m)return[];if(m.fn)return[m.fn];for(var h=0,y=m.length,p=new Array(y);h<y;h++)p[h]=m[h].fn;return p},o.prototype.listenerCount=function(u){var l=t?t+u:u,m=this._events[l];return m?m.fn?1:m.length:0},o.prototype.emit=function(u,l,m,h,y,p){var A=t?t+u:u;if(!this._events[A])return!1;var f=this._events[A],P=arguments.length,b,g;if(f.fn){switch(f.once&&this.removeListener(u,f.fn,void 0,!0),P){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,l),!0;case 3:return f.fn.call(f.context,l,m),!0;case 4:return f.fn.call(f.context,l,m,h),!0;case 5:return f.fn.call(f.context,l,m,h,y),!0;case 6:return f.fn.call(f.context,l,m,h,y,p),!0}for(g=1,b=new Array(P-1);g<P;g++)b[g-1]=arguments[g];f.fn.apply(f.context,b)}else{var v=f.length,O;for(g=0;g<v;g++)switch(f[g].once&&this.removeListener(u,f[g].fn,void 0,!0),P){case 1:f[g].fn.call(f[g].context);break;case 2:f[g].fn.call(f[g].context,l);break;case 3:f[g].fn.call(f[g].context,l,m);break;case 4:f[g].fn.call(f[g].context,l,m,h);break;default:if(!b)for(O=1,b=new Array(P-1);O<P;O++)b[O-1]=arguments[O];f[g].fn.apply(f[g].context,b)}}return!0},o.prototype.on=function(u,l,m){return i(this,u,l,m,!1)},o.prototype.once=function(u,l,m){return i(this,u,l,m,!0)},o.prototype.removeListener=function(u,l,m,h){var y=t?t+u:u;if(!this._events[y])return this;if(!l)return s(this,y),this;var p=this._events[y];if(p.fn)p.fn===l&&(!h||p.once)&&(!m||p.context===m)&&s(this,y);else{for(var A=0,f=[],P=p.length;A<P;A++)(p[A].fn!==l||h&&!p[A].once||m&&p[A].context!==m)&&f.push(p[A]);f.length?this._events[y]=f.length===1?f[0]:f:s(this,y)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Zo);var b0=Zo.exports,Kr={exports:{}},v0=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const _0=v0;class Wo extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Go=(n,e,t)=>new Promise((r,a)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(c){a(c)}return}const s=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Wo(s);typeof n.cancel=="function"&&n.cancel(),a(o)},e);_0(n.then(r,a),()=>{clearTimeout(i)})});Kr.exports=Go,Kr.exports.default=Go,Kr.exports.TimeoutError=Wo;var w0=Kr.exports,gi={},yi={};Object.defineProperty(yi,"__esModule",{value:!0});function A0(n,e,t){let r=0,a=n.length;for(;a>0;){const i=a/2|0;let s=r+i;t(n[s],e)<=0?(r=++s,a-=i+1):a=i}return r}yi.default=A0,Object.defineProperty(gi,"__esModule",{value:!0});const E0=yi;class C0{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const a=E0.default(this._queue,r,(i,s)=>s.priority-i.priority);this._queue.splice(a,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}gi.default=C0,Object.defineProperty(Vo,"__esModule",{value:!0});const P0=b0,Yo=w0,k0=gi,Hr=()=>{},I0=new Yo.TimeoutError;class S0 extends P0{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Hr,this._resolveIdle=Hr,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:k0.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(a=e.interval)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Hr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Hr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const s=this._timeout===void 0&&t.timeout===void 0?e():Yo.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&a(I0)});r(await s)}catch(s){a(s)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var st=Vo.default=S0;const O0=[400,401,402,403,404,405,406,407,408,409],B0=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.name==="TimeoutError"||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&O0.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const a=new Error(n==null?void 0:n.message);throw a.name="InsufficientQuotaError",a}};let qr=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??B0;const t="default"in st?st.default:st;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ur(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const Vr={},T0=new qr({});async function D0(n,e){return n in Vr||(Vr[n]=T0.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete Vr[n],t})),new Uo(await Vr[n],e==null?void 0:e.extendedSpecialTokens)}async function Xo(n,e){return D0(h0(n),e)}let Zr;const R0=new Uint8Array(16);function F0(){if(!Zr&&(Zr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Zr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zr(R0)}const N0=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function j0(n){return typeof n=="string"&&N0.test(n)}const Se=[];for(let n=0;n<256;++n)Se.push((n+256).toString(16).slice(1));function L0(n,e=0){return Se[n[e+0]]+Se[n[e+1]]+Se[n[e+2]]+Se[n[e+3]]+"-"+Se[n[e+4]]+Se[n[e+5]]+"-"+Se[n[e+6]]+Se[n[e+7]]+"-"+Se[n[e+8]]+Se[n[e+9]]+"-"+Se[n[e+10]]+Se[n[e+11]]+Se[n[e+12]]+Se[n[e+13]]+Se[n[e+14]]+Se[n[e+15]]}const Jo={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ot(n,e,t){if(Jo.randomUUID&&!e&&!n)return Jo.randomUUID();n=n||{};const r=n.random||(n.rng||F0)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=r[a];return e}return L0(r)}var $0=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const z0=Ke($0);var Qo={exports:{}};const M0=/[\p{Lu}]/u,U0=/[\p{Ll}]/u,eu=/^[\p{Lu}](?![\p{Lu}])/gu,tu=/([\p{Alpha}\p{N}_]|$)/u,ru=/[_.\- ]+/,K0=new RegExp("^"+ru.source),nu=new RegExp(ru.source+tu.source,"gu"),au=new RegExp("\\d+"+tu.source,"gu"),H0=(n,e,t)=>{let r=!1,a=!1,i=!1;for(let s=0;s<n.length;s++){const o=n[s];r&&M0.test(o)?(n=n.slice(0,s)+"-"+n.slice(s),r=!1,i=a,a=!0,s++):a&&i&&U0.test(o)?(n=n.slice(0,s-1)+"-"+n.slice(s-1),i=a,a=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=a,a=t(o)===o&&e(o)!==o)}return n},q0=(n,e)=>(eu.lastIndex=0,n.replace(eu,t=>e(t))),V0=(n,e)=>(nu.lastIndex=0,au.lastIndex=0,n.replace(nu,(t,r)=>e(r)).replace(au,t=>e(t))),iu=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=H0(n,t,r)),n=n.replace(K0,""),e.preserveConsecutiveUppercase?n=q0(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),V0(n,r))};Qo.exports=iu,Qo.exports.default=iu;function Z0(n,e){return(e==null?void 0:e[n])||z0(n)}function W0(n,e,t){const r={};for(const a in n)Object.hasOwn(n,a)&&(r[e(a,t)]=n[a]);return r}function su(n){return Array.isArray(n)?[...n]:{...n}}function G0(n,e){const t=su(n);for(const[r,a]of Object.entries(e)){const[i,...s]=r.split(".").reverse();let o=t;for(const c of s.reverse()){if(o[c]===void 0)break;o[c]=su(o[c]),o=o[c]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[a]})}return t}function ou(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class ut{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ou(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof ut||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((a,i)=>(a[i]=i in this?this[i]:this.lc_kwargs[i],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let i=this,s=r;const[o,...c]=a.split(".").reverse();for(const u of c.reverse()){if(!(u in i)||i[u]===void 0)return;(!(u in s)||s[u]===void 0)&&(typeof i[u]=="object"&&i[u]!=null?s[u]={}:Array.isArray(i[u])&&(s[u]=[])),i=i[u],s=s[u]}o in i&&i[o]!==void 0&&(s[o]=s[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:W0(Object.keys(t).length?G0(r,t):r,Z0,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}class Y0{}class or extends Y0{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ou(this.constructor)]}constructor(e){var t;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?((t=process.env)==null?void 0:t.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return ut.prototype.toJSON.call(this)}toJSONNotImplemented(){return ut.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends or{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ot()}),Object.assign(this,e)}}return new t}}var bi={exports:{}};bi.exports,function(n){const t=(i=0)=>s=>`\x1B[${38+i};5;${s}m`,r=(i=0)=>(s,o,c)=>`\x1B[${38+i};2;${s};${o};${c}m`;function a(){const i=new Map,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};s.color.gray=s.color.blackBright,s.bgColor.bgGray=s.bgColor.bgBlackBright,s.color.grey=s.color.blackBright,s.bgColor.bgGrey=s.bgColor.bgBlackBright;for(const[o,c]of Object.entries(s)){for(const[u,l]of Object.entries(c))s[u]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},c[u]=s[u],i.set(l[0],l[1]);Object.defineProperty(s,o,{value:c,enumerable:!1})}return Object.defineProperty(s,"codes",{value:i,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi256=t(),s.color.ansi16m=r(),s.bgColor.ansi256=t(10),s.bgColor.ansi16m=r(10),Object.defineProperties(s,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(m=>m+m).join(""));const l=Number.parseInt(u,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1}}),s}Object.defineProperty(n,"exports",{enumerable:!0,get:a})}(bi);var X0=bi.exports;const uu=Ke(X0);function vi(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class _i extends or{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,i,s,o){var h;const c=this._getExecutionOrder(a),u=Date.now(),l=o?{...i,metadata:o}:i,m={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:s||[]};this._startTrace(m),await((h=this.onLLMStart)==null?void 0:h.call(this,m))}async handleChatModelStart(e,t,r,a,i,s,o){var h;const c=this._getExecutionOrder(a),u=Date.now(),l=o?{...i,metadata:o}:i,m={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:s||[]};this._startTrace(m),await((h=this.onLLMStart)==null?void 0:h.call(this,m))}async handleLLMEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onLLMEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleLLMError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onLLMError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleChainStart(e,t,r,a,i,s,o){var m;const c=this._getExecutionOrder(a),u=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};this._startTrace(l),await((m=this.onChainStart)==null?void 0:m.call(this,l))}async handleChainEnd(e,t,r,a,i){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");s.end_time=Date.now(),s.outputs=vi(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=vi(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s)}async handleChainError(e,t,r,a,i){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");s.end_time=Date.now(),s.error=e.message,s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=vi(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s)}async handleToolStart(e,t,r,a,i,s){var l;const o=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};this._startTrace(u),await((l=this.onToolStart)==null?void 0:l.call(this,u))}async handleToolEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleToolError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var a;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,r)))}async handleRetrieverStart(e,t,r,a,i,s){var l;const o=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};this._startTrace(u),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u))}async handleRetrieverEnd(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleRetrieverError(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,r)),await this._endTrace(r)}async handleText(e,t){var a;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,r)))}async handleLLMNewToken(e,t,r,a,i,s){var c;const o=this.runMap.get(r);!o||(o==null?void 0:o.run_type)!=="llm"||(o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o)))}}function Ne(n,e){return`${n.open}${e}${n.close}`}function Ye(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function yt(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Me}=uu;class cu extends _i{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const a=this.runMap.get(r.parent_run_id);if(a)t.push(a),r=a;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((a,i,s)=>{const o=`${a.execution_order}:${a.run_type}:${a.name}`;return i===s.length-1?Ne(uu.bold,o):o}).join(" > ");return Ne(Me.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ye(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.cyan,"[chain/end]")} [${t}] [${yt(e)}] Exiting Chain run with output: ${Ye(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.red,"[chain/error]")} [${t}] [${yt(e)}] Chain run errored with error: ${Ye(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Ne(Me.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ye(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.cyan,"[llm/end]")} [${t}] [${yt(e)}] Exiting LLM run with output: ${Ye(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.red,"[llm/error]")} [${t}] [${yt(e)}] LLM run errored with error: ${Ye(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,a;const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.cyan,"[tool/end]")} [${t}] [${yt(e)}] Exiting Tool run with output: "${(a=(r=e.outputs)==null?void 0:r.output)==null?void 0:a.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.red,"[tool/error]")} [${t}] [${yt(e)}] Tool run errored with error: ${Ye(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ye(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.cyan,"[retriever/end]")} [${t}] [${yt(e)}] Exiting Retriever run with output: ${Ye(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Ne(Me.red,"[retriever/error]")} [${t}] [${yt(e)}] Retriever run errored with error: ${Ye(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Ne(Me.blue,"[agent/action]")} [${r}] Agent selected action: ${Ye(t.actions[t.actions.length-1],"[action]")}`)}}const J0=[400,401,403,404,405,406,407,408,409];class Q0{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in st?st.default:st;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ur(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var i;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const a=(i=r==null?void 0:r.response)==null?void 0:i.status;if(a&&J0.includes(+a))throw r},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}function lu(n){return typeof(n==null?void 0:n._getType)=="function"}function hu(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}const eh=()=>typeof window<"u"&&typeof window.document<"u",th=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",rh=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),du=()=>typeof Deno<"u",nh=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!du(),ah=()=>{let n;return eh()?n="browser":nh()?n="node":th()?n="webworker":rh()?n="jsdom":du()?n="deno":n="other",n};let wi;async function ih(){if(wi===void 0){const n=ah(),e=sh();wi={library:"langsmith",runtime:n,...e}}return wi}function Mt(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}let Ai;function sh(){if(Ai!==void 0)return Ai;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Mt(t);r!==void 0&&(e[t]=r)}return Ai=e,e}const fu=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},It=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};async function oh(n){const e=[];for await(const t of n)e.push(t);return e}function Ei(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function pu(n){return Mt("LANGCHAIN_HIDE_INPUTS")==="true"?{}:n}function mu(n){return Mt("LANGCHAIN_HIDE_OUTPUTS")==="true"?{}:n}function _e(n){if(!j0(n))throw new Error(`Invalid UUID: ${n}`)}class Ci{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});const t=Ci.getDefaultClientConfig();this.apiUrl=Ei(e.apiUrl??t.apiUrl)??"",this.apiKey=Ei(e.apiKey??t.apiKey),this.webUrl=Ei(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new Q0(e.callerOptions??{})}static getDefaultClientConfig(){const e=Mt("LANGCHAIN_API_KEY");return{apiUrl:Mt("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984"),apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){if(!fu(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:fu(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);const o=await s.json();if(o.length===0||(yield o,o.length<a))break;r+=o.length}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},a=await ih(),i=e.project_name;delete e.project_name;const s={session_name:i,...e,extra:{...e.extra,runtime:{...a,...r.runtime}}};s.inputs=pu(s.inputs),s.outputs&&(s.outputs=mu(s.outputs));const o=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});await It(o,"create run")}async updateRun(e,t){_e(e),t.inputs&&(t.inputs=pu(t.inputs)),t.outputs&&(t.outputs=mu(t.outputs));const r={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await It(a,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){_e(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let a;t.session_id?a=t.session_id:r!=null&&r.projectName?a=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?a=r==null?void 0:r.projectId:a=(await this.readProject({projectName:Mt("LANGCHAIN_PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await oh(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort((i,s)=>((i==null?void 0:i.dotted_order)??"").localeCompare((s==null?void 0:s.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),a[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(a[i].child_runs=r[i]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:a,startTime:i,executionOrder:s,runType:o,error:c,id:u,limit:l,offset:m,query:h,filter:y}){const p=new URLSearchParams;let A=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");A=(await this.readProject({projectName:t})).id}if(A&&p.append("session",A),r&&p.append("parent_run",r),a&&p.append("reference_example",a),i&&p.append("start_time",i.toISOString()),s&&p.append("execution_order",s.toString()),o&&p.append("run_type",o),c!==void 0&&p.append("error",c.toString()),u!==void 0)for(const f of u)p.append("id",f);l!==void 0&&p.append("limit",l.toString()),m!==void 0&&p.append("offset",m.toString()),h!==void 0&&p.append("query",h),y!==void 0&&p.append("filter",y);for await(const f of this._getPaginated("/runs",p))yield*f}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||ot()};_e(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){_e(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await It(t,"unshare run")}async readRunSharedLink(e){_e(e);const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const s of t)r.append("id",s);return _e(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),_e(e);const a=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};_e(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){_e(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await It(t,"unshare dataset")}async readSharedDataset(e){return _e(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json()}async createProject({projectName:e,projectExtra:t,upsert:r,referenceDatasetId:a}){const i=r?"?upsert=true":"",s=`${this.apiUrl}/sessions${i}`,o={name:e};t!==void 0&&(o.extra=t),a!==void 0&&(o.reference_dataset_id=a);const c=await this.caller.call(fetch,s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)}),u=await c.json();if(!c.ok)throw new Error(`Failed to create session ${e}: ${c.status} ${c.statusText}`);return u}async readProject({projectId:e,projectName:t}){let r="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)_e(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this._get(r,a);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:s}={}){const o=new URLSearchParams;if(e!==void 0)for(const c of e)o.append("id",c);if(t!==void 0&&o.append("name",t),r!==void 0&&o.append("name_contains",r),a!==void 0)o.append("reference_dataset",a);else if(i!==void 0){const c=await this.readDataset({datasetName:i});o.append("reference_dataset",c.id)}s!==void 0&&o.append("reference_free",s.toString());for await(const c of this._getPaginated("/sessions",o))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,_e(r);const a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await It(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:s,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(h=>{u.append("input_keys",h)}),a.forEach(h=>{u.append("output_keys",h)}),i&&u.append("description",i),s&&u.append("data_type",s),o&&u.append("name",o);const l=await this.caller.call(fetch,c,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok){const h=await l.json();throw h.detail&&h.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const a={name:e,description:t};r&&(a.data_type=r);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok){const o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)_e(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,a);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i}={}){const s="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)o.append("id",c);a!==void 0&&o.append("name",a),i!==void 0&&o.append("name_contains",i);for await(const c of this._getPaginated(s,o))yield*c}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)_e(a),r+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:i,exampleId:s}){let o=r;if(o===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:a})).id);const u={dataset_id:o,inputs:e,outputs:t,created_at:(i||new Date).toISOString(),id:s},l=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok)throw new Error(`Failed to create example: ${l.status} ${l.statusText}`);return await l.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const a=e.map(s=>lu(s)?hu(s):s),i=lu(t)?hu(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){_e(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)a=e;else if(t!==void 0)a=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const i=new URLSearchParams({dataset:a});if(r!==void 0)for(const s of r)i.append("id",s);for await(const s of this._getPaginated("/examples",i))yield*s}async deleteExample(e){_e(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){_e(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a}={loadChildRuns:!1}){let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);let s;i.reference_example_id!==null&&i.reference_example_id!==void 0&&(s=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,s);let c=r??{};return o.evaluatorInfo&&(c={...c,...o.evaluatorInfo}),await this.createFeedback(i.id,o.key,{score:o.score,value:o.value,comment:o.comment,correction:o.correction,sourceInfo:c,feedbackSourceType:"model"})}async createFeedback(e,t,{score:r,value:a,correction:i,comment:s,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,eager:m=!1}){var f;const h={type:c??"api",metadata:o??{}};u!==void 0&&(h==null?void 0:h.metadata)!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:u}),(h==null?void 0:h.metadata)!==void 0&&((f=h.metadata.__run)==null?void 0:f.run_id)!==void 0&&_e(h.metadata.__run.run_id);const y={id:l??ot(),run_id:e,key:t,score:r,value:a,correction:i,comment:s,feedback_source:h},p=`${this.apiUrl}/feedback`+(m?"/eager":""),A=await this.caller.call(fetch,p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms)});return await It(A,"create feedback"),y}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){const s={};t!=null&&(s.score=t),r!=null&&(s.value=r),a!=null&&(s.correction=a),i!=null&&(s.comment=i),_e(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});await It(o,"update feedback")}async readFeedback(e){_e(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){_e(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const i of t)a.append("key",i);if(r)for(const i of r)a.append("source",i);for await(const i of this._getPaginated("/feedback",a))yield*i}}const uh=()=>typeof window<"u"&&typeof window.document<"u",ch=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",lh=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),xu=()=>typeof Deno<"u",hh=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!xu(),dh=()=>{let n;return uh()?n="browser":hh()?n="node":ch()?n="webworker":lh()?n="jsdom":xu()?n="deno":n="other",n};let Pi;async function fh(){return Pi===void 0&&(Pi={library:"langchain-js",runtime:dh()}),Pi}function ne(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}class ph extends _i{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:a}=e;this.projectName=r??ne("LANGCHAIN_PROJECT")??ne("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new Ci({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await fh()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}class mh{}const gu=(n,e)=>{if(e!==void 0)return n[e];const t=Object.keys(n);if(t.length===1)return n[t[0]]},xh=(n,e)=>{const t=gu(n,e);if(!t){const r=Object.keys(n);throw new Error(`input values have ${r.length} keys, you must specify an input key or pass only 1 key as input`)}return t},gh=(n,e)=>{const t=gu(n,e);if(!t){const r=Object.keys(n);throw new Error(`output values have ${r.length} keys, you must specify an output key or pass only 1 key as output`)}return t};function Wr(n,e="Human",t="AI"){const r=[];for(const a of n){let i;if(a._getType()==="human")i=e;else if(a._getType()==="ai")i=t;else if(a._getType()==="system")i="System";else if(a._getType()==="function")i="Function";else if(a._getType()==="generic")i=a.role;else throw new Error(`Got unsupported message type: ${a}`);const s=a.name?`${a.name}, `:"";r.push(`${i}: ${s}${a.content}`)}return r.join(`
`)}class yh extends _i{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:ne("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=ne("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var i;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let a;if(e.run_type==="llm"){const s=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(c=>Wr(c));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:s,response:e.outputs}}else if(e.run_type==="chain"){const s=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:s.filter(c=>c.type==="llm"),child_chain_runs:s.filter(c=>c.type==="chain"),child_tool_runs:s.filter(c=>c.type==="tool")}}else if(e.run_type==="tool"){const s=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(i=e.outputs)==null?void 0:i.output,action:JSON.stringify(r),child_llm_runs:s.filter(c=>c.type==="llm"),child_chain_runs:s.filter(c=>c.type==="chain"),child_tool_runs:s.filter(c=>c.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return a}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const a=await t.json();return a.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=a,this.session=r,r)}}async function bh(n){const e=new yh;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function vh(){return new ph}let ki;function _h(){const n="default"in st?st.default:st;return new n({autoStart:!0,concurrency:1})}async function Oe(n,e){e===!0?await n():(typeof ki>"u"&&(ki=_h()),ki.add(n))}function yu(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class wh{setHandler(e){return this.setHandlers([e])}}class Gr{constructor(e,t,r,a,i,s,o,c){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:c})}async handleText(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleText: ${a}`)}},t.awaitHandlers)))}}class Ah extends Gr{getChild(e){const t=new De(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${a}`)}},t.awaitHandlers)))}}class bu extends Gr{async handleLLMNewToken(e,t,r,a,i,s){await Promise.all(this.handlers.map(o=>Oe(async()=>{var c;if(!o.ignoreLLM)try{await((c=o.handleLLMNewToken)==null?void 0:c.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${a}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${a}`)}},t.awaitHandlers)))}}class Eh extends Gr{getChild(e){const t=new De(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(s=>Oe(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(c){console.error(`Error in handler ${s.constructor.name}, handleChainError: ${c}`)}},s.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(s=>Oe(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(c){console.error(`Error in handler ${s.constructor.name}, handleChainEnd: ${c}`)}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${a}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${a}`)}},t.awaitHandlers)))}}class Ch extends Gr{getChild(e){const t=new De(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${a}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Oe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${a}`)}},t.awaitHandlers)))}}class De extends wh{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,a=void 0,i=void 0){return Promise.all(t.map(async s=>{const o=ot();return await Promise.all(this.handlers.map(c=>Oe(async()=>{var u;if(!c.ignoreLLM)try{await((u=c.handleLLMStart)==null?void 0:u.call(c,e,[s],o,this._parentRunId,i,this.tags,this.metadata))}catch(l){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${l}`)}},c.awaitHandlers))),new bu(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,a=void 0,i=void 0){return Promise.all(t.map(async s=>{const o=ot();return await Promise.all(this.handlers.map(c=>Oe(async()=>{var u,l;if(!c.ignoreLLM)try{if(c.handleChatModelStart)await((u=c.handleChatModelStart)==null?void 0:u.call(c,e,[s],o,this._parentRunId,i,this.tags,this.metadata));else if(c.handleLLMStart){const m=Wr(s);await((l=c.handleLLMStart)==null?void 0:l.call(c,e,[m],o,this._parentRunId,i,this.tags,this.metadata))}}catch(m){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${m}`)}},c.awaitHandlers))),new bu(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=ot(),a=void 0){return await Promise.all(this.handlers.map(i=>Oe(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainStart)==null?void 0:s.call(i,e,t,r,this._parentRunId,this.tags,this.metadata,a))}catch(o){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${o}`)}},i.awaitHandlers))),new Eh(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=ot()){return await Promise.all(this.handlers.map(a=>Oe(async()=>{var i;if(!a.ignoreAgent)try{await((i=a.handleToolStart)==null?void 0:i.call(a,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(s){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${s}`)}},a.awaitHandlers))),new Ch(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=ot(),a=void 0){return await Promise.all(this.handlers.map(i=>Oe(async()=>{var s;if(!i.ignoreRetriever)try{await((s=i.handleRetrieverStart)==null?void 0:s.call(i,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(o){console.error(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${o}`)}},i.awaitHandlers))),new Ah(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new De(this._parentRunId);for(const a of this.handlers){const i=this.inheritableHandlers.includes(a);r.addHandler(a,i)}for(const a of this.tags){const i=this.inheritableTags.includes(a);r.addTags([a],i)}for(const a of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},i)}for(const a of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends or{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ot()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,i,s,o){let c;(e||t)&&(Array.isArray(e)||!e?(c=new De,c.setHandlers((e==null?void 0:e.map(vu))??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(vu):t==null?void 0:t.handlers,!1));const u=ne("LANGCHAIN_VERBOSE")||(o==null?void 0:o.verbose),l=ne("LANGCHAIN_TRACING_V2")==="true",m=l||(ne("LANGCHAIN_TRACING")??!1);if(u||m){if(c||(c=new De),u&&!c.handlers.some(h=>h.name===cu.prototype.name)){const h=new cu;c.addHandler(h,!0)}if(m&&!c.handlers.some(h=>h.name==="langchain_tracer"))if(l)c.addHandler(await vh(),!0);else{const h=ne("LANGCHAIN_PROJECT")&&ne("LANGCHAIN_SESSION");c.addHandler(await bh(h),!0)}}return(r||a)&&c&&(c.addTags(r??[]),c.addTags(a??[],!1)),(i||s)&&c&&(c.addMetadata(i??{}),c.addMetadata(s??{},!1)),c}}function vu(n){return"name"in n?n:or.fromMethods(n)}class Yr extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();const e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new Yr({start(r){return a();function a(){return t.read().then(({done:i,value:s})=>{if(i){r.close();return}return r.enqueue(s),a()})}}})}static fromAsyncGenerator(e){return new Yr({async pull(t){const{value:r,done:a}=await e.next();a?t.close():r&&t.enqueue(r)}})}}async function St(n){return De.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function Re(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class Pe extends ut{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new Xr({bound:this,kwargs:e,config:{}})}map(){return new Ii({bound:this})}withRetry(e){return new Ph({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Xr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new Sh({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),i=new qr({maxConcurrency:r==null?void 0:r.maxConcurrency,onFailedAttempt:o=>{throw o}}),s=e.map((o,c)=>i.call(async()=>{try{return await this.invoke(o,a[c])}catch(u){if(r!=null&&r.returnExceptions)return u;throw u}}));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return Yr.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){const a=await St(r),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),Re(t,"input"),void 0,r==null?void 0:r.runType));let s;try{s=await e.bind(this)(t,r,i)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(Re(s,"output"))),s}async _batchWithConfig(e,t,r,a){const i=this._getOptionsList(r??{},t.length),s=await Promise.all(i.map(St)),o=await Promise.all(s.map((u,l)=>u==null?void 0:u.handleChainStart(this.toJSON(),Re(t[l],"input"))));let c;try{c=await e(t,i,o,a)}catch(u){throw await Promise.all(o.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Re(c,"output")))),c}async*_transformStreamWithConfig(e,t,r){let a,i=!0,s,o=!0;const c=await St(r);let u;const l=this.toJSON();async function*m(){for await(const y of e){if(u||(u=await(c==null?void 0:c.handleChainStart(l,{input:""},void 0,r==null?void 0:r.runType))),i)if(a===void 0)a=y;else try{a=a.concat(y)}catch{a=void 0,i=!1}yield y}}const h=m();try{const y=t(h,u,r);for await(const p of y)if(yield p,o)if(s===void 0)s=p;else try{s=s.concat(p)}catch{s=void 0,o=!1}}catch(y){throw await(u==null?void 0:u.handleChainError(y,void 0,void 0,void 0,{inputs:Re(a,"input")})),y}await(u==null?void 0:u.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:Re(a,"input")}))}_patchConfig(e={},t=void 0){return{...e,callbacks:t}}pipe(e){return new Ut({first:this,last:Ot(e)})}async*transform(e,t){let r;for await(const a of e)r?r=r.concat(a):r=a;yield*this._streamIterator(r,t)}static isRunnable(e){return e.lc_runnable}}class Xr extends Pe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config}_mergeConfig(e){const t={...this.config};if(e)for(const r of Object.keys(e))r==="metadata"?t[r]={...t[r],...e[r]}:r==="tags"?t[r]=(t[r]??[]).concat(e[r]??[]):t[r]=e[r]??t[r];return t}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){const a=Array.isArray(t)?t.map(i=>this._mergeConfig({...i,...this.kwargs})):this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,this._mergeConfig({...t,...this.kwargs}))}async*transform(e,t){yield*this.bound.transform(e,this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&Pe.isRunnable(e.bound)}}class Ii extends Pe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ii({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r==null?void 0:r.getChild()))}}class Ph extends Xr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r==null?void 0:r.getChild(a))}async _invoke(e,t,r){return Ur(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){const i={};try{await Ur(async s=>{const o=e.map((h,y)=>y).filter(h=>i[h.toString()]===void 0||i[h.toString()]instanceof Error),c=o.map(h=>e[h]),u=o.map(h=>this._patchConfigForRetry(s,t==null?void 0:t[h],r==null?void 0:r[h])),l=await super.batch(c,u,{...a,returnExceptions:!0});let m;for(let h=0;h<l.length;h+=1){const y=l[h],p=o[h];y instanceof Error&&m===void 0&&(m=y),i[p.toString()]=y}if(m)throw m;return l},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((a==null?void 0:a.returnExceptions)!==!0)throw s}return Object.keys(i).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>i[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Ut extends Pe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await St(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Re(e,"input")));let i=e,s;try{const o=[this.first,...this.middle];for(let c=0;c<o.length;c+=1)i=await o[c].invoke(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${c+1}`)));s=await this.last.invoke(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${this.steps.length}`)))}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(Re(s,"output"))),s}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(St)),s=await Promise.all(i.map((u,l)=>u==null?void 0:u.handleChainStart(this.toJSON(),Re(e[l],"input"))));let o=e,c;try{const u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1)o=await u[l].batch(o,s.map((h,y)=>this._patchConfig(a[y],h==null?void 0:h.getChild(`seq:step:${l+1}`))),r);c=await this.last.batch(o,s.map(l=>this._patchConfig(a[this.steps.length-1],l==null?void 0:l.getChild(`seq:step:${this.steps.length}`))),r)}catch(u){throw await Promise.all(s.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(s.map((u,l)=>u==null?void 0:u.handleChainEnd(Re(c[l],"output")))),c}async*_streamIterator(e,t){const r=await St(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Re(e,"input")));let i=e;const s=[this.first,...this.middle,this.last],o=Math.min(s.length-1,s.length-[...s].reverse().findIndex(l=>{var y;const m=l.transform===Pe.prototype.transform,h=Xr.isRunnableBinding(l)&&((y=l.bound)==null?void 0:y.transform)===Pe.prototype.transform;return m||h})-1);try{const l=s.slice(0,o);for(let m=0;m<l.length;m+=1)i=await l[m].invoke(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${m+1}`)))}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}let c=!0,u;try{let l=await s[o]._streamIterator(i,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${o+1}`)));const m=s.slice(o+1);for(let h=0;h<m.length;h+=1)l=await m[h].transform(l,this._patchConfig(t,a==null?void 0:a.getChild(`seq:step:${o+h+2}`)));for await(const h of l)if(yield h,c)if(u===void 0)u=h;else try{u=u.concat(h)}catch{u=void 0,c=!1}}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}await(a==null?void 0:a.handleChainEnd(Re(u,"output")))}pipe(e){return Ut.isRunnableSequence(e)?new Ut({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}):new Ut({first:this.first,middle:[...this.middle,this.last],last:Ot(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Pe.isRunnable(e)}static from([e,...t]){return new Ut({first:Ot(e),middle:t.slice(0,-1).map(Ot),last:Ot(t[t.length-1])})}}class kh extends Pe{static lc_name(){return"RunnableMap"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Ot(r)}async invoke(e,t){const r=await St(t),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),{input:e})),i={};try{for(const[s,o]of Object.entries(this.steps)){const c=await o.invoke(e,this._patchConfig(t,a==null?void 0:a.getChild()));i[s]=c}}catch(s){throw await(a==null?void 0:a.handleChainError(s)),s}return await(a==null?void 0:a.handleChainEnd(i)),i}}class Ih extends Pe{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async _invoke(e,t,r){let a=await this.func(e);return a&&Pe.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r==null?void 0:r.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class Sh extends Pe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await De.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Re(e,"input")));let i;for(const s of this.runnables())try{const o=await s.invoke(e,this._patchConfig(t,a==null?void 0:a.getChild()));return await(a==null?void 0:a.handleChainEnd(Re(o,"output"))),o}catch(o){i===void 0&&(i=o)}throw i===void 0?new Error("No error stored at end of fallback."):(await(a==null?void 0:a.handleChainError(i)),i)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(c=>De.configure(c==null?void 0:c.callbacks,void 0,c==null?void 0:c.tags,void 0,c==null?void 0:c.metadata))),s=await Promise.all(i.map((c,u)=>c==null?void 0:c.handleChainStart(this.toJSON(),Re(e[u],"input"))));let o;for(const c of this.runnables())try{const u=await c.batch(e,s.map((l,m)=>this._patchConfig(a[m],l==null?void 0:l.getChild())),r);return await Promise.all(s.map((l,m)=>l==null?void 0:l.handleChainEnd(Re(u[m],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Ot(n){if(typeof n=="function")return new Ih({func:n});if(Pe.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Ot(r);return new kh({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class Oh extends Pe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}invoke(e,t){return this.transformDocuments(e)}}class Bh extends Oh{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const a=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${a})`))}else r=e.split(t);else r=e.split("");return r.filter(a=>a!=="")}async createDocuments(e,t=[],r={}){const a=t.length>0?t:new Array(e.length).fill({}),{chunkHeader:i="",chunkOverlapHeader:s="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,c=new Array;for(let u=0;u<e.length;u+=1){const l=e[u];let m=1,h=null;for(const y of await this.splitText(l)){let p=i,A=0;if(h){const g=l.indexOf(y),v=l.indexOf(h)+await this.lengthFunction(h);A=(l.slice(v,g).match(/\n/g)||[]).length,o&&(p+=s)}m+=A;const f=(y.match(/\n/g)||[]).length,P=a[u].loc&&typeof a[u].loc=="object"?{...a[u].loc}:{};P.lines={from:m,to:m+f};const b={...a[u],loc:P};p+=y,c.push(new $r({pageContent:p,metadata:b})),m+=f,h=y}}return c}async splitDocuments(e,t={}){const r=e.filter(s=>s.pageContent!==void 0),a=r.map(s=>s.pageContent),i=r.map(s=>s.metadata);return this.createDocuments(a,i,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}async mergeSplits(e,t){const r=[],a=[];let i=0;for(const o of e){const c=await this.lengthFunction(o);if(i+c+(a.length>0?t.length:0)>this.chunkSize&&(i>this.chunkSize&&console.warn(`Created a chunk of size ${i}, +
which is longer than the specified ${this.chunkSize}`),a.length>0)){const u=this.joinDocs(a,t);for(u!==null&&r.push(u);i>this.chunkOverlap||i+c>this.chunkSize&&i>0;)i-=await this.lengthFunction(a[0]),a.shift()}a.push(o),i+=c}const s=this.joinDocs(a,t);return s!==null&&r.push(s),r}}class Jr extends Bh{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let a=t[t.length-1],i;for(let u=0;u<t.length;u+=1){const l=t[u];if(l===""){a=l;break}if(e.includes(l)){a=l,i=t.slice(u+1);break}}const s=this.splitOnSeparator(e,a);let o=[];const c=this.keepSeparator?"":a;for(const u of s)if(await this.lengthFunction(u)<this.chunkSize)o.push(u);else{if(o.length){const l=await this.mergeSplits(o,c);r.push(...l),o=[]}if(!i)r.push(u);else{const l=await this._splitText(u,i);r.push(...l)}}if(o.length){const u=await this.mergeSplits(o,c);r.push(...u)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new Jr({...t,separators:Jr.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}const Kt="4.19.0";let _u=!1,ur,wu,Au,Si,Eu,Cu,Pu,ku,Iu;function Th(n,e={auto:!1}){if(_u)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(ur)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${ur}'\``);_u=e.auto,ur=n.kind,wu=n.fetch,n.Request,n.Response,n.Headers,Au=n.FormData,n.Blob,Si=n.File,Eu=n.ReadableStream,Cu=n.getMultipartRequestOptions,Pu=n.getDefaultAgent,ku=n.fileFromPath,Iu=n.isFsReadStream}let Dh=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Rh({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,a,i;try{t=fetch,r=Request,a=Response,i=Headers}catch(s){throw new Error(`this environment is missing the following Web Fetch API type: ${s.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:a,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(s,o)=>({...o,body:new Dh(s)}),getDefaultAgent:s=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:s=>!1}}ur||Th(Rh(),{auto:!0});class ce extends Error{}let He=class Qs extends ce{constructor(e,t,r,a){super(`${Qs.makeMessage(e,t,r)}`),this.status=e,this.headers=a;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const a=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,r,a){if(!e)return new Qr({cause:Fi(t)});const i=t==null?void 0:t.error;return e===400?new Su(e,i,r,a):e===401?new Ou(e,i,r,a):e===403?new Bu(e,i,r,a):e===404?new Tu(e,i,r,a):e===409?new Du(e,i,r,a):e===422?new Ru(e,i,r,a):e===429?new Fu(e,i,r,a):e>=500?new Nu(e,i,r,a):new Qs(e,i,r,a)}},Bt=class extends He{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Qr=class extends He{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},Oi=class extends Qr{constructor({message:e}={}){super({message:e??"Request timed out."})}},Su=class extends He{constructor(){super(...arguments),this.status=400}},Ou=class extends He{constructor(){super(...arguments),this.status=401}},Bu=class extends He{constructor(){super(...arguments),this.status=403}},Tu=class extends He{constructor(){super(...arguments),this.status=404}},Du=class extends He{constructor(){super(...arguments),this.status=409}},Ru=class extends He{constructor(){super(...arguments),this.status=422}},Fu=class extends He{constructor(){super(...arguments),this.status=429}},Nu=class extends He{},Bi=class jr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;const a=new Fh;async function*i(){if(!e.body)throw t.abort(),new ce("Attempted to iterate over a response with no body");const o=new en,c=ju(e.body);for await(const u of c)for(const l of o.decode(u)){const m=a.decode(l);m&&(yield m)}for(const u of o.flush()){const l=a.decode(u);l&&(yield l)}}async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of i())if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null){let u;try{u=JSON.parse(c.data)}catch(l){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),l}if(u&&u.error)throw new He(void 0,u.error,void 0,void 0);yield u}}o=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{o||t.abort()}}return new jr(s,t)}static fromReadableStream(e,t){let r=!1;async function*a(){const s=new en,o=ju(e);for await(const c of o)for(const u of s.decode(c))yield u;for(const c of s.flush())yield c}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of a())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{s||t.abort()}}return new jr(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){const s=r.next();e.push(s),t.push(s)}return i.shift()}});return[new jr(()=>a(e),this.controller),new jr(()=>a(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Eu({async start(){t=e[Symbol.asyncIterator]()},async pull(a){try{const{value:i,done:s}=await t.next();if(s)return a.close();const o=r.encode(JSON.stringify(i)+`
`);a.enqueue(o)}catch(i){a.error(i)}},async cancel(){var a;await((a=t.return)==null?void 0:a.call(t))}})}},Fh=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=Nh(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}},en=class eo{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=eo.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(eo.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ce(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ce(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ce("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};en.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","Â","\u2028","\u2029"]),en.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Nh(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function ju(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Lu=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",jh=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&$u(n),$u=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Lh=n=>jh(n)||Lu(n)||Iu(n);async function zu(n,e,t={}){var a;if(n=await n,Lu(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new Si([i],e,t)}const r=await $h(n);if(e||(e=Mh(n)??"unknown_file"),!t.type){const i=(a=r[0])==null?void 0:a.type;typeof i=="string"&&(t={...t,type:i})}return new Si(r,e,t)}async function $h(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if($u(n))e.push(await n.arrayBuffer());else if(Uh(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${zh(n)}`);return e}function zh(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Mh(n){var e;return Ti(n.name)||Ti(n.filename)||((e=Ti(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Ti=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Uh=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Mu=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",cr=async n=>{const e=await Kh(n.body);return Cu(e,n)},Kh=async n=>{const e=new Au;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Di(e,t,r))),e},Di=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Lh(t)){const r=await zu(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Di(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>Di(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Hh=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},qh=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},tn;async function Uu(n){const{response:e}=n;if(n.options.stream)return lr("response",e.status,e.url,e.headers,e.body),Bi.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if(t!=null&&t.includes("application/json")){const a=await e.json();return lr("response",e.status,e.url,e.headers,a),a}const r=await e.text();return lr("response",e.status,e.url,e.headers,r),r}let Ku=class wl extends Promise{constructor(e,t=Uu){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new wl(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Vh=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=Ri("maxRetries",t),this.timeout=Ri("timeout",r),this.httpAgent=a,this.fetch=i??wu}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Jh(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${nd()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(a=>({method:e,path:t,...a})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var p;const{method:t,path:r,query:a,headers:i={}}=e,s=Mu(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(s),c=this.buildURL(r,a);"timeout"in e&&Ri("timeout",e.timeout);const u=e.timeout??this.timeout,l=e.httpAgent??this.httpAgent??Pu(c),m=u+1e3;typeof((p=l==null?void 0:l.options)==null?void 0:p.timeout)=="number"&&m>(l.options.timeout??0)&&(l.options.timeout=m),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const h={...o&&{"Content-Length":o},...this.defaultHeaders(e),...i};Mu(e.body)&&ur!=="node"&&delete h["Content-Type"],Object.keys(h).forEach(A=>h[A]===null&&delete h[A]);const y={method:t,...s&&{body:s},headers:h,...l&&{agent:l},signal:e.signal??null};return this.validateHeaders(h,i),{req:y,url:c,timeout:u}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return He.generate(e,t,r,a)}request(e,t=null){return new Ku(this.makeRequest(e,t))}async makeRequest(e,t){var l,m;const r=await e;t==null&&(t=r.maxRetries??this.maxRetries);const{req:a,url:i,timeout:s}=this.buildRequest(r);if(await this.prepareRequest(a,{url:i,options:r}),lr("request",i,r,a.headers),(l=r.signal)!=null&&l.aborted)throw new Bt;const o=new AbortController,c=await this.fetchWithTimeout(i,a,s,o).catch(Fi);if(c instanceof Error){if((m=r.signal)!=null&&m.aborted)throw new Bt;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new Oi:new Qr({cause:c})}const u=Wh(c.headers);if(!c.ok){if(t&&this.shouldRetry(c))return this.retryRequest(r,t,u);const h=await c.text().catch(f=>Fi(f).message),y=Qh(h),p=y?void 0:h;throw lr("response",c.status,i,u,p),this.makeStatusError(c.status,y,p,u)}return{response:c,options:r,controller:o}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Zh(this,r,e)}buildURL(e,t){const r=td(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Yu(a)||(t={...a,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ce(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){const{signal:i,...s}=t||{};i&&i.addEventListener("abort",()=>a.abort());const o=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:a.signal,...s}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let a;const i=r==null?void 0:r["retry-after"];if(i){const s=parseInt(i);Number.isNaN(s)?a=Date.parse(i)-Date.now():a=s*1e3}if(!a||!Number.isInteger(a)||a<=0||a>60*1e3){const s=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,s)}return await Wu(a),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,s=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return s*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Kt}`}},Hu=class{constructor(e,t,r,a){tn.set(this,void 0),Hh(this,tn,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ce("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,i]of r)e.url.searchParams.set(a,i);t.query=void 0,t.path=e.url.toString()}return await qh(this,tn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(tn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Zh=class extends Ku{constructor(e,t,r){super(t,async a=>new r(e,a.response,await Uu(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const Wh=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Gh={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0},et=n=>typeof n=="object"&&n!==null&&!Yu(n)&&Object.keys(n).every(e=>rd(Gh,e)),Yh=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Kt,"X-Stainless-OS":Vu(Deno.build.os),"X-Stainless-Arch":qu(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Kt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Kt,"X-Stainless-OS":Vu(process.platform),"X-Stainless-Arch":qu(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Xh();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Kt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Kt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Xh(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${a}.${i}.${s}`}}}return null}const qu=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Vu=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Zu;const Jh=()=>Zu??(Zu=Yh()),Qh=n=>{try{return JSON.parse(n)}catch{return}},ed=new RegExp("^(?:[a-z]+:)?//","i"),td=n=>ed.test(n),Wu=n=>new Promise(e=>setTimeout(e,n)),Ri=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ce(`${n} must be an integer`);if(e<0)throw new ce(`${n} must be a positive integer`);return e},Fi=n=>n instanceof Error?n:new Error(n),Gu=n=>{var e,t,r;if(typeof process<"u")return((e=process.env)==null?void 0:e[n])??void 0;if(typeof Deno<"u")return(r=(t=Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n)};function Yu(n){if(!n)return!0;for(const e in n)return!1;return!0}function rd(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function lr(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const nd=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),ad=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";let rn=class extends Hu{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data,this.object=r.object}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}},ct=class extends Hu{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t,r;if(!((t=this.data)!=null&&t.length))return null;const e=(r=this.data[this.data.length-1])==null?void 0:r.id;return e?{params:{after:e}}:null}},xe=class{constructor(e){this._client=e}},nn=class extends xe{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};nn||(nn={});let an=class extends xe{constructor(){super(...arguments),this.completions=new nn(this._client)}};(function(n){n.Completions=nn})(an||(an={}));class sn extends xe{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}sn||(sn={});let on=class extends xe{create(e,t){return this._client.post("/audio/transcriptions",cr({body:e,...t}))}};on||(on={});let un=class extends xe{create(e,t){return this._client.post("/audio/translations",cr({body:e,...t}))}};un||(un={});let cn=class extends xe{constructor(){super(...arguments),this.transcriptions=new on(this._client),this.translations=new un(this._client),this.speech=new sn(this._client)}};(function(n){n.Transcriptions=on,n.Translations=un,n.Speech=sn})(cn||(cn={}));let ln=class extends xe{create(e,t,r){return this._client.post(`/assistants/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t={},r){return et(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,Ni,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}};class Ni extends ct{}(function(n){n.AssistantFilesPage=Ni})(ln||(ln={}));class hn extends xe{constructor(){super(...arguments),this.files=new ln(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e={},t){return et(e)?this.list({},e):this._client.getAPIList("/assistants",ji,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}}class ji extends ct{}(function(n){n.AssistantsPage=ji,n.Files=ln,n.AssistantFilesPage=Ni})(hn||(hn={}));function Xu(n){return typeof n.parse=="function"}const hr=n=>(n==null?void 0:n.role)==="assistant",Ju=n=>(n==null?void 0:n.role)==="function",id=n=>(n==null?void 0:n.role)==="tool";var Xe=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},ie=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},je,dn,fn,dr,fr,pn,pr,lt,mr,mn,xn,Ht,Li,$i,zi,Mi,Ui,Ki,Qu,Hi;const ec=10;class tc{constructor(){je.add(this),this.controller=new AbortController,dn.set(this,void 0),fn.set(this,()=>{}),dr.set(this,()=>{}),fr.set(this,void 0),pn.set(this,()=>{}),pr.set(this,()=>{}),lt.set(this,{}),this._chatCompletions=[],this.messages=[],mr.set(this,!1),mn.set(this,!1),xn.set(this,!1),Ht.set(this,!1),Ki.set(this,e=>{if(Xe(this,mn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Bt),e instanceof Bt)return Xe(this,xn,!0,"f"),this._emit("abort",e);if(e instanceof ce)return this._emit("error",e);if(e instanceof Error){const t=new ce(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ce(String(e)))}),Xe(this,dn,new Promise((e,t)=>{Xe(this,fn,e,"f"),Xe(this,dr,t,"f")}),"f"),Xe(this,fr,new Promise((e,t)=>{Xe(this,pn,e,"f"),Xe(this,pr,t,"f")}),"f"),ie(this,dn,"f").catch(()=>{}),ie(this,fr,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ie(this,Ki,"f"))},0)}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if(this.messages.push(e),t){if(this._emit("message",e),(Ju(e)||id(e))&&e.content)this._emit("functionCallResult",e.content);else if(hr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(hr(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}_connected(){this.ended||(ie(this,fn,"f").call(this),this._emit("connect"))}get ended(){return ie(this,mr,"f")}get errored(){return ie(this,mn,"f")}get aborted(){return ie(this,xn,"f")}abort(){this.controller.abort()}on(e,t){return(ie(this,lt,"f")[e]||(ie(this,lt,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=ie(this,lt,"f")[e];if(!r)return this;const a=r.findIndex(i=>i.listener===t);return a>=0&&r.splice(a,1),this}once(e,t){return(ie(this,lt,"f")[e]||(ie(this,lt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Xe(this,Ht,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Xe(this,Ht,!0,"f"),await ie(this,fr,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ce("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ie(this,je,"m",Li).call(this)}async finalMessage(){return await this.done(),ie(this,je,"m",$i).call(this)}async finalFunctionCall(){return await this.done(),ie(this,je,"m",zi).call(this)}async finalFunctionCallResult(){return await this.done(),ie(this,je,"m",Mi).call(this)}async totalUsage(){return await this.done(),ie(this,je,"m",Ui).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(ie(this,mr,"f"))return;e==="end"&&(Xe(this,mr,!0,"f"),ie(this,pn,"f").call(this));const r=ie(this,lt,"f")[e];if(r&&(ie(this,lt,"f")[e]=r.filter(a=>!a.once),r.forEach(({listener:a})=>a(...t))),e==="abort"){const a=t[0];!ie(this,Ht,"f")&&!(r!=null&&r.length)&&Promise.reject(a),ie(this,dr,"f").call(this,a),ie(this,pr,"f").call(this,a),this._emit("end");return}if(e==="error"){const a=t[0];!ie(this,Ht,"f")&&!(r!=null&&r.length)&&Promise.reject(a),ie(this,dr,"f").call(this,a),ie(this,pr,"f").call(this,a),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=this.messages[this.messages.length-1];t&&this._emit("finalMessage",t);const r=ie(this,je,"m",Li).call(this);r&&this._emit("finalContent",r);const a=ie(this,je,"m",zi).call(this);a&&this._emit("finalFunctionCall",a);const i=ie(this,je,"m",Mi).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(s=>s.usage)&&this._emit("totalUsage",ie(this,je,"m",Ui).call(this))}async _createChatCompletion(e,t,r){const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),ie(this,je,"m",Qu).call(this,t);const i=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,r){for(const a of t.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const a="function",{function_call:i="auto",stream:s,...o}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:u=ec}=r||{},l={};for(const y of t.functions)l[y.name||y.function.name]=y;const m=t.functions.map(y=>({name:y.name||y.function.name,parameters:y.parameters,description:y.description}));for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<u;++y){const A=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:m,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!A)throw new ce("missing message in ChatCompletion response");if(!A.function_call)return;const{name:f,arguments:P}=A.function_call,b=l[f];if(b){if(c&&c!==f){const w=`Invalid function_call: ${JSON.stringify(f)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:a,name:f,content:w});continue}}else{const w=`Invalid function_call: ${JSON.stringify(f)}. Available options are: ${m.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:f,content:w});continue}let g;try{g=Xu(b)?await b.parse(P):P}catch(w){this._addMessage({role:a,name:f,content:w instanceof Error?w.message:String(w)});continue}const v=await b.function(g,this),O=ie(this,je,"m",Hi).call(this,v);if(this._addMessage({role:a,name:f,content:O}),c)return}}async _runTools(e,t,r){var h,y;const a="tool",{tool_choice:i="auto",stream:s,...o}=t,c=typeof i!="string"&&((h=i==null?void 0:i.function)==null?void 0:h.name),{maxChatCompletions:u=ec}=r||{},l={};for(const p of t.tools)p.type==="function"&&(l[p.function.name||p.function.function.name]=p.function);const m="tools"in t?t.tools.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description}}:p):void 0;for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<u;++p){const f=(y=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:y.message;if(!f)throw new ce("missing message in ChatCompletion response");if(!f.tool_calls)return;for(const P of f.tool_calls){if(P.type!=="function")continue;const b=P.id,{name:g,arguments:v}=P.function,O=l[g];if(O){if(c&&c!==g){const E=`Invalid tool_call: ${JSON.stringify(g)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:a,tool_call_id:b,content:E});continue}}else{const E=`Invalid tool_call: ${JSON.stringify(g)}. Available options are: ${m.map(d=>JSON.stringify(d.function.name)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:b,content:E});continue}let w;try{w=Xu(O)?await O.parse(v):v}catch(E){const d=E instanceof Error?E.message:String(E);this._addMessage({role:a,tool_call_id:b,content:d});continue}const k=await O.function(w,this),x=ie(this,je,"m",Hi).call(this,k);if(this._addMessage({role:a,tool_call_id:b,content:x}),c)return}}}}dn=new WeakMap,fn=new WeakMap,dr=new WeakMap,fr=new WeakMap,pn=new WeakMap,pr=new WeakMap,lt=new WeakMap,mr=new WeakMap,mn=new WeakMap,xn=new WeakMap,Ht=new WeakMap,Ki=new WeakMap,je=new WeakSet,Li=function(){return ie(this,je,"m",$i).call(this).content},$i=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(hr(t))return t}throw new ce("stream ended without producing a ChatCompletionMessage with role=assistant")},zi=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(hr(t)&&(t!=null&&t.function_call))return t.function_call}},Mi=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ju(t)&&t.content!=null)return t.content}},Ui=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Qu=function(e){if(e.n!=null&&e.n>1)throw new ce("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Hi=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class xr extends tc{static runFunctions(e,t,r){const a=new xr;return a._run(()=>a._runFunctions(e,t,r)),a}static runTools(e,t,r){const a=new xr;return a._run(()=>a._runTools(e,t,r)),a}_addMessage(e){super._addMessage(e),hr(e)&&e.content&&this._emit("content",e.content)}}var Je=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},qi=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},tt,bt,Vi,Zi,gn,rc;class gr extends tc{constructor(){super(...arguments),tt.add(this),bt.set(this,void 0)}get currentChatCompletionSnapshot(){return Je(this,bt,"f")}static fromReadableStream(e){const t=new gr;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const a=new gr;return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,r){var s;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Je(this,tt,"m",Vi).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Je(this,tt,"m",Zi).call(this,o);if((s=i.controller.signal)!=null&&s.aborted)throw new Bt;return this._addChatCompletion(Je(this,tt,"m",gn).call(this))}async _fromReadableStream(e,t){var s;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Je(this,tt,"m",Vi).call(this),this._connected();const a=Bi.fromReadableStream(e,this.controller);let i;for await(const o of a)i&&i!==o.id&&this._addChatCompletion(Je(this,tt,"m",gn).call(this)),Je(this,tt,"m",Zi).call(this,o),i=o.id;if((s=a.controller.signal)!=null&&s.aborted)throw new Bt;return this._addChatCompletion(Je(this,tt,"m",gn).call(this))}[(bt=new WeakMap,tt=new WeakSet,Vi=function(){this.ended||qi(this,bt,void 0,"f")},Zi=function(t){var s,o,c;if(this.ended)return;const r=Je(this,tt,"m",rc).call(this,t);this._emit("chunk",t,r);const a=(o=(s=t.choices[0])==null?void 0:s.delta)==null?void 0:o.content,i=(c=r.choices[0])==null?void 0:c.message;a!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",a,i.content)},gn=function(){if(this.ended)throw new ce("stream has ended, this shouldn't happen");const t=Je(this,bt,"f");if(!t)throw new ce("request ended without sending any chunks");return qi(this,bt,void 0,"f"),sd(t)},rc=function(t){var r,a;let i=Je(this,bt,"f");const{choices:s,...o}=t;i?Object.assign(i,o):i=qi(this,bt,{...o,choices:[]},"f");for(const{delta:c,finish_reason:u,index:l,...m}of t.choices){let h=i.choices[l];if(!h){i.choices[l]={finish_reason:u,index:l,message:c,...m};continue}if(u&&(h.finish_reason=u),Object.assign(h,m),!c)continue;const{content:y,function_call:p,role:A,tool_calls:f}=c;if(y&&(h.message.content=(h.message.content||"")+y),A&&(h.message.role=A),p&&(h.message.function_call?(p.name&&(h.message.function_call.name=p.name),p.arguments&&((r=h.message.function_call).arguments??(r.arguments=""),h.message.function_call.arguments+=p.arguments)):h.message.function_call=p),f){h.message.tool_calls||(h.message.tool_calls=[]);for(const{index:P,id:b,type:g,function:v}of f){const O=(a=h.message.tool_calls)[P]??(a[P]={});b&&(O.id=b),g&&(O.type=g),v&&(O.function??(O.function={arguments:""})),v!=null&&v.name&&(O.function.name=v.name),v!=null&&v.arguments&&(O.function.arguments+=v.arguments)}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",a=>{const i=t.shift();i?i(a):e.push(a)}),this.on("end",()=>{r=!0;for(const a of t)a(void 0);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise(i=>t.push(i)).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0})}}toReadableStream(){return new Bi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sd(n){const{id:e,choices:t,created:r,model:a}=n;return{id:e,choices:t.map(({message:i,finish_reason:s,index:o})=>{if(!s)throw new ce(`missing finish_reason for choice ${o}`);const{content:c=null,function_call:u,tool_calls:l}=i,m=i.role;if(!m)throw new ce(`missing role for choice ${o}`);if(u){const{arguments:h,name:y}=u;if(h==null)throw new ce(`missing function_call.arguments for choice ${o}`);if(!y)throw new ce(`missing function_call.name for choice ${o}`);return{message:{content:c,function_call:{arguments:h,name:y},role:m},finish_reason:s,index:o}}return l?{index:o,finish_reason:s,message:{role:m,content:c,tool_calls:l.map((h,y)=>{const{function:p,type:A,id:f}=h,{arguments:P,name:b}=p||{};if(f==null)throw new ce(`missing choices[${o}].tool_calls[${y}].id
${yn(n)}`);if(A==null)throw new ce(`missing choices[${o}].tool_calls[${y}].type
${yn(n)}`);if(b==null)throw new ce(`missing choices[${o}].tool_calls[${y}].function.name
${yn(n)}`);if(P==null)throw new ce(`missing choices[${o}].tool_calls[${y}].function.arguments
${yn(n)}`);return{id:f,type:A,function:{name:b,arguments:P}}})}}:{message:{content:c,role:m},finish_reason:s,index:o}}),created:r,model:a,object:"chat.completion"}}function yn(n){return JSON.stringify(n)}class qt extends gr{static fromReadableStream(e){const t=new qt;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const a=new qt;return a._run(()=>a._runFunctions(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}})),a}static runTools(e,t,r){const a=new qt;return a._run(()=>a._runTools(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}})),a}}let nc=class extends xe{runFunctions(e,t){return e.stream?qt.runFunctions(this._client.chat.completions,e,t):xr.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?qt.runTools(this._client.chat.completions,e,t):xr.runTools(this._client.chat.completions,e,t)}stream(e,t){return gr.createChatCompletion(this._client.chat.completions,e,t)}},bn=class extends xe{constructor(){super(...arguments),this.completions=new nc(this._client)}};(function(n){n.Completions=nc})(bn||(bn={}));let vn=class extends xe{retrieve(e,t,r,a){return this._client.get(`/threads/${e}/messages/${t}/files/${r}`,{...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}list(e,t,r={},a){return et(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,Wi,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}};class Wi extends ct{}(function(n){n.MessageFilesPage=Wi})(vn||(vn={}));class _n extends xe{constructor(){super(...arguments),this.files=new vn(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}list(e,t={},r){return et(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Gi,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}}class Gi extends ct{}(function(n){n.ThreadMessagesPage=Gi,n.Files=vn,n.MessageFilesPage=Wi})(_n||(_n={}));class wn extends xe{retrieve(e,t,r,a){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}list(e,t,r={},a){return et(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Yi,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}}class Yi extends ct{}(function(n){n.RunStepsPage=Yi})(wn||(wn={}));class An extends xe{constructor(){super(...arguments),this.steps=new wn(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}list(e,t={},r){return et(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Xi,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}submitToolOutputs(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v1",...a==null?void 0:a.headers}})}}class Xi extends ct{}(function(n){n.RunsPage=Xi,n.Steps=wn,n.RunStepsPage=Yi})(An||(An={}));class En extends xe{constructor(){super(...arguments),this.runs=new An(this._client),this.messages=new _n(this._client)}create(e={},t){return et(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}}(function(n){n.Runs=An,n.RunsPage=Xi,n.Messages=_n,n.ThreadMessagesPage=Gi})(En||(En={}));class Cn extends xe{constructor(){super(...arguments),this.chat=new bn(this._client),this.assistants=new hn(this._client),this.threads=new En(this._client)}}(function(n){n.Chat=bn,n.Assistants=hn,n.AssistantsPage=ji,n.Threads=En})(Cn||(Cn={}));let Pn=class extends xe{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};Pn||(Pn={});let kn=class extends xe{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};kn||(kn={});let In=class extends xe{create(e,t){return this._client.post("/edits",{body:e,...t})}};In||(In={});let Sn=class extends xe{create(e,t){return this._client.post("/files",cr({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return et(e)?this.list({},e):this._client.getAPIList("/files",Ji,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const a=new Set(["processed","error","deleted"]),i=Date.now();let s=await this.retrieve(e);for(;!s.status||!a.has(s.status);)if(await Wu(t),s=await this.retrieve(e),Date.now()-i>r)throw new Oi({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}},Ji=class extends rn{};(function(n){n.FileObjectsPage=Ji})(Sn||(Sn={}));let On=class extends xe{create(e,t){return this._client.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine-tunes/${e}`,t)}list(e){return this._client.getAPIList("/fine-tunes",Qi,e)}cancel(e,t){return this._client.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){return this._client.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:(t==null?void 0:t.stream)??!1})}},Qi=class extends rn{};(function(n){n.FineTunesPage=Qi})(On||(On={}));let Bn=class extends xe{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return et(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",es,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return et(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,ts,{query:t,...r})}},es=class extends ct{},ts=class extends ct{};(function(n){n.FineTuningJobsPage=es,n.FineTuningJobEventsPage=ts})(Bn||(Bn={}));let Tn=class extends xe{constructor(){super(...arguments),this.jobs=new Bn(this._client)}};(function(n){n.Jobs=Bn,n.FineTuningJobsPage=es,n.FineTuningJobEventsPage=ts})(Tn||(Tn={}));let Dn=class extends xe{createVariation(e,t){return this._client.post("/images/variations",cr({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",cr({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};Dn||(Dn={});let Rn=class extends xe{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",rs,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},rs=class extends rn{};(function(n){n.ModelsPage=rs})(Rn||(Rn={}));let Fn=class extends xe{create(e,t){return this._client.post("/moderations",{body:e,...t})}};Fn||(Fn={});var ac;let ke=class extends Vh{constructor({apiKey:e=Gu("OPENAI_API_KEY"),organization:t=Gu("OPENAI_ORG_ID")??null,...r}={}){if(e===void 0)throw new ce("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:e,organization:t,...r,baseURL:r.baseURL??"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&ad())throw new ce(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Pn(this),this.chat=new an(this),this.edits=new In(this),this.embeddings=new kn(this),this.files=new Sn(this),this.images=new Dn(this),this.audio=new cn(this),this.moderations=new Fn(this),this.models=new Rn(this),this.fineTuning=new Tn(this),this.fineTunes=new On(this),this.beta=new Cn(this),this._options=a,this.apiKey=e,this.organization=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};ac=ke,ke.OpenAI=ac,ke.OpenAIError=ce,ke.APIError=He,ke.APIConnectionError=Qr,ke.APIConnectionTimeoutError=Oi,ke.APIUserAbortError=Bt,ke.NotFoundError=Tu,ke.ConflictError=Du,ke.RateLimitError=Fu,ke.BadRequestError=Su,ke.AuthenticationError=Ou,ke.InternalServerError=Nu,ke.PermissionDeniedError=Bu,ke.UnprocessableEntityError=Ru,function(n){n.toFile=zu,n.fileFromPath=ku,n.Page=rn,n.CursorPage=ct,n.Completions=Pn,n.Chat=an,n.Edits=In,n.Embeddings=kn,n.Files=Sn,n.FileObjectsPage=Ji,n.Images=Dn,n.Audio=cn,n.Moderations=Fn,n.Models=Rn,n.ModelsPage=rs,n.FineTuning=Tn,n.FineTunes=On,n.FineTunesPage=Qi,n.Beta=Cn}(ke||(ke={}));const od=ke,ht={sanitizeUrl:n=>{let e;try{e=new URL(n.trim())}catch{return null}return e.href.length>2048||!e.hostname?null:(e.pathname.length===1?e.pathname="/":e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),e.href)},md5:n=>Yl.MD5(n).toString(),currTs:()=>Date.now()/1e3,extractHtmlContent:n=>{let e=n;return e=e.replace(/\n+/g,`
`).replace(/\s+/g," ").trim(),e},text2docs:async(n,e)=>{const r=await new Jr({chunkSize:500,chunkOverlap:20}).createDocuments([n]);return e&&r.forEach(a=>{a.metadata=e}),r},testOpenAIKey:async n=>{try{return await new od({apiKey:n,dangerouslyAllowBrowser:!0}).chat.completions.create({messages:[{role:"user",content:"test"}],model:"gpt-3.5-turbo",max_tokens:1,n:1}),!0}catch{return!1}}},Vt="4.4.0";class ud{constructor(e,t){this.response=e,this.controller=t,this.decoder=new cd}async*iterMessages(){if(!this.response.body)throw this.controller.abort(),new Error("Attempted to iterate over a response with no body");const e=new Zt,t=hd(this.response.body);for await(const r of t)for(const a of e.decode(r)){const i=this.decoder.decode(a);i&&(yield i)}for(const r of e.flush()){const a=this.decoder.decode(r);a&&(yield a)}}async*[Symbol.asyncIterator](){let e=!1;try{for await(const t of this.iterMessages())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(t.event===null)try{yield JSON.parse(t.data)}catch(r){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),r}}e=!0}catch(t){if(t instanceof Error&&t.name==="AbortError")return;throw t}finally{e||this.controller.abort()}}}class cd{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=ld(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}}class Zt{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Zt.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(Zt.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Error(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!==null&&t!==void 0||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Error(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Error("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Zt.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","Â","\u2028","\u2029"]),Zt.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function ld(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function hd(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let qe=class to extends Error{constructor(e,t,r,a){super(to.makeMessage(t,r)),this.status=e,this.headers=a;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t){return e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):t||"Unknown error occurred"}static generate(e,t,r,a){if(!e)return new yr({cause:mc(t)});const i=t==null?void 0:t.error;return e===400?new as(e,i,r,a):e===401?new is(e,i,r,a):e===403?new ss(e,i,r,a):e===404?new os(e,i,r,a):e===409?new us(e,i,r,a):e===422?new cs(e,i,r,a):e===429?new ls(e,i,r,a):e>=500?new hs(e,i,r,a):new to(e,i,r,a)}},Nn=class extends qe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},yr=class extends qe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},ns=class extends yr{constructor(){super({message:"Request timed out."})}},as=class extends qe{constructor(){super(...arguments),this.status=400}},is=class extends qe{constructor(){super(...arguments),this.status=401}},ss=class extends qe{constructor(){super(...arguments),this.status=403}},os=class extends qe{constructor(){super(...arguments),this.status=404}},us=class extends qe{constructor(){super(...arguments),this.status=409}},cs=class extends qe{constructor(){super(...arguments),this.status=422}},ls=class extends qe{constructor(){super(...arguments),this.status=429}},hs=class extends qe{};const dd=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:yr,APIConnectionTimeoutError:ns,APIError:qe,APIUserAbortError:Nn,AuthenticationError:is,BadRequestError:as,ConflictError:us,InternalServerError:hs,NotFoundError:os,PermissionDeniedError:ss,RateLimitError:ls,UnprocessableEntityError:cs},Symbol.toStringTag,{value:"Module"})),fd=n=>{},pd=fetch.bind(void 0),md=!1,xd=FormData,ic=typeof File<"u"?File:class extends Blob{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'File' is not defined")}};async function gd(n,e){return{...e,body:new Pd(n)}}async function yd(){throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")}function bd(n){return!1}const sc=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",vd=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&oc(n),oc=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",_d=n=>vd(n)||sc(n)||bd();async function uc(n,e,t={}){var r,a,i;if(n=await n,sc(n)){const o=await n.blob();return e||(e=(r=new URL(n.url).pathname.split(/[\\/]/).pop())!==null&&r!==void 0?r:"unknown_file"),new ic([o],e,t)}const s=await wd(n);if(e||(e=(a=Ed(n))!==null&&a!==void 0?a:"unknown_file"),!t.type){const o=(i=s[0])===null||i===void 0?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new ic(s,e,t)}async function wd(n){var e;let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(oc(n))t.push(await n.arrayBuffer());else if(Cd(n))for await(const r of n)t.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(e=n==null?void 0:n.constructor)===null||e===void 0?void 0:e.name}; props: ${Ad(n)}`);return t}function Ad(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Ed(n){var e;return ds(n.name)||ds(n.filename)||((e=ds(n.path))===null||e===void 0?void 0:e.split(/[\\/]/).pop())}const ds=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Cd=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";class Pd{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const cc=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",br=async n=>{const e=await kd(n.body);return gd(e,n)},kd=async n=>{const e=new xd;return await Promise.all(Object.entries(n||{}).map(([t,r])=>fs(e,t,r))),e},fs=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(_d(t)){const r=await uc(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>fs(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>fs(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Id=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Sd=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},jn;const Od=2;async function lc(n){const{response:e}=n;if(n.options.stream)return new ud(e,n.controller);const t=e.headers.get("content-type");if(t!=null&&t.includes("application/json")){const a=await e.json();return zn("response",e.status,e.url,e.headers,a),a}const r=await e.text();return zn("response",e.status,e.url,e.headers,r),r}class Ln extends Promise{constructor(e,t=lc){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Ln(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Bd{constructor({baseURL:e,maxRetries:t,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=ps("maxRetries",t??Od),this.timeout=ps("timeout",r),this.httpAgent=a,this.fetch=i??pd}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...jd(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Kd()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(a=>({method:e,path:t,...a})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var t,r,a,i,s,o;const{method:c,path:u,query:l,headers:m={}}=e,h=cc(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,y=this.calculateContentLength(h),p=this.buildURL(u,l);"timeout"in e&&ps("timeout",e.timeout);const A=(t=e.timeout)!==null&&t!==void 0?t:this.timeout,f=(a=(r=e.httpAgent)!==null&&r!==void 0?r:this.httpAgent)!==null&&a!==void 0?a:fd(),P=A+1e3;typeof((i=f==null?void 0:f.options)===null||i===void 0?void 0:i.timeout)=="number"&&P>((s=f.options.timeout)!==null&&s!==void 0?s:0)&&(f.options.timeout=P),this.idempotencyHeader&&c!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),m[this.idempotencyHeader]=e.idempotencyKey);const b={...y&&{"Content-Length":y},...this.defaultHeaders(e),...m};cc(e.body)&&!md&&delete b["Content-Type"],Object.keys(b).forEach(v=>b[v]===null&&delete b[v]);const g={method:c,...h&&{body:h},headers:b,...f&&{agent:f},signal:(o=e.signal)!==null&&o!==void 0?o:null};return this.validateHeaders(b,m),{req:g,url:p,timeout:A}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return qe.generate(e,t,r,a)}request(e,t=null){return new Ln(this.makeRequest(e,t))}async makeRequest(e,t){var r,a,i;const s=await e;t==null&&(t=(r=s.maxRetries)!==null&&r!==void 0?r:this.maxRetries);const{req:o,url:c,timeout:u}=this.buildRequest(s);if(await this.prepareRequest(o,{url:c,options:s}),zn("request",c,s,o.headers),!((a=s.signal)===null||a===void 0)&&a.aborted)throw new Nn;const l=new AbortController,m=await this.fetchWithTimeout(c,o,u,l).catch(mc);if(m instanceof Error){if(!((i=s.signal)===null||i===void 0)&&i.aborted)throw new Nn;if(t)return this.retryRequest(s,t);throw m.name==="AbortError"?new ns:new yr({cause:m})}const h=Dd(m.headers);if(!m.ok){if(t&&this.shouldRetry(m))return this.retryRequest(s,t,h);const y=await m.text().catch(()=>"Unknown"),p=Ld(y),A=p?void 0:y;throw zn("response",m.status,c,h,A),this.makeStatusError(m.status,p,A,h)}return{response:m,options:s,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Td(this,r,e)}buildURL(e,t){const r=zd(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return gc(a)||(t={...a,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Error(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){const{signal:i,...s}=t||{};i&&i.addEventListener("abort",()=>a.abort());const o=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch(e,{signal:a.signal,...s}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var a;t-=1;const i=parseInt((r==null?void 0:r["retry-after"])||""),s=(a=e.maxRetries)!==null&&a!==void 0?a:this.maxRetries,o=this.calculateRetryTimeoutSeconds(t,i,s)*1e3;return await Md(o),this.makeRequest(e,t)}calculateRetryTimeoutSeconds(e,t,r){if(Number.isInteger(t)&&t<=60)return t;const s=r-e,o=Math.min(.5*Math.pow(s-1,2),2),c=Math.random()-.5;return o+c}getUserAgent(){return`${this.constructor.name}/JS ${Vt}`}}class hc{constructor(e,t,r,a){jn.set(this,void 0),Id(this,jn,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Error("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,i]of r)e.url.searchParams.set(a,i);t.query=void 0,t.path=e.url.toString()}return await Sd(this,jn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(jn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Td extends Ln{constructor(e,t,r){super(t,async a=>new r(e,a.response,await lc(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Dd=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Rd={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0},dc=n=>typeof n=="object"&&n!==null&&!gc(n)&&Object.keys(n).every(e=>Ud(Rd,e)),Fd=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":pc(Deno.build.os),"X-Stainless-Arch":fc(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":pc(process.platform),"X-Stainless-Arch":fc(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Nd();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Nd(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${a}.${i}.${s}`}}}return null}const fc=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",pc=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let $n;const jd=()=>$n??($n=Fd()),Ld=n=>{try{return JSON.parse(n)}catch{return}},$d=new RegExp("^(?:[a-z]+:)?//","i"),zd=n=>$d.test(n),Md=n=>new Promise(e=>setTimeout(e,n)),ps=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Error(`${n} must be an integer`);if(e<0)throw new Error(`${n} must be a positive integer`);return e},mc=n=>n instanceof Error?n:new Error(n),xc=n=>{var e,t,r,a;if(typeof process<"u")return(t=(e=process.env)===null||e===void 0?void 0:e[n])!==null&&t!==void 0?t:void 0;if(typeof Deno<"u")return(a=(r=Deno.env)===null||r===void 0?void 0:r.get)===null||a===void 0?void 0:a.call(r,n)};function gc(n){if(!n)return!0;for(const e in n)return!1;return!0}function Ud(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function zn(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const Kd=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Hd=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";class Mn extends hc{constructor(e,t,r,a){super(e,t,r,a),this.object=r.object,this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}}class ms extends hc{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e,t;if(!(!((e=this.data)===null||e===void 0)&&e.length))return null;const r=(t=this.data[this.data.length-1])===null||t===void 0?void 0:t.id;return r?{params:{after:r}}:null}}class Le{constructor(e){this.client=e,this.get=e.get.bind(e),this.post=e.post.bind(e),this.patch=e.patch.bind(e),this.put=e.put.bind(e),this.delete=e.delete.bind(e),this.getAPIList=e.getAPIList.bind(e)}}class Un extends Le{create(e,t){return this.post("/audio/transcriptions",br({body:e,...t}))}}Un||(Un={});class Kn extends Le{create(e,t){return this.post("/audio/translations",br({body:e,...t}))}}Kn||(Kn={});class Hn extends Le{constructor(){super(...arguments),this.transcriptions=new Un(this.client),this.translations=new Kn(this.client)}}(function(n){n.Transcriptions=Un,n.Translations=Kn})(Hn||(Hn={}));let qn=class extends Le{create(e,t){var r;return this.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}};qn||(qn={});class Vn extends Le{constructor(){super(...arguments),this.completions=new qn(this.client)}}(function(n){n.Completions=qn})(Vn||(Vn={}));class Zn extends Le{create(e,t){var r;return this.post("/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}}Zn||(Zn={});let Wn=class extends Le{create(e,t){return this.post("/embeddings",{body:e,...t})}};Wn||(Wn={});class Gn extends Le{create(e,t){return this.post("/edits",{body:e,...t})}}Gn||(Gn={});class Yn extends Le{create(e,t){return this.post("/files",br({body:e,...t}))}retrieve(e,t){return this.get(`/files/${e}`,t)}list(e){return this.getAPIList("/files",yc,e)}del(e,t){return this.delete(`/files/${e}`,t)}retrieveContent(e,t){return this.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}}class yc extends Mn{}Yn||(Yn={});class Xn extends Le{create(e,t){return this.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this.get(`/fine-tunes/${e}`,t)}list(e){return this.getAPIList("/fine-tunes",bc,e)}cancel(e,t){return this.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){var a;return this.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:(a=t==null?void 0:t.stream)!==null&&a!==void 0?a:!1})}}class bc extends Mn{}Xn||(Xn={});class Jn extends Le{create(e,t){return this.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return dc(e)?this.list({},e):this.getAPIList("/fine_tuning/jobs",vc,{query:e,...t})}cancel(e,t){return this.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return dc(t)?this.listEvents(e,{},t):this.getAPIList(`/fine_tuning/jobs/${e}/events`,_c,{query:t,...r})}}class vc extends ms{}class _c extends ms{}Jn||(Jn={});class Qn extends Le{constructor(){super(...arguments),this.jobs=new Jn(this.client)}}(function(n){n.Jobs=Jn,n.FineTuningJobsPage=vc,n.FineTuningJobEventsPage=_c})(Qn||(Qn={}));class ea extends Le{createVariation(e,t){return this.post("/images/variations",br({body:e,...t}))}edit(e,t){return this.post("/images/edits",br({body:e,...t}))}generate(e,t){return this.post("/images/generations",{body:e,...t})}}ea||(ea={});class ta extends Le{retrieve(e,t){return this.get(`/models/${e}`,t)}list(e){return this.getAPIList("/models",wc,e)}del(e,t){return this.delete(`/models/${e}`,t)}}class wc extends Mn{}ta||(ta={});class ra extends Le{create(e,t){return this.post("/moderations",{body:e,...t})}}ra||(ra={});var Ac;let we=class extends Bd{constructor(e){var t,r,{apiKey:a=xc("OPENAI_API_KEY"),organization:i=(t=xc("OPENAI_ORG_ID"))!==null&&t!==void 0?t:null,...s}=e===void 0?{}:e;if(a===void 0)throw new Error("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'my apiKey' }).");const o={apiKey:a,organization:i,baseURL:"https://api.openai.com/v1",...s};if(!o.dangerouslyAllowBrowser&&Hd())throw new Error(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:(r=o.timeout)!==null&&r!==void 0?r:6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Zn(this),this.chat=new Vn(this),this.edits=new Gn(this),this.embeddings=new Wn(this),this.files=new Yn(this),this.images=new ea(this),this.audio=new Hn(this),this.moderations=new ra(this),this.models=new ta(this),this.fineTuning=new Qn(this),this.fineTunes=new Xn(this),this._options=o,this.apiKey=a,this.organization=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Ac=we,we.OpenAI=Ac,we.APIError=qe,we.APIConnectionError=yr,we.APIConnectionTimeoutError=ns,we.APIUserAbortError=Nn,we.NotFoundError=os,we.ConflictError=us,we.RateLimitError=ls,we.BadRequestError=as,we.AuthenticationError=is,we.InternalServerError=hs,we.PermissionDeniedError=ss,we.UnprocessableEntityError=cs;const{APIError:dg,APIConnectionError:fg,APIConnectionTimeoutError:qd,APIUserAbortError:Vd,NotFoundError:pg,ConflictError:mg,RateLimitError:xg,BadRequestError:gg,AuthenticationError:yg,InternalServerError:bg,PermissionDeniedError:vg,UnprocessableEntityError:_g}=dd;(function(n){n.toFile=uc,n.fileFromPath=yd,n.Page=Mn,n.CursorPage=ms,n.Completions=Zn,n.Chat=Vn,n.Edits=Gn,n.Embeddings=Wn,n.Files=Yn,n.FileObjectsPage=yc,n.Images=ea,n.Audio=Hn,n.Moderations=ra,n.Models=ta,n.ModelsPage=wc,n.FineTuning=Qn,n.FineTunes=Xn,n.FineTunesPage=bc})(we||(we={}));const xs=(n,e)=>n.reduce((t,r,a)=>{const i=Math.floor(a/e),s=t[i]||[];return t[i]=s.concat([r]),t},[]);class Zd{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new qr(e??{})}}function na(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:i}=n;if(r&&a&&e)return`${a}/${e}`;if(r){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function aa(n){let e;return n.constructor.name===qd.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===Vd.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}class Wd extends Zd{constructor(e,t){var u,l;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a=(r==null?void 0:r.openAIApiKey)??ne("OPENAI_API_KEY");const i=(r==null?void 0:r.azureOpenAIApiKey)??ne("AZURE_OPENAI_API_KEY");if(!i&&!a)throw new Error("OpenAI or Azure OpenAI API key not found");const s=(r==null?void 0:r.azureOpenAIApiInstanceName)??ne("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(ne("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||ne("AZURE_OPENAI_API_DEPLOYMENT_NAME")),c=(r==null?void 0:r.azureOpenAIApiVersion)??ne("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??ne("AZURE_OPENAI_BASE_PATH"),this.modelName=(r==null?void 0:r.modelName)??this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(i?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.azureOpenAIApiVersion=c,this.azureOpenAIApiKey=i,this.azureOpenAIApiInstanceName=s,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");a=a??""}this.clientConfig={apiKey:a,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(u=t==null?void 0:t.baseOptions)==null?void 0:u.headers,defaultQuery:(l=t==null?void 0:t.baseOptions)==null?void 0:l.params,...t}}async embedDocuments(e){const t=xs(this.stripNewLines?e.map(s=>s.replace(/\n/g," ")):e,this.batchSize),r=t.map(s=>this.embeddingWithRetry({model:this.modelName,input:s})),a=await Promise.all(r),i=[];for(let s=0;s<a.length;s+=1){const o=t[s],{data:c}=a[s];for(let u=0;u<o.length;u+=1)i.push(c[u].embedding)}return i}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=na(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new we(i)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw aa(r)}})}}function Gd(n,e){let t=0,r=0,a=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i],r+=n[i]*n[i],a+=e[i]*e[i];return t/(Math.sqrt(r)*Math.sqrt(a))}class Yd extends Pe{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,t)}async getRelevantDocuments(e,t){const r=yu(t),a=await De.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i=await(a==null?void 0:a.handleRetrieverStart(this.toJSON(),e));try{const s=await this._getRelevantDocuments(e,i);return await(i==null?void 0:i.handleRetrieverEnd(s)),s}catch(s){throw await(i==null?void 0:i.handleRetrieverError(s)),s}}}class gs extends Yd{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain","retrievers","base"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class Xd extends ut{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(s=>s[0])}async similaritySearchWithScore(e,t=4,r=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,a,i,s){if(typeof e=="number")return new gs({vectorStore:this,k:e,filter:t,tags:[...a??[],this._vectorstoreType()],metadata:i,verbose:s,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new gs({...o,searchKwargs:e.searchKwargs}):new gs({...o})}}}class ys extends Xd{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??Gd}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((a,i)=>({content:t[i].pageContent,embedding:a,metadata:t[i].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){const a=c=>{if(!r)return!0;const u=new $r({metadata:c.metadata,pageContent:c.content});return r(u)},i=this.memoryVectors.filter(a);return i.map((c,u)=>({similarity:this.similarity(e,c.embedding),index:u})).sort((c,u)=>c.similarity>u.similarity?-1:0).slice(0,t).map(c=>[new $r({metadata:i[c.index].metadata,pageContent:i[c.index].content}),c.similarity])}static async fromTexts(e,t,r,a){const i=[];for(let s=0;s<e.length;s+=1){const o=Array.isArray(t)?t[s]:t,c=new $r({pageContent:e[s],metadata:o});i.push(c)}return ys.fromDocuments(i,r,a)}static async fromDocuments(e,t,r){const a=new this(t,r);return await a.addDocuments(e),a}static async fromExistingIndex(e,t){return new this(e,t)}}class Ec{constructor(){Ee(this,"data");Ee(this,"QUOTA_BYTES",100);this.data={}}async get(e){const t=this.data[e],r={};return t&&(r[e]=t),r}async set(e){console.log("set ",e),console.log("old data",this.data),this.data={...this.data,...e},console.log("new data ",this.data)}async getBytesInUse(e){return 100}}class Jd{constructor(){Ee(this,"local");Ee(this,"sync");this.local=new Ec,this.sync=new Ec}}const vr=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n,Qd=n=>{switch(vr(n)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},ef=async({prompt:n,modelName:e})=>{let t;try{t=(await Xo(vr(e))).encode(n).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(n.length/4)}return Qd(e)-t},bs="__run";class Wt{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Wt({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class vt extends ut{get text(){return this.content}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class _r extends vt{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[a,i]of Object.entries(t))if(r[a]===void 0)r[a]=i;else{if(typeof r[a]!=typeof i)throw new Error(`additional_kwargs[${a}] already exists in the message chunk, but with a different type.`);if(typeof r[a]=="string")r[a]=r[a]+i;else if(!Array.isArray(r[a])&&typeof r[a]=="object")r[a]=this._mergeAdditionalKwargs(r[a],i);else throw new Error(`additional_kwargs[${a}] already exists in this message chunk.`)}return r}}class dt extends vt{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class ia extends _r{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new ia({content:this.content+e.content,additional_kwargs:ia._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class Tt extends vt{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class sa extends _r{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new sa({content:this.content+e.content,additional_kwargs:sa._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class vs extends vt{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class oa extends _r{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new oa({content:this.content+e.content,additional_kwargs:oa._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class ua extends _r{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new ua({content:this.content+e.content,additional_kwargs:ua._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class ca extends vt{static lc_name(){return"ChatMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}function Cc(n){return typeof n._getType=="function"}function la(n){if(typeof n=="string")return new dt(n);if(Cc(n))return n;const[e,t]=n;if(e==="human"||e==="user")return new dt({content:t});if(e==="ai"||e==="assistant")return new Tt({content:t});if(e==="system")return new vs({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class ha extends _r{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new ha({content:this.content+e.content,additional_kwargs:ha._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}class _s extends Wt{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new _s({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}class Pc extends ut{}class tf extends ut{addUserMessage(e){return this.addMessage(new dt(e))}addAIChatMessage(e){return this.addMessage(new Tt(e))}}class rf{}var kc={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(r,a,i){function s(u,l){if(!a[u]){if(!r[u]){var m=typeof sr=="function"&&sr;if(!l&&m)return m(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}l=a[u]={exports:{}},r[u][0].call(l.exports,function(h){var y=r[u][1][h];return s(y||h)},l,l.exports,t,r,a,i)}return a[u].exports}for(var o=typeof sr=="function"&&sr,c=0;c<i.length;c++)s(i[c]);return s}({1:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){var p=t("crypto");function A(w,k){k=b(w,k);var x;return(x=k.algorithm!=="passthrough"?p.createHash(k.algorithm):new O).write===void 0&&(x.write=x.update,x.end=x.update),v(k,x).dispatch(w),x.update||x.end(""),x.digest?x.digest(k.encoding==="buffer"?void 0:k.encoding):(w=x.read(),k.encoding!=="buffer"?w.toString(k.encoding):w)}(a=r.exports=A).sha1=function(w){return A(w)},a.keys=function(w){return A(w,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(w){return A(w,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(w){return A(w,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var f=p.getHashes?p.getHashes().slice():["sha1","md5"],P=(f.push("passthrough"),["buffer","hex","binary","base64"]);function b(w,k){var x={};if(x.algorithm=(k=k||{}).algorithm||"sha1",x.encoding=k.encoding||"hex",x.excludeValues=!!k.excludeValues,x.algorithm=x.algorithm.toLowerCase(),x.encoding=x.encoding.toLowerCase(),x.ignoreUnknown=k.ignoreUnknown===!0,x.respectType=k.respectType!==!1,x.respectFunctionNames=k.respectFunctionNames!==!1,x.respectFunctionProperties=k.respectFunctionProperties!==!1,x.unorderedArrays=k.unorderedArrays===!0,x.unorderedSets=k.unorderedSets!==!1,x.unorderedObjects=k.unorderedObjects!==!1,x.replacer=k.replacer||void 0,x.excludeKeys=k.excludeKeys||void 0,w===void 0)throw new Error("Object argument required.");for(var E=0;E<f.length;++E)f[E].toLowerCase()===x.algorithm.toLowerCase()&&(x.algorithm=f[E]);if(f.indexOf(x.algorithm)===-1)throw new Error('Algorithm "'+x.algorithm+'"  not supported. supported values: '+f.join(", "));if(P.indexOf(x.encoding)===-1&&x.algorithm!=="passthrough")throw new Error('Encoding "'+x.encoding+'"  not supported. supported values: '+P.join(", "));return x}function g(w){if(typeof w=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(w))!=null}function v(w,k,x){x=x||[];function E(d){return k.update?k.update(d,"utf8"):k.write(d,"utf8")}return{dispatch:function(d){return this["_"+((d=w.replacer?w.replacer(d):d)===null?"null":typeof d)](d)},_object:function(d){var C,S=Object.prototype.toString.call(d),T=/\[object (.*)\]/i.exec(S);if(T=(T=T?T[1]:"unknown:["+S+"]").toLowerCase(),0<=(S=x.indexOf(d)))return this.dispatch("[CIRCULAR:"+S+"]");if(x.push(d),o!==void 0&&o.isBuffer&&o.isBuffer(d))return E("buffer:"),E(d);if(T==="object"||T==="function"||T==="asyncfunction")return S=Object.keys(d),w.unorderedObjects&&(S=S.sort()),w.respectType===!1||g(d)||S.splice(0,0,"prototype","__proto__","constructor"),w.excludeKeys&&(S=S.filter(function(N){return!w.excludeKeys(N)})),E("object:"+S.length+":"),C=this,S.forEach(function(N){C.dispatch(N),E(":"),w.excludeValues||C.dispatch(d[N]),E(",")});if(!this["_"+T]){if(w.ignoreUnknown)return E("["+T+"]");throw new Error('Unknown object type "'+T+'"')}this["_"+T](d)},_array:function(d,N){N=N!==void 0?N:w.unorderedArrays!==!1;var S=this;if(E("array:"+d.length+":"),!N||d.length<=1)return d.forEach(function(U){return S.dispatch(U)});var T=[],N=d.map(function(U){var L=new O,Y=x.slice();return v(w,L,Y).dispatch(U),T=T.concat(Y.slice(x.length)),L.read().toString()});return x=x.concat(T),N.sort(),this._array(N,!1)},_date:function(d){return E("date:"+d.toJSON())},_symbol:function(d){return E("symbol:"+d.toString())},_error:function(d){return E("error:"+d.toString())},_boolean:function(d){return E("bool:"+d.toString())},_string:function(d){E("string:"+d.length+":"),E(d.toString())},_function:function(d){E("fn:"),g(d)?this.dispatch("[native]"):this.dispatch(d.toString()),w.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(d.name)),w.respectFunctionProperties&&this._object(d)},_number:function(d){return E("number:"+d.toString())},_xml:function(d){return E("xml:"+d.toString())},_null:function(){return E("Null")},_undefined:function(){return E("Undefined")},_regexp:function(d){return E("regex:"+d.toString())},_uint8array:function(d){return E("uint8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint8clampedarray:function(d){return E("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(d))},_int8array:function(d){return E("int8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint16array:function(d){return E("uint16array:"),this.dispatch(Array.prototype.slice.call(d))},_int16array:function(d){return E("int16array:"),this.dispatch(Array.prototype.slice.call(d))},_uint32array:function(d){return E("uint32array:"),this.dispatch(Array.prototype.slice.call(d))},_int32array:function(d){return E("int32array:"),this.dispatch(Array.prototype.slice.call(d))},_float32array:function(d){return E("float32array:"),this.dispatch(Array.prototype.slice.call(d))},_float64array:function(d){return E("float64array:"),this.dispatch(Array.prototype.slice.call(d))},_arraybuffer:function(d){return E("arraybuffer:"),this.dispatch(new Uint8Array(d))},_url:function(d){return E("url:"+d.toString())},_map:function(d){return E("map:"),d=Array.from(d),this._array(d,w.unorderedSets!==!1)},_set:function(d){return E("set:"),d=Array.from(d),this._array(d,w.unorderedSets!==!1)},_file:function(d){return E("file:"),this.dispatch([d.name,d.size,d.type,d.lastModfied])},_blob:function(){if(w.ignoreUnknown)return E("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return E("domwindow")},_bigint:function(d){return E("bigint:"+d.toString())},_process:function(){return E("process")},_timer:function(){return E("timer")},_pipe:function(){return E("pipe")},_tcp:function(){return E("tcp")},_udp:function(){return E("udp")},_tty:function(){return E("tty")},_statwatcher:function(){return E("statwatcher")},_securecontext:function(){return E("securecontext")},_connection:function(){return E("connection")},_zlib:function(){return E("zlib")},_context:function(){return E("context")},_nodescript:function(){return E("nodescript")},_httpparser:function(){return E("httpparser")},_dataview:function(){return E("dataview")},_signal:function(){return E("signal")},_fsevent:function(){return E("fsevent")},_tlswrap:function(){return E("tlswrap")}}}function O(){return{buf:"",write:function(w){this.buf+=w},end:function(w){this.buf+=w},read:function(){return this.buf}}}a.writeToStream=function(w,k,x){return x===void 0&&(x=k,k={}),v(k=b(w,k),x).dispatch(w)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){(function(p){var A=typeof Uint8Array<"u"?Uint8Array:Array,f="+".charCodeAt(0),P="/".charCodeAt(0),b="0".charCodeAt(0),g="a".charCodeAt(0),v="A".charCodeAt(0),O="-".charCodeAt(0),w="_".charCodeAt(0);function k(x){return x=x.charCodeAt(0),x===f||x===O?62:x===P||x===w?63:x<b?-1:x<b+10?x-b+26+26:x<v+26?x-v:x<g+26?x-g+26:void 0}p.toByteArray=function(x){var E,d;if(0<x.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var C=x.length,C=x.charAt(C-2)==="="?2:x.charAt(C-1)==="="?1:0,S=new A(3*x.length/4-C),T=0<C?x.length-4:x.length,N=0;function U(L){S[N++]=L}for(E=0;E<T;E+=4,0)U((16711680&(d=k(x.charAt(E))<<18|k(x.charAt(E+1))<<12|k(x.charAt(E+2))<<6|k(x.charAt(E+3))))>>16),U((65280&d)>>8),U(255&d);return C==2?U(255&(d=k(x.charAt(E))<<2|k(x.charAt(E+1))>>4)):C==1&&(U((d=k(x.charAt(E))<<10|k(x.charAt(E+1))<<4|k(x.charAt(E+2))>>2)>>8&255),U(255&d)),S},p.fromByteArray=function(x){var E,d,C,S,T=x.length%3,N="";function U(L){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(L)}for(E=0,C=x.length-T;E<C;E+=3)d=(x[E]<<16)+(x[E+1]<<8)+x[E+2],N+=U((S=d)>>18&63)+U(S>>12&63)+U(S>>6&63)+U(63&S);switch(T){case 1:N=(N+=U((d=x[x.length-1])>>2))+U(d<<4&63)+"==";break;case 2:N=(N=(N+=U((d=(x[x.length-2]<<8)+x[x.length-1])>>10))+U(d>>4&63))+U(d<<2&63)+"="}return N}})(a===void 0?this.base64js={}:a)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,r,a){(function(i,s,f,c,u,l,m,h,y){var p=t("base64-js"),A=t("ieee754");function f(_,I,B){if(!(this instanceof f))return new f(_,I,B);var M,F,q,re,me=typeof _;if(I==="base64"&&me=="string")for(_=(re=_).trim?re.trim():re.replace(/^\s+|\s+$/g,"");_.length%4!=0;)_+="=";if(me=="number")M=Q(_);else if(me=="string")M=f.byteLength(_,I);else{if(me!="object")throw new Error("First argument needs to be a number, array or string.");M=Q(_.length)}if(f._useTypedArrays?F=f._augment(new Uint8Array(M)):((F=this).length=M,F._isBuffer=!0),f._useTypedArrays&&typeof _.byteLength=="number")F._set(_);else if(X(re=_)||f.isBuffer(re)||re&&typeof re=="object"&&typeof re.length=="number")for(q=0;q<M;q++)f.isBuffer(_)?F[q]=_.readUInt8(q):F[q]=_[q];else if(me=="string")F.write(_,0,I);else if(me=="number"&&!f._useTypedArrays&&!B)for(q=0;q<M;q++)F[q]=0;return F}function P(_,I,B,M){return f._charsWritten=z(function(F){for(var q=[],re=0;re<F.length;re++)q.push(255&F.charCodeAt(re));return q}(I),_,B,M)}function b(_,I,B,M){return f._charsWritten=z(function(F){for(var q,re,me=[],ye=0;ye<F.length;ye++)re=F.charCodeAt(ye),q=re>>8,re=re%256,me.push(re),me.push(q);return me}(I),_,B,M)}function g(_,I,B){var M="";B=Math.min(_.length,B);for(var F=I;F<B;F++)M+=String.fromCharCode(_[F]);return M}function v(_,I,B,q){q||(R(typeof B=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+1<_.length,"Trying to read beyond buffer length"));var F,q=_.length;if(!(q<=I))return B?(F=_[I],I+1<q&&(F|=_[I+1]<<8)):(F=_[I]<<8,I+1<q&&(F|=_[I+1])),F}function O(_,I,B,q){q||(R(typeof B=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+3<_.length,"Trying to read beyond buffer length"));var F,q=_.length;if(!(q<=I))return B?(I+2<q&&(F=_[I+2]<<16),I+1<q&&(F|=_[I+1]<<8),F|=_[I],I+3<q&&(F+=_[I+3]<<24>>>0)):(I+1<q&&(F=_[I+1]<<16),I+2<q&&(F|=_[I+2]<<8),I+3<q&&(F|=_[I+3]),F+=_[I]<<24>>>0),F}function w(_,I,B,M){if(M||(R(typeof B=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+1<_.length,"Trying to read beyond buffer length")),!(_.length<=I))return M=v(_,I,B,!0),32768&M?-1*(65535-M+1):M}function k(_,I,B,M){if(M||(R(typeof B=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+3<_.length,"Trying to read beyond buffer length")),!(_.length<=I))return M=O(_,I,B,!0),2147483648&M?-1*(4294967295-M+1):M}function x(_,I,B,M){return M||(R(typeof B=="boolean","missing or invalid endian"),R(I+3<_.length,"Trying to read beyond buffer length")),A.read(_,I,B,23,4)}function E(_,I,B,M){return M||(R(typeof B=="boolean","missing or invalid endian"),R(I+7<_.length,"Trying to read beyond buffer length")),A.read(_,I,B,52,8)}function d(_,I,B,M,F){if(F||(R(I!=null,"missing value"),R(typeof M=="boolean","missing or invalid endian"),R(B!=null,"missing offset"),R(B+1<_.length,"trying to write beyond buffer length"),pe(I,65535)),F=_.length,!(F<=B))for(var q=0,re=Math.min(F-B,2);q<re;q++)_[B+q]=(I&255<<8*(M?q:1-q))>>>8*(M?q:1-q)}function C(_,I,B,M,F){if(F||(R(I!=null,"missing value"),R(typeof M=="boolean","missing or invalid endian"),R(B!=null,"missing offset"),R(B+3<_.length,"trying to write beyond buffer length"),pe(I,4294967295)),F=_.length,!(F<=B))for(var q=0,re=Math.min(F-B,4);q<re;q++)_[B+q]=I>>>8*(M?q:3-q)&255}function S(_,I,B,M,F){F||(R(I!=null,"missing value"),R(typeof M=="boolean","missing or invalid endian"),R(B!=null,"missing offset"),R(B+1<_.length,"Trying to write beyond buffer length"),he(I,32767,-32768)),_.length<=B||d(_,0<=I?I:65535+I+1,B,M,F)}function T(_,I,B,M,F){F||(R(I!=null,"missing value"),R(typeof M=="boolean","missing or invalid endian"),R(B!=null,"missing offset"),R(B+3<_.length,"Trying to write beyond buffer length"),he(I,2147483647,-2147483648)),_.length<=B||C(_,0<=I?I:4294967295+I+1,B,M,F)}function N(_,I,B,M,F){F||(R(I!=null,"missing value"),R(typeof M=="boolean","missing or invalid endian"),R(B!=null,"missing offset"),R(B+3<_.length,"Trying to write beyond buffer length"),Be(I,34028234663852886e22,-34028234663852886e22)),_.length<=B||A.write(_,I,B,M,23,4)}function U(_,I,B,M,F){F||(R(I!=null,"missing value"),R(typeof M=="boolean","missing or invalid endian"),R(B!=null,"missing offset"),R(B+7<_.length,"Trying to write beyond buffer length"),Be(I,17976931348623157e292,-17976931348623157e292)),_.length<=B||A.write(_,I,B,M,52,8)}a.Buffer=f,a.SlowBuffer=f,a.INSPECT_MAX_BYTES=50,f.poolSize=8192,f._useTypedArrays=function(){try{var _=new ArrayBuffer(0),I=new Uint8Array(_);return I.foo=function(){return 42},I.foo()===42&&typeof I.subarray=="function"}catch{return!1}}(),f.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.isBuffer=function(_){return!(_==null||!_._isBuffer)},f.byteLength=function(_,I){var B;switch(_+="",I||"utf8"){case"hex":B=_.length/2;break;case"utf8":case"utf-8":B=D(_).length;break;case"ascii":case"binary":case"raw":B=_.length;break;case"base64":B=$(_).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=2*_.length;break;default:throw new Error("Unknown encoding")}return B},f.concat=function(_,I){if(R(X(_),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),_.length===0)return new f(0);if(_.length===1)return _[0];if(typeof I!="number")for(F=I=0;F<_.length;F++)I+=_[F].length;for(var B=new f(I),M=0,F=0;F<_.length;F++){var q=_[F];q.copy(B,M),M+=q.length}return B},f.prototype.write=function(_,I,B,M){isFinite(I)?isFinite(B)||(M=B,B=void 0):(ye=M,M=I,I=B,B=ye),I=Number(I)||0;var F,q,re,me,ye=this.length-I;switch((!B||ye<(B=Number(B)))&&(B=ye),M=String(M||"utf8").toLowerCase()){case"hex":F=function(Te,Ie,Ae,de){Ae=Number(Ae)||0;var oe=Te.length-Ae;(!de||oe<(de=Number(de)))&&(de=oe),R((oe=Ie.length)%2==0,"Invalid hex string"),oe/2<de&&(de=oe/2);for(var ze=0;ze<de;ze++){var $t=parseInt(Ie.substr(2*ze,2),16);R(!isNaN($t),"Invalid hex string"),Te[Ae+ze]=$t}return f._charsWritten=2*ze,ze}(this,_,I,B);break;case"utf8":case"utf-8":q=this,re=I,me=B,F=f._charsWritten=z(D(_),q,re,me);break;case"ascii":case"binary":F=P(this,_,I,B);break;case"base64":q=this,re=I,me=B,F=f._charsWritten=z($(_),q,re,me);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":F=b(this,_,I,B);break;default:throw new Error("Unknown encoding")}return F},f.prototype.toString=function(_,I,B){var M,F,q,re,me=this;if(_=String(_||"utf8").toLowerCase(),I=Number(I)||0,(B=B!==void 0?Number(B):me.length)===I)return"";switch(_){case"hex":M=function(ye,Te,Ie){var Ae=ye.length;(!Te||Te<0)&&(Te=0),(!Ie||Ie<0||Ae<Ie)&&(Ie=Ae);for(var de="",oe=Te;oe<Ie;oe++)de+=W(ye[oe]);return de}(me,I,B);break;case"utf8":case"utf-8":M=function(ye,Te,Ie){var Ae="",de="";Ie=Math.min(ye.length,Ie);for(var oe=Te;oe<Ie;oe++)ye[oe]<=127?(Ae+=j(de)+String.fromCharCode(ye[oe]),de=""):de+="%"+ye[oe].toString(16);return Ae+j(de)}(me,I,B);break;case"ascii":case"binary":M=g(me,I,B);break;case"base64":F=me,re=B,M=(q=I)===0&&re===F.length?p.fromByteArray(F):p.fromByteArray(F.slice(q,re));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":M=function(ye,Te,Ie){for(var Ae=ye.slice(Te,Ie),de="",oe=0;oe<Ae.length;oe+=2)de+=String.fromCharCode(Ae[oe]+256*Ae[oe+1]);return de}(me,I,B);break;default:throw new Error("Unknown encoding")}return M},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},f.prototype.copy=function(_,I,B,M){if(I=I||0,(M=M||M===0?M:this.length)!==(B=B||0)&&_.length!==0&&this.length!==0){R(B<=M,"sourceEnd < sourceStart"),R(0<=I&&I<_.length,"targetStart out of bounds"),R(0<=B&&B<this.length,"sourceStart out of bounds"),R(0<=M&&M<=this.length,"sourceEnd out of bounds"),M>this.length&&(M=this.length);var F=(M=_.length-I<M-B?_.length-I+B:M)-B;if(F<100||!f._useTypedArrays)for(var q=0;q<F;q++)_[q+I]=this[q+B];else _._set(this.subarray(B,B+F),I)}},f.prototype.slice=function(_,I){var B=this.length;if(_=Y(_,B,0),I=Y(I,B,B),f._useTypedArrays)return f._augment(this.subarray(_,I));for(var M=I-_,F=new f(M,void 0,!0),q=0;q<M;q++)F[q]=this[q+_];return F},f.prototype.get=function(_){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(_)},f.prototype.set=function(_,I){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(_,I)},f.prototype.readUInt8=function(_,I){if(I||(R(_!=null,"missing offset"),R(_<this.length,"Trying to read beyond buffer length")),!(_>=this.length))return this[_]},f.prototype.readUInt16LE=function(_,I){return v(this,_,!0,I)},f.prototype.readUInt16BE=function(_,I){return v(this,_,!1,I)},f.prototype.readUInt32LE=function(_,I){return O(this,_,!0,I)},f.prototype.readUInt32BE=function(_,I){return O(this,_,!1,I)},f.prototype.readInt8=function(_,I){if(I||(R(_!=null,"missing offset"),R(_<this.length,"Trying to read beyond buffer length")),!(_>=this.length))return 128&this[_]?-1*(255-this[_]+1):this[_]},f.prototype.readInt16LE=function(_,I){return w(this,_,!0,I)},f.prototype.readInt16BE=function(_,I){return w(this,_,!1,I)},f.prototype.readInt32LE=function(_,I){return k(this,_,!0,I)},f.prototype.readInt32BE=function(_,I){return k(this,_,!1,I)},f.prototype.readFloatLE=function(_,I){return x(this,_,!0,I)},f.prototype.readFloatBE=function(_,I){return x(this,_,!1,I)},f.prototype.readDoubleLE=function(_,I){return E(this,_,!0,I)},f.prototype.readDoubleBE=function(_,I){return E(this,_,!1,I)},f.prototype.writeUInt8=function(_,I,B){B||(R(_!=null,"missing value"),R(I!=null,"missing offset"),R(I<this.length,"trying to write beyond buffer length"),pe(_,255)),I>=this.length||(this[I]=_)},f.prototype.writeUInt16LE=function(_,I,B){d(this,_,I,!0,B)},f.prototype.writeUInt16BE=function(_,I,B){d(this,_,I,!1,B)},f.prototype.writeUInt32LE=function(_,I,B){C(this,_,I,!0,B)},f.prototype.writeUInt32BE=function(_,I,B){C(this,_,I,!1,B)},f.prototype.writeInt8=function(_,I,B){B||(R(_!=null,"missing value"),R(I!=null,"missing offset"),R(I<this.length,"Trying to write beyond buffer length"),he(_,127,-128)),I>=this.length||(0<=_?this.writeUInt8(_,I,B):this.writeUInt8(255+_+1,I,B))},f.prototype.writeInt16LE=function(_,I,B){S(this,_,I,!0,B)},f.prototype.writeInt16BE=function(_,I,B){S(this,_,I,!1,B)},f.prototype.writeInt32LE=function(_,I,B){T(this,_,I,!0,B)},f.prototype.writeInt32BE=function(_,I,B){T(this,_,I,!1,B)},f.prototype.writeFloatLE=function(_,I,B){N(this,_,I,!0,B)},f.prototype.writeFloatBE=function(_,I,B){N(this,_,I,!1,B)},f.prototype.writeDoubleLE=function(_,I,B){U(this,_,I,!0,B)},f.prototype.writeDoubleBE=function(_,I,B){U(this,_,I,!1,B)},f.prototype.fill=function(_,I,B){if(I=I||0,B=B||this.length,R(typeof(_=typeof(_=_||0)=="string"?_.charCodeAt(0):_)=="number"&&!isNaN(_),"value is not a number"),R(I<=B,"end < start"),B!==I&&this.length!==0){R(0<=I&&I<this.length,"start out of bounds"),R(0<=B&&B<=this.length,"end out of bounds");for(var M=I;M<B;M++)this[M]=_}},f.prototype.inspect=function(){for(var _=[],I=this.length,B=0;B<I;B++)if(_[B]=W(this[B]),B===a.INSPECT_MAX_BYTES){_[B+1]="...";break}return"<Buffer "+_.join(" ")+">"},f.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(f._useTypedArrays)return new f(this).buffer;for(var _=new Uint8Array(this.length),I=0,B=_.length;I<B;I+=1)_[I]=this[I];return _.buffer};var L=f.prototype;function Y(_,I,B){return typeof _!="number"?B:I<=(_=~~_)?I:0<=_||0<=(_+=I)?_:0}function Q(_){return(_=~~Math.ceil(+_))<0?0:_}function X(_){return(Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"})(_)}function W(_){return _<16?"0"+_.toString(16):_.toString(16)}function D(_){for(var I=[],B=0;B<_.length;B++){var M=_.charCodeAt(B);if(M<=127)I.push(_.charCodeAt(B));else for(var F=B,q=(55296<=M&&M<=57343&&B++,encodeURIComponent(_.slice(F,B+1)).substr(1).split("%")),re=0;re<q.length;re++)I.push(parseInt(q[re],16))}return I}function $(_){return p.toByteArray(_)}function z(_,I,B,M){for(var F=0;F<M&&!(F+B>=I.length||F>=_.length);F++)I[F+B]=_[F];return F}function j(_){try{return decodeURIComponent(_)}catch{return String.fromCharCode(65533)}}function pe(_,I){R(typeof _=="number","cannot write a non-number as a number"),R(0<=_,"specified a negative value for writing an unsigned value"),R(_<=I,"value is larger than maximum value for type"),R(Math.floor(_)===_,"value has a fractional component")}function he(_,I,B){R(typeof _=="number","cannot write a non-number as a number"),R(_<=I,"value larger than maximum allowed value"),R(B<=_,"value smaller than minimum allowed value"),R(Math.floor(_)===_,"value has a fractional component")}function Be(_,I,B){R(typeof _=="number","cannot write a non-number as a number"),R(_<=I,"value larger than maximum allowed value"),R(B<=_,"value smaller than minimum allowed value")}function R(_,I){if(!_)throw new Error(I||"Failed assertion")}f._augment=function(_){return _._isBuffer=!0,_._get=_.get,_._set=_.set,_.get=L.get,_.set=L.set,_.write=L.write,_.toString=L.toString,_.toLocaleString=L.toString,_.toJSON=L.toJSON,_.copy=L.copy,_.slice=L.slice,_.readUInt8=L.readUInt8,_.readUInt16LE=L.readUInt16LE,_.readUInt16BE=L.readUInt16BE,_.readUInt32LE=L.readUInt32LE,_.readUInt32BE=L.readUInt32BE,_.readInt8=L.readInt8,_.readInt16LE=L.readInt16LE,_.readInt16BE=L.readInt16BE,_.readInt32LE=L.readInt32LE,_.readInt32BE=L.readInt32BE,_.readFloatLE=L.readFloatLE,_.readFloatBE=L.readFloatBE,_.readDoubleLE=L.readDoubleLE,_.readDoubleBE=L.readDoubleBE,_.writeUInt8=L.writeUInt8,_.writeUInt16LE=L.writeUInt16LE,_.writeUInt16BE=L.writeUInt16BE,_.writeUInt32LE=L.writeUInt32LE,_.writeUInt32BE=L.writeUInt32BE,_.writeInt8=L.writeInt8,_.writeInt16LE=L.writeInt16LE,_.writeInt16BE=L.writeInt16BE,_.writeInt32LE=L.writeInt32LE,_.writeInt32BE=L.writeInt32BE,_.writeFloatLE=L.writeFloatLE,_.writeFloatBE=L.writeFloatBE,_.writeDoubleLE=L.writeDoubleLE,_.writeDoubleBE=L.writeDoubleBE,_.fill=L.fill,_.inspect=L.inspect,_.toArrayBuffer=L.toArrayBuffer,_}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,r,a){(function(i,s,p,c,u,l,m,h,y){var p=t("buffer").Buffer,A=4,f=new p(A);f.fill(0),r.exports={hash:function(P,b,g,v){for(var O=b(function(d,C){d.length%A!=0&&(S=d.length+(A-d.length%A),d=p.concat([d,f],S));for(var S,T=[],N=C?d.readInt32BE:d.readInt32LE,U=0;U<d.length;U+=A)T.push(N.call(d,U));return T}(P=p.isBuffer(P)?P:new p(P),v),8*P.length),b=v,w=new p(g),k=b?w.writeInt32BE:w.writeInt32LE,x=0;x<O.length;x++)k.call(w,O[x],4*x,!0);return w}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,r,a){(function(i,s,p,c,u,l,m,h,y){var p=t("buffer").Buffer,A=t("./sha"),f=t("./sha256"),P=t("./rng"),b={sha1:A,sha256:f,md5:t("./md5")},g=64,v=new p(g);function O(d,C){var S=b[d=d||"sha1"],T=[];return S||w("algorithm:",d,"is not yet supported"),{update:function(N){return p.isBuffer(N)||(N=new p(N)),T.push(N),N.length,this},digest:function(N){var U=p.concat(T),U=C?function(L,Y,Q){p.isBuffer(Y)||(Y=new p(Y)),p.isBuffer(Q)||(Q=new p(Q)),Y.length>g?Y=L(Y):Y.length<g&&(Y=p.concat([Y,v],g));for(var X=new p(g),W=new p(g),D=0;D<g;D++)X[D]=54^Y[D],W[D]=92^Y[D];return Q=L(p.concat([X,Q])),L(p.concat([W,Q]))}(S,C,U):S(U);return T=null,N?U.toString(N):U}}}function w(){var d=[].slice.call(arguments).join(" ");throw new Error([d,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}v.fill(0),a.createHash=function(d){return O(d)},a.createHmac=O,a.randomBytes=function(d,C){if(!C||!C.call)return new p(P(d));try{C.call(this,void 0,new p(P(d)))}catch(S){C(S)}};var k,x=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],E=function(d){a[d]=function(){w("sorry,",d,"is not implemented yet")}};for(k in x)E(x[k])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){var p=t("./helpers");function A(w,k){w[k>>5]|=128<<k%32,w[14+(k+64>>>9<<4)]=k;for(var x=1732584193,E=-271733879,d=-1732584194,C=271733878,S=0;S<w.length;S+=16){var T=x,N=E,U=d,L=C,x=P(x,E,d,C,w[S+0],7,-680876936),C=P(C,x,E,d,w[S+1],12,-389564586),d=P(d,C,x,E,w[S+2],17,606105819),E=P(E,d,C,x,w[S+3],22,-1044525330);x=P(x,E,d,C,w[S+4],7,-176418897),C=P(C,x,E,d,w[S+5],12,1200080426),d=P(d,C,x,E,w[S+6],17,-1473231341),E=P(E,d,C,x,w[S+7],22,-45705983),x=P(x,E,d,C,w[S+8],7,1770035416),C=P(C,x,E,d,w[S+9],12,-1958414417),d=P(d,C,x,E,w[S+10],17,-42063),E=P(E,d,C,x,w[S+11],22,-1990404162),x=P(x,E,d,C,w[S+12],7,1804603682),C=P(C,x,E,d,w[S+13],12,-40341101),d=P(d,C,x,E,w[S+14],17,-1502002290),x=b(x,E=P(E,d,C,x,w[S+15],22,1236535329),d,C,w[S+1],5,-165796510),C=b(C,x,E,d,w[S+6],9,-1069501632),d=b(d,C,x,E,w[S+11],14,643717713),E=b(E,d,C,x,w[S+0],20,-373897302),x=b(x,E,d,C,w[S+5],5,-701558691),C=b(C,x,E,d,w[S+10],9,38016083),d=b(d,C,x,E,w[S+15],14,-660478335),E=b(E,d,C,x,w[S+4],20,-405537848),x=b(x,E,d,C,w[S+9],5,568446438),C=b(C,x,E,d,w[S+14],9,-1019803690),d=b(d,C,x,E,w[S+3],14,-187363961),E=b(E,d,C,x,w[S+8],20,1163531501),x=b(x,E,d,C,w[S+13],5,-1444681467),C=b(C,x,E,d,w[S+2],9,-51403784),d=b(d,C,x,E,w[S+7],14,1735328473),x=g(x,E=b(E,d,C,x,w[S+12],20,-1926607734),d,C,w[S+5],4,-378558),C=g(C,x,E,d,w[S+8],11,-2022574463),d=g(d,C,x,E,w[S+11],16,1839030562),E=g(E,d,C,x,w[S+14],23,-35309556),x=g(x,E,d,C,w[S+1],4,-1530992060),C=g(C,x,E,d,w[S+4],11,1272893353),d=g(d,C,x,E,w[S+7],16,-155497632),E=g(E,d,C,x,w[S+10],23,-1094730640),x=g(x,E,d,C,w[S+13],4,681279174),C=g(C,x,E,d,w[S+0],11,-358537222),d=g(d,C,x,E,w[S+3],16,-722521979),E=g(E,d,C,x,w[S+6],23,76029189),x=g(x,E,d,C,w[S+9],4,-640364487),C=g(C,x,E,d,w[S+12],11,-421815835),d=g(d,C,x,E,w[S+15],16,530742520),x=v(x,E=g(E,d,C,x,w[S+2],23,-995338651),d,C,w[S+0],6,-198630844),C=v(C,x,E,d,w[S+7],10,1126891415),d=v(d,C,x,E,w[S+14],15,-1416354905),E=v(E,d,C,x,w[S+5],21,-57434055),x=v(x,E,d,C,w[S+12],6,1700485571),C=v(C,x,E,d,w[S+3],10,-1894986606),d=v(d,C,x,E,w[S+10],15,-1051523),E=v(E,d,C,x,w[S+1],21,-2054922799),x=v(x,E,d,C,w[S+8],6,1873313359),C=v(C,x,E,d,w[S+15],10,-30611744),d=v(d,C,x,E,w[S+6],15,-1560198380),E=v(E,d,C,x,w[S+13],21,1309151649),x=v(x,E,d,C,w[S+4],6,-145523070),C=v(C,x,E,d,w[S+11],10,-1120210379),d=v(d,C,x,E,w[S+2],15,718787259),E=v(E,d,C,x,w[S+9],21,-343485551),x=O(x,T),E=O(E,N),d=O(d,U),C=O(C,L)}return Array(x,E,d,C)}function f(w,k,x,E,d,C){return O((k=O(O(k,w),O(E,C)))<<d|k>>>32-d,x)}function P(w,k,x,E,d,C,S){return f(k&x|~k&E,w,k,d,C,S)}function b(w,k,x,E,d,C,S){return f(k&E|x&~E,w,k,d,C,S)}function g(w,k,x,E,d,C,S){return f(k^x^E,w,k,d,C,S)}function v(w,k,x,E,d,C,S){return f(x^(k|~E),w,k,d,C,S)}function O(w,k){var x=(65535&w)+(65535&k);return(w>>16)+(k>>16)+(x>>16)<<16|65535&x}r.exports=function(w){return p.hash(w,A,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){r.exports=function(p){for(var A,f=new Array(p),P=0;P<p;P++)!(3&P)&&(A=4294967296*Math.random()),f[P]=A>>>((3&P)<<3)&255;return f}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){var p=t("./helpers");function A(b,g){b[g>>5]|=128<<24-g%32,b[15+(g+64>>9<<4)]=g;for(var v,O,w,k=Array(80),x=1732584193,E=-271733879,d=-1732584194,C=271733878,S=-1009589776,T=0;T<b.length;T+=16){for(var N=x,U=E,L=d,Y=C,Q=S,X=0;X<80;X++){k[X]=X<16?b[T+X]:P(k[X-3]^k[X-8]^k[X-14]^k[X-16],1);var W=f(f(P(x,5),(W=E,O=d,w=C,(v=X)<20?W&O|~W&w:!(v<40)&&v<60?W&O|W&w|O&w:W^O^w)),f(f(S,k[X]),(v=X)<20?1518500249:v<40?1859775393:v<60?-1894007588:-899497514)),S=C,C=d,d=P(E,30),E=x,x=W}x=f(x,N),E=f(E,U),d=f(d,L),C=f(C,Y),S=f(S,Q)}return Array(x,E,d,C,S)}function f(b,g){var v=(65535&b)+(65535&g);return(b>>16)+(g>>16)+(v>>16)<<16|65535&v}function P(b,g){return b<<g|b>>>32-g}r.exports=function(b){return p.hash(b,A,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){function p(g,v){var O=(65535&g)+(65535&v);return(g>>16)+(v>>16)+(O>>16)<<16|65535&O}function A(g,v){var O,w=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),k=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),x=new Array(64);g[v>>5]|=128<<24-v%32,g[15+(v+64>>9<<4)]=v;for(var E,d,C=0;C<g.length;C+=16){for(var S=k[0],T=k[1],N=k[2],U=k[3],L=k[4],Y=k[5],Q=k[6],X=k[7],W=0;W<64;W++)x[W]=W<16?g[W+C]:p(p(p((d=x[W-2],P(d,17)^P(d,19)^b(d,10)),x[W-7]),(d=x[W-15],P(d,7)^P(d,18)^b(d,3))),x[W-16]),O=p(p(p(p(X,P(d=L,6)^P(d,11)^P(d,25)),L&Y^~L&Q),w[W]),x[W]),E=p(P(E=S,2)^P(E,13)^P(E,22),S&T^S&N^T&N),X=Q,Q=Y,Y=L,L=p(U,O),U=N,N=T,T=S,S=p(O,E);k[0]=p(S,k[0]),k[1]=p(T,k[1]),k[2]=p(N,k[2]),k[3]=p(U,k[3]),k[4]=p(L,k[4]),k[5]=p(Y,k[5]),k[6]=p(Q,k[6]),k[7]=p(X,k[7])}return k}var f=t("./helpers"),P=function(g,v){return g>>>v|g<<32-v},b=function(g,v){return g>>>v};r.exports=function(g){return f.hash(g,A,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){a.read=function(p,A,f,P,C){var g,v,O=8*C-P-1,w=(1<<O)-1,k=w>>1,x=-7,E=f?C-1:0,d=f?-1:1,C=p[A+E];for(E+=d,g=C&(1<<-x)-1,C>>=-x,x+=O;0<x;g=256*g+p[A+E],E+=d,x-=8);for(v=g&(1<<-x)-1,g>>=-x,x+=P;0<x;v=256*v+p[A+E],E+=d,x-=8);if(g===0)g=1-k;else{if(g===w)return v?NaN:1/0*(C?-1:1);v+=Math.pow(2,P),g-=k}return(C?-1:1)*v*Math.pow(2,g-P)},a.write=function(p,A,f,P,b,S){var v,O,w=8*S-b-1,k=(1<<w)-1,x=k>>1,E=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=P?0:S-1,C=P?1:-1,S=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(O=isNaN(A)?1:0,v=k):(v=Math.floor(Math.log(A)/Math.LN2),A*(P=Math.pow(2,-v))<1&&(v--,P*=2),2<=(A+=1<=v+x?E/P:E*Math.pow(2,1-x))*P&&(v++,P/=2),k<=v+x?(O=0,v=k):1<=v+x?(O=(A*P-1)*Math.pow(2,b),v+=x):(O=A*Math.pow(2,x-1)*Math.pow(2,b),v=0));8<=b;p[f+d]=255&O,d+=C,O/=256,b-=8);for(v=v<<b|O,w+=b;0<w;p[f+d]=255&v,d+=C,v/=256,w-=8);p[f+d-C]|=128*S}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,r,a){(function(i,s,o,c,u,l,m,h,y){var p,A,f;function P(){}(i=r.exports={}).nextTick=(A=typeof window<"u"&&window.setImmediate,f=typeof window<"u"&&window.postMessage&&window.addEventListener,A?function(b){return window.setImmediate(b)}:f?(p=[],window.addEventListener("message",function(b){var g=b.source;g!==window&&g!==null||b.data!=="process-tick"||(b.stopPropagation(),0<p.length&&p.shift()())},!0),function(b){p.push(b),window.postMessage("process-tick","*")}):function(b){setTimeout(b,0)}),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=P,i.addListener=P,i.once=P,i.off=P,i.removeListener=P,i.removeAllListeners=P,i.emit=P,i.binding=function(b){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(b){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(kc);var nf=kc.exports;const af=Ke(nf),Ic=(...n)=>af(n.join("_")),sf=new Map;class ws extends rf{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Ic(e,t))??null)}async update(e,t,r){this.cache.set(Ic(e,t),r)}static global(){return new ws(sf)}}class Sc extends Pc{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new dt(this.value)]}}class As extends Pe{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,s]of Object.entries(t))typeof s=="string"?r[i]=s:r[i]=await s();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(()=>Dc);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(()=>Dc);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>qf);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Oc extends As{async formatPromptValue(e){const t=await this.format(e);return new Sc(t)}}const Bc=n=>{const e=n.split(""),t=[],r=(i,s)=>{for(let o=s;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){const i=r("}",a);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,i).join("")}),a=i+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{const i=r("{}",a),s=(i<0?e.slice(a):e.slice(a,i)).join("");t.push({type:"literal",text:s}),a=i<0?e.length:i}}return t},Es={"f-string":(n,e)=>Bc(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`Missing value for input ${r.name}`)}return t+r.text},""),jinja2:(n,e)=>""},of={"f-string":Bc,jinja2:n=>[]},Cs=(n,e,t)=>Es[e](n,t),uf=(n,e)=>of[e](n),Tc=(n,e,t)=>{if(!(e in Es)){const r=Object.keys(Es);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((a,i)=>(a[i]="foo",a),{});Cs(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class ge extends Oc{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Tc(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Cs(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a=`

`,i=""){const s=[i,...e,t].join(a);return new ge({inputVariables:r,template:s})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){if(t==="jinja2")throw new Error("jinja2 templates are not currently supported.");const a=new Set;return uf(e,t).forEach(i=>{i.type==="variable"&&a.add(i.name)}),new ge({inputVariables:[...a],templateFormat:t,template:e,...r})}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new ge(a)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new ge({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const Dc=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:ge},Symbol.toStringTag,{value:"Module"}));class cf extends Pe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class Rc extends Pc{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class da extends cf{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class lf extends As{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new Rc(t)}}class hf extends da{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new ca(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this(ge.fromTemplate(e),t)}}class Dt extends da{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new dt(await this.prompt.format(e))}static fromTemplate(e){return new this(ge.fromTemplate(e))}}class Fc extends da{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new Tt(await this.prompt.format(e))}static fromTemplate(e){return new this(ge.fromTemplate(e))}}class wr extends da{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new vs(await this.prompt.format(e))}static fromTemplate(e){return new this(ge.fromTemplate(e))}}function df(n){return typeof n.formatMessages=="function"}function ff(n){if(df(n)||Cc(n))return n;const e=la(n);if(e._getType()==="human")return Dt.fromTemplate(e.content);if(e._getType()==="ai")return Fc.fromTemplate(e.content);if(e._getType()==="system")return wr.fromTemplate(e.content);if(ca.isInstance(e))return hf.fromTemplate(e.content,e.role);throw new Error(`Could not coerce message prompt template from input. Received message type: "${e._getType()}".`)}class rt extends lf{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof vt))for(const c of o.inputVariables)t.add(c);const r=this.inputVariables,a=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),i=new Set([...a].filter(o=>!t.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);const s=new Set([...t].filter(o=>!a.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const a of this.promptMessages)if(a instanceof vt)r.push(a);else{const i=a.inputVariables.reduce((o,c)=>{if(!(c in t))throw new Error(`Missing value for input variable \`${c.toString()}\``);return o[c]=t[c],o},{}),s=await a.formatMessages(i);r=r.concat(s)}return r}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new rt(a)}static fromMessages(e){const t=e.reduce((i,s)=>i.concat(s instanceof rt?s.promptMessages:[ff(s)]),[]),r=e.reduce((i,s)=>s instanceof rt?Object.assign(i,s.partialVariables):i,Object.create(null)),a=new Set;for(const i of t)if(!(i instanceof vt))for(const s of i.inputVariables)s in r||a.add(s);return new rt({inputVariables:[...a],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}const pf=()=>!1;class Nc extends Pe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??pf(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class Ps extends Nc{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new qr(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await Xo("modelName"in this?vr(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return typeof e=="string"?new Sc(e):Array.isArray(e)?new Rc(e.map(la)):e}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:r,...a}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await Promise.resolve().then(()=>Dx)).ChatOpenAI}[t];if(i===void 0)throw new Error(`Cannot load LLM with type ${t}`);return new i(a)}}class Gt extends Ps{constructor({cache:e,concurrency:t,...r}){super(t?{maxConcurrency:t,...r}:r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e=="object"?this.cache=e:e?this.cache=ws.global():this.cache=void 0}async invoke(e,t){const r=Gt._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async*_streamIterator(e,t){if(this._streamResponseChunks===Gt.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=Gt._convertInputToPromptValue(e),[a,i]=this._separateRunnableConfigFromCallOptions(t),s=await De.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this==null?void 0:this.invocationParams(i)},c=await(s==null?void 0:s.handleLLMStart(this.toJSON(),[r.toString()],void 0,void 0,o));let u=new Wt({text:""});try{for await(const l of this._streamResponseChunks(e.toString(),i,c==null?void 0:c[0]))u?u=u.concat(l):u=l,typeof l.text=="string"&&(yield l.text)}catch(l){throw await Promise.all((c??[]).map(m=>m==null?void 0:m.handleLLMError(l))),l}await Promise.all((c??[]).map(l=>l==null?void 0:l.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(e,t,r){const a=e.map(i=>i.toString());return this.generate(a,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const a=e.generations[r];if(r===0)t.push({generations:[a],llmOutput:e.llmOutput});else{const i=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[a],llmOutput:i})}}return t}async _generateUncached(e,t,r){const a=await De.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this==null?void 0:this.invocationParams(t)},s=await(a==null?void 0:a.handleLLMStart(this.toJSON(),e,void 0,void 0,i));let o;try{o=await this._generate(e,t,s==null?void 0:s[0])}catch(l){throw await Promise.all((s??[]).map(m=>m==null?void 0:m.handleLLMError(l))),l}const c=this._flattenLLMResult(o);await Promise.all((s??[]).map((l,m)=>l==null?void 0:l.handleLLMEnd(c[m])));const u=(s==null?void 0:s.map(l=>l.runId))||void 0;return Object.defineProperty(o,bs,{value:u?{runIds:u}:void 0,configurable:!0}),o}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let a;Array.isArray(t)?a={stop:t}:a=t;const[i,s]=this._separateRunnableConfigFromCallOptions(a);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(e,s,i);const{cache:o}=this,c=this.serialize();c.stop=s.stop??c.stop;const u=`${Object.entries(c).sort()}`,l=[],m=await Promise.all(e.map(async(y,p)=>{const A=await o.lookup(y,u);return A||l.push(p),A}));let h={};if(l.length>0){const y=await this._generateUncached(l.map(p=>e[p]),s,i);await Promise.all(y.generations.map(async(p,A)=>{const f=l[A];return m[f]=p,o.update(e[f],u,p)})),h=y.llmOutput??{}}return{generations:m,llmOutput:h}}async call(e,t,r){const{generations:a}=await this.generate([e],t,r);return a[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const a=Wr(e),i=await this.call(a,t,r);return new Tt(i)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}static async deserialize(e){const{_type:t,_model:r,...a}=e;if(r&&r!=="base_llm")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await Promise.resolve().then(()=>xf)).OpenAI}[t];if(i===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new i(a)}}class mf extends Gt{async _generate(e,t,r){return{generations:await Promise.all(e.map((i,s)=>this._call(i,{...t,promptIndex:s},r).then(o=>[{text:o}])))}}}class jc extends mf{static lc_name(){return"OpenAIChat"}get callKeys(){return[...super.callKeys,"options","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,i,s,o,c,u,l;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"prefixMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ne("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ne("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ne("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(ne("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||ne("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ne("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ne("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??ne("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.prefixMessages=(e==null?void 0:e.prefixMessages)??this.prefixMessages,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.maxTokens=e==null?void 0:e.maxTokens,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.n>1)throw new Error("Cannot use n > 1 in OpenAIChat LLM. Use ChatOpenAI Chat Model instead.");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((a=e==null?void 0:e.configuration)==null?void 0:a.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=t==null?void 0:t.baseOptions)==null?void 0:i.headers)??((o=(s=e==null?void 0:e.configuration)==null?void 0:s.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,logit_bias:this.logitBias,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}formatMessages(e){const t={role:"user",content:e};return this.prefixMessages?[...this.prefixMessages,t]:[t]}async*_streamResponseChunks(e,t,r){var s;const a={...this.invocationParams(t),messages:this.formatMessages(e),stream:!0},i=await this.completionWithRetry(a,t);for await(const o of i){const c=o==null?void 0:o.choices[0];if(!c)continue;const{delta:u}=c,l=new Wt({text:u.content??""});yield l;const m={prompt:t.promptIndex??0,completion:c.index??0};r==null||r.handleLLMNewToken(l.text??"",m)}if((s=t.signal)!=null&&s.aborted)throw new Error("AbortError")}async _call(e,t,r){var i,s;const a=this.invocationParams(t);if(a.stream){const o=await this._streamResponseChunks(e,t,r);let c;for await(const u of o)c===void 0?c=u:c=c.concat(u);return(c==null?void 0:c.text)??""}else{const o=await this.completionWithRetry({...a,stream:!1,messages:this.formatMessages(e)},{signal:t.signal,...t.options});return((s=(i=o==null?void 0:o.choices[0])==null?void 0:i.message)==null?void 0:s.content)??""}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw aa(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=na(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new we(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}class Lc extends Gt{static lc_name(){return"OpenAI"}get callKeys(){return[...super.callKeys,"options"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,i,s,o,c,u,l,m,h,y;if(((r=e==null?void 0:e.modelName)!=null&&r.startsWith("gpt-3.5-turbo")||(a=e==null?void 0:e.modelName)!=null&&a.startsWith("gpt-4"))&&!((i=e==null?void 0:e.modelName)!=null&&i.includes("-instruct")))return new jc(e,t);if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:256}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"bestOf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-davinci-003"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ne("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ne("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ne("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(ne("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||ne("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ne("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ne("AZURE_OPENAI_BASE_PATH"),this.organization=((s=e==null?void 0:e.configuration)==null?void 0:s.organization)??ne("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.batchSize=(e==null?void 0:e.batchSize)??this.batchSize,this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.maxTokens=(e==null?void 0:e.maxTokens)??this.maxTokens,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.bestOf=(e==null?void 0:e.bestOf)??this.bestOf,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.streaming&&this.bestOf&&this.bestOf>1)throw new Error("Cannot stream results when bestOf > 1");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((o=e==null?void 0:e.configuration)==null?void 0:o.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((c=t==null?void 0:t.baseOptions)==null?void 0:c.headers)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.headers),defaultQuery:((m=t==null?void 0:t.baseOptions)==null?void 0:m.params)??((y=(h=e==null?void 0:e.configuration)==null?void 0:h.baseOptions)==null?void 0:y.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,max_tokens:this.maxTokens,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,best_of:this.bestOf,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const a=xs(e,this.batchSize),i=[],s={},o=this.invocationParams(t);if(o.max_tokens===-1){if(e.length!==1)throw new Error("max_tokens set to -1 not supported for multiple inputs");o.max_tokens=await ef({prompt:e[0],modelName:this.modelName})}for(let u=0;u<a.length;u+=1){const l=o.stream?await(async()=>{var P;const p=[];let A;const f=await this.completionWithRetry({...o,stream:!0,prompt:a[u]},t);for await(const b of f){A||(A={id:b.id,object:b.object,created:b.created,model:b.model});for(const g of b.choices){if(!p[g.index])p[g.index]=g;else{const v=p[g.index];v.text+=g.text,v.finish_reason=g.finish_reason,v.logprobs=g.logprobs}r==null||r.handleLLMNewToken(g.text,{prompt:Math.floor(g.index/this.n),completion:g.index%this.n})}}if((P=t.signal)!=null&&P.aborted)throw new Error("AbortError");return{...A,choices:p}})():await this.completionWithRetry({...o,stream:!1,prompt:a[u]},{signal:t.signal,...t.options});i.push(...l.choices);const{completion_tokens:m,prompt_tokens:h,total_tokens:y}=l.usage?l.usage:{completion_tokens:void 0,prompt_tokens:void 0,total_tokens:void 0};m&&(s.completionTokens=(s.completionTokens??0)+m),h&&(s.promptTokens=(s.promptTokens??0)+h),y&&(s.totalTokens=(s.totalTokens??0)+y)}return{generations:xs(i,this.n).map(u=>u.map(l=>({text:l.text??"",generationInfo:{finishReason:l.finish_reason,logprobs:l.logprobs}}))),llmOutput:{tokenUsage:s}}}async*_streamResponseChunks(e,t,r){var s;const a={...this.invocationParams(t),prompt:e,stream:!0},i=await this.completionWithRetry(a,t);for await(const o of i){const c=o==null?void 0:o.choices[0];if(!c)continue;const u=new Wt({text:c.text,generationInfo:{finishReason:c.finish_reason}});yield u,r==null||r.handleLLMNewToken(u.text??"")}if((s=t.signal)!=null&&s.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.completions.create(e,r)}catch(a){throw aa(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=na(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new we(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}const xf=Object.freeze(Object.defineProperty({__proto__:null,OpenAI:Lc,OpenAIChat:jc},Symbol.toStringTag,{value:"Module"}));class Ge extends Nc{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:a,callbackManager:i,...s}=e;super({...s,callbacks:i??s.callbacks}),this.memory=a}else super({verbose:t,callbacks:r}),this.memory=e}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter(c=>{var u;return!((u=this.memory)!=null&&u.memoryKeys.includes(c))});if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const i=r.length?{[r[0]]:e}:{},s=await this.call(i,t),o=Object.keys(s);if(o.length===1)return s[o[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),this.memory!=null){const r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[a,i]of Object.entries(r))t[a]=i}return t}async call(e,t,r){const a=await this._formatValues(e),i=yu(t),s=await De.configure(i.callbacks,this.callbacks,i.tags||r,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(s==null?void 0:s.handleChainStart(this.toJSON(),a));let c;try{c=await(e.signal?Promise.race([this._call(a,o),new Promise((u,l)=>{var m;(m=e.signal)==null||m.addEventListener("abort",()=>{l(new Error("AbortError"))})})]):this._call(a,o))}catch(u){throw await(o==null?void 0:o.handleChainError(u)),u}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),c),await(o==null?void 0:o.handleChainEnd(c)),Object.defineProperty(c,bs,{value:o?{runId:o==null?void 0:o.runId}:void 0,configurable:!0}),c}async apply(e,t){return Promise.all(e.map(async(r,a)=>this.call(r,t==null?void 0:t[a])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:r}=await Promise.resolve().then(()=>vf);return r.deserialize(e)}case"sequential_chain":{const{SequentialChain:r}=await Promise.resolve().then(()=>Kc);return r.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:r}=await Promise.resolve().then(()=>Kc);return r.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:r}=await Promise.resolve().then(()=>Os);return r.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:r}=await Promise.resolve().then(()=>Os);return r.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:r}=await Promise.resolve().then(()=>Os);return r.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:r}=await Promise.resolve().then(()=>op);return r.deserialize(e,t)}case"api_chain":{const{APIChain:r}=await Promise.resolve().then(()=>Ef);return r.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class gf extends Pe{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async r=>this.parseResult([{text:r}]),e,{...t,runType:"parser"}):this._callWithConfig(async r=>this.parseResult([{message:r,text:r.content}]),e,{...t,runType:"parser"})}}class yf extends gf{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class bf extends yf{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class be extends Ge{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new bf,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){let a;return this.outputParser?a=await this.outputParser.parseResultWithPrompt(e,t,r==null?void 0:r.getChild()):a=e[0].text,a}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},a={...this.llmKwargs};for(const o of this.llm.callKeys)o in e&&(a[o]=e[o],delete r[o]);const i=await this.prompt.formatPromptValue(r),{generations:s}=await this.llm.generatePrompt([i],a,t==null?void 0:t.getChild());return{[this.outputKey]:await this._getFinalOutput(s[0],i,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new be({llm:await Ps.deserialize(t),prompt:await As.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}const vf=Object.freeze(Object.defineProperty({__proto__:null,LLMChain:be},Symbol.toStringTag,{value:"Module"})),$c=`You are given the below API Documentation:
{api_docs}
Using this documentation, generate the full API url to call for answering the user question.
You should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.

Question:{question}
API url:`,_f=new ge({inputVariables:["api_docs","question"],template:$c}),wf=`${$c} {api_url}

Here is the response from the API:

{api_response}

Summarize this response to answer the original question.

Summary:`,Af=new ge({inputVariables:["api_docs","question","api_url","api_response"],template:wf});class ks extends Ge{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,t){const r=e[this.inputKey],a=await this.apiRequestChain.predict({question:r,api_docs:this.apiDocs},t==null?void 0:t.getChild("request")),s=await(await fetch(a,{headers:this.headers})).text(),o=await this.apiAnswerChain.predict({question:r,api_docs:this.apiDocs,api_url:a,api_response:s},t==null?void 0:t.getChild("response"));return{[this.outputKey]:o}}_chainType(){return"api_chain"}static async deserialize(e){const{api_request_chain:t,api_answer_chain:r,api_docs:a}=e;if(!t)throw new Error("LLMChain must have api_request_chain");if(!r)throw new Error("LLMChain must have api_answer_chain");if(!a)throw new Error("LLMChain must have api_docs");return new ks({apiAnswerChain:await be.deserialize(r),apiRequestChain:await be.deserialize(t),apiDocs:a})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,t,r={}){const{apiUrlPrompt:a=_f,apiResponsePrompt:i=Af}=r,s=new be({prompt:a,llm:e}),o=new be({prompt:i,llm:e});return new this({apiAnswerChain:o,apiRequestChain:s,apiDocs:t,...r})}}const Ef=Object.freeze(Object.defineProperty({__proto__:null,APIChain:ks},Symbol.toStringTag,{value:"Module"}));class zc extends tf{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}class Cf extends mh{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=(e==null?void 0:e.chatHistory)??new zc,this.returnMessages=(e==null?void 0:e.returnMessages)??this.returnMessages,this.inputKey=(e==null?void 0:e.inputKey)??this.inputKey,this.outputKey=(e==null?void 0:e.outputKey)??this.outputKey}async saveContext(e,t){await this.chatHistory.addUserMessage(xh(e,this.inputKey)),await this.chatHistory.addAIChatMessage(gh(t,this.outputKey))}async clear(){await this.chatHistory.clear()}}class Mc extends Cf{constructor(e){super({chatHistory:e==null?void 0:e.chatHistory,returnMessages:(e==null?void 0:e.returnMessages)??!1,inputKey:e==null?void 0:e.inputKey,outputKey:e==null?void 0:e.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const t=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:t}:{[this.memoryKey]:Wr(t,this.humanPrefix,this.aiPrefix)}}}function Uc(n,e){const t=new Set;for(const r of e)n.has(r)&&t.add(r);return t}function Pf(n,e){const t=new Set(n);for(const r of e)t.add(r);return t}function fa(n,e){const t=new Set(n);for(const r of e)t.delete(r);return t}function Ar(n){return Array.from(n).map(e=>`"${e}"`).join(", ")}class Is extends Ge{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){var s;if(this.chains.length===0)throw new Error("Sequential chain must have at least one chain.");const e=((s=this.memory)==null?void 0:s.memoryKeys)??[],t=new Set(this.inputKeys),r=new Set(e),a=Uc(t,r);if(a.size>0)throw new Error(`The following keys: ${Ar(a)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const i=Pf(t,r);for(const o of this.chains){let c=fa(new Set(o.inputKeys),i);if(o.memory&&(c=fa(c,new Set(o.memory.memoryKeys))),c.size>0)throw new Error(`Missing variables for chain "${o._chainType()}": ${Ar(c)}. Only got the following variables: ${Ar(i)}.`);const u=new Set(o.outputKeys),l=Uc(i,u);if(l.size>0)throw new Error(`The following output variables for chain "${o._chainType()}" are overlapping: ${Ar(l)}. This can lead to unexpected behaviour.`);for(const m of u)i.add(m)}if(this.outputVariables.length===0)if(this.returnAll){const o=fa(i,t);this.outputVariables=Array.from(o)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const o=fa(new Set(this.outputVariables),new Set(i));if(o.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${Ar(o)}.`)}}async _call(e,t){let r={};const a=e;let i=0;for(const o of this.chains){i+=1,r=await o.call(a,t==null?void 0:t.getChild(`step_${i}`));for(const c of Object.keys(r))a[c]=r[c]}const s={};for(const o of this.outputVariables)s[o]=a[o];return s}_chainType(){return"sequential_chain"}static async deserialize(e){const t=[],r=e.input_variables,a=e.output_variables,i=e.chains;for(const s of i){const o=await Ge.deserialize(s);t.push(o)}return new Is({chains:t,inputVariables:r,outputVariables:a})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class Ss extends Ge{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(e.inputKeys.filter(t=>{var r;return!((r=e.memory)!=null&&r.memoryKeys.includes(t))}).length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(e.outputKeys.length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],a=0;for(const i of this.chains)a+=1,r=(await i.call({[i.inputKeys[0]]:r,signal:e.signal},t==null?void 0:t.getChild(`step_${a}`)))[i.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await(t==null?void 0:t.handleText(r));return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const t=[],r=e.chains;for(const a of r){const i=await Ge.deserialize(a);t.push(i)}return new Ss({chains:t})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}const Kc=Object.freeze(Object.defineProperty({__proto__:null,SequentialChain:Is,SimpleSequentialChain:Ss},Symbol.toStringTag,{value:"Module"}));class _t extends Ge{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,i=t.map(({pageContent:s})=>s).join(`

`);return{...r,[this.documentVariableName]:i}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t==null?void 0:t.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new _t({llmChain:await be.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class Er extends Ge{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...a}=e;let i=r,s=[];for(let u=0;u<this.maxIterations;u+=1){const l=i.map(p=>({[this.documentVariableName]:p.pageContent,...a}));if(u!==0||!this.ensureMapStep){const p=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:i,...a}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(p)<this.maxTokens)break}const h=await this.llmChain.apply(l,t?Array.from({length:l.length},(p,A)=>t.getChild(`map_${A+1}`)):void 0),{outputKey:y}=this.llmChain;this.returnIntermediateSteps&&(s=s.concat(h.map(p=>p[y]))),i=h.map(p=>({pageContent:p[y],metadata:{}}))}const o={[this.combineDocumentChain.inputKey]:i,...a},c=await this.combineDocumentChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnIntermediateSteps?{...c,intermediateSteps:s}:c}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new Er({llmChain:await be.deserialize(e.llm_chain),combineDocumentChain:await _t.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class Cr extends Ge{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new ge({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},a={};return this.documentPrompt.inputVariables.forEach(o=>{a[o]=r[o]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...a})},...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},a={};this.documentPrompt.inputVariables.forEach(o=>{a[o]=r[o]});const i={[this.documentVariableName]:await this.documentPrompt.format({...a})};return{[this.initialResponseName]:t,...i}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...a}=e,i=r,s=await this._constructInitialInputs(i[0],a);let o=await this.llmChain.predict({...s},t==null?void 0:t.getChild("answer"));for(let c=1;c<i.length;c+=1){const l={...await this._constructRefineInputs(i[c],o),...a};o=await this.refineLLMChain.predict({...l},t==null?void 0:t.getChild("refine"))}return{[this.outputKey]:o}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new Cr({llmChain:await be.deserialize(t),refineLLMChain:await be.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const Os=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain:Er,RefineDocumentsChain:Cr,StuffDocumentsChain:_t},Symbol.toStringTag,{value:"Module"}));class kf{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class Pr extends kf{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function kr(n){return n._modelType()==="base_chat_model"}const If=new ge({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),Sf=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,Of=[wr.fromTemplate(Sf),Dt.fromTemplate("{question}")],Bf=rt.fromMessages(Of),Tf=new Pr(If,[[kr,Bf]]),Df=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
{context}
Question: {question}
Relevant text, if any:`,Rf=ge.fromTemplate(Df),Ff=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
----------------
{context}`,Nf=[wr.fromTemplate(Ff),Dt.fromTemplate("{question}")],jf=rt.fromMessages(Nf),Lf=new Pr(Rf,[[kr,jf]]),$f=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.

QUESTION: Which state/country's law governs the interpretation of the contract?
=========
Content: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.

Content: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.

11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.

11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.

11.9 No Third-Party Beneficiaries.

Content: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,
=========
FINAL ANSWER: This Agreement is governed by English law.

QUESTION: What did the president say about Michael Jackson?
=========
Content: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  

Last year COVID-19 kept us apart. This year we are finally together again. 

Tonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. 

With a duty to one another to the American people to the Constitution. 

And with an unwavering resolve that freedom will always triumph over tyranny. 

Six days ago, Russiaâs Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. 

He thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. 

He met the Ukrainian people. 

From President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. 

Groups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.

Content: And we wonât stop. 

We have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. 

Letâs use this moment to reset. Letâs stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  

Letâs stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  

We canât change how divided weâve been. But we can change how we move forwardâon COVID-19 and other issues we must face together. 

I recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. 

They were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. 

Officer Mora was 27 years old. 

Officer Rivera was 22. 

Both Dominican Americans whoâd grown up on the same streets they later chose to patrol as police officers. 

I spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.

Content: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  

To all Americans, I will be honest with you, as Iâve always promised. A Russian dictator, invading a foreign country, has costs around the world. 

And Iâm taking robust action to make sure the pain of our sanctions  is targeted at Russiaâs economy. And I will use every tool at our disposal to protect American businesses and consumers. 

Tonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  

America will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  

These steps will help blunt gas prices here at home. And I know the news about whatâs happening can seem alarming. 

But I want you to know that we are going to be okay.

Content: More support for patients and families. 

To get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. 

Itâs based on DARPAâthe Defense Department project that led to the Internet, GPS, and so much more.  

ARPA-H will have a singular purposeâto drive breakthroughs in cancer, Alzheimerâs, diabetes, and more. 

A unity agenda for the nation. 

We can do this. 

My fellow Americansâtonight , we have gathered in a sacred spaceâthe citadel of our democracy. 

In this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. 

We have fought for freedom, expanded liberty, defeated totalitarianism and terror. 

And built the strongest, freest, and most prosperous nation the world has ever known. 

Now is the hour. 

Our moment of responsibility. 

Our test of resolve and conscience, of history itself. 

It is in this moment that our character is formed. Our purpose is found. Our future is forged. 

Well I know this nation.
=========
FINAL ANSWER: The president did not mention Michael Jackson.

QUESTION: {question}
=========
{summaries}
=========
FINAL ANSWER:`,zf=ge.fromTemplate($f),Mf=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.
----------------
{summaries}`,Uf=[wr.fromTemplate(Mf),Dt.fromTemplate("{question}")],Kf=rt.fromMessages(Uf),Hf=new Pr(zf,[[kr,Kf]]);class pa extends Oc{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Tc(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new pa(a)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(s=>this.examplePrompt.format(s))),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return Cs(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await ge.deserialize(t);let a;if(Array.isArray(e.examples))a=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new pa({inputVariables:e.input_variables,examplePrompt:r,examples:a,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}const qf=Object.freeze(Object.defineProperty({__proto__:null,FewShotPromptTemplate:pa},Symbol.toStringTag,{value:"Module"})),Vf=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,Zf=new ge({inputVariables:["question","existing_answer","context"],template:Vf}),Wf=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,Gf=[Dt.fromTemplate("{question}"),Fc.fromTemplate("{existing_answer}"),Dt.fromTemplate(Wf)],Yf=rt.fromMessages(Gf),Xf=new Pr(Zf,[[kr,Yf]]),Jf=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer the question: {question}`,Qf=new ge({inputVariables:["context","question"],template:Jf}),ep=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer any questions`,tp=[wr.fromTemplate(ep),Dt.fromTemplate("{question}")],rp=rt.fromMessages(tp),np=new Pr(Qf,[[kr,rp]]),ap=(n,e={type:"stuff"})=>{const{type:t}=e;if(t==="stuff")return Hc(n,e);if(t==="map_reduce")return ip(n,e);if(t==="refine")return sp(n,e);throw new Error(`Invalid _type: ${t}`)};function Hc(n,e={}){const{prompt:t=Tf.getPrompt(n),verbose:r}=e,a=new be({prompt:t,llm:n,verbose:r});return new _t({llmChain:a,verbose:r})}function ip(n,e={}){const{combineMapPrompt:t=Lf.getPrompt(n),combinePrompt:r=Hf.getPrompt(n),verbose:a,combineLLM:i,returnIntermediateSteps:s}=e,o=new be({prompt:t,llm:n,verbose:a}),c=new be({prompt:r,llm:i??n,verbose:a}),u=new _t({llmChain:c,documentVariableName:"summaries",verbose:a});return new Er({llmChain:o,combineDocumentChain:u,returnIntermediateSteps:s,verbose:a})}function sp(n,e={}){const{questionPrompt:t=np.getPrompt(n),refinePrompt:r=Xf.getPrompt(n),refineLLM:a,verbose:i}=e,s=new be({prompt:t,llm:n,verbose:i}),o=new be({prompt:r,llm:a??n,verbose:i});return new Cr({llmChain:s,refineLLMChain:o,verbose:i})}class Bs extends Ge{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const r=e[this.inputKey],a=await this.vectorstore.similaritySearch(r,this.k,e.filter,t==null?void 0:t.getChild("vectorstore")),i={question:r,input_documents:a},s=await this.combineDocumentsChain.call(i,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...s,sourceDocuments:a}:s}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:r}=t;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new Bs({combineDocumentsChain:await Ge.deserialize(e.combine_documents_chain),k:e.k,vectorstore:r})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,r){const a=Hc(e);return new this({vectorstore:t,combineDocumentsChain:a,...r})}}const op=Object.freeze(Object.defineProperty({__proto__:null,VectorDBQAChain:Bs},Symbol.toStringTag,{value:"Module"})),up=`Write a concise summary of the following:


"{text}"


CONCISE SUMMARY:`,ma=new ge({template:up,inputVariables:["text"]}),cp=`Your job is to produce a final summary
We have provided an existing summary up to a certain point: "{existing_answer}"
We have the opportunity to refine the existing summary
(only if needed) with some more context below.
------------
"{text}"
------------

Given the new context, refine the original summary
If the context isn't useful, return the original summary.

REFINED SUMMARY:`,lp=new ge({template:cp,inputVariables:["existing_answer","text"]}),hp=(n,e={type:"map_reduce"})=>{const{verbose:t}=e;if(e.type==="stuff"){const{prompt:r=ma}=e,a=new be({prompt:r,llm:n,verbose:t});return new _t({llmChain:a,documentVariableName:"text",verbose:t})}if(e.type==="map_reduce"){const{combineMapPrompt:r=ma,combinePrompt:a=ma,combineLLM:i,returnIntermediateSteps:s}=e,o=new be({prompt:r,llm:n,verbose:t}),c=new be({prompt:a,llm:i??n,verbose:t}),u=new _t({llmChain:c,documentVariableName:"text",verbose:t});return new Er({llmChain:o,combineDocumentChain:u,documentVariableName:"text",returnIntermediateSteps:s,verbose:t})}if(e.type==="refine"){const{refinePrompt:r=lp,refineLLM:a,questionPrompt:i=ma}=e,s=new be({prompt:i,llm:n,verbose:t}),o=new be({prompt:r,llm:a??n,verbose:t});return new Cr({llmChain:s,refineLLMChain:o,documentVariableName:"text",verbose:t})}throw new Error(`Invalid _type: ${e.type}`)},dp=`Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.

Chat History:
{chat_history}
Follow Up Input: {question}
Standalone question:`;class Ts extends Ge{static lc_name(){return"ConversationalRetrievalQAChain"}get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}static getChatHistoryString(e){let t;return Array.isArray(e)?(Array.isArray(e[0])&&typeof e[0][0]=="string"?(console.warn(`Passing chat history as an array of strings is deprecated.
Please see https://js.langchain.com/docs/modules/chains/popular/chat_vector_db#externally-managed-memory for more information.`),t=e.flat().map((r,a)=>a%2===0?new dt(r):new Tt(r))):t=e,t.map(r=>r._getType()==="human"?`Human: ${r.content}`:r._getType()==="ai"?`Assistant: ${r.content}`:`${r.content}`).join(`
`)):e}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found.`);const r=e[this.inputKey],a=Ts.getChatHistoryString(e[this.chatHistoryKey]);let i=r;if(a.length>0){const u=await this.questionGeneratorChain.call({question:r,chat_history:a},t==null?void 0:t.getChild("question_generator")),l=Object.keys(u);if(l.length===1)i=u[l[0]];else throw new Error("Return from llm chain has multiple values, only single values supported.")}const s=await this.retriever.getRelevantDocuments(i,t==null?void 0:t.getChild("retriever")),o={question:i,input_documents:s,chat_history:a},c=await this.combineDocumentsChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...c,sourceDocuments:s}:c}_chainType(){return"conversational_retrieval_chain"}static async deserialize(e,t){throw new Error("Not implemented.")}serialize(){throw new Error("Not implemented.")}static fromLLM(e,t,r={}){const{questionGeneratorTemplate:a,qaTemplate:i,qaChainOptions:s={type:"stuff",prompt:i?ge.fromTemplate(i):void 0},questionGeneratorChainOptions:o,verbose:c,...u}=r,l=ap(e,s),m=ge.fromTemplate((o==null?void 0:o.template)??a??dp),h=new be({prompt:m,llm:(o==null?void 0:o.llm)??e,verbose:c});return new this({retriever:t,combineDocumentsChain:l,questionGeneratorChain:h,verbose:c,...u})}}var ue;(function(n){n.assertEqual=a=>a;function e(a){}n.assertIs=e;function t(a){throw new Error}n.assertNever=t,n.arrayToEnum=a=>{const i={};for(const s of a)i[s]=s;return i},n.getValidEnumValues=a=>{const i=n.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),s={};for(const o of i)s[o]=a[o];return n.objectValues(s)},n.objectValues=a=>n.objectKeys(a).map(function(i){return a[i]}),n.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},n.find=(a,i)=>{for(const s of a)if(i(s))return s},n.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(ue||(ue={}));var qc;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(qc||(qc={}));const V=ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=n=>{switch(typeof n){case"undefined":return V.undefined;case"string":return V.string;case"number":return isNaN(n)?V.nan:V.number;case"boolean":return V.boolean;case"function":return V.function;case"bigint":return V.bigint;case"symbol":return V.symbol;case"object":return Array.isArray(n)?V.array:n===null?V.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?V.promise:typeof Map<"u"&&n instanceof Map?V.map:typeof Set<"u"&&n instanceof Set?V.set:typeof Date<"u"&&n instanceof Date?V.date:V.object;default:return V.unknown}},H=ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class nt extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},a=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)r._errors.push(t(s));else{let o=r,c=0;for(;c<s.path.length;){const u=s.path[c];c===s.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(s))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return a(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}nt.create=n=>new nt(n);const xa=(n,e)=>{let t;switch(n.code){case H.invalid_type:n.received===V.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case H.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,ue.jsonStringifyReplacer)}`;break;case H.unrecognized_keys:t=`Unrecognized key(s) in object: ${ue.joinValues(n.keys,", ")}`;break;case H.invalid_union:t="Invalid input";break;case H.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ue.joinValues(n.options)}`;break;case H.invalid_enum_value:t=`Invalid enum value. Expected ${ue.joinValues(n.options)}, received '${n.received}'`;break;case H.invalid_arguments:t="Invalid function arguments";break;case H.invalid_return_type:t="Invalid function return type";break;case H.invalid_date:t="Invalid date";break;case H.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:ue.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case H.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case H.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case H.custom:t="Invalid input";break;case H.invalid_intersection_types:t="Intersection results could not be merged";break;case H.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case H.not_finite:t="Number must be finite";break;default:t=e.defaultError,ue.assertNever(n)}return{message:t}};let fp=xa;function Ds(){return fp}const Rs=n=>{const{data:e,path:t,errorMaps:r,issueData:a}=n,i=[...t,...a.path||[]],s={...a,path:i};let o="";const c=r.filter(u=>!!u).slice().reverse();for(const u of c)o=u(s,{data:e,defaultError:o}).message;return{...a,path:i,message:a.message||o}};function Z(n,e){const t=Rs({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Ds(),xa].filter(r=>!!r)});n.common.issues.push(t)}class $e{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const a of t){if(a.status==="aborted")return ee;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const a of t)r.push({key:await a.key,value:await a.value});return $e.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const a of t){const{key:i,value:s}=a;if(i.status==="aborted"||s.status==="aborted")return ee;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||a.alwaysSet)&&(r[i.value]=s.value)}return{status:e.value,value:r}}}const ee=Object.freeze({status:"aborted"}),pp=n=>({status:"dirty",value:n}),Ue=n=>({status:"valid",value:n}),Vc=n=>n.status==="aborted",Zc=n=>n.status==="dirty",ga=n=>n.status==="valid",Fs=n=>typeof Promise<"u"&&n instanceof Promise;var G;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(G||(G={}));class at{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Wc=(n,e)=>{if(ga(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new nt(n.common.issues);return this._error=t,this._error}}};function te(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:a}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(s,o)=>s.code!=="invalid_type"?{message:o.defaultError}:typeof o.data>"u"?{message:r??o.defaultError}:{message:t??o.defaultError},description:a}}class ae{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new $e,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Fs(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const a={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parseSync({data:e,path:a.path,parent:a});return Wc(a,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await(Fs(a)?a:Promise.resolve(a));return Wc(r,i)}refine(e,t){const r=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,i)=>{const s=e(a),o=()=>i.addIssue({code:H.custom,...r(a)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof t=="function"?t(r,a):t),!1))}_refinement(e){return new mt({schema:this,typeName:K.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return At.create(this,this._def)}nullable(){return tr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return it.create(this,this._def)}promise(){return Or.create(this,this._def)}or(e){return va.create([this,e],this._def)}and(e){return wa.create(this,e,this._def)}transform(e){return new mt({...te(this._def),schema:this,typeName:K.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new ka({...te(this._def),innerType:this,defaultValue:t,typeName:K.ZodDefault})}brand(){return new Pp({typeName:K.ZodBranded,type:this,...te(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Hs({...te(this._def),innerType:this,catchValue:t,typeName:K.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ia.create(this,e)}readonly(){return Vs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const mp=/^c[^\s-]{8,}$/i,xp=/^[a-z][a-z0-9]*$/,gp=/^[0-9A-HJKMNP-TV-Z]{26}$/,yp=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bp=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,vp="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ns;const _p=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,wp=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ap=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Ep(n,e){return!!((e==="v4"||!e)&&_p.test(n)||(e==="v6"||!e)&&wp.test(n))}class ft extends ae{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==V.string){const i=this._getOrReturnCtx(e);return Z(i,{code:H.invalid_type,expected:V.string,received:i.parsedType}),ee}const r=new $e;let a;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),Z(a,{code:H.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),Z(a,{code:H.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const s=e.data.length>i.value,o=e.data.length<i.value;(s||o)&&(a=this._getOrReturnCtx(e,a),s?Z(a,{code:H.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&Z(a,{code:H.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")bp.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"email",code:H.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Ns||(Ns=new RegExp(vp,"u")),Ns.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"emoji",code:H.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")yp.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"uuid",code:H.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")mp.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"cuid",code:H.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")xp.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"cuid2",code:H.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")gp.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"ulid",code:H.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),Z(a,{validation:"url",code:H.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"regex",code:H.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),Z(a,{code:H.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),Z(a,{code:H.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),Z(a,{code:H.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Ap(i).test(e.data)||(a=this._getOrReturnCtx(e,a),Z(a,{code:H.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="ip"?Ep(e.data,i.version)||(a=this._getOrReturnCtx(e,a),Z(a,{validation:"ip",code:H.invalid_string,message:i.message}),r.dirty()):ue.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(a=>e.test(a),{validation:t,code:H.invalid_string,...G.errToObj(r)})}_addCheck(e){return new ft({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...G.errToObj(e)})}url(e){return this._addCheck({kind:"url",...G.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...G.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...G.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...G.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...G.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...G.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...G.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...G.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...G.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...G.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...G.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...G.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...G.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...G.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...G.errToObj(t)})}nonempty(e){return this.min(1,G.errToObj(e))}trim(){return new ft({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ft({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ft({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ft.create=n=>{var e;return new ft({checks:[],typeName:K.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...te(n)})};function Cp(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=t>r?t:r,i=parseInt(n.toFixed(a).replace(".","")),s=parseInt(e.toFixed(a).replace(".",""));return i%s/Math.pow(10,a)}class Yt extends ae{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==V.number){const i=this._getOrReturnCtx(e);return Z(i,{code:H.invalid_type,expected:V.number,received:i.parsedType}),ee}let r;const a=new $e;for(const i of this._def.checks)i.kind==="int"?ue.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),Z(r,{code:H.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:H.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:H.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Cp(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),Z(r,{code:H.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),Z(r,{code:H.not_finite,message:i.message}),a.dirty()):ue.assertNever(i);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,G.toString(t))}gt(e,t){return this.setLimit("min",e,!1,G.toString(t))}lte(e,t){return this.setLimit("max",e,!0,G.toString(t))}lt(e,t){return this.setLimit("max",e,!1,G.toString(t))}setLimit(e,t,r,a){return new Yt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:G.toString(a)}]})}_addCheck(e){return new Yt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:G.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:G.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:G.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:G.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:G.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ue.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Yt.create=n=>new Yt({checks:[],typeName:K.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...te(n)});class Xt extends ae{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==V.bigint){const i=this._getOrReturnCtx(e);return Z(i,{code:H.invalid_type,expected:V.bigint,received:i.parsedType}),ee}let r;const a=new $e;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:H.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:H.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:H.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):ue.assertNever(i);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,G.toString(t))}gt(e,t){return this.setLimit("min",e,!1,G.toString(t))}lte(e,t){return this.setLimit("max",e,!0,G.toString(t))}lt(e,t){return this.setLimit("max",e,!1,G.toString(t))}setLimit(e,t,r,a){return new Xt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:G.toString(a)}]})}_addCheck(e){return new Xt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:G.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Xt.create=n=>{var e;return new Xt({checks:[],typeName:K.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...te(n)})};class js extends ae{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==V.boolean){const r=this._getOrReturnCtx(e);return Z(r,{code:H.invalid_type,expected:V.boolean,received:r.parsedType}),ee}return Ue(e.data)}}js.create=n=>new js({typeName:K.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...te(n)});class Ir extends ae{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==V.date){const i=this._getOrReturnCtx(e);return Z(i,{code:H.invalid_type,expected:V.date,received:i.parsedType}),ee}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return Z(i,{code:H.invalid_date}),ee}const r=new $e;let a;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),Z(a,{code:H.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),Z(a,{code:H.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):ue.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ir({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:G.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:G.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Ir.create=n=>new Ir({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:K.ZodDate,...te(n)});class Ls extends ae{_parse(e){if(this._getType(e)!==V.symbol){const r=this._getOrReturnCtx(e);return Z(r,{code:H.invalid_type,expected:V.symbol,received:r.parsedType}),ee}return Ue(e.data)}}Ls.create=n=>new Ls({typeName:K.ZodSymbol,...te(n)});class ya extends ae{_parse(e){if(this._getType(e)!==V.undefined){const r=this._getOrReturnCtx(e);return Z(r,{code:H.invalid_type,expected:V.undefined,received:r.parsedType}),ee}return Ue(e.data)}}ya.create=n=>new ya({typeName:K.ZodUndefined,...te(n)});class ba extends ae{_parse(e){if(this._getType(e)!==V.null){const r=this._getOrReturnCtx(e);return Z(r,{code:H.invalid_type,expected:V.null,received:r.parsedType}),ee}return Ue(e.data)}}ba.create=n=>new ba({typeName:K.ZodNull,...te(n)});class $s extends ae{constructor(){super(...arguments),this._any=!0}_parse(e){return Ue(e.data)}}$s.create=n=>new $s({typeName:K.ZodAny,...te(n)});class Jt extends ae{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ue(e.data)}}Jt.create=n=>new Jt({typeName:K.ZodUnknown,...te(n)});class wt extends ae{_parse(e){const t=this._getOrReturnCtx(e);return Z(t,{code:H.invalid_type,expected:V.never,received:t.parsedType}),ee}}wt.create=n=>new wt({typeName:K.ZodNever,...te(n)});class zs extends ae{_parse(e){if(this._getType(e)!==V.undefined){const r=this._getOrReturnCtx(e);return Z(r,{code:H.invalid_type,expected:V.void,received:r.parsedType}),ee}return Ue(e.data)}}zs.create=n=>new zs({typeName:K.ZodVoid,...te(n)});class it extends ae{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==V.array)return Z(t,{code:H.invalid_type,expected:V.array,received:t.parsedType}),ee;if(a.exactLength!==null){const s=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(s||o)&&(Z(t,{code:s?H.too_big:H.too_small,minimum:o?a.exactLength.value:void 0,maximum:s?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(Z(t,{code:H.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(Z(t,{code:H.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((s,o)=>a.type._parseAsync(new at(t,s,t.path,o)))).then(s=>$e.mergeArray(r,s));const i=[...t.data].map((s,o)=>a.type._parseSync(new at(t,s,t.path,o)));return $e.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new it({...this._def,minLength:{value:e,message:G.toString(t)}})}max(e,t){return new it({...this._def,maxLength:{value:e,message:G.toString(t)}})}length(e,t){return new it({...this._def,exactLength:{value:e,message:G.toString(t)}})}nonempty(e){return this.min(1,e)}}it.create=(n,e)=>new it({type:n,minLength:null,maxLength:null,exactLength:null,typeName:K.ZodArray,...te(e)});function Qt(n){if(n instanceof ve){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=At.create(Qt(r))}return new ve({...n._def,shape:()=>e})}else return n instanceof it?new it({...n._def,type:Qt(n.element)}):n instanceof At?At.create(Qt(n.unwrap())):n instanceof tr?tr.create(Qt(n.unwrap())):n instanceof pt?pt.create(n.items.map(e=>Qt(e))):n}class ve extends ae{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ue.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==V.object){const u=this._getOrReturnCtx(e);return Z(u,{code:H.invalid_type,expected:V.object,received:u.parsedType}),ee}const{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof wt&&this._def.unknownKeys==="strip"))for(const u in a.data)s.includes(u)||o.push(u);const c=[];for(const u of s){const l=i[u],m=a.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new at(a,m,a.path,u)),alwaysSet:u in a.data})}if(this._def.catchall instanceof wt){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:a.data[l]}});else if(u==="strict")o.length>0&&(Z(a,{code:H.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const m=a.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new at(a,m,a.path,l)),alwaysSet:l in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of c){const m=await l.key;u.push({key:m,value:await l.value,alwaysSet:l.alwaysSet})}return u}).then(u=>$e.mergeObjectSync(r,u)):$e.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return G.errToObj,new ve({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var a,i,s,o;const c=(s=(i=(a=this._def).errorMap)===null||i===void 0?void 0:i.call(a,t,r).message)!==null&&s!==void 0?s:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=G.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new ve({...this._def,unknownKeys:"strip"})}passthrough(){return new ve({...this._def,unknownKeys:"passthrough"})}extend(e){return new ve({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ve({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:K.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ve({...this._def,catchall:e})}pick(e){const t={};return ue.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ve({...this._def,shape:()=>t})}omit(e){const t={};return ue.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ve({...this._def,shape:()=>t})}deepPartial(){return Qt(this)}partial(e){const t={};return ue.objectKeys(this.shape).forEach(r=>{const a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new ve({...this._def,shape:()=>t})}required(e){const t={};return ue.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof At;)i=i._def.innerType;t[r]=i}}),new ve({...this._def,shape:()=>t})}keyof(){return Gc(ue.objectKeys(this.shape))}}ve.create=(n,e)=>new ve({shape:()=>n,unknownKeys:"strip",catchall:wt.create(),typeName:K.ZodObject,...te(e)}),ve.strictCreate=(n,e)=>new ve({shape:()=>n,unknownKeys:"strict",catchall:wt.create(),typeName:K.ZodObject,...te(e)}),ve.lazycreate=(n,e)=>new ve({shape:n,unknownKeys:"strip",catchall:wt.create(),typeName:K.ZodObject,...te(e)});class va extends ae{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function a(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(o=>new nt(o.ctx.common.issues));return Z(t,{code:H.invalid_union,unionErrors:s}),ee}if(t.common.async)return Promise.all(r.map(async i=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(a);{let i;const s=[];for(const c of r){const u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=s.map(c=>new nt(c));return Z(t,{code:H.invalid_union,unionErrors:o}),ee}}get options(){return this._def.options}}va.create=(n,e)=>new va({options:n,typeName:K.ZodUnion,...te(e)});const _a=n=>n instanceof Ea?_a(n.schema):n instanceof mt?_a(n.innerType()):n instanceof Ca?[n.value]:n instanceof Ft?n.options:n instanceof Pa?Object.keys(n.enum):n instanceof ka?_a(n._def.innerType):n instanceof ya?[void 0]:n instanceof ba?[null]:null;class Ms extends ae{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==V.object)return Z(t,{code:H.invalid_type,expected:V.object,received:t.parsedType}),ee;const r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(Z(t,{code:H.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ee)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const a=new Map;for(const i of t){const s=_a(i.shape[e]);if(!s)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of s){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,i)}}return new Ms({typeName:K.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...te(r)})}}function Us(n,e){const t=Rt(n),r=Rt(e);if(n===e)return{valid:!0,data:n};if(t===V.object&&r===V.object){const a=ue.objectKeys(e),i=ue.objectKeys(n).filter(o=>a.indexOf(o)!==-1),s={...n,...e};for(const o of i){const c=Us(n[o],e[o]);if(!c.valid)return{valid:!1};s[o]=c.data}return{valid:!0,data:s}}else if(t===V.array&&r===V.array){if(n.length!==e.length)return{valid:!1};const a=[];for(let i=0;i<n.length;i++){const s=n[i],o=e[i],c=Us(s,o);if(!c.valid)return{valid:!1};a.push(c.data)}return{valid:!0,data:a}}else return t===V.date&&r===V.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class wa extends ae{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=(i,s)=>{if(Vc(i)||Vc(s))return ee;const o=Us(i.value,s.value);return o.valid?((Zc(i)||Zc(s))&&t.dirty(),{status:t.value,value:o.data}):(Z(r,{code:H.invalid_intersection_types}),ee)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,s])=>a(i,s)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}wa.create=(n,e,t)=>new wa({left:n,right:e,typeName:K.ZodIntersection,...te(t)});class pt extends ae{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==V.array)return Z(r,{code:H.invalid_type,expected:V.array,received:r.parsedType}),ee;if(r.data.length<this._def.items.length)return Z(r,{code:H.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ee;!this._def.rest&&r.data.length>this._def.items.length&&(Z(r,{code:H.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((s,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new at(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>$e.mergeArray(t,s)):$e.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new pt({...this._def,rest:e})}}pt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new pt({items:n,typeName:K.ZodTuple,rest:null,...te(e)})};class Aa extends ae{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==V.object)return Z(r,{code:H.invalid_type,expected:V.object,received:r.parsedType}),ee;const a=[],i=this._def.keyType,s=this._def.valueType;for(const o in r.data)a.push({key:i._parse(new at(r,o,r.path,o)),value:s._parse(new at(r,r.data[o],r.path,o))});return r.common.async?$e.mergeObjectAsync(t,a):$e.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof ae?new Aa({keyType:e,valueType:t,typeName:K.ZodRecord,...te(r)}):new Aa({keyType:ft.create(),valueType:e,typeName:K.ZodRecord,...te(t)})}}class Ks extends ae{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==V.map)return Z(r,{code:H.invalid_type,expected:V.map,received:r.parsedType}),ee;const a=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([o,c],u)=>({key:a._parse(new at(r,o,r.path,[u,"key"])),value:i._parse(new at(r,c,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of s){const u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return ee;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of s){const u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return ee;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}}}}Ks.create=(n,e,t)=>new Ks({valueType:e,keyType:n,typeName:K.ZodMap,...te(t)});class er extends ae{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==V.set)return Z(r,{code:H.invalid_type,expected:V.set,received:r.parsedType}),ee;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Z(r,{code:H.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Z(r,{code:H.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const i=this._def.valueType;function s(c){const u=new Set;for(const l of c){if(l.status==="aborted")return ee;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((c,u)=>i._parse(new at(r,c,r.path,u)));return r.common.async?Promise.all(o).then(c=>s(c)):s(o)}min(e,t){return new er({...this._def,minSize:{value:e,message:G.toString(t)}})}max(e,t){return new er({...this._def,maxSize:{value:e,message:G.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}er.create=(n,e)=>new er({valueType:n,minSize:null,maxSize:null,typeName:K.ZodSet,...te(e)});class Sr extends ae{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==V.function)return Z(t,{code:H.invalid_type,expected:V.function,received:t.parsedType}),ee;function r(o,c){return Rs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ds(),xa].filter(u=>!!u),issueData:{code:H.invalid_arguments,argumentsError:c}})}function a(o,c){return Rs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ds(),xa].filter(u=>!!u),issueData:{code:H.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Or){const o=this;return Ue(async function(...c){const u=new nt([]),l=await o._def.args.parseAsync(c,i).catch(y=>{throw u.addIssue(r(c,y)),u}),m=await Reflect.apply(s,this,l);return await o._def.returns._def.type.parseAsync(m,i).catch(y=>{throw u.addIssue(a(m,y)),u})})}else{const o=this;return Ue(function(...c){const u=o._def.args.safeParse(c,i);if(!u.success)throw new nt([r(c,u.error)]);const l=Reflect.apply(s,this,u.data),m=o._def.returns.safeParse(l,i);if(!m.success)throw new nt([a(l,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Sr({...this._def,args:pt.create(e).rest(Jt.create())})}returns(e){return new Sr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Sr({args:e||pt.create([]).rest(Jt.create()),returns:t||Jt.create(),typeName:K.ZodFunction,...te(r)})}}class Ea extends ae{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ea.create=(n,e)=>new Ea({getter:n,typeName:K.ZodLazy,...te(e)});class Ca extends ae{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Z(t,{received:t.data,code:H.invalid_literal,expected:this._def.value}),ee}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ca.create=(n,e)=>new Ca({value:n,typeName:K.ZodLiteral,...te(e)});function Gc(n,e){return new Ft({values:n,typeName:K.ZodEnum,...te(e)})}class Ft extends ae{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return Z(t,{expected:ue.joinValues(r),received:t.parsedType,code:H.invalid_type}),ee}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),r=this._def.values;return Z(t,{received:t.data,code:H.invalid_enum_value,options:r}),ee}return Ue(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Ft.create(e)}exclude(e){return Ft.create(this.options.filter(t=>!e.includes(t)))}}Ft.create=Gc;class Pa extends ae{_parse(e){const t=ue.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==V.string&&r.parsedType!==V.number){const a=ue.objectValues(t);return Z(r,{expected:ue.joinValues(a),received:r.parsedType,code:H.invalid_type}),ee}if(t.indexOf(e.data)===-1){const a=ue.objectValues(t);return Z(r,{received:r.data,code:H.invalid_enum_value,options:a}),ee}return Ue(e.data)}get enum(){return this._def.values}}Pa.create=(n,e)=>new Pa({values:n,typeName:K.ZodNativeEnum,...te(e)});class Or extends ae{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==V.promise&&t.common.async===!1)return Z(t,{code:H.invalid_type,expected:V.promise,received:t.parsedType}),ee;const r=t.parsedType===V.promise?t.data:Promise.resolve(t.data);return Ue(r.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Or.create=(n,e)=>new Or({type:n,typeName:K.ZodPromise,...te(e)});class mt extends ae{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===K.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:s=>{Z(r,s),s.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const s=a.transform(r.data,i);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(s).then(o=>this._def.schema._parseAsync({data:o,path:r.path,parent:r})):this._def.schema._parseSync({data:s,path:r.path,parent:r})}if(a.type==="refinement"){const s=o=>{const c=a.refinement(o,i);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?ee:(o.status==="dirty"&&t.dirty(),s(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?ee:(o.status==="dirty"&&t.dirty(),s(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ga(s))return s;const o=a.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>ga(s)?Promise.resolve(a.transform(s.value,i)).then(o=>({status:t.value,value:o})):s);ue.assertNever(a)}}mt.create=(n,e,t)=>new mt({schema:n,typeName:K.ZodEffects,effect:e,...te(t)}),mt.createWithPreprocess=(n,e,t)=>new mt({schema:e,effect:{type:"preprocess",transform:n},typeName:K.ZodEffects,...te(t)});class At extends ae{_parse(e){return this._getType(e)===V.undefined?Ue(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}At.create=(n,e)=>new At({innerType:n,typeName:K.ZodOptional,...te(e)});class tr extends ae{_parse(e){return this._getType(e)===V.null?Ue(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}tr.create=(n,e)=>new tr({innerType:n,typeName:K.ZodNullable,...te(e)});class ka extends ae{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===V.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ka.create=(n,e)=>new ka({innerType:n,typeName:K.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...te(e)});class Hs extends ae{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Fs(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new nt(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new nt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Hs.create=(n,e)=>new Hs({innerType:n,typeName:K.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...te(e)});class qs extends ae{_parse(e){if(this._getType(e)!==V.nan){const r=this._getOrReturnCtx(e);return Z(r,{code:H.invalid_type,expected:V.nan,received:r.parsedType}),ee}return{status:"valid",value:e.data}}}qs.create=n=>new qs({typeName:K.ZodNaN,...te(n)});class Pp extends ae{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ia extends ae{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ee:i.status==="dirty"?(t.dirty(),pp(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ee:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,t){return new Ia({in:e,out:t,typeName:K.ZodPipeline})}}class Vs extends ae{_parse(e){const t=this._def.innerType._parse(e);return ga(t)&&(t.value=Object.freeze(t.value)),t}}Vs.create=(n,e)=>new Vs({innerType:n,typeName:K.ZodReadonly,...te(e)}),ve.lazycreate;var K;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(K||(K={})),ft.create,Yt.create,qs.create,Xt.create,js.create,Ir.create,Ls.create,ya.create,ba.create,$s.create,Jt.create,wt.create,zs.create,it.create,ve.create,ve.strictCreate,va.create,Ms.create,wa.create,pt.create,Aa.create,Ks.create,er.create,Sr.create,Ea.create,Ca.create,Ft.create,Pa.create,Or.create,mt.create,At.create,tr.create,mt.createWithPreprocess,Ia.create;function Yc(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function fe(n,e,t,r,a){n[e]=t,Yc(n,e,r,a)}const Xc={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"},kp=n=>typeof n=="string"?{...Xc,name:n}:{...Xc,...n};function Ip(){return{}}function Sp(n,e){var r,a;const t={type:"array"};return((a=(r=n.type)==null?void 0:r._def)==null?void 0:a.typeName)!==K.ZodAny&&(t.items=le(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&fe(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&fe(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(fe(t,"minItems",n.exactLength.value,n.exactLength.message,e),fe(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Op(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?fe(t,"minimum",r.value,r.message,e):fe(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),fe(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?fe(t,"maximum",r.value,r.message,e):fe(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),fe(t,"maximum",r.value,r.message,e));break;case"multipleOf":fe(t,"multipleOf",r.value,r.message,e);break}return t}function Bp(){return{type:"boolean"}}function Tp(n,e){return le(n.type._def,e)}const Dp=(n,e)=>le(n.innerType._def,e);function Rp(n,e){return e.dateStrategy=="integer"?Fp(n,e):{type:"string",format:"date-time"}}const Fp=(n,e)=>{const t={type:"integer",format:"unix-time"};for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"&&fe(t,"minimum",r.value,r.message,e);break;case"max":e.target==="jsonSchema7"&&fe(t,"maximum",r.value,r.message,e);break}return t};function Np(n,e){return{...le(n.innerType._def,e),default:n.defaultValue()}}function jp(n,e){return e.effectStrategy==="input"?le(n.schema._def,e):{}}function Lp(n){return{type:"string",enum:n.values}}const $p=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function zp(n,e){const t=[le(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),le(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(i=>{if($p(i))a.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...c}=i;s=c}else r=void 0;a.push(s)}}),a.length?{allOf:a,...r}:void 0}function Mp(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}const Br={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function Jc(n,e){const t={type:"string"};function r(a){return e.patternStrategy==="escape"?Up(a):a}if(n.checks)for(const a of n.checks)switch(a.kind){case"min":fe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e);break;case"max":fe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Nt(t,"email",a.message,e);break;case"format:idn-email":Nt(t,"idn-email",a.message,e);break;case"pattern:zod":xt(t,Br.email,a.message,e);break}break;case"url":Nt(t,"uri",a.message,e);break;case"uuid":Nt(t,"uuid",a.message,e);break;case"regex":xt(t,a.regex.source,a.message,e);break;case"cuid":xt(t,Br.cuid,a.message,e);break;case"cuid2":xt(t,Br.cuid2,a.message,e);break;case"startsWith":xt(t,"^"+r(a.value),a.message,e);break;case"endsWith":xt(t,r(a.value)+"$",a.message,e);break;case"datetime":Nt(t,"date-time",a.message,e);break;case"length":fe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e),fe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"includes":{xt(t,r(a.value),a.message,e);break}case"ip":{a.version!=="v6"&&Nt(t,"ipv4",a.message,e),a.version!=="v4"&&Nt(t,"ipv6",a.message,e);break}case"emoji":xt(t,Br.emoji,a.message,e);break;case"ulid":{xt(t,Br.ulid,a.message,e);break}}return t}const Up=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Nt=(n,e,t,r)=>{var a;n.format||(a=n.anyOf)!=null&&a.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):fe(n,"format",e,t,r)},xt=(n,e,t,r)=>{var a;n.pattern||(a=n.allOf)!=null&&a.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:e,...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):fe(n,"pattern",e,t,r)};function Qc(n,e){var r,a,i,s;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===K.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,c)=>({...o,[c]:le(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:le(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((a=n.keyType)==null?void 0:a._def.typeName)===K.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(Jc(n.keyType._def,e)).reduce((c,[u,l])=>u==="type"?c:{...c,[u]:l},{});return{...t,propertyNames:o}}else if(((s=n.keyType)==null?void 0:s._def.typeName)===K.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function Kp(n,e){if(e.mapStrategy==="record")return Qc(n,e);const t=le(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=le(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Hp(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),a=Array.from(new Set(r.map(i=>typeof i)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function qp(){return{not:{}}}function Vp(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Sa={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Zp(n,e){if(e.target==="openApi3")return el(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Sa&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((a,i)=>{const s=Sa[i._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((a,i)=>{const s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(i._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===t.length){const a=r.filter((i,s,o)=>o.indexOf(i)===s);return{type:a.length>1?a:a[0],enum:t.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,a)=>[...r,...a._def.values.filter(i=>!r.includes(i))],[])};return el(n,e)}const el=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,a)=>le(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Wp(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Sa[n.innerType._def.typeName],nullable:!0}:{type:[Sa[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=le(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&{...r,nullable:!0}}const t=le(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Gp(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",Yc(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?fe(t,"minimum",r.value,r.message,e):fe(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),fe(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?fe(t,"maximum",r.value,r.message,e):fe(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),fe(t,"maximum",r.value,r.message,e));break;case"multipleOf":fe(t,"multipleOf",r.value,r.message,e);break}return t}function Yp(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[a,i])=>{if(i===void 0||i._def===void 0)return r;const s=le(i._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return s===void 0?r:{properties:{...r.properties,[a]:s},required:i.isOptional()?r.required:[...r.required,a]}},{properties:{},required:[]}),additionalProperties:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":le(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0};return t.required.length||delete t.required,t}const Xp=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return le(n.innerType._def,e);const t=le(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Jp=(n,e)=>{if(e.pipeStrategy==="input")return le(n.in._def,e);const t=le(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=le(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(a=>a!==void 0)}};function Qp(n,e){return le(n.type._def,e)}function em(n,e){const r={type:"array",uniqueItems:!0,items:le(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&fe(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&fe(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function tm(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>le(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:le(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>le(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function rm(){return{not:{}}}function nm(){return{}}const am=(n,e)=>le(n.innerType._def,e);function le(n,e,t=!1){const r=e.seen.get(n);if(r&&!t){const s=im(r,e);if(s!==void 0)return s}const a={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,a);const i=om(n,n.typeName,e);return i&&um(n,e,i),a.jsonSchema=i,i}const im=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.length===0?"":n.path.length===1?`${n.path[0]}/`:n.path.join("/")};case"relative":return{$ref:sm(e.currentPath,n.path)};case"none":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):void 0;case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):n.jsonSchema}},sm=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},om=(n,e,t)=>{switch(e){case K.ZodString:return Jc(n,t);case K.ZodNumber:return Gp(n,t);case K.ZodObject:return Yp(n,t);case K.ZodBigInt:return Op(n,t);case K.ZodBoolean:return Bp();case K.ZodDate:return Rp(n,t);case K.ZodUndefined:return rm();case K.ZodNull:return Vp(t);case K.ZodArray:return Sp(n,t);case K.ZodUnion:case K.ZodDiscriminatedUnion:return Zp(n,t);case K.ZodIntersection:return zp(n,t);case K.ZodTuple:return tm(n,t);case K.ZodRecord:return Qc(n,t);case K.ZodLiteral:return Mp(n,t);case K.ZodEnum:return Lp(n);case K.ZodNativeEnum:return Hp(n);case K.ZodNullable:return Wp(n,t);case K.ZodOptional:return Xp(n,t);case K.ZodMap:return Kp(n,t);case K.ZodSet:return em(n,t);case K.ZodLazy:return le(n.getter()._def,t);case K.ZodPromise:return Qp(n,t);case K.ZodNaN:case K.ZodNever:return qp();case K.ZodEffects:return jp(n,t);case K.ZodAny:return Ip();case K.ZodUnknown:return nm();case K.ZodDefault:return Np(n,t);case K.ZodBranded:return Tp(n,t);case K.ZodReadonly:return am(n,t);case K.ZodCatch:return Dp(n,t);case K.ZodPipeline:return Jp(n,t);case K.ZodFunction:case K.ZodVoid:case K.ZodSymbol:return;default:return(r=>{})()}},um=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),cm=n=>{const e=kp(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},lm=(n,e)=>{const t=cm(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((o,[c,u])=>({...o,[c]:le(u._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0)??{}}),{}):void 0,a=typeof e=="string"?e:e==null?void 0:e.name,i=le(n._def,a===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,a]},!1)??{},s=a===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:{...r,[a]:i}};return t.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s};/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function tl(n){return typeof n>"u"||n===null}function hm(n){return typeof n=="object"&&n!==null}function dm(n){return Array.isArray(n)?n:tl(n)?[]:[n]}function fm(n,e){var t,r,a,i;if(e)for(i=Object.keys(e),t=0,r=i.length;t<r;t+=1)a=i[t],n[a]=e[a];return n}function pm(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}function mm(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var xm=tl,gm=hm,ym=dm,bm=pm,vm=mm,_m=fm,Zs={isNothing:xm,isObject:gm,toArray:ym,repeat:bm,isNegativeZero:vm,extend:_m};function rl(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}function Tr(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=rl(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Tr.prototype=Object.create(Error.prototype),Tr.prototype.constructor=Tr,Tr.prototype.toString=function(e){return this.name+": "+rl(this,e)};var jt=Tr,wm=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Am=["scalar","sequence","mapping"];function Em(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}function Cm(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(wm.indexOf(t)===-1)throw new jt('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=Em(e.styleAliases||null),Am.indexOf(this.kind)===-1)throw new jt('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var Fe=Cm;function nl(n,e){var t=[];return n[e].forEach(function(r){var a=t.length;t.forEach(function(i,s){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(a=s)}),t[a]=r}),t}function Pm(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(a){a.multi?(n.multi[a.kind].push(a),n.multi.fallback.push(a)):n[a.kind][a.tag]=n.fallback[a.tag]=a}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}function Ws(n){return this.extend(n)}Ws.prototype.extend=function(e){var t=[],r=[];if(e instanceof Fe)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new jt("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(i){if(!(i instanceof Fe))throw new jt("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new jt("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new jt("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof Fe))throw new jt("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var a=Object.create(Ws.prototype);return a.implicit=(this.implicit||[]).concat(t),a.explicit=(this.explicit||[]).concat(r),a.compiledImplicit=nl(a,"implicit"),a.compiledExplicit=nl(a,"explicit"),a.compiledTypeMap=Pm(a.compiledImplicit,a.compiledExplicit),a};var km=Ws,Im=new Fe("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),Sm=new Fe("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),Om=new Fe("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),Bm=new km({explicit:[Im,Sm,Om]});function Tm(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function Dm(){return null}function Rm(n){return n===null}var Fm=new Fe("tag:yaml.org,2002:null",{kind:"scalar",resolve:Tm,construct:Dm,predicate:Rm,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Nm(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function jm(n){return n==="true"||n==="True"||n==="TRUE"}function Lm(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var $m=new Fe("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Nm,construct:jm,predicate:Lm,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function zm(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function Mm(n){return 48<=n&&n<=55}function Um(n){return 48<=n&&n<=57}function Km(n){if(n===null)return!1;var e=n.length,t=0,r=!1,a;if(!e)return!1;if(a=n[t],(a==="-"||a==="+")&&(a=n[++t]),a==="0"){if(t+1===e)return!0;if(a=n[++t],a==="b"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(a!=="0"&&a!=="1")return!1;r=!0}return r&&a!=="_"}if(a==="x"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(!zm(n.charCodeAt(t)))return!1;r=!0}return r&&a!=="_"}if(a==="o"){for(t++;t<e;t++)if(a=n[t],a!=="_"){if(!Mm(n.charCodeAt(t)))return!1;r=!0}return r&&a!=="_"}}if(a==="_")return!1;for(;t<e;t++)if(a=n[t],a!=="_"){if(!Um(n.charCodeAt(t)))return!1;r=!0}return!(!r||a==="_")}function Hm(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function qm(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!Zs.isNegativeZero(n)}var Vm=new Fe("tag:yaml.org,2002:int",{kind:"scalar",resolve:Km,construct:Hm,predicate:qm,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Zm=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Wm(n){return!(n===null||!Zm.test(n)||n[n.length-1]==="_")}function Gm(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var Ym=/^[-+]?[0-9]+e/;function Xm(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Zs.isNegativeZero(n))return"-0.0";return t=n.toString(10),Ym.test(t)?t.replace("e",".e"):t}function Jm(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||Zs.isNegativeZero(n))}var Qm=new Fe("tag:yaml.org,2002:float",{kind:"scalar",resolve:Wm,construct:Gm,predicate:Jm,represent:Xm,defaultStyle:"lowercase"}),ex=Bm.extend({implicit:[Fm,$m,Vm,Qm]}),tx=ex,al=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),il=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function rx(n){return n===null?!1:al.exec(n)!==null||il.exec(n)!==null}function nx(n){var e,t,r,a,i,s,o,c=0,u=null,l,m,h;if(e=al.exec(n),e===null&&(e=il.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,a=+e[3],!e[4])return new Date(Date.UTC(t,r,a));if(i=+e[4],s=+e[5],o=+e[6],e[7]){for(c=e[7].slice(0,3);c.length<3;)c+="0";c=+c}return e[9]&&(l=+e[10],m=+(e[11]||0),u=(l*60+m)*6e4,e[9]==="-"&&(u=-u)),h=new Date(Date.UTC(t,r,a,i,s,o,c)),u&&h.setTime(h.getTime()-u),h}function ax(n){return n.toISOString()}var ix=new Fe("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:rx,construct:nx,instanceOf:Date,represent:ax});function sx(n){return n==="<<"||n===null}var ox=new Fe("tag:yaml.org,2002:merge",{kind:"scalar",resolve:sx}),Gs=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function ux(n){if(n===null)return!1;var e,t,r=0,a=n.length,i=Gs;for(t=0;t<a;t++)if(e=i.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function cx(n){var e,t,r=n.replace(/[\r\n=]/g,""),a=r.length,i=Gs,s=0,o=[];for(e=0;e<a;e++)e%4===0&&e&&(o.push(s>>16&255),o.push(s>>8&255),o.push(s&255)),s=s<<6|i.indexOf(r.charAt(e));return t=a%4*6,t===0?(o.push(s>>16&255),o.push(s>>8&255),o.push(s&255)):t===18?(o.push(s>>10&255),o.push(s>>2&255)):t===12&&o.push(s>>4&255),new Uint8Array(o)}function lx(n){var e="",t=0,r,a,i=n.length,s=Gs;for(r=0;r<i;r++)r%3===0&&r&&(e+=s[t>>18&63],e+=s[t>>12&63],e+=s[t>>6&63],e+=s[t&63]),t=(t<<8)+n[r];return a=i%3,a===0?(e+=s[t>>18&63],e+=s[t>>12&63],e+=s[t>>6&63],e+=s[t&63]):a===2?(e+=s[t>>10&63],e+=s[t>>4&63],e+=s[t<<2&63],e+=s[64]):a===1&&(e+=s[t>>2&63],e+=s[t<<4&63],e+=s[64],e+=s[64]),e}function hx(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var dx=new Fe("tag:yaml.org,2002:binary",{kind:"scalar",resolve:ux,construct:cx,predicate:hx,represent:lx}),fx=Object.prototype.hasOwnProperty,px=Object.prototype.toString;function mx(n){if(n===null)return!0;var e=[],t,r,a,i,s,o=n;for(t=0,r=o.length;t<r;t+=1){if(a=o[t],s=!1,px.call(a)!=="[object Object]")return!1;for(i in a)if(fx.call(a,i))if(!s)s=!0;else return!1;if(!s)return!1;if(e.indexOf(i)===-1)e.push(i);else return!1}return!0}function xx(n){return n!==null?n:[]}var gx=new Fe("tag:yaml.org,2002:omap",{kind:"sequence",resolve:mx,construct:xx}),yx=Object.prototype.toString;function bx(n){if(n===null)return!0;var e,t,r,a,i,s=n;for(i=new Array(s.length),e=0,t=s.length;e<t;e+=1){if(r=s[e],yx.call(r)!=="[object Object]"||(a=Object.keys(r),a.length!==1))return!1;i[e]=[a[0],r[a[0]]]}return!0}function vx(n){if(n===null)return[];var e,t,r,a,i,s=n;for(i=new Array(s.length),e=0,t=s.length;e<t;e+=1)r=s[e],a=Object.keys(r),i[e]=[a[0],r[a[0]]];return i}var _x=new Fe("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:bx,construct:vx}),wx=Object.prototype.hasOwnProperty;function Ax(n){if(n===null)return!0;var e,t=n;for(e in t)if(wx.call(t,e)&&t[e]!==null)return!1;return!0}function Ex(n){return n!==null?n:{}}var Cx=new Fe("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ax,construct:Ex});tx.extend({implicit:[ix,ox],explicit:[dx,gx,_x,Cx]});function sl(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"Â":n===95?"Â ":n===76?"\u2028":n===80?"\u2029":""}for(var Px=new Array(256),kx=new Array(256),rr=0;rr<256;rr++)Px[rr]=sl(rr)?1:0,kx[rr]=sl(rr);function Ix(n){return{name:n.name,description:n.description,parameters:lm(n.schema)}}class Dr extends Ps{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=Dr._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===Dr.prototype._streamResponseChunks)yield this.invoke(e,t);else{const a=Dr._convertInputToPromptValue(e).toChatMessages(),[i,s]=this._separateRunnableConfigFromCallOptions(t),o=await De.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s)},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[a],void 0,void 0,c));let l;try{for await(const m of this._streamResponseChunks(a,s,u==null?void 0:u[0]))yield m.message,l?l=l.concat(m):l=m}catch(m){throw await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMError(m))),m}await Promise.all((u??[]).map(m=>m==null?void 0:m.handleLLMEnd({generations:[[l]]})))}}async generate(e,t,r){var A;let a;Array.isArray(t)?a={stop:t}:a=t;const i=e.map(f=>f.map(la)),[s,o]=this._separateRunnableConfigFromCallOptions(a),c=await De.configure(s.callbacks??r,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(a)},l=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),i,void 0,void 0,u)),m=await Promise.allSettled(i.map((f,P)=>this._generate(f,{...o,promptIndex:P},l==null?void 0:l[P]))),h=[],y=[];await Promise.all(m.map(async(f,P)=>{var b,g;if(f.status==="fulfilled"){const v=f.value;return h[P]=v.generations,y[P]=v.llmOutput,(b=l==null?void 0:l[P])==null?void 0:b.handleLLMEnd({generations:[v.generations],llmOutput:v.llmOutput})}else return await((g=l==null?void 0:l[P])==null?void 0:g.handleLLMError(f.reason)),Promise.reject(f.reason)}));const p={generations:h,llmOutput:y.length?(A=this._combineLLMOutput)==null?void 0:A.call(this,...y):void 0};return Object.defineProperty(p,bs,{value:l?{runIds:l==null?void 0:l.map(f=>f.runId)}:void 0,configurable:!0}),p}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const a=e.map(i=>i.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(la)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const a=new dt(e);return(await this.call([a],t,r)).content}}function Sx(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&console.warn(`Unknown message role: ${n.role}`),n.role}function Ys(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":{if(!ca.isInstance(n))throw new Error("Invalid generic chat message");return Sx(n)}default:throw new Error(`Unknown message type: ${e}`)}}function Ox(n){switch(n.role){case"user":return new dt(n.content||"");case"assistant":return new Tt(n.content||"",{function_call:n.function_call});case"system":return new vs(n.content||"");default:return new ca(n.content||"",n.role??"unknown")}}function Bx(n,e){const t=n.role??e,r=n.content??"";let a;return n.function_call?a={function_call:n.function_call}:a={},t==="user"?new ia({content:r}):t==="assistant"?new sa({content:r,additional_kwargs:a}):t==="system"?new oa({content:r}):t==="function"?new ua({content:r,additional_kwargs:a,name:n.name}):new ha({content:r,role:t})}class Tx extends Dr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,a,i,s,o,c,u,l;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??ne("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??ne("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??ne("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??ne("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??ne("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??ne("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??ne("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((a=e==null?void 0:e.configuration)==null?void 0:a.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=t==null?void 0:t.baseOptions)==null?void 0:i.headers)??((o=(s=e==null?void 0:e.configuration)==null?void 0:s.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,functions:(e==null?void 0:e.functions)??(e!=null&&e.tools?e==null?void 0:e.tools.map(Ix):void 0),function_call:e==null?void 0:e.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c;const a=e.map(u=>({role:Ys(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call})),i={...this.invocationParams(t),messages:a,stream:!0};let s;const o=await this.completionWithRetry(i,t);for await(const u of o){const l=u==null?void 0:u.choices[0];if(!l)continue;const{delta:m}=l,h=Bx(m,s);s=m.role??s;const y={prompt:t.promptIndex??0,completion:l.index??0},p=new _s({message:h,text:h.content,generationInfo:y});yield p,r==null||r.handleLLMNewToken(p.text??"",y,void 0,void 0,void 0,{chunk:p})}if((c=t.signal)!=null&&c.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,c;const a={},i=this.invocationParams(t),s=e.map(u=>({role:Ys(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call}));if(i.stream){const u=await this._streamResponseChunks(e,t,r),l={};for await(const h of u){const y=((o=h.generationInfo)==null?void 0:o.completion)??0;l[y]===void 0?l[y]=h:l[y]=l[y].concat(h)}return{generations:Object.entries(l).sort(([h],[y])=>parseInt(h,10)-parseInt(y,10)).map(([h,y])=>y)}}else{const u=await this.completionWithRetry({...i,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:l,prompt_tokens:m,total_tokens:h}=(u==null?void 0:u.usage)??{};l&&(a.completionTokens=(a.completionTokens??0)+l),m&&(a.promptTokens=(a.promptTokens??0)+m),h&&(a.totalTokens=(a.totalTokens??0)+h);const y=[];for(const p of(u==null?void 0:u.choices)??[]){const f={text:((c=p.message)==null?void 0:c.content)??"",message:Ox(p.message??{role:"assistant"})};p.finish_reason&&(f.generationInfo={finish_reason:p.finish_reason}),y.push(f)}return{generations:y,llmOutput:{tokenUsage:a}}}}async getNumTokensFromMessages(e){let t=0,r=0,a=0;vr(this.modelName)==="gpt-3.5-turbo"?(r=4,a=-1):vr(this.modelName).startsWith("gpt-4")&&(r=3,a=1);const i=await Promise.all(e.map(async s=>{const o=await this.getNumTokens(s.content),c=await this.getNumTokens(Ys(s)),u=s.name!==void 0?a+await this.getNumTokens(s.name):0,l=o+r+c+u;return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw aa(a)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=na(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new we(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}const Dx=Object.freeze(Object.defineProperty({__proto__:null,ChatOpenAI:Tx},Symbol.toStringTag,{value:"Module"})),Rx=`Write a concise summary of the following content from a webpage:


"{text}"


CONCISE SUMMARY:`,Fx=new ge({template:Rx,inputVariables:["text"]}),Oa=n=>`embed-${n}`,Ba=n=>`chatlog-${n||""}`,nr="pageInfo",ol="chat_history";let Xs;Xs=chrome.storage;const ul=async()=>{const n=await Xs.local.get("key");return n?n.key:null},Nx=async n=>{await Xs.local.set({key:n})};class Js{constructor(e){Ee(this,"storage");Ee(this,"key");Ee(this,"openai");Ee(this,"vectorStore");Ee(this,"chain");Ee(this,"sumChain");Ee(this,"memory");Ee(this,"targetLinkHash",null);let t;e?t=chrome.storage:t=new Jd,this.storage=t}async init(e){this.key!==e&&(this.key=e,await this.initOpenAI())}async info(){return{quota:this.storage.local.QUOTA_BYTES,size:await this.storage.local.getBytesInUse()}}async search(e,t,r){var a;return await((a=this.vectorStore)==null?void 0:a.similaritySearchWithScore(e,t,r))}async query(e){var a;const t=await((a=this.chain)==null?void 0:a.call({question:e}));return(t==null?void 0:t.text)||""}async initOpenAI(e){let t=e?ht.md5(e):null;const r=new Wd({openAIApiKey:this.key}),a=new Lc({openAIApiKey:this.key});this.vectorStore=new ys(r);let i=this.vectorStore.asRetriever();t?(this.targetLinkHash=t,i=this.vectorStore.asRetriever({filter:o=>o.metadata.linkHash===t})):this.targetLinkHash=null,this.memory=await this.loadChatHistory(),await this.loadMemoryVectorStore();const s=Ts.fromLLM(a,i,{memory:this.memory});this.chain=s,this.sumChain=hp(a,{type:"map_reduce",combinePrompt:Fx})}async getChatLogByKey(e){let t=[];const r=await this.storage.local.get(e);return r&&r[e]&&(t=r[e]),t}async getChatLog(e){const t=Ba(e?ht.md5(e):null);return await this.getChatLogByKey(t)}async addChatLog(e,t){const r=await this.getChatLog(t);r.push(e);const a=Ba(t?ht.md5(t):null);await this.storage.local.set({[a]:r})}async getPageList(e){let t={};const a=(await this.storage.local.get(nr))[nr]||{};let i=[];if(e){const s=ht.md5(e),o=a[s];o&&i.push(o)}else i=Object.values(a);for(let s=0;s<i.length;s++){const o=i[s],c=Oa(o.linkHash),u=await this.storage.local.getBytesInUse(c);t[o.linkHash]={...o,size:u}}return t}async summary(e){var r;const t=await((r=this.sumChain)==null?void 0:r.call({input_documents:e}));return(t==null?void 0:t.text)||""}async addPage(e,t,r){const a=ht.md5(e),i={link:e,linkHash:a,title:t},s=await ht.text2docs(r),o=await this.content2Vectors(i,s);o.length>0&&this.addVectorData(o);const c=await this.summary(s.slice(0,2)),u={link:e,linkHash:a,title:t,summary:c,ts:ht.currTs()},m=(await this.storage.local.get(nr))[nr]||{};m[a]=u,await this.storage.local.set({[nr]:m});const h=Oa(a);return await this.storage.local.set({[h]:o}),c}async delPage(e){if(!e)return;const t=ht.md5(e),r=await this.getPageList();delete r[t],await this.storage.local.set({[nr]:r}),await this.storage.local.remove(Oa(t)),await this.storage.local.remove(Ba(t))}async text2Vector(e){return this.vectorStore?this.vectorStore.embeddings.embedQuery(e):void 0}async content2Vectors(e,t){const r=[];for(let a=0;a<t.length;a++){const i=t[a],s=await this.text2Vector(i.pageContent);if(s){const o={embedding:s,content:i.pageContent,metadata:e};r.push(o)}}return r}async addVectorData(e){const t=this.vectorStore;t&&t.addVectors(e.map(r=>r.embedding),e.map(r=>({pageContent:r.content,metadata:r.metadata})))}async loadMemoryVectorStore(){if(!this.vectorStore)return;const t=await this.getPageList(),r=Object.values(t);for(let a=0;a<r.length;a++){const s=r[a].linkHash;if(!s||this.targetLinkHash&&this.targetLinkHash!==s)continue;const o=Oa(s),c=await this.storage.local.get(o);if(!c[o])continue;const u=c[o];this.addVectorData(u)}}async loadChatHistory(){let e=new Mc({memoryKey:ol});const t=Ba(this.targetLinkHash),a=(await this.getChatLogByKey(t)).map(i=>i.isBot?new Tt(i.msg):new dt(i.msg));return e=new Mc({memoryKey:ol,chatHistory:new zc(a)}),e}}let Rr,Lt;const cl=async n=>{Rr=new Js(!0),await Rr.init(n),await Rr.initOpenAI(),Lt=new Js(!1),await Lt.init(n)},jx=async()=>{const n=Lt.key;n&&(Lt=new Js(!1),await Lt.init(n))},Lx=async n=>{let e=n.temp?Lt:Rr;if(!e){const t=await ul();t&&(cl(t),e=n.temp?Lt:Rr)}return e},$x=(n,e,t)=>{console.log(`[${n}]`);for(let r in e)console.log(`  ->${r}: ${e[r]}`);for(let r in t)console.log(`  <-${r}: ${t[r]}`)},zx=async n=>{let e={ok:!1};if(n.type==="setKey")await ht.testOpenAIKey(n.key)&&(await cl(n.key),await Nx(n.key),e.ok=!0);else{const t=await Lx(n);if(t)switch(n.type){case"chat":t?(e.ok=!0,e.msg=await t.query(n.query)):e.error="asst not ready";break;case"getChatLog":const r=await t.getChatLog(n.link);e.ok=!0,e.data=r;break;case"addChatLog":await t.addChatLog(n.log,n.link),e.ok=!0;break;case"getKey":const a=await ul();e.ok=!!a,e.data=a;break;case"handshake":e.ok=!!t;break;case"addPage":n.temp&&await jx();const i=await t.addPage(n.link,n.title,n.content);e.ok=!0,e.summary=i;break;case"delPage":await t.delPage(n.link),e.ok=!0;break;case"setScope":await t.initOpenAI(n.scope),e.ok=!0;break;case"getPageList":const s=await t.getPageList(n.link);e.ok=!0,e.data=s;break;case"log":console.log("[LOG] ",n),e.ok=!0;break;case"info":const o=await t.info();e.ok=!0,e.data=o;break}else e.error="asst not ready"}return e},Mx=async(n,e,t)=>{let r={ok:!1};try{r=await zx(n)}catch(a){r.error=a.toString()}$x(n.type,n,r),t(r)};(async()=>{chrome.runtime.onMessage.addListener((n,e,t)=>(Mx(n,e,t),!0))})()});
